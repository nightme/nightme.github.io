<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Array对象</title>
    <url>/2016/01/05/Array%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="基本描述"><a href="#基本描述" class="headerlink" title="基本描述"></a>基本描述</h2><p>Array时javaScript的内置对象，同时也是一个构造函数。用它可以创建数组。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];    // 返回：[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line">new Array(<span class="string">&#x27;abc&#x27;</span>);           // 返回：[<span class="string">&quot;abc&quot;</span>]</span><br><span class="line">new Array([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])    // 返回：Array[3]</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="Array对象属性"><a href="#Array对象属性" class="headerlink" title="Array对象属性"></a>Array对象属性</h2><img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_1.png" class="" title="Array对象属性">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = new Array();</span><br><span class="line"></span><br><span class="line">arr.constructor              // 返回：<span class="keyword">function</span> <span class="function"><span class="title">Array</span></span>() &#123; [native code] &#125;</span><br><span class="line">arr.constructor == Array     // 返回：<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="静态方法isArray"><a href="#静态方法isArray" class="headerlink" title="静态方法isArray"></a>静态方法isArray</h2><p>Array.isArray() 方法用来判断某个值是否为数组。如果是，则返回 true，否则返回 false。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">Array.isArray(arr);         // 返回：<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">//兼容老浏览器如：IE 8及以前版本，代码运行之前添加以下代码</span><br><span class="line"><span class="keyword">if</span> (!Array.isArray) &#123;</span><br><span class="line">  Array.isArray = <span class="keyword">function</span>(arg) &#123;</span><br><span class="line">    <span class="built_in">return</span> Object.prototype.toString.call(arg) === <span class="string">&#x27;[object Array]&#x27;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ECMAScript3的函数方法"><a href="#ECMAScript3的函数方法" class="headerlink" title="ECMAScript3的函数方法"></a>ECMAScript3的函数方法</h2><p>ECMAScript3在Array.prototype中定义了一些函数，这些函数作为任何数组的方法都是可用的。</p>
<img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_2.png" class="" title="Array对象方法">

<h3 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h3><p>join() 方法将数组中的所有元素连接成一个字符串。<br>参数：可选，用于指定连接每个数组元素的分隔符，默认逗号。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var a = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">a.join();             // 返回：<span class="string">&quot;a,b,c&quot;</span></span><br><span class="line">a.join(<span class="string">&#x27;-&#x27;</span>);          // 返回：<span class="string">&quot;a-b-c&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="push-和pop"><a href="#push-和pop" class="headerlink" title="push()和pop()"></a>push()和pop()</h3><p>push方法用于在数组的末端添加一个或多个元素，并返回添加后的数组的长度。<br>pop方法用于删除数组的最后一个元素，并返回该元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">arr.push(<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>);  // 返回：6</span><br><span class="line"></span><br><span class="line">arr.pop();              // 返回：<span class="string">&quot;c&quot;</span></span><br><span class="line">[].pop();               // 返回：undefined</span><br></pre></td></tr></table></figure>

<h3 id="reverse"><a href="#reverse" class="headerlink" title="reverse()"></a>reverse()</h3><p>reverse方法用于颠倒数组中元素的顺序,返回改变后的原数组</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">arr.reverse();      // 返回：[<span class="string">&quot;c&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h3><p>将传入的数组或非数组值与原数组合并,组成一个新的数组并返回<br>语法：array.concat(value1, value2, …, valueN)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">arr.concat(<span class="string">&#x27;e&#x27;</span>,[<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>]);      返回：[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;g&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="shift-和unshift"><a href="#shift-和unshift" class="headerlink" title="shift()和unshift()"></a>shift()和unshift()</h3><p>shift方法用于删除数组的第一个元素，并返回该元素。<br>unshift方法用于在数组的第一个位置添加元素，并返回添加新元素后的数组长度</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">arr.shift();        // 返回：<span class="string">&quot;a&quot;</span></span><br><span class="line"></span><br><span class="line">arr.unshift(<span class="string">&#x27;-a&#x27;</span>,<span class="string">&#x27;-b&#x27;</span>); // 返回：5; arr is [<span class="string">&quot;-a&quot;</span>, <span class="string">&quot;-b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="slice-和splice"><a href="#slice-和splice" class="headerlink" title="slice()和splice()"></a>slice()和splice()</h3><p>slice方法用于提取原数组的一部分，返回一个新数组。<br>语法：array.slice(begin [,end])<br>参数：begin,索引处开始，省略，则默认0； end,索引处结束，省略，则取到数组末尾</p>
<p>splice方法用于删除原数组的一部分成员，并可以在被删除的位置添加入新的数组成员。它的返回值是被删除的元素<br>语法：array.splice(start, deleteCount[, item1[, item2[, …]]])<br>参数：start索引处开始，超出了数组的长度，则从数组末尾开始，如是负值，则表示从数组末位开始的第几位；deleteCount，整数，移除的数组元素的个数，deleteCount大于start之后的元素的总数，则从 start 后面的元素都将被删除（含第 start 位）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">//数组未改变</span><br><span class="line">arr.slice();                    // 返回：[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line">arr.slice(0,1);                 // 返回：[<span class="string">&quot;a&quot;</span>]</span><br><span class="line"></span><br><span class="line">//数组已改变</span><br><span class="line">arr.splice(0,1)                 // 返回：[<span class="string">&quot;a&quot;</span>]</span><br><span class="line">arr.splice(0,2,<span class="string">&#x27;-a&#x27;</span>,<span class="string">&#x27;-b&#x27;</span>);      // 返回：[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>]；arr is [<span class="string">&quot;-a&quot;</span>, <span class="string">&quot;-b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="sort-方法"><a href="#sort-方法" class="headerlink" title="sort()方法"></a>sort()方法</h3><p>sort默认按照字典顺序排序，原数组将被改变。<br>语法：arr.sort([compareFunction])<br>参数：可选。用来指定按某种顺序进行排列的函数。如果省略，元素按照字典顺序进行排序。<br>补充： compareFunction(a, b)，小于0，那么a会被排列到b之前；等于 0，a 和 b 的相对位置不变；大于0， b会被排列到a之前</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//Eg1:</span><br><span class="line">var arr = [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">arr.sort()               // 返回：[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]</span><br><span class="line"></span><br><span class="line">//Eg2:</span><br><span class="line">var arr = [</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪1&#x27;</span>,money:500&#125;,</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪2&#x27;</span>,money:1000&#125;,</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪3&#x27;</span>,money:500&#125;,</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪4&#x27;</span>,money:1&#125;</span><br><span class="line">]</span><br><span class="line">arr.sort(<span class="keyword">function</span>(a,b)&#123;</span><br><span class="line">  <span class="keyword">if</span>(a.money &gt; b.money )&#123; <span class="built_in">return</span> 1;&#125;</span><br><span class="line">  <span class="keyword">if</span>(a.money &lt; b.money )&#123; <span class="built_in">return</span> -1;&#125;</span><br><span class="line">  <span class="built_in">return</span> 0;</span><br><span class="line">&#125;);</span><br><span class="line">排序结果arr是这样的：</span><br><span class="line">var arr = [</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪4&#x27;</span>,money:1&#125;</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪1&#x27;</span>,money:500&#125;,</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪3&#x27;</span>,money:500&#125;,</span><br><span class="line">  &#123;name:<span class="string">&#x27;土豪2&#x27;</span>,money:1000&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="toString-和toLocaleString"><a href="#toString-和toLocaleString" class="headerlink" title="toString()和toLocaleString()"></a>toString()和toLocaleString()</h3><p>toString 把数组转换为字符串，并返回结果。<br>toLocaleString把数组转换为本地数组，并返回结果。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">arr.toString();         // 返回：<span class="string">&quot;a,b,c&quot;</span></span><br><span class="line">arr.toLocaleString();   // 返回：<span class="string">&quot;a,b,c&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="ECMAScript5中的数组方法"><a href="#ECMAScript5中的数组方法" class="headerlink" title="ECMAScript5中的数组方法"></a>ECMAScript5中的数组方法</h2><p>ECMAScript 5 定义了9个新的数组方法，分别是map、forEach、filter、every、some、reduce、reduceRight、indexOf和lastIndexOf；<br>这些方法可在数组、字符串、类数组上使用；<br>参数：(callback[, thisArg])<br>callback:currentValue当前项（指遍历时正在被处理那个数组项）的值;index当前项的索引（或下标）;array数组本身。<br>thisArg：可选参数，用来当作callback 函数内this的值的对象</p>
<h3 id="forEach方法"><a href="#forEach方法" class="headerlink" title="forEach方法"></a>forEach方法</h3><p>forEach() 方法让数组的每一项都执行一次给定的函数。<br>语法：array.forEach(callback[, thisArg])</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var arr = [],</span><br><span class="line">    num = [1,2,3,4,5];</span><br><span class="line">num.forEach(<span class="keyword">function</span>(currentValue)&#123;</span><br><span class="line">  arr.push(currentValue+1);</span><br><span class="line">&#125;,arr);</span><br><span class="line"></span><br><span class="line">arr is : [2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure>

<h3 id="map方法"><a href="#map方法" class="headerlink" title="map方法"></a>map方法</h3><p>map方法对数组的所有成员依次调用一个函数，根据函数结果返回一个新数组。<br>语法：array.map(callback[, thisArg])</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.map(<span class="keyword">function</span>(currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> currentValue+1;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">结果：[2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure>

<h3 id="filter方法"><a href="#filter方法" class="headerlink" title="filter方法"></a>filter方法</h3><p>语法：arr.filter(callback[, thisArg])</p>
<p>filter() 方法使用指定的函数测试所有元素，并创建一个包含所有通过测试的元素的新数组<br>语法：arr.filter(callback[, thisArg])</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.filter(<span class="keyword">function</span>(currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> currentValue % 2 == 0;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">结果：[2, 4]</span><br></pre></td></tr></table></figure>

<h3 id="every和some方法"><a href="#every和some方法" class="headerlink" title="every和some方法"></a>every和some方法</h3><p>every() 方法测试数组的所有元素是否都通过了指定函数的测试。所有通过返回true，否则false<br>语法：arr.every(callback[, thisArg])</p>
<p>some() 方法测试数组中的某些元素是否通过了指定函数的测试。一有通过就返回true,否则false<br>语法：arr.some(callback[, thisArg])</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.every(<span class="keyword">function</span>(currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> currentValue&gt;4;</span><br><span class="line">&#125;)</span><br><span class="line">结果：fasle;</span><br><span class="line"></span><br><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.some(<span class="keyword">function</span>(currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> currentValue&gt;4;</span><br><span class="line">&#125;)</span><br><span class="line">结果:<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="reduce和reduceRight方法"><a href="#reduce和reduceRight方法" class="headerlink" title="reduce和reduceRight方法"></a>reduce和reduceRight方法</h3><p>reduce方法和reduceRight方法的作用，是依次处理数组的每个元素，最终累计为一个值，reduce对数组元素的处理顺序是从左到右，reduceRight则是从右到左。<br>语法：arr.reduce(callback,[initialValue])<br>callback参数有：<br>previousValue：上一次调用回调返回的值，或者是提供的初始值（initialValue）<br>currentValue：数组中当前被处理的元素<br>index：下标<br>array：调用 reduce 的数组<br>initialValue：作为第一次调用 callback 的第一个参数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.reduce(<span class="keyword">function</span>(previousValue,currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> previousValue + currentValue;</span><br><span class="line">&#125;);</span><br><span class="line">结果是：15</span><br><span class="line"></span><br><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.reduce(<span class="keyword">function</span>(previousValue,currentValue)&#123;</span><br><span class="line">  <span class="built_in">return</span> previousValue + currentValue;</span><br><span class="line">&#125;,10)</span><br><span class="line">结果是：25</span><br></pre></td></tr></table></figure>

<h3 id="indexOf和lastIndexOf方法"><a href="#indexOf和lastIndexOf方法" class="headerlink" title="indexOf和lastIndexOf方法"></a>indexOf和lastIndexOf方法</h3><p>indexOf返回给定元素在数组中第一次出现的下标，如果没有出现则返回-1<br>语法：arr.indexOf(searchElement[, fromIndex &#x3D; 0])</p>
<p>lastIndexOf返回给定元素在数组中最后一次出现的下标，如果没有出现则返回-1，从数组的后面向前查找，从 fromIndex 处开始<br>语法：arr.lastIndexOf(searchElement[, fromIndex &#x3D; arr.length - 1])</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var num = [1,2,3,4,5];</span><br><span class="line">num.indexOf(3,1)            // 返回：2</span><br><span class="line">num.lastIndexOf(3,4)        // 返回：2</span><br></pre></td></tr></table></figure>

<h2 id="兼容旧环境-Polyfill"><a href="#兼容旧环境-Polyfill" class="headerlink" title="兼容旧环境(Polyfill)"></a>兼容旧环境(Polyfill)</h2><p>ECMAScript 5这些方法，一些旧浏览器不支持，主要是IE 8及以前版本，我们就要在使用之前对它进行处理，然而Mozilla网络开发者(Mozilla Developer Network,简称MDN)就对此进行了处理：</p>
<h3 id="兼容forEach"><a href="#兼容forEach" class="headerlink" title="兼容forEach"></a>兼容forEach</h3><p>这是我对MDN的forEach方法，加的一点注释。并保留了原来的英文注释。</p>
<p><strong>看着似乎有点长，但是把注释去掉只有几行代码</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.forEach) &#123;</span><br><span class="line"></span><br><span class="line">    Array.prototype.forEach = <span class="keyword">function</span> forEach(callback, thisArg) &#123;</span><br><span class="line">        var T, k;</span><br><span class="line">        <span class="keyword">if</span> (this == null) &#123;</span><br><span class="line">            throw new TypeError(<span class="string">&quot;this is null or not defined&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 1. Let O be the result of calling ToObject passing the |this| value as the argument.</span><br><span class="line">        // 将当前this对象作为参数传递给Obejct对象，返回一个与给定值对应类型的对象。该对象包装了给定的参数。</span><br><span class="line">        var O = Object(this);</span><br><span class="line"></span><br><span class="line">        // 2. Let lenValue be the result of calling the Get internal method of O with the argument <span class="string">&quot;length&quot;</span>.</span><br><span class="line">        // 3. Let len be ToUint32(lenValue).</span><br><span class="line">        // 进行无符号位移运算符，将所有非数值转换成0，所有大于等于0数取整数部分，并赋值变量len</span><br><span class="line">        var len = O.length &gt;&gt;&gt; 0;</span><br><span class="line"></span><br><span class="line">        // 4. If IsCallable(callback) is <span class="literal">false</span>, throw a TypeError exception.</span><br><span class="line">        // See: http://es5.github.com/<span class="comment">#x9.11</span></span><br><span class="line">        <span class="keyword">if</span> (typeof callback !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            throw new TypeError(callback + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 5. If thisArg was supplied, <span class="built_in">let</span> T be thisArg; <span class="keyword">else</span> <span class="built_in">let</span> T be undefined.</span><br><span class="line">        // 检查arguments对象是否有第二个参数，如果有则进行操作。</span><br><span class="line">        <span class="keyword">if</span> (arguments.length &gt; 1) &#123;</span><br><span class="line">            T = thisArg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 6. Let k be 0</span><br><span class="line">        k = 0;</span><br><span class="line"></span><br><span class="line">        // 7. Repeat, <span class="keyword">while</span> k &lt; len</span><br><span class="line">        // 循环每一项,调用指定函数</span><br><span class="line">        <span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line"></span><br><span class="line">            var kValue;</span><br><span class="line"></span><br><span class="line">            // a. Let Pk be ToString(k).</span><br><span class="line">            //   This is implicit <span class="keyword">for</span> LHS operands of the <span class="keyword">in</span> operator</span><br><span class="line">            // b. Let kPresent be the result of calling the HasProperty internal method of O with argument Pk.</span><br><span class="line">            //   This step can be combined with c</span><br><span class="line">            // c. If kPresent is <span class="literal">true</span>, <span class="keyword">then</span></span><br><span class="line">            /*</span><br><span class="line">             * a. <span class="keyword">in</span>运算符希望它的左操作数是一个字符串或可以转换为字符串；</span><br><span class="line">             *    希望他的右操作数是一个对象；</span><br><span class="line">             *    如果右侧对象拥有一个名为左操作数值的属性名，那么表达式返回<span class="literal">true</span></span><br><span class="line">             * b. 对于数组属性需要指定数字形式的索引值来表示数组的属性名称（固有属性除外，如length）</span><br><span class="line">             * var arr =[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">             * 0 <span class="keyword">in</span> arr; =&gt; 返回：<span class="literal">true</span></span><br><span class="line">             * 3 <span class="keyword">in</span> arr; =&gt; 返回：<span class="literal">false</span></span><br><span class="line">             */</span><br><span class="line">            <span class="keyword">if</span> (k <span class="keyword">in</span> O) &#123;</span><br><span class="line"></span><br><span class="line">                // i. Let kValue be the result of calling the Get internal method of O with argument Pk.</span><br><span class="line">                // 获取值对应赋给给变量kValue</span><br><span class="line">                kValue = O[k];</span><br><span class="line"></span><br><span class="line">                // ii. Call the Call internal method of callback with T as the this value and</span><br><span class="line">                // argument list containing kValue, k, and O.</span><br><span class="line">                // 使用call方法，T(传进的对象),kValue(当前值),k(索引),O(理解为使用的数组)</span><br><span class="line">                callback.call(T, kValue, k, O);</span><br><span class="line">            &#125;</span><br><span class="line">            // d. Increase k by 1.</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        // 8. <span class="built_in">return</span> undefined</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容map"><a href="#兼容map" class="headerlink" title="兼容map"></a>兼容map</h3><p>MDN上已经有中文注释了，很好理解</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.map) &#123;</span><br><span class="line">    Array.prototype.map = <span class="keyword">function</span>(callback, thisArg) &#123;</span><br><span class="line"></span><br><span class="line">        var T, A, k;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (this == null) &#123;</span><br><span class="line">            throw new TypeError(<span class="string">&quot; this is null or not defined&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 1. 将O赋值为调用map方法的数组.</span><br><span class="line">        var O = Object(this);</span><br><span class="line"></span><br><span class="line">        // 2.将len赋值为数组O的长度.</span><br><span class="line">        var len = O.length &gt;&gt;&gt; 0;</span><br><span class="line"></span><br><span class="line">        // 3.如果callback不是函数,则抛出TypeError异常.</span><br><span class="line">        <span class="keyword">if</span> (Object.prototype.toString.call(callback) != <span class="string">&quot;[object Function]&quot;</span>) &#123;</span><br><span class="line">            throw new TypeError(callback + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 4. 如果参数thisArg有值,则将T赋值为thisArg;否则T为undefined.</span><br><span class="line">        <span class="keyword">if</span> (thisArg) &#123;</span><br><span class="line">            T = thisArg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 5. 创建新数组A,长度为原数组O长度len</span><br><span class="line">        A = new Array(len);</span><br><span class="line"></span><br><span class="line">        // 6. 将k赋值为0</span><br><span class="line">        k = 0;</span><br><span class="line"></span><br><span class="line">        // 7. 当 k &lt; len 时,执行循环.</span><br><span class="line">        <span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line"></span><br><span class="line">            var kValue, mappedValue;</span><br><span class="line"></span><br><span class="line">            //遍历O,k为原数组索引</span><br><span class="line">            <span class="keyword">if</span> (k <span class="keyword">in</span> O) &#123;</span><br><span class="line"></span><br><span class="line">                //kValue为索引k对应的值.</span><br><span class="line">                kValue = O[k];</span><br><span class="line"></span><br><span class="line">                // 执行callback,this指向T,参数有三个.分别是kValue:值,k:索引,O:原数组.</span><br><span class="line">                mappedValue = callback.call(T, kValue, k, O);</span><br><span class="line"></span><br><span class="line">                // 返回值添加到新数组A中.</span><br><span class="line">                A[k] = mappedValue;</span><br><span class="line">            &#125;</span><br><span class="line">            // k自增1</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 8. 返回新数组A</span><br><span class="line">        <span class="built_in">return</span> A;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容filter"><a href="#兼容filter" class="headerlink" title="兼容filter"></a>兼容filter</h3><p>方法中的void 0：</p>
<ol>
<li>void 0 &#x3D;&#x3D;&#x3D; undefined &#x3D;&gt; 返回：true</li>
<li>undefined在JavaScript中并不属于保留字&#x2F;关键字</li>
<li>undefined在IE5.5~8中可将当变量赋值(IE9+及其他现代浏览器中赋值给undefined将无效)</li>
<li>无论void后的运算数是什么，只返回纯正的undefined</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.filter) &#123;</span><br><span class="line">    Array.prototype.filter = <span class="keyword">function</span>(fun /*, thisArg */ ) &#123;</span><br><span class="line">        <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (this === void 0 || this === null)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var t = Object(this);</span><br><span class="line">        var len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">        <span class="keyword">if</span> (typeof fun !== <span class="string">&quot;function&quot;</span>)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var res = [];</span><br><span class="line">        var thisArg = arguments.length &gt;= 2 ? arguments[1] : void 0;</span><br><span class="line">        <span class="keyword">for</span> (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">in</span> t) &#123;</span><br><span class="line">                var val = t[i];</span><br><span class="line"></span><br><span class="line">                // NOTE: Technically this should Object.defineProperty at</span><br><span class="line">                //       the next index, as push can be affected by</span><br><span class="line">                //       properties on Object.prototype and Array.prototype.</span><br><span class="line">                //       But that method<span class="string">&#x27;s new, and collisions should be</span></span><br><span class="line"><span class="string">                //       rare, so use the more-compatible alternative.</span></span><br><span class="line"><span class="string">                if (fun.call(thisArg, val, i, t))</span></span><br><span class="line"><span class="string">                    res.push(val);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return res;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="兼容reduce"><a href="#兼容reduce" class="headerlink" title="兼容reduce"></a>兼容reduce</h3><p>hasOwnProperty：是用来判断一个对象是否有你给出名称的属性或对象。不过需要注意的是，此方法无法检查该对象的原型链中是否具有该属性，该属性必须是对象本身的一个成员。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;function&#x27;</span> !== typeof Array.prototype.reduce) &#123;</span><br><span class="line">    Array.prototype.reduce = <span class="keyword">function</span>(callback, opt_initialValue) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (null === this || <span class="string">&#x27;undefined&#x27;</span> === typeof this) &#123;</span><br><span class="line">            // At the moment all modern browsers, that support strict mode, have</span><br><span class="line">            // native implementation of Array.prototype.reduce. For instance, IE8</span><br><span class="line">            // does not support strict mode, so this check is actually useless.</span><br><span class="line">            throw new TypeError(</span><br><span class="line">                <span class="string">&#x27;Array.prototype.reduce called on null or undefined&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;function&#x27;</span> !== typeof callback) &#123;</span><br><span class="line">            throw new TypeError(callback + <span class="string">&#x27; is not a function&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        var index, value,</span><br><span class="line">            length = this.length &gt;&gt;&gt; 0,</span><br><span class="line">            isValueSet = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (1 &lt; arguments.length) &#123;</span><br><span class="line">            value = opt_initialValue;</span><br><span class="line">            isValueSet = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (index = 0; length &gt; index; ++index) &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.hasOwnProperty(index)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isValueSet) &#123;</span><br><span class="line">                    value = callback(value, this[index], index, this);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    value = this[index];</span><br><span class="line">                    isValueSet = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!isValueSet) &#123;</span><br><span class="line">            throw new TypeError(<span class="string">&#x27;Reduce of empty array with no initial value&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容reduceRight"><a href="#兼容reduceRight" class="headerlink" title="兼容reduceRight"></a>兼容reduceRight</h3><p>与reduce的执行顺序相反，reduceRight则是从右到左。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;function&#x27;</span> !== typeof Array.prototype.reduceRight) &#123;</span><br><span class="line">    Array.prototype.reduceRight = <span class="keyword">function</span>(callback /*, initialValue*/ ) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (null === this || <span class="string">&#x27;undefined&#x27;</span> === typeof this) &#123;</span><br><span class="line">            throw new TypeError(</span><br><span class="line">                <span class="string">&#x27;Array.prototype.reduce called on null or undefined&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;function&#x27;</span> !== typeof callback) &#123;</span><br><span class="line">            throw new TypeError(callback + <span class="string">&#x27; is not a function&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        var t = Object(this),</span><br><span class="line">            len = t.length &gt;&gt;&gt; 0,</span><br><span class="line">            k = len - 1,</span><br><span class="line">            value;</span><br><span class="line">        <span class="keyword">if</span> (arguments.length &gt;= 2) &#123;</span><br><span class="line">            value = arguments[1];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (k &gt;= 0 &amp;&amp; !k <span class="keyword">in</span> t) k--;</span><br><span class="line">            <span class="keyword">if</span> (k &lt; 0)</span><br><span class="line">                throw new TypeError(<span class="string">&#x27;Reduce of empty array with no initial value&#x27;</span>);</span><br><span class="line">            value = t[k--];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (; k &gt;= 0; k--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k <span class="keyword">in</span> t) &#123;</span><br><span class="line">                value = callback(value, t[k], k, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容some"><a href="#兼容some" class="headerlink" title="兼容some"></a>兼容some</h3><p>some() 方法测试数组中的某些元素是否通过了指定函数的测试。一有通过就返回true,否则false</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.some) &#123;</span><br><span class="line">    Array.prototype.some = <span class="keyword">function</span>(fun /*, thisArg */ ) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (this === void 0 || this === null)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var t = Object(this);</span><br><span class="line">        var len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">        <span class="keyword">if</span> (typeof fun !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var thisArg = arguments.length &gt;= 2 ? arguments[1] : void 0;</span><br><span class="line">        <span class="keyword">for</span> (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">in</span> t &amp;&amp; fun.call(thisArg, t[i], i, t))</span><br><span class="line">                <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容every"><a href="#兼容every" class="headerlink" title="兼容every"></a>兼容every</h3><p>every() 方法测试数组的所有元素是否都通过了指定函数的测试。全部通过，返回true</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.every) &#123;</span><br><span class="line">    Array.prototype.every = <span class="keyword">function</span>(fun /*, thisArg */ ) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (this === void 0 || this === null)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var t = Object(this);</span><br><span class="line">        var len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">        <span class="keyword">if</span> (typeof fun !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">            throw new TypeError();</span><br><span class="line"></span><br><span class="line">        var thisArg = arguments.length &gt;= 2 ? arguments[1] : void 0;</span><br><span class="line">        <span class="keyword">for</span> (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">in</span> t &amp;&amp; !fun.call(thisArg, t[i], i, t))</span><br><span class="line">                <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容indexOf"><a href="#兼容indexOf" class="headerlink" title="兼容indexOf"></a>兼容indexOf</h3><p>indexOf()方法返回给定元素能找在数组中找到的第一个索引值，否则返回-1<br>语法：arr.indexOf(searchElement[, fromIndex &#x3D; 0])<br>MDN的注释已全部去掉</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.indexOf) &#123;</span><br><span class="line">    Array.prototype.indexOf = <span class="keyword">function</span>(searchElement, fromIndex) &#123;</span><br><span class="line">        var k;</span><br><span class="line">        <span class="keyword">if</span> (this == null) &#123;</span><br><span class="line">            throw new TypeError(<span class="string">&#x27;&quot;this&quot; is null or not defined&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        var O = Object(this);</span><br><span class="line">        var len = O.length &gt;&gt;&gt; 0;</span><br><span class="line">        <span class="keyword">if</span> (len === 0) &#123;</span><br><span class="line">            <span class="built_in">return</span> -1;</span><br><span class="line">        &#125;</span><br><span class="line">        var n = +fromIndex || 0;</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(n) === Infinity) &#123;</span><br><span class="line">            n = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n &gt;= len) &#123;</span><br><span class="line">            <span class="built_in">return</span> -1;</span><br><span class="line">        &#125;</span><br><span class="line">        k = Math.max(n &gt;= 0 ? n : len - Math.abs(n), 0);</span><br><span class="line">        <span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k <span class="keyword">in</span> O &amp;&amp; O[k] === searchElement) &#123;</span><br><span class="line">                <span class="built_in">return</span> k;</span><br><span class="line">            &#125;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兼容lastIndexOf"><a href="#兼容lastIndexOf" class="headerlink" title="兼容lastIndexOf"></a>兼容lastIndexOf</h3><p>从数组的后面向前查找，从 fromIndex 处开始<br>语法：arr.lastIndexOf(searchElement[, fromIndex &#x3D; arr.length - 1])</p>
<p>floor() 方法可对一个数进行下舍入 。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Array.prototype.lastIndexOf) &#123;</span><br><span class="line">    Array.prototype.lastIndexOf = <span class="keyword">function</span>(searchElement /*, fromIndex*/ ) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (this === void 0 || this === null) &#123;</span><br><span class="line">            throw new TypeError();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var n, k,</span><br><span class="line">            t = Object(this),</span><br><span class="line">            len = t.length &gt;&gt;&gt; 0;</span><br><span class="line">        <span class="keyword">if</span> (len === 0) &#123;</span><br><span class="line">            <span class="built_in">return</span> -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        n = len - 1;</span><br><span class="line">        <span class="keyword">if</span> (arguments.length &gt; 1) &#123;</span><br><span class="line">            n = Number(arguments[1]);</span><br><span class="line">            <span class="keyword">if</span> (n != n) &#123;</span><br><span class="line">                n = 0;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n != 0 &amp;&amp; n != (1 / 0) &amp;&amp; n != -(1 / 0)) &#123;</span><br><span class="line">                n = (n &gt; 0 || -1) * Math.floor(Math.abs(n));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (k = n &gt;= 0 ? Math.min(n, len - 1) : len - Math.abs(n); k &gt;= 0; k--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k <span class="keyword">in</span> t &amp;&amp; t[k] === searchElement) &#123;</span><br><span class="line">                <span class="built_in">return</span> k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ECMAScript5兼容"><a href="#ECMAScript5兼容" class="headerlink" title="ECMAScript5兼容"></a>ECMAScript5兼容</h2><p>ECMAScript3的方法我们可以放心的使用，不担心兼容问题，但是ECMAScript5就得考虑了，但是上面这么多我还得自己一个个弄，太麻烦了，于是前辈们就造了es5-shim.js库</p>
<img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_3.png" class="" title="es5-shim参考图">

<p>es5-shim里面通过测试的方法有：</p>
<img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_4.png" class="" title="方法">


<p>在使用新方法前引用它，就可以了。</p>
<h2 id="其他途径"><a href="#其他途径" class="headerlink" title="其他途径"></a>其他途径</h2><h3 id="1、jquery"><a href="#1、jquery" class="headerlink" title="1、jquery"></a>1、jquery</h3><p>jquery之强大，毋庸置疑，里面就有了这些方法。只要你引用了jquery，你就可以放心的使用。详情参考jquery API</p>
<h3 id="2、Underscore"><a href="#2、Underscore" class="headerlink" title="2、Underscore"></a>2、Underscore</h3><p>Underscore JavaScript 工具库，里面提供了100多个函数。</p>
<img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_5.png" class="" title="一部分函数">

<h3 id="3、lodash"><a href="#3、lodash" class="headerlink" title="3、lodash"></a>3、lodash</h3><p>lodash一个JavaScript工具库</p>
<img src="/2016/01/05/Array%E6%96%B9%E6%B3%95/arr_pic_6.png" class="" title="兼容性测试">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">MDN-array文档</a></li>
<li><a href="http://www.w3school.com.cn/js/js_obj_array.asp">JavaScript Array数组对象-w3school</a></li>
<li><a href="http://www.css88.com/doc/underscore/">Underscore-中文文档</a></li>
<li><a href="https://lodash.com/">lodash-文档</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>EDM制作</title>
    <url>/2015/10/19/EDM%E5%88%B6%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h2><p>EDM 是 Email Direct Marketing 的缩写，即电子邮件营销，简称为邮件营销，是利用电子邮件（Email）与受众客户进行商业交流的一种直销方式。下面是一张参考图：</p>
<img src="/2015/10/19/EDM%E5%88%B6%E4%BD%9C/jd_edm.jpg" class="" title="京东商城">
<span id="more"></span>

<h2 id="了解规范"><a href="#了解规范" class="headerlink" title="了解规范"></a>了解规范</h2><h3 id="邮件制作概述"><a href="#邮件制作概述" class="headerlink" title="邮件制作概述"></a>邮件制作概述</h3><p>邮件制作不同于其他的页面制作，所以有些规范您还是得考虑的。<br>这些限制并不是DMdelivery来决定的，而来自于艺术、网络礼仪的现状、技术交流和目标群体的各种邮件客户端。 如果您的邮件符合这些规范,将有利于您邮件对正确目标群体的受欢迎程度</p>
<h3 id="模板编码语言选择："><a href="#模板编码语言选择：" class="headerlink" title="模板编码语言选择："></a>模板编码语言选择：</h3><p>模板编码设定与使用的发送软件有关，一般来说，utf-8为较常用的选择，错误的编码会造成用户浏览的时候出现乱码；</p>
<h3 id="对于HTML格式邮件的要求："><a href="#对于HTML格式邮件的要求：" class="headerlink" title="对于HTML格式邮件的要求："></a>对于HTML格式邮件的要求：</h3><ul>
<li>包括空格在内，邮件标题的字符最好控制在35个字符。</li>
<li>文件大小(HTML和图片)最好控制在500KB以下。</li>
<li>电子邮件主流邮件的宽度为650px左右, 鉴于现的浏览器普遍偏大,可根据设计的显示效果自定义宽度,建议不要超过750像素</li>
<li>不推荐使用最新的HTML版本,因为目前常用的浏览器有些是不支持最新的HTML标签的,为了给用户更好的浏览效果,采用“老版本” HTML3.2、 HTM L4.0即可</li>
<li>不可将 word 类文件直接转换为 html 格式，否则会造成编码不规范。</li>
<li>如果需要邮件居中显示，请在 table 里设定 align&#x3D;”center”。</li>
<li>请使用 table 表格来布局。同一个 td 里只放一张图片，同一段文字放在同一 td 里。</li>
<li>若邮件模板内侧边或者上下有空白间距，不要用 padding，必须得用标准的 td 来设定空白间距，否则会导致各个邮箱解析不同。</li>
</ul>
<h3 id="不要使用div，使用最简单的嵌套table定位"><a href="#不要使用div，使用最简单的嵌套table定位" class="headerlink" title="不要使用div，使用最简单的嵌套table定位:"></a>不要使用div，使用最简单的嵌套table定位:</h3><p>Div+css是近几年新兴的web2.0定位方式，这种方式不适合在EDM邮件模板切割中使用，不同邮件客户端或在线浏览器对css模型解释不尽 相同，会造成错位或布局混乱等问题。同时也不要使用单一table重复多次colspan，可能会被邮件客户端判断为结构过于复杂，归类为垃圾邮件；同时 也容易被打乱布局而影响用户浏览。参考图：</p>
<img src="/2015/10/19/EDM%E5%88%B6%E4%BD%9C/table.png" class="" title="表格的使用">

<h3 id="图片样式与背景图片颜色使用"><a href="#图片样式与背景图片颜色使用" class="headerlink" title="图片样式与背景图片颜色使用:"></a>图片样式与背景图片颜色使用:</h3><ul>
<li>制作edm邮件模板尽量不要使用背景图片。背景图片在某些邮件客户端或或web界面中默认不显示</li>
<li>模板中每张图的地址都一定要用绝对地址，否则会不显示；</li>
<li>每张图都 要指定alt属性，可以在图片被拦截的时候显示图片的内容；</li>
<li>每张图都要指定width宽度、height高度，在图片被拦截的时候，不会因图片大小无法读 取而被打乱布局。</li>
<li>body中不要设定背景色，不然在转发邮件的时候，转发人写的信息背景色都会变为被转发邮件的背景色，影响浏览。如果一定要给邮件模板设 定整体背景色，请在模板文件最外面加一个table，设定此table的背景色。</li>
<li>在切割模板的时候，要注意限制图片的大小和数量，不要为了效果使图片过大，会使邮件接收者打开过于缓慢，甚至直接关闭邮件。更不要完全把模板切为图片形式，那样会在图片被拦截的时候使用户看不到内容，并且很可能会直接被邮件运营商或邮件客户端认定为垃圾邮件。</li>
</ul>
<h3 id="动画与互动元素的处理"><a href="#动画与互动元素的处理" class="headerlink" title="动画与互动元素的处理:"></a>动画与互动元素的处理:</h3><ul>
<li>可以使用简单的gif动画来表达某些需要明显突出的要素，但要控制gif文件的大小，不要影响整封EDM邮件的下载浏览速度；</li>
<li>不要使用不要使用Flash、 Java、 Javascript、 Frames,I-Frames、 ActiveX、 dynamic HTML等，前些年邮件病毒泛滥，大部分邮件运营商都已经屏蔽了这些元素。具体可以查看EDM营销存在的<a href="http://www.cnblogs.com/EDM-DATA/archive/2012/07/29/2614140.html">六大问题</a></li>
</ul>
<h3 id="css样式编写："><a href="#css样式编写：" class="headerlink" title="css样式编写："></a>css样式编写：</h3><p>制作edm邮件模板不要使用外部样式表引用，因为大部分的ISP会屏蔽css样式表，将样式表写入模板内部，如果模板有完全相同样式的列表型文本，可以吧样式表写在页面 内<style></style> 中引用，但缺点是在邮件转发过程中经过web编辑器或邮件客户端的编辑，<style></style>被去掉，导致此列表样式 变形。这种页面内引用的方式却能节省大量代码，使代码与内容比降低，同时也缩减了模板文件大小，有利于模板评分；可以如下设置样式：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;color:#ffffff;font-size:24px;font-family:Microsoft YaHei,MicrosoftJhengHei,Verdana, Geneva, sans-serif;&quot;</span>&gt;</span></span><br><span class="line">            致webpower中国区全体员工的新年祝福：</span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="模板html标签规则："><a href="#模板html标签规则：" class="headerlink" title="模板html标签规则："></a>模板html标签规则：</h3><ul>
<li>尽量不要使用提交表单；padding和margin标签</li>
<li>table中，EDM邮件营销发送的某些邮件客户端或web界面（如Gmail），对浮 动的标签(padding、margin等)支持很差，所以尽量不要使用；</li>
<li>float浮动标签：某些邮件客户端不支持浮动属性，尽量避免使用。</li>
<li>在页面内调 用&amp;#60;style&amp;#62;&amp;#60;&#x2F;style&amp;#62;的情况下，尽量不要使 用&amp;#60;h2&amp;#62;、&amp;#60;ul&amp;#62;、&amp;#60;li&amp;#62;、&amp;#60;p&amp;#62;、&amp;#60;ol&amp;#62;等有默认样式的标签，防 止&amp;#60;style&amp;#62;&amp;#60;&#x2F;style&amp;#62;被隔离时页面布局混乱。</li>
</ul>
<h3 id="邮件附件夹带"><a href="#邮件附件夹带" class="headerlink" title="邮件附件夹带:"></a>邮件附件夹带:</h3><p>制作edm邮件模板邮件一定不要夹带附件，发送大量附件会占用大量珍贵的网络带宽，切大部分附件用户根本不会打开，这部分占用的带宽基本都是浪费的。带有附件的邮件有 很大可能被用户认为是病毒，对品牌产生不良影响。在模板上设置下载按钮，链接到网站上下载页面，还可以给网站带来一部分流量，何乐而不为。</p>
<h3 id="使用所见即所得工具，在制作完成后手动优化代码"><a href="#使用所见即所得工具，在制作完成后手动优化代码" class="headerlink" title="使用所见即所得工具，在制作完成后手动优化代码:"></a>使用所见即所得工具，在制作完成后手动优化代码:</h3><p>使用主流所见即所得工具可以节省大量时间、提高工作效率，但所见即所得工具生成的代码会有许多垃圾代码掺杂其中，最好在制作完成后手动优化。</p>
<h3 id="纯图片邮件图片于图片之前出现断行："><a href="#纯图片邮件图片于图片之前出现断行：" class="headerlink" title="纯图片邮件图片于图片之前出现断行："></a>纯图片邮件图片于图片之前出现断行：</h3><p>目前很多公司的邮件都是使用大图片切图这种不规则的，形式来制作邮件的，经常会出现下面问题。</p>
<img src="/2015/10/19/EDM%E5%88%B6%E4%BD%9C/edm_pic.jpg" class="" title="切图问题">
<p><strong>解决方法：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;http://blog.54575.com/logo.gif&quot;</span> width=<span class="string">&quot;297″ height=&quot;</span>160<span class="string">&quot; alt=&quot;</span>情人节特供<span class="string">&quot; style=&quot;</span>display:block;<span class="string">&quot; /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在每张图片后添加style&#x3D;”display:block;”此CSS即可。</p>
<h3 id="图片与文本链接规则"><a href="#图片与文本链接规则" class="headerlink" title="图片与文本链接规则:"></a>图片与文本链接规则:</h3><ul>
<li>文字内容，版面尽量简洁，突出主题，以达到更高的点击率。</li>
<li>模板中文本文字不能使用过大的字体，否则可能会被邮 件客户端判定为垃圾邮件.</li>
<li>文字应尽量定义字体的样式，每个邮箱的默认字体样式不同，为了达到您想要的效果，字体样式一定要定义完整。</li>
<li>不使用类似如下敏感及带促销类的文字：免费、优惠、特惠、特价、低价、便宜、廉价、视频、赚钱、群发、发财、致富、代开、薪水、交友、支付、商机、法宝、宝典、秘密、情报、机密、保密、绝密、神秘、秘诀等。如果一定需要，请把敏感字做成图片。</li>
<li>文字中出现网站地址链接被屏蔽为垃圾邮件的风险是极高的，例如：http:&#x2F;&#x2F; xxx.com此类链接，建议写成“XXX公司”文字加链接，或是将网址做成图片加链接</li>
<li>请使用英文字符对图片名称命名，不要使用中文、非法字符来命名图片，否则会导致图片无法显示,不能含有 ad 字符，否则图片上传后会显示成“被过滤广告”。</li>
<li>模板中所有链接，都必须使用绝对路径；</li>
<li>EDM邮件营销发送的邮件链接长度不能超过255个字符，不能存在空格，也不能有中文字符，否则可能会导致连 接无法追踪；</li>
<li>图片链接不要使用&amp;#60;map&amp;#62;标签，而导致图片无法点击,否则可能被邮件客户端判定为垃圾邮件，甚至被邮件运营商直接屏蔽。</li>
<li>为避免用户收到的邮件图片无法浏览，请制作一份和邮件内容一样的 web 页面，然后在邮件顶部注明：“如果您无法查看邮件内容，请点击这里”，链接到访友同样内容的 web 页面。</li>
</ul>
<h3 id="尽可能用table而不用div-要重点强调的一点"><a href="#尽可能用table而不用div-要重点强调的一点" class="headerlink" title="尽可能用table而不用div(要重点强调的一点):"></a>尽可能用table而不用div(要重点强调的一点):</h3><p>做web前端有点年限的都知道，早年间才用table布局，table是一个很落后的布局方式了，现在div甚至于html5出现以来，table仅有的作用在于用在数据表格的制作，但是殊不知，在制作edm邮件模板的时候，用table往往也会比div要好，table的兼容性还是不错的。而且为了考虑在foxmail，outlook等软件上能够正常显示，table比div要更好。</p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>了解以上规范，会对我们高校的制作EDM有所帮助。为了帮助你制作EDM这里提供了参考链接：</p>
<ul>
<li><p><a href="http://www.w3cplus.com/css/build-an-html-email-template-from-scratch.html">从头开始构建一个HTML电子邮件模板&#x2F;zh-cn</a></p>
</li>
<li><p><a href="http://webdesign.tutsplus.com/articles/build-an-html-email-template-from-scratch--webdesign-12770">Build an HTML Email Template From Scratch&#x2F;en-us</a></p>
<img src="/2015/10/19/EDM%E5%88%B6%E4%BD%9C/email.png" class="" title="EDM制作">

</li>
<li><p><a href="https://www.campaignmonitor.com/css/">邮件css指南&#x2F;The Ultimate Guide to CSS：</a></p>
<img src="/2015/10/19/EDM%E5%88%B6%E4%BD%9C/guide.png" class="" title="邮件css参考"></li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.qietu.com/9-production-edm-mail-template-specification">切图网模板规范</a></li>
<li><a href="https://www.campaignmonitor.com/css/">The Ultimate Guide to CSS</a></li>
<li><a href="http://www.w3cplus.com/css/build-an-html-email-template-from-scratch.html">从头开始构建一个HTML电子邮件模板-大漠<strong>译</strong></a></li>
<li><a href="http://webdesign.tutsplus.com/articles/build-an-html-email-template-from-scratch--webdesign-12770">Build an HTML Email Template From Scratch</a></li>
</ol>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>Handlebars的使用</title>
    <url>/2015/12/25/Handlebars%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="Handlebars模版"><a href="#Handlebars模版" class="headerlink" title="Handlebars模版"></a>Handlebars模版</h2><p>Handlebars模板是一个JavaScript模板引擎，有些类似与Mustache、Underscore Templates、Embedded JS Templates、Jade templating等模版，但是他们都各有各的特点。</p>
<ol>
<li>Mustache模板和 Handlebars是兼容的</li>
<li>逻辑处理由Handlebars的Helper进行</li>
<li>无依赖</li>
</ol>
<span id="more"></span>

<h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>1、视图-用来展示数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;wrap&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;script <span class="built_in">id</span>=<span class="string">&quot;template&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/x-handlebars-template&quot;</span>&gt;</span><br><span class="line">&lt;h2&gt;&#123;&#123;title&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">	&#123;&#123;<span class="comment">#each peoples&#125;&#125;</span></span><br><span class="line">		&lt;li&gt;姓名：&#123;&#123;name&#125;&#125;-------描述:&#123;&#123;des&#125;&#125;&lt;/li&gt;</span><br><span class="line">	&#123;&#123;/each&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;handlebars.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2、脚本-处理数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var data = &#123;</span><br><span class="line">	title:<span class="string">&#x27;游戏人物名单&#x27;</span>,</span><br><span class="line">	peoples:[</span><br><span class="line">		&#123;name:<span class="string">&#x27;奥巴马&#x27;</span>,des:<span class="string">&#x27;攻击力&lt;b&gt;10&lt;/b&gt;万点伤害&#x27;</span>,age:<span class="string">&#x27;100&#x27;</span>,money:<span class="string">&#x27;25&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;毛主席&#x27;</span>,des:<span class="string">&#x27;攻击力1.5万点伤害&#x27;</span>,age:<span class="string">&#x27;80&#x27;</span>,money:<span class="string">&#x27;36&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;如来&#x27;</span>,des:<span class="string">&#x27;攻击力0.3万点伤害&#x27;</span>,age:<span class="string">&#x27;60&#x27;</span>,money:<span class="string">&#x27;39&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;卡卡西&#x27;</span>,des:<span class="string">&#x27;攻击力8万点伤害&#x27;</span>,age:<span class="string">&#x27;80&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;曹操&#x27;</span>,des:<span class="string">&#x27;攻击力80万点伤害&#x27;</span>,age:<span class="string">&#x27;45&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;诸葛亮&#x27;</span>,des:<span class="string">&#x27;攻击力100万点伤害&#x27;</span>,age:<span class="string">&#x27;90&#x27;</span>&#125;,</span><br><span class="line">		&#123;name:<span class="string">&#x27;貂禅&#x27;</span>,des:<span class="string">&#x27;攻击力60万点伤害&#x27;</span>,age:<span class="string">&#x27;89&#x27;</span>&#125;</span><br><span class="line">	],</span><br><span class="line">	tag:[<span class="string">&#x27;刺客&#x27;</span>,<span class="string">&#x27;隐士&#x27;</span>,<span class="string">&#x27;策士&#x27;</span>,<span class="string">&#x27;术士&#x27;</span>],</span><br><span class="line">	country:&#123;</span><br><span class="line">		areaFisrt:<span class="string">&#x27;吴国&#x27;</span>,</span><br><span class="line">		areaSecond:<span class="string">&#x27;秦国&#x27;</span>,</span><br><span class="line">		areaThird:<span class="string">&#x27;楚国&#x27;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var wrap = document.getElementById(<span class="string">&#x27;wrap&#x27;</span>),</span><br><span class="line">    tpl = document.getElementById(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">var <span class="built_in">source</span> = tpl.innerHTML;</span><br><span class="line">var template = Handlebars.compile(<span class="built_in">source</span>);</span><br><span class="line">var str = template(data);</span><br><span class="line">wrap.innerHTML = str;</span><br></pre></td></tr></table></figure>

<p>3、UI-结果</p>
<img src="/2015/12/25/Handlebars%E7%9A%84%E4%BD%BF%E7%94%A8/hbd_pic.png" class="" title="UI-结果">


<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>1、数据传进去handlebars会自动进行匹配，相应的数值，对象甚至是函数。例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;h2&gt;&#123;&#123;title&#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123;peoples&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>2、下面这个东西不能忘：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="string">&quot;text/x-handlebars-template&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、找到不到匹配项，则没有输出，支持点操作符<br>4、使用Handlebars.compile()方法预编译模板<br>5、用jquery获取模板</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var tpl  = $(<span class="string">&quot;#template&quot;</span>).html();</span><br></pre></td></tr></table></figure>

<h2 id="Block表达式"><a href="#Block表达式" class="headerlink" title="Block表达式"></a>Block表达式</h2><p>表达式后面跟随一个#号来表示Blocks，然后通过双花括号里面添加反斜杠和表达式来结束Blocks,如果表达式是数组则自动展开，上面循环部分改写如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#peoples&#125;&#125;//开始</span></span><br><span class="line">    &lt;li&gt;姓名：&#123;&#123;namex&#125;&#125;-------描述:&#123;&#123;des&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;&#123;/peoples&#125;&#125;//结束</span><br></pre></td></tr></table></figure>

<h2 id="each-block-helper"><a href="#each-block-helper" class="headerlink" title="each block helper"></a>each block helper</h2><p>遍历块内容，用this来引用元素,用上边的部分数据，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#each tag&#125;&#125;</span></span><br><span class="line">    &lt;li&gt;&#123;&#123;this&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="if-else-block-helper"><a href="#if-else-block-helper" class="headerlink" title="if else block helper"></a>if else block helper</h2><p>if判断和使用js一样,参数返回false，undefined, null, “” 或者 [],Handlebar将不会执行里面的内容，如果有else则执行else操作，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#each tag&#125;&#125;</span></span><br><span class="line">	&#123;&#123;<span class="comment">#if this&#125;&#125;</span></span><br><span class="line">		&lt;li&gt;&#123;&#123;this&#125;&#125;&lt;/li&gt;</span><br><span class="line">	&#123;&#123;<span class="keyword">else</span>&#125;&#125;</span><br><span class="line">		&lt;li&gt;没有值&lt;/li&gt;</span><br><span class="line">	&#123;&#123;/if&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="unless-block-helper"><a href="#unless-block-helper" class="headerlink" title="unless block helper"></a>unless block helper</h2><p>unless则与if相反,值为false时执行内容，如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#each tag&#125;&#125;</span></span><br><span class="line">	&#123;&#123;<span class="comment">#unless this&#125;&#125;</span></span><br><span class="line">		&lt;li&gt;&#123;&#123;this&#125;&#125;&lt;/li&gt;</span><br><span class="line">	&#123;&#123;<span class="keyword">else</span>&#125;&#125;</span><br><span class="line">		&lt;li&gt;没有值&lt;/li&gt;</span><br><span class="line">	&#123;&#123;/unless&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="with-block-helper"><a href="#with-block-helper" class="headerlink" title="with block helper"></a>with block helper</h2><p>with可以进行上下文传递，和赋值，如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#with country&#125;&#125;</span></span><br><span class="line">	&lt;div&gt;&#123;&#123;areaFisrt&#125;&#125;&lt;/div&gt;</span><br><span class="line">	&lt;div&gt;&#123;&#123;areaSecond&#125;&#125;&lt;/div&gt;</span><br><span class="line">	&lt;div&gt;&#123;&#123;areaThird&#125;&#125;&lt;/div&gt;</span><br><span class="line">&#123;&#123;/with&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Handlebar的注释如下"><a href="#Handlebar的注释如下" class="headerlink" title="Handlebar的注释如下"></a>Handlebar的注释如下</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;! 我是注释 &#125;&#125;</span><br><span class="line">&#123;&#123;!-- 我是注释 --&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="路径访问"><a href="#路径访问" class="headerlink" title="路径访问"></a>路径访问</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="comment">#with country&#125;&#125;</span></span><br><span class="line">	&lt;div&gt;&#123;&#123;../title&#125;&#125;&lt;/div&gt;</span><br><span class="line">&#123;&#123;/with&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;country.areaFisrt&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义helper"><a href="#自定义helper" class="headerlink" title="自定义helper"></a>自定义helper</h2><p>可以使用Handlebars.registerHelper()方法来注册一个helper,如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//使用一</span><br><span class="line">&#123;&#123;confName name&#125;&#125; //视图</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">&quot;confName&quot;</span>, <span class="keyword">function</span>(name) &#123;</span><br><span class="line">	<span class="built_in">return</span> <span class="string">&quot;大&quot;</span>+name;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//使用二</span><br><span class="line">&#123;&#123;<span class="comment">#filter age money&#125;&#125;//视图</span></span><br><span class="line">	&lt;li&gt;姓名：&#123;&#123;confName name&#125;&#125;-------描述:&#123;&#123;des&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;&#123;/filter&#125;&#125;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">&quot;filter&quot;</span>, <span class="keyword">function</span>(age, money,options) &#123;</span><br><span class="line">	<span class="keyword">if</span> (age &amp;&amp; money) &#123;</span><br><span class="line">		<span class="built_in">return</span> options.fn(this);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="字符串进行编码Handlebars-SafeString"><a href="#字符串进行编码Handlebars-SafeString" class="headerlink" title="字符串进行编码Handlebars.SafeString"></a>字符串进行编码Handlebars.SafeString</h2><p>Handlebars.SafeString  对字符串不编码<br>new Handlebars.SafeString(result)进行编码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;des:<span class="string">&#x27;攻击力&lt;b&gt;10&lt;/b&gt;万点伤害&#x27;</span>&#125; //原始数据</span><br><span class="line"></span><br><span class="line">使用一:</span><br><span class="line">&#123;&#123;des&#125;&#125; //页面输出：攻击力&lt;b&gt;10&lt;/b&gt;万点伤害</span><br><span class="line"></span><br><span class="line">使用二：</span><br><span class="line"></span><br><span class="line">&#123;&#123;confDes des&#125;&#125; //视图</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">Handlebars.registerHelper(<span class="string">&quot;confDes&quot;</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	var emotion = Handlebars.escapeExpression(this.des);</span><br><span class="line">	<span class="built_in">return</span> emotion; //页面输出：攻击力&amp;lt;b&amp;gt;10&amp;lt;/b&amp;gt;万点伤害</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">Handlebars.registerHelper(<span class="string">&quot;confDes&quot;</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	var emotion = Handlebars.escapeExpression(this.des);</span><br><span class="line">	<span class="built_in">return</span> new Handlebars.SafeString(emotion); //页面输出：攻击力&lt;b&gt;10&lt;/b&gt;万点伤害</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">数字10已加粗</span><br><span class="line">Handlebars.registerHelper(<span class="string">&quot;confDes&quot;</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	<span class="built_in">return</span> new Handlebars.SafeString(this.des);//页面输出：攻击力10万点伤害</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="log-helper"><a href="#log-helper" class="headerlink" title="log helper"></a>log helper</h2><p>log输出信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="built_in">log</span> <span class="string">&quot;正确&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h2><p>基本用法就这些,具体还是应该已官网为表准。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://handlebarsjs.com/">handlebarsjs官方网站-英文</a></li>
<li><a href="http://handlebarsjs.cn/">handlebarsjs官方网站-中文</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>IOS支付</title>
    <url>/2025/09/19/IOS%E6%94%AF%E4%BB%98/</url>
    <content><![CDATA[<h2 id="IOS支付"><a href="#IOS支付" class="headerlink" title="IOS支付"></a>IOS支付</h2><blockquote>
<p>使用苹果开发者账号登录 <a href="https://appstoreconnect.apple.com/">App Store Connect</a>，在应用的功能选项卡页面，添加 App 内购项目。注意：</p>
</blockquote>
<ul>
<li>内购项目的各信息需要填写完整，然后保存，此时内购项目的状态应该是准备提交，当提交应用通过审核后，状态则变为已批准</li>
<li>测试时，建议使用测试证书打一个自定义的 iOS 基座进行测试</li>
<li>在应用 <code>TestFight</code> 的选项卡添加 <code>App Store Connect</code> 用户，测试支付时可以使用此用户帐号进行测试</li>
</ul>
<span id="more"></span>

<h2 id="开通-并签署协议"><a href="#开通-并签署协议" class="headerlink" title="开通, 并签署协议"></a>开通, 并签署协议</h2><ol>
<li>登录<code>App Store Connect</code>签署《付费应用程序协议》, 点击【商务】，签署该页面的所有协议，不能有警告<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918175129_25_148.png" alt="image"></li>
<li>添加银行账户，CNAPS12位数字(大额支付行号&#x2F;银行识别代码)<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918175913_26_148.png" alt="image"><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918180108_27_148.png" alt="image"></li>
<li>添加报税表<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918180800_28_148.png" alt="image"><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918181023_29_148.png" alt="image"></li>
</ol>
<p>&#x3D;&#x3D;<strong>（提示：这一步做完需要等待大概1个小时左右，苹果测试时才会生效）</strong>&#x3D;&#x3D;</p>
<h2 id="添加沙盒用户"><a href="#添加沙盒用户" class="headerlink" title="添加沙盒用户"></a>添加沙盒用户</h2><ol>
<li>用户访问，添加沙盒用户，邮箱可以不存在。<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918181344_30_148.png" alt="image"></li>
<li>手机<code>ios</code> 设备登录沙盒用户，设置-&gt;开发者-》沙盒APPLE账户<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918182956_657.jpg" alt="image"></li>
</ol>
<h2 id="添加内购项目"><a href="#添加内购项目" class="headerlink" title="添加内购项目"></a>添加内购项目</h2><ol>
<li>添加内购项目<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091816522118148.png" alt="image"></li>
<li>选择销售范围<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091816550119148.png" alt="image"></li>
<li><code>App</code> 内购买项目定价<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918165627_20_148.png" alt="image"><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918165810_21_148.png" alt="image"></li>
<li>添加 <code>App Store</code> 本地化版本<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918165955_22_148.png" alt="image"></li>
<li>图像（可选）<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918170344_23_148.png" alt="image"></li>
<li>填写审核信息<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918170600_327.jpg" alt="image"></li>
<li>点击存储，状态为准备提交</li>
</ol>
<h2 id="证书配置"><a href="#证书配置" class="headerlink" title="证书配置"></a>证书配置</h2><p>如果您的应用只接入内购（<code>IAP</code>），那么请您忽略手动创建 <code>Merchant ID</code> 的步骤。您只需要在 <code>Xcode</code> 中开启 <code>In-App Purchase</code> 能力，并在 <code>App Store Connect</code> 中配置商品和银行信息即可。</p>
<p>证书配置完成记得重新生成</p>
<p><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250919113251_39_148.png" alt="image"></p>
<h2 id="配置SDK"><a href="#配置SDK" class="headerlink" title="配置SDK"></a>配置SDK</h2><p><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250919113515_40_148.png" alt="image"></p>
<h2 id="支付流程"><a href="#支付流程" class="headerlink" title="支付流程"></a>支付流程</h2><ol>
<li>获取支付通道 (<code>uni.getProvider</code>)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; applePayCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">RECHARGE_ENV</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constant&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">IAP</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// plus.runtime.openURL(&quot;https://apps.apple.com/account/billing&quot;);</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CODE_MAP</span> = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">	[<span class="number">2</span>, <span class="string">&#x27;支付流程结束&#x27;</span>],</span><br><span class="line">	[-<span class="number">1</span>, <span class="string">&#x27;参数错误&#x27;</span>],</span><br><span class="line">	[-<span class="number">2</span>, <span class="string">&#x27;用户取消&#x27;</span>],</span><br><span class="line">	[-<span class="number">3</span>, <span class="string">&#x27;此功能不支持&#x27;</span>],</span><br><span class="line">	[-<span class="number">4</span>, <span class="string">&#x27;文件不存在&#x27;</span>],</span><br><span class="line">	[-<span class="number">5</span>, <span class="string">&#x27;IO错误&#x27;</span>],</span><br><span class="line">	[-<span class="number">6</span>, <span class="string">&#x27;网络错误&#x27;</span>],</span><br><span class="line">	[-<span class="number">7</span>, <span class="string">&#x27;业务参数配置缺失&#x27;</span>],</span><br><span class="line">	[-<span class="number">8</span>, <span class="string">&#x27;客户端未安装&#x27;</span>],</span><br><span class="line">	[-<span class="number">9</span>, <span class="string">&#x27;快捷方式已存在&#x27;</span>],</span><br><span class="line">	[-<span class="number">10</span>, <span class="string">&#x27;授权失败&#x27;</span>],</span><br><span class="line">	[-<span class="number">100</span>, <span class="string">&#x27;业务内部错误&#x27;</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取iap支付</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getIpaChannels</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable constant_">IAP</span>)&#123;</span><br><span class="line">		<span class="title function_">restoreOrder</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="variable constant_">IAP</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		uni.<span class="title function_">getProvider</span>(&#123;</span><br><span class="line">		  <span class="attr">service</span>: <span class="string">&#x27;payment&#x27;</span>,</span><br><span class="line">		  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">		    <span class="keyword">const</span> iapChannel = res.<span class="property">providers</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">channel</span>) =&gt;</span> &#123;</span><br><span class="line">		      <span class="keyword">return</span> (channel.<span class="property">id</span> === <span class="string">&#x27;appleiap&#x27;</span>)</span><br><span class="line">		    &#125;)</span><br><span class="line">				<span class="keyword">if</span>(iapChannel)&#123;</span><br><span class="line">					<span class="variable constant_">IAP</span> = iapChannel;</span><br><span class="line">					<span class="comment">// console.log(&#x27;IAP&#x27;, IAP)</span></span><br><span class="line">					<span class="title function_">resolve</span>(iapChannel)</span><br><span class="line">					<span class="title function_">restoreOrder</span>();</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="title function_">reject</span>(<span class="string">&#x27;未找到苹果IAP支付通道&#x27;</span>)</span><br><span class="line">				&#125;</span><br><span class="line">		  &#125;,</span><br><span class="line">			<span class="attr">fail</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="title function_">reject</span>(e)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>通过支付通道获取产品列表 (<code>iapChannel.requestProduct</code>)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取产品列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getProducts</span>(<span class="params">productIds = []</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable constant_">IAP</span>)&#123;</span><br><span class="line">		uni.<span class="title function_">showToast</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;IPA通道不存在&#x27;</span>,<span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="variable constant_">IAP</span>.<span class="title function_">requestProduct</span>(productIds,<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">resolve</span>(res)</span><br><span class="line">		&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">reject</span>(err)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>检查是否存在未关闭的订单 (<code>iapChannel.restoreCompletedTransactions</code>, 可选在合适的时机检查)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查上次用户已支付且未关闭的订单，可能出现原因：首次绑卡，网络中断等异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">restoreOrder</span> () &#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable constant_">IAP</span>)&#123;</span><br><span class="line">		uni.<span class="title function_">showToast</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;IPA通道不存在&#x27;</span>,<span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable constant_">IAP</span>.<span class="title function_">restoreCompletedTransactions</span>(&#123;</span><br><span class="line">		<span class="attr">manualFinishTransaction</span>: <span class="literal">true</span>, <span class="comment">// true时不关闭订单</span></span><br><span class="line">		<span class="attr">username</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 支付商户的名称 可不填</span></span><br><span class="line">	&#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// console.log(res, &quot;未关闭的订单&quot;);</span></span><br><span class="line">		<span class="keyword">if</span> (res?.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="variable constant_">IAP</span>.<span class="title function_">finishTransaction</span>(res[<span class="number">0</span>], <span class="function">(<span class="params">reslut</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(reslut, <span class="string">&#x27;关闭成功&#x27;</span>);</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>请求支付，传递产品信息 (<code>uni.requestPayment</code>)</li>
<li>客户端接收苹果返回的支付票据发送到服务器，在服务器请求苹果服务器验证支付是否有效</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 苹果支付</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">applePay</span>(<span class="params">parameter = &#123;</span></span><br><span class="line"><span class="params">	orderInfo,</span></span><br><span class="line"><span class="params">	rechargeOrder,</span></span><br><span class="line"><span class="params">	successCall,</span></span><br><span class="line"><span class="params">	failCall,</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; orderInfo, successCall, failCall, rechargeOrder &#125; = parameter</span><br><span class="line">	uni.<span class="title function_">showLoading</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;支付中...&#x27;</span>, <span class="attr">mask</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">	uni.<span class="title function_">requestPayment</span>(&#123;</span><br><span class="line">		<span class="attr">provider</span>: <span class="string">&#x27;appleiap&#x27;</span>,</span><br><span class="line">		orderInfo,</span><br><span class="line">		<span class="attr">success</span>: <span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">			<span class="comment">// console.log(&#x27;@applePay&#x27;, res)</span></span><br><span class="line">			<span class="comment">// console.log(&#x27;parameter&#x27;, parameter)</span></span><br><span class="line">			uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">			<span class="keyword">const</span> transactionId = res.<span class="property">transactionIdentifier</span> <span class="comment">//交易id</span></span><br><span class="line">			<span class="keyword">const</span> receiptData = res.<span class="property">transactionReceipt</span> <span class="comment">//校验体</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">applePayCallback</span>(&#123;</span><br><span class="line">					<span class="attr">userId</span>: rechargeOrder?.<span class="property">userId</span>,</span><br><span class="line">					transactionId,</span><br><span class="line">					receiptData,</span><br><span class="line">					<span class="attr">iosOrderId</span>: rechargeOrder?.<span class="property">id</span>,</span><br><span class="line">					<span class="attr">environment</span>: <span class="variable constant_">RECHARGE_ENV</span>.<span class="property">sandbox</span></span><br><span class="line">				&#125;)</span><br><span class="line">				successCall &amp;&amp; <span class="title function_">successCall</span>(res)</span><br><span class="line">			&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">				<span class="comment">// console.log(&#x27;@applePay@error&#x27;, error)</span></span><br><span class="line">				failCall &amp;&amp; <span class="title function_">failCall</span>(error)</span><br><span class="line">				<span class="comment">//TODO handle the exception</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="comment">// console.log(&#x27;@applePay&#x27;, err)</span></span><br><span class="line">			uni.<span class="title function_">hideLoading</span>()</span><br><span class="line">			<span class="keyword">let</span> errRes = err</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable constant_">CODE_MAP</span>.<span class="title function_">get</span>(err?.<span class="property">code</span>))&#123;</span><br><span class="line">				errRes = &#123;</span><br><span class="line">					...err,</span><br><span class="line">					<span class="attr">message</span>: <span class="variable constant_">CODE_MAP</span>.<span class="title function_">get</span>(err?.<span class="property">code</span>)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			failCall &amp;&amp; <span class="title function_">failCall</span>(errRes)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>服务器验证票据有效后在客户端关闭订单 (<code>iapChannel.finishTransaction</code>)</li>
</ol>
<p><code>HBuilder 3.5.1</code> 之前因自动关闭订单导致某些情况下丢单的问题</p>
<p><code>HBuilder 3.5.1 +</code> 增加了手动关闭订单参数 <code>manualFinishTransaction</code>, 在合适的时机调用<br><code>HBuilder 3.5.1+ </code>开始支持通过 <code>uni.getProvider</code> 获取IAP支付通道的方法</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li>相同订单，重复调用 <code>restoreCompletedTransactions</code> 后 <code>transactionReceipt</code> 会发生变化，并非唯一值</li>
<li>调用 <code>finishTransaction</code> 关闭订单可能不会立即生效，取决于苹果的服务器</li>
<li>沙盒环境：一个测试账号相同产品仅能购买一次，重复测试需要清除购买记录或重新添加沙盒测试账号</li>
<li>沙盒环境：调用 <code>restoreCompletedTransactions</code> 长时间无反应，检查设备登陆的沙箱账号是否正常</li>
<li>提交<code>App Store</code> 的 <code>App</code> 才能开通应用内支付，使用苹果企业账号发布的 App 不能开通使用</li>
<li>根据 <code>App Store</code> 审核指南条款 <code>3.1.1</code> 要求，虚拟物品交易必须使用应用内支付，实物交易才可使用第三方支付(支付宝、微信等)</li>
<li>创建 <code>App</code>内购买项目的各项信息需要填写完整，保存后内购项目的状态是准备提交，当提交应用通过审核后，状态则变为已批准</li>
<li>正式上线前可在 <code>Test Flight</code> 平台添加 <code>App Store Connect</code> 用户，测试支付时可以使用此用户帐号</li>
</ol>
<h2 id="订单丢失场景"><a href="#订单丢失场景" class="headerlink" title="订单丢失场景"></a>订单丢失场景</h2><p>用户没有绑定 <code>AppStore</code> 支付方式，调用 <code>uni.requestPayment()</code> 准备支付，触发失败 fail 回调，<code>errCode=2</code>，用户未绑定支付方式，<code>app</code>内支付流程结束。 系统弹出框引导用户绑定支付方式，此过程将跳转到系统应用 <code>AppStore</code> 进行绑定支付方式，绑定成功同步支付成功，用户成功付款</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ol>
<li>使用开发证书打包，可以借助<code>App Uploader</code>生成证书、和测试、和安装</li>
</ol>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://developer.apple.com/cn/help/app-store-connect/configure-in-app-purchase-settings/overview-for-configuring-in-app-purchases/">配置 App 内购买项目概述</a></li>
<li><a href="https://uniapp.dcloud.net.cn/api/plugins/payment.html#iap">苹果应用内支付</a></li>
<li><a href="https://ask.dcloud.net.cn/article/282">5+API错误代码</a></li>
</ol>
]]></content>
      <categories>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript编码</title>
    <url>/2017/02/14/JavaScript%E7%BC%96%E7%A0%81/</url>
    <content><![CDATA[<h2 id="escape-和unescape-函数"><a href="#escape-和unescape-函数" class="headerlink" title="escape()和unescape()函数"></a>escape()和unescape()函数</h2><h3 id="escape-函数"><a href="#escape-函数" class="headerlink" title="escape()函数"></a>escape()函数</h3><p><strong>定义和用法:</strong> escape() 函数可对字符串进行编码，这样就可以在所有的计算机上读取该字符串。</p>
<p>字符的16进制格式值,当该值小于等于0xFF时,用一个2位转移序列: %xx 表示. 大于的话则使用4位序列:%uxxxx 表示.</p>
<p><strong>返回值:</strong> 已编码的 string 的副本。其中某些字符被替换成了十六进制的转义序列。</p>
<span id="more"></span>

<p><strong>说明:</strong> 该函数不会对 ASCII 字母和数字进行编码，也不会对下面这些 ASCII 标点符号进行编码： * @ - _ + . &#x2F; 。其他所有的字符都会被转义序列替换。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">escape(string) <span class="comment">#string	必需。要被转义或编码的字符串。</span></span><br><span class="line"></span><br><span class="line">escape(<span class="string">&quot;你好世界;hello word!&quot;</span>) <span class="comment"># &quot;%u4F60%u597D%u4E16%u754C%3Bhello%20word%21&quot;</span></span><br><span class="line">escape(<span class="string">&quot;* @ - _ + . / &quot;</span>) <span class="comment"># &quot;*%20@%20-%20_%20+%20.%20/%20&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>注释：</strong> 该特性已经从 Web 标准中删除，虽然一些浏览器目前仍然支持它，但也许会在未来的某个时间停止支持，请尽量不要使用该特性,ES3 反对使用该方法，应用使用 decodeURI() 和 decodeURIComponent() 替代它。</p>
<h3 id="unescape-函数"><a href="#unescape-函数" class="headerlink" title="unescape()函数"></a>unescape()函数</h3><p><strong>定义用法:</strong> unescape() 函数可对通过 escape() 编码的字符串进行解码。</p>
<p><strong>返回值:</strong> string 被解码后的一个副本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unescape(<span class="string">&quot;hello%20world&quot;</span>); <span class="comment"># &quot;hello world&quot;</span></span><br><span class="line">unescape(<span class="string">&quot;%u60A8%u597D%uFF0C%u4E16%u754C&quot;</span>) <span class="comment"># &quot;您好，世界&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong> 该函数的工作原理是这样的：通过找到形式为 %xx 和 %uxxxx 的字符序列（x 表示十六进制的数字），用 Unicode 字符 \u00xx 和 \uxxxx 替换这样的字符序列进行解码</p>
<p><strong>注释：</strong>  该特性已经从 Web 标准中删除，虽然一些浏览器目前仍然支持它，但也许会在未来的某个时间停止支持，请尽量不要使用该特性,ES3 反对使用该方法，应用使用 decodeURI() 和 decodeURIComponent() 替代它。</p>
<h2 id="encodeURI-和decodeURI-函数"><a href="#encodeURI-和decodeURI-函数" class="headerlink" title="encodeURI()和decodeURI()函数"></a>encodeURI()和decodeURI()函数</h2><h3 id="encodeURI-函数"><a href="#encodeURI-函数" class="headerlink" title="encodeURI()函数"></a>encodeURI()函数</h3><p><strong>定义和用法：</strong><br>encodeURI() 是对统一资源标识符（URI）进行编码的方法。它使用1到4个转义序列来表示每个字符的UTF-8编码（只有由两个代理字符区组成的字符才用四个转义字符编码）。</p>
<p><strong>返回值：</strong> URIstring 的副本，其中的某些字符将被十六进制的转义序列进行替换。</p>
<p><strong>说明：</strong> 假定一个URI是完整的URI，那么无需对那些保留的并且在URI中有特殊意思的字符进行编码。</p>
<p>encodeURI 会替换所有的字符，但不包括以下字符，即使它们具有适当的UTF-8转义序列：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>包含</th>
</tr>
</thead>
<tbody><tr>
<td>保留字符</td>
<td>; , &#x2F; ? : @ &amp; &#x3D; + $</td>
</tr>
<tr>
<td>非转义的字符</td>
<td>字母 数字 - _ . ! ~ * ‘ ( )</td>
</tr>
<tr>
<td>数字符号</td>
<td>#</td>
</tr>
</tbody></table>
<p>encodeURI 自身无法产生能适用于HTTP GET 或 POST 请求的URI，例如对于 XMLHTTPRequests, 因为 “&amp;”, “+”, 和 “&#x3D;” 不会被编码，然而在 GET 和 POST 请求中它们是特殊字符。然而encodeURIComponent这个方法会对这些字符编码。</p>
<p>如果试图编码一个非高-低位完整的代理字符，将会抛出一个 URIError 错误如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">编码高-低位完整字符 ok</span><br><span class="line">encodeURI(<span class="string">&#x27;\uD800\uDFFF&#x27;</span>) <span class="comment"># &quot;%F0%90%8F%BF&quot;</span></span><br><span class="line"></span><br><span class="line">编码单独的高位字符抛出 <span class="string">&quot;Uncaught URIError: URI malformed&quot;</span></span><br><span class="line">encodeURI(<span class="string">&#x27;\uD800&#x27;</span>)</span><br><span class="line"></span><br><span class="line">编码单独的低位字符抛出 <span class="string">&quot;Uncaught URIError: URI malformed&quot;</span></span><br><span class="line">encodeURI(<span class="string">&#x27;\uDFFF&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果URL需要遵循较新的RFC3986标准,那么方括号是被保留的(给IPv6)，因此对于那些没有被编码的URL部分(例如主机)，可以使用下面的代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> fixedEncodeURI (str) &#123;</span><br><span class="line">    <span class="built_in">return</span> encodeURI(str).replace(/%5B/g, <span class="string">&#x27;[&#x27;</span>).replace(/%5D/g, <span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="decodeURI-函数"><a href="#decodeURI-函数" class="headerlink" title="decodeURI()函数"></a>decodeURI()函数</h3><p><strong>定义和用法:</strong> decodeURI() 函数可对 encodeURI() 函数编码过的 URI 进行解码。</p>
<p><strong>返回值:</strong> URIstring 的副本，其中的十六进制转义序列将被它们表示的字符替换。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">encodeURI(<span class="string">&quot;http://www.baidu.com.cn/My first/&quot;</span>) <span class="comment"># &quot;http://www.baidu.com.cn/My%20first/&quot;</span></span><br><span class="line"></span><br><span class="line">decodeURI(<span class="string">&quot;http://www.baidu.com.cn/My%20first/&quot;</span>); <span class="comment"># &quot;http://www.baidu.com.cn/My first/&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="encodeURIComponent-函数和decodeURIComponent-函数"><a href="#encodeURIComponent-函数和decodeURIComponent-函数" class="headerlink" title="encodeURIComponent()函数和decodeURIComponent()函数"></a>encodeURIComponent()函数和decodeURIComponent()函数</h2><h3 id="encodeURIComponent-函数"><a href="#encodeURIComponent-函数" class="headerlink" title="encodeURIComponent()函数"></a>encodeURIComponent()函数</h3><p><strong>概述:</strong> encodeURIComponent()是对统一资源标识符（URI）的组成部分进行编码的方法。它使用一到四个转义序列来表示字符串中的每个字符的UTF-8编码（只有由两个Unicode代理区字符组成的字符才用四个转义字符编码）。</p>
<p><strong>返回值:</strong> URIstring 的副本，其中的某些字符将被十六进制的转义序列进行替换。</p>
<p><strong>说明:</strong> 该方法不会对 ASCII 字母和数字进行编码，也不会对这些 ASCII 标点符号进行编码： - _ . ! ~ * ‘ ( ) 。<br>其他字符（比如 ：;&#x2F;?: @&amp;&#x3D;+$,# 这些用于分隔 URI 组件的标点符号），都是由一个或多个十六进制的转义序列替换的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">encodeURIComponent(<span class="string">&quot;http://www.baidu.com&quot;</span>) <span class="comment"># &quot;http%3A%2F%2Fwww.baidu.com&quot;</span></span><br><span class="line">encodeURIComponent(<span class="string">&quot;,/?:@&amp;=+<span class="variable">$#</span>&quot;</span>) <span class="comment"># &quot;%2C%2F%3F%3A%40%26%3D%2B%24%23&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果试图编码一个非高-低位完整的代理字符，将会抛出一个 URIError 错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">高低位完整</span><br><span class="line">encodeURIComponent(<span class="string">&#x27;\uD800\uDFFF&#x27;</span>) <span class="comment"># &quot;%F0%90%8F%BF&quot;</span></span><br><span class="line"></span><br><span class="line">只有高位，将抛出<span class="string">&quot;URIError: malformed URI sequence&quot;</span></span><br><span class="line">encodeURIComponent(<span class="string">&#x27;\uD800&#x27;</span>)</span><br><span class="line"></span><br><span class="line">只有低位，将抛出<span class="string">&quot;URIError: malformed URI sequence&quot;</span></span><br><span class="line">encodeURIComponent(<span class="string">&#x27;\uDFFF&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>对于 application&#x2F;x-www-form-urlencoded (POST) 这种数据方式，空格需要被替换成 ‘+’，所以通常使用 encodeURIComponent 的时候还会把 “%20” 替换为 “+”。</p>
<p>为了更严格的遵循 RFC 3986（它保留 !, ‘, (, ), 和 *），即使这些字符并没有正式划定 URI 的用途，下面这种方式是比较安全的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> fixedEncodeURIComponent (str) &#123;</span><br><span class="line">  <span class="built_in">return</span> encodeURIComponent(str).replace(/[!<span class="string">&#x27;()]/g, escape).replace(/\*/g, &quot;%2A&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="decodeURIComponent-函数"><a href="#decodeURIComponent-函数" class="headerlink" title="decodeURIComponent()函数"></a>decodeURIComponent()函数</h3><p><strong>定义和用法：</strong> decodeURIComponent() 方法用于解码由 encodeURIComponent 方法或者其它类似方法编码的部分统一资源标识符（URI）。</p>
<p><strong>返回值：</strong> URIstring 的副本，其中的十六进制转义序列将被它们表示的字符替换。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">decodeURIComponent(<span class="string">&quot;%2C%2F%3F%3A%40%26%3D%2B%24%23&quot;</span>) <span class="comment"># &quot;,/?:@&amp;=+$#&quot;</span></span><br><span class="line">decodeURIComponent(<span class="string">&quot;http%3A%2F%2Fwww.baidu.com&quot;</span>) <span class="comment"># &quot;http://www.baidu.com&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="atob-函数和btoa-函数"><a href="#atob-函数和btoa-函数" class="headerlink" title="atob()函数和btoa()函数"></a>atob()函数和btoa()函数</h2><p>Base64是一组相似的二进制到文本(binary-to-text)的编码规则，使得二进制数据在解释成radix-64的表现形式后能够用ASCII字符串的格式表示出来。Base64 这个词出自一种MIME数据传输编码。</p>
<h3 id="atob-函数"><a href="#atob-函数" class="headerlink" title="atob()函数"></a>atob()函数</h3><p><strong>概述:</strong> 将ascii字符串或二进制数据转换成一个base64编码过的字符串,该方法不能直接作用于Unicode字符串.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">window.btoa(<span class="string">&quot;Hello, world&quot;</span>) <span class="comment"># &quot;SGVsbG8sIHdvcmxk&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong> 在各浏览器中,使用 window.btoa 对Unicode字符串进行编码都会触发一个字符越界的异常.</p>
<p>先把Unicode字符串转换为UTF-8编码,可以解决这个问题,</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> utf8_to_b64( str ) &#123;</span><br><span class="line">    <span class="built_in">return</span> window.btoa(unescape(encodeURIComponent( str )));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> b64_to_utf8( str ) &#123;</span><br><span class="line">    <span class="built_in">return</span> decodeURIComponent(escape(window.atob( str )));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">utf8_to_b64(<span class="string">&#x27;? à la mode&#x27;</span>); <span class="comment"># &quot;PyDDoCBsYSBtb2Rl&quot;</span></span><br><span class="line">b64_to_utf8(<span class="string">&#x27;4pyTIMOgIGxhIG1vZGU=&#x27;</span>); <span class="comment"># &quot;✓ à la mode&quot;</span></span><br><span class="line"></span><br><span class="line">在js引擎内部,encodeURIComponent(str)相当于escape(unicodeToUTF8(str))</span><br><span class="line">所以可以推导出unicodeToUTF8(str)等同于unescape(encodeURIComponent(str))</span><br></pre></td></tr></table></figure>

<h3 id="btoa-函数"><a href="#btoa-函数" class="headerlink" title="btoa()函数"></a>btoa()函数</h3><p><strong>概述:</strong> atob() 函数用来解码一个已经被base-64编码过的数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">window.atob(<span class="string">&quot;SGVsbG8sIHdvcmxk&quot;</span>) <span class="comment"># &quot;Hello, world&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects&#x2F;encodeURIComponent</a></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>OSI七层模型</title>
    <url>/2017/12/08/OSI%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="OSI"><a href="#OSI" class="headerlink" title="OSI"></a>OSI</h2><p>OSI（Open System Interconnection）参考模型是国际标准化组织（ISO）制定的一个用于计算机或通信系统间互联的标准体系，一般称为OSI参考模型或七层模型。</p>
<p>为开放式互连信息系统提供了一种功能结构的框架。它从高到低分别是：应用层、表示层、会话层、传输层、网络层、数链路层、物理层</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201801180940.jpg" alt="image"></p>
<span id="more"></span>

<h3 id="应用层（Application-Layer）"><a href="#应用层（Application-Layer）" class="headerlink" title="应用层（Application Layer）"></a>应用层（Application Layer）</h3><p>应用层是OSI参考模型中最最高层，是通信用户之间的窗口，为用户提供网络管理、文件传输、事务处理等服务.</p>
<p>应用层为操作系统或网络应用程序提供访问网络服务的接口。</p>
<p>典型协议：HTTP、POP3、SMTP、IMAP、DNS、DHCP、FTP、Telnet、SSH、NNTP、XMPP、SIP、RPC、RTCP、SDP、MMS、SOAP、SSDP等。</p>
<p>典型设备：终端设备（PC、手机、平板等）</p>
<h3 id="表示层-Presentation-Layer"><a href="#表示层-Presentation-Layer" class="headerlink" title="表示层(Presentation Layer)"></a>表示层(Presentation Layer)</h3><p>表示层向上对应用层提供服务，向下接收来自会话层的服务。</p>
<p>表示层要完成某些特定的功能，主要有不同数据编码格式的转换，提供数据压缩、解压缩服务，对数据进行加密、解密。</p>
<p>例如：图像格式的显示，就是由位于表示层的协议来支持</p>
<p>表示层没有协议，应用层的HTTP、FTP、Telnet等协议有类似的功能，传输层的TLS&#x2F;SSL也有类似功能。</p>
<h3 id="会话层（Session-Layer）"><a href="#会话层（Session-Layer）" class="headerlink" title="会话层（Session Layer）"></a>会话层（Session Layer）</h3><p>会话层也可以称为会晤层或对话层，在会话层及以上的高层次中，数据传送的单位不再另外命名，统称为报文。</p>
<p>会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制，如服务器验证用户登录便是由会话层完成的。</p>
<h3 id="传输层（Transport-Layer）"><a href="#传输层（Transport-Layer）" class="headerlink" title="传输层（Transport Layer）"></a>传输层（Transport Layer）</h3><p>传输层也称为运输层。</p>
<p>传输层建立在网络层和会话层之间，实质上它是网络体系结构中高低层之间衔接的一个接口层。用一个寻址机制来标识一个特定的应用程序（端口号）。</p>
<p>传输层的主要功能是从会话层接收数据，根据需要把数据切成较小的数据片，并把数据传送给网络层，确保数据片正确到达网络层，从而实现两层数据的透明传送。</p>
<p>传输层的数据单元是由数据组织成的数据段（segment）这个层负责获取全部信息，因此，它必须跟踪数据单元碎片、乱序到达的数据包和其它在传输过程中可能发生的危险。</p>
<p>传输层的典型协议包括：TCP、UDP、SPX、PPTP、TLS&#x2F;SSL、SCTP、DCCP等。</p>
<h3 id="网络层（Network-Layer）"><a href="#网络层（Network-Layer）" class="headerlink" title="网络层（Network Layer）"></a>网络层（Network Layer）</h3><p>网络层也称通信子网层，是高层协议之间的界面层，用于控制通信子网的操作，是通信子网与资源子网的接口。</p>
<p>网络层的任务就是选择合适的网间路由和交换结点，确保数据及时传送。网络层将解封装数据链路层收到的帧，提取数据包，包中封装有网络层包头，其中含有逻辑地址信息源站点和目的站点地址的网络地址。</p>
<p>网络层主要功能是基于网络层地址（IP地址）进行不同网络系统间的路径选择。</p>
<p>网络层的典型协议包括：IP、IPX、IPsec、RIP、OSPF、BGP、IGMP等。</p>
<p>网络层典型设备：网关、路由器</p>
<h3 id="数据链路层（Data-Link-Layer）"><a href="#数据链路层（Data-Link-Layer）" class="headerlink" title="数据链路层（Data Link Layer）"></a>数据链路层（Data Link Layer）</h3><p>在物理层提供比特流服务的基础上，将比特信息封装成数据帧Frame，起到在物理层上建立、撤销、标识逻辑链接和链路复用以及差错校验等功能。</p>
<p>该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等,在这一层，数据的单位称为帧（frame）。</p>
<p>数据链路层典型协议包括：IEEE 802.11、PPP、L2TP、STP、ATM、SDLC、HDLC Ethernet、GPRS、HSPA、PPPoE帧中继等。</p>
<p>数据链路层的典型设备：二层交换机、网桥、网卡</p>
<h3 id="物理层（Physical-Layer）"><a href="#物理层（Physical-Layer）" class="headerlink" title="物理层（Physical Layer）"></a>物理层（Physical Layer）</h3><p>物理层是OSI分层结构体系中最重要、最基础的一层，它建立在传输媒介基础上，起建立、维护和取消物理连接作用，实现设备之间的物理接口。物理层之接收和发送一串比特(bit)流，不考虑信息的意义和信息结构。</p>
<p>属于物理层定义的典型规范代表包括：EIA&#x2F;TIARS-232、EIA&#x2F;TIARS-449、V.35、RJ-45等。</p>
<p>物理层的典型设备：光纤、同轴电缆、双绞线、中继器和集线器</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B">OSI模型-维基百科</a></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>Wox</title>
    <url>/2017/02/26/Wox/</url>
    <content><![CDATA[<h2 id="wox"><a href="#wox" class="headerlink" title="wox"></a>wox</h2><p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/wox_preview.jpg" alt="image"></p>
<span id="more"></span>

<p>Wox - 开源免费强大的快捷启动器辅助工具，快速高效率打开软件&#x2F;搜索文件！</p>
<p>官网地址：<a href="http://www.getwox.com/">http://www.getwox.com/</a></p>
<p>gitHub地址：<a href="https://github.com/Wox-launcher/Wox">https://github.com/Wox-launcher/Wox</a></p>
<p>插件地址：<a href="http://www.getwox.com/plugin">http://www.getwox.com/plugin</a></p>
<p>中文文档：<a href="http://doc.getwox.com/zh/">http://doc.getwox.com/zh/</a></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>寻找一切应用程序、文件夹、文件和更多</li>
<li>支持用拼音搜索程序，yyy &#x2F; wangyiyun→网易云音乐</li>
<li>关键字搜索，搜索谷歌g search_term</li>
<li>建立自定义主题<a href="http://www.getwox.com/theme/builder">http://www.getwox.com/theme/builder</a></li>
<li>安装插件</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li><strong>启动：</strong> Alt+Space</li>
<li><strong>安装和卸载插件：</strong> wpm install&#x2F;uninstall xxx</li>
<li><strong>删除：</strong> delete %APPDATA%\Wox</li>
<li><strong>已安装插件：</strong> wpm list</li>
</ul>
<h2 id="Wox搜索"><a href="#Wox搜索" class="headerlink" title="Wox搜索"></a>Wox搜索</h2><h3 id="开始菜单中的程序"><a href="#开始菜单中的程序" class="headerlink" title="开始菜单中的程序"></a>开始菜单中的程序</h3><p>Wox会自动收集开始菜单中的程序列表并索引之后供用户进行搜索。</p>
<h3 id="用户自定义目录中的程序"><a href="#用户自定义目录中的程序" class="headerlink" title="用户自定义目录中的程序"></a>用户自定义目录中的程序</h3><p>通过setting命令（推荐）。如下图所示，直接输入setting然后选择第一项</p>
<p>搜索的应用程序不再开始菜单中，用户自己将需要索引的文件夹添加进来，再右下角右键单击：Setting&#x3D;&gt;Plugin&#x3D;&gt;Programs</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170225224749.png" alt="image"></p>
<p>默认Wox会索引以lnk;exe;bat为结尾的程序。用户可以通过点击Index File suffixes按钮进行设置。</p>
<h3 id="内置插件"><a href="#内置插件" class="headerlink" title="内置插件"></a>内置插件</h3><ul>
<li><p><strong>颜色插件(Color):</strong> 当用户输入符合特定条件的颜色值的时候，Wox会告诉你这个颜色是什么。</p>
</li>
<li><p><strong>控制面板插件(Control Panel):</strong> Wox还支持控制面板的搜索。例如上图所示，输入防火墙的首拼音字母后，Wox会搜索出控制面板中的防火墙选项。</p>
</li>
<li><p><strong>计算器插件(Caculator):</strong> 插件。直接在Wox中搜索你想计算的公式，立马就能得到计算结果。</p>
</li>
<li><p><strong>网址插件(URL handler):</strong> 当你拷贝了一个网址想快速打开此网址的时候，打开Wox，粘贴，回车即可。</p>
</li>
<li><p><strong>文件夹插件(Folder)：</strong> Wox提供了文件夹书签的功能。如果你有经常需要访问的文件夹，那么你可以将它加入文件夹列表中。以后直接搜索文件夹的名字即可快速打开此文件夹了。添加的设置位于：Settings&#x3D;&gt;Plugin&#x3D;&gt;Folder当中。</p>
</li>
<li><p><strong>系统命令插件(System Commands):</strong> Wox集成了一些系统级别的命令。例如，注销，关机，锁定等等。具体的支持列表可以从Settings&#x3D;&gt;Plugin&#x3D;&gt;System Command中查看</p>
</li>
<li><p><strong>第三方插件提示插件(Third-party Indicator):</strong> 此插件用于提示其他插件的触发关键字。</p>
</li>
<li><p><strong>Web搜索插件(Web Searches):</strong><br>Wox还提供了名为Web搜索的系统插件。所谓Web搜索，就是Wox允许用户设置一个URL，然后替换其中搜索关键字部分，从而达到快速搜索的目的。最常见的莫过于谷歌，百度搜索了。Wox内置了谷歌的Web搜索。关键字是g。另外在添加自定的Web搜索的时候记得把需要替换的地方换成{q}占位符，此占位符会在正常搜索的时候替换为你的输入。</p>
</li>
</ul>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170225230230.png" alt="image"></p>
<h2 id="热键"><a href="#热键" class="headerlink" title="热键"></a>热键</h2><p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170225230640.png" alt="image"></p>
<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><h3 id="使用wpm命令安装"><a href="#使用wpm命令安装" class="headerlink" title="使用wpm命令安装"></a>使用wpm命令安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpm install &lt;插件名字&gt;</span><br><span class="line">删除插件: wpm uninstall &lt;插件名字&gt;</span><br><span class="line">已安装插件： wpm list</span><br></pre></td></tr></table></figure>

<h3 id="下载Wox插件包，手动安装"><a href="#下载Wox插件包，手动安装" class="headerlink" title="下载Wox插件包，手动安装"></a>下载Wox插件包，手动安装</h3><p>用户可以将插件安装包下载到本地（以.wox结尾），然后将插件安装包拖拽到Wox搜索框上即可开始安装。</p>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Wox.exe reloadplugin</span><br><span class="line"><span class="comment"># 这个参数会重新加载所有的插件。在你拷贝新的插件到插件目录的时候，如果你不想重新启动Wox来使插件生效的话可以使用此参数。</span></span><br><span class="line"></span><br><span class="line">Wox.exe query &lt;查询内容&gt;</span><br><span class="line">使用这个参数会自动打开Wox，并输入你想查询的内容进行查询。</span><br><span class="line"></span><br><span class="line">Wox.exe hidestart</span><br><span class="line">使用这个参数会打开Wox，但是不显示查询窗体。一般开机启动的时候用到。</span><br><span class="line"></span><br><span class="line">Wox.exe installplugin &lt;plugin路径&gt;</span><br><span class="line">使用这个参数进行插件的安装。</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>angularjs1.x双向绑定</title>
    <url>/2017/05/06/angularjs%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/</url>
    <content><![CDATA[<h2 id="angularjs双向绑定"><a href="#angularjs双向绑定" class="headerlink" title="angularjs双向绑定"></a>angularjs双向绑定</h2><p>双向绑定：界面的操作能实时反映到数据，数据的改变能实时反映界面，如下图：文本框的操作</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170803223248.png" alt="image"></p>
<span id="more"></span>

<h2 id="双向绑定实现"><a href="#双向绑定实现" class="headerlink" title="双向绑定实现"></a>双向绑定实现</h2><ul>
<li>脏值检测 例如AngularJS1.x</li>
<li>Getter&#x2F;Setter：重定义model的getter与setter方法，在数据变动的时候重新渲染页面，例如Vue.js</li>
</ul>
<p>使用Getter&#x2F;Setter的时候,数据的每次修改都会激活刷新模版的方法，</p>
<p>脏值检测，可以在完成所有数值变动后，统一刷新到Dom，当监听元素变多的时候 watcher 列表会变得很长，查询变动的数据元素将耗费更多的资源。</p>
<h2 id="脏检查"><a href="#脏检查" class="headerlink" title="脏检查"></a>脏检查</h2><p>angular 必须去挨个检查一定作用域上(如 ,<code>$scope</code>)的这些元素对应绑定表达式的值是否有被改变。这就是脏数据检查的由来.</p>
<ul>
<li>脏检查是一种模型到视图的数据映射机制，由 $apply 或 $digest 触发。</li>
<li>脏检查的范围是整个页面，不受区域或组件划分影响</li>
<li>使用尽量简单的绑定表达式提升脏检查执行速度</li>
<li>尽量减少页面上绑定表达式的个数（单次绑定和ng-if）</li>
<li>给 ng-repeat 添加 track by 让 angular 复用已有元素</li>
</ul>
<h2 id="构造函数Scope"><a href="#构造函数Scope" class="headerlink" title="构造函数Scope"></a>构造函数Scope</h2><p>在angular框架中，缀$$表示这个变量被当作私有的来考虑，不应当在外部代码中调用</p>
<p>在写angularjs时到处都能遇到<code>$scope</code>,而<code>$scope</code> 就是 <code>Scope</code> 的实例</p>
<p>源码：<code>angular@1.5.0</code>:</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170803231613.png" alt="image"></p>
<p>在Scope的原型(Scope.prototype)中共定义了大概14个函数，如下图：</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170803232852.png" alt="image"><br><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170803232946.png" alt="image"></p>
<p>其中有3个函数起者至关重要的作用域(译的不准)：</p>
<ul>
<li><code>$watch</code>(译:监听、监视)</li>
<li><code>$digest</code>(译:迭代、循环、遍历)</li>
<li><code>$apply</code>(译：传播、应用)</li>
</ul>
<p><code>$watch</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">$watch</span>: <span class="keyword">function</span>(<span class="params">watchExp, listener, objectEquality, prettyPrintExpression</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> get = $parse(watchExp);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (get.<span class="property">$$watchDelegate</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> get.$$watchDelegate(<span class="variable language_">this</span>, listener, objectEquality, get, watchExp);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> scope = <span class="variable language_">this</span>,</span><br><span class="line">      array = scope.<span class="property">$$watchers</span>,</span><br><span class="line">      watcher = &#123;</span><br><span class="line">        <span class="attr">fn</span>: listener,</span><br><span class="line">        <span class="attr">last</span>: initWatchVal,</span><br><span class="line">        <span class="attr">get</span>: get,</span><br><span class="line">        <span class="attr">exp</span>: prettyPrintExpression || watchExp,</span><br><span class="line">        <span class="attr">eq</span>: !!objectEquality</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  lastDirtyWatch = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isFunction</span>(listener)) &#123;</span><br><span class="line">    watcher.<span class="property">fn</span> = noop;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!array) &#123;</span><br><span class="line">    array = scope.<span class="property">$$watchers</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// we use unshift since we use a while loop in $digest for speed.</span></span><br><span class="line">  <span class="comment">// the while loop reads in reverse order.</span></span><br><span class="line">  array.<span class="title function_">unshift</span>(watcher);</span><br><span class="line">  <span class="title function_">incrementWatchersCount</span>(<span class="variable language_">this</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">deregisterWatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">arrayRemove</span>(array, watcher) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title function_">incrementWatchersCount</span>(scope, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    lastDirtyWatch = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><code>$digest</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">$digest</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> watch, value, last, fn, get,</span><br><span class="line">      watchers,</span><br><span class="line">      length,</span><br><span class="line">      dirty, ttl = <span class="variable constant_">TTL</span>,</span><br><span class="line">      next, current, target = <span class="variable language_">this</span>,</span><br><span class="line">      watchLog = [],</span><br><span class="line">      logIdx, logMsg, asyncTask;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beginPhase</span>(<span class="string">&#x27;$digest&#x27;</span>);</span><br><span class="line">  <span class="comment">// Check for changes to browser url that happened in sync before the call to $digest</span></span><br><span class="line">  $browser.$$checkUrlChange();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span> === $rootScope &amp;&amp; applyAsyncId !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// If this is the root scope, and $applyAsync has scheduled a deferred $apply(), then</span></span><br><span class="line">    <span class="comment">// cancel the scheduled $apply and flush the queue of expressions to be evaluated.</span></span><br><span class="line">    $browser.<span class="property">defer</span>.<span class="title function_">cancel</span>(applyAsyncId);</span><br><span class="line">    <span class="title function_">flushApplyAsync</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lastDirtyWatch = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> &#123; <span class="comment">// &quot;while dirty&quot; loop</span></span><br><span class="line">    dirty = <span class="literal">false</span>;</span><br><span class="line">    current = target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (asyncQueue.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        asyncTask = asyncQueue.<span class="title function_">shift</span>();</span><br><span class="line">        asyncTask.<span class="property">scope</span>.$eval(asyncTask.<span class="property">expression</span>, asyncTask.<span class="property">locals</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        $exceptionHandler(e);</span><br><span class="line">      &#125;</span><br><span class="line">      lastDirtyWatch = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attr">traverseScopesLoop</span>:</span><br><span class="line">    <span class="keyword">do</span> &#123; <span class="comment">// &quot;traverse the scopes&quot; loop</span></span><br><span class="line">      <span class="keyword">if</span> ((watchers = current.<span class="property">$$watchers</span>)) &#123;</span><br><span class="line">        <span class="comment">// process our watches</span></span><br><span class="line">        length = watchers.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">while</span> (length--) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            watch = watchers[length];</span><br><span class="line">            <span class="comment">// Most common watches are on primitives, in which case we can short</span></span><br><span class="line">            <span class="comment">// circuit it with === operator, only when === fails do we use .equals</span></span><br><span class="line">            <span class="keyword">if</span> (watch) &#123;</span><br><span class="line">              get = watch.<span class="property">get</span>;</span><br><span class="line">              <span class="keyword">if</span> ((value = <span class="title function_">get</span>(current)) !== (last = watch.<span class="property">last</span>) &amp;&amp;</span><br><span class="line">                  !(watch.<span class="property">eq</span></span><br><span class="line">                      ? <span class="title function_">equals</span>(value, last)</span><br><span class="line">                      : (<span class="keyword">typeof</span> value === <span class="string">&#x27;number&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> last === <span class="string">&#x27;number&#x27;</span></span><br><span class="line">                         &amp;&amp; <span class="built_in">isNaN</span>(value) &amp;&amp; <span class="built_in">isNaN</span>(last)))) &#123;</span><br><span class="line">                dirty = <span class="literal">true</span>;</span><br><span class="line">                lastDirtyWatch = watch;</span><br><span class="line">                watch.<span class="property">last</span> = watch.<span class="property">eq</span> ? <span class="title function_">copy</span>(value, <span class="literal">null</span>) : value;</span><br><span class="line">                fn = watch.<span class="property">fn</span>;</span><br><span class="line">                <span class="title function_">fn</span>(value, ((last === initWatchVal) ? value : last), current);</span><br><span class="line">                <span class="keyword">if</span> (ttl &lt; <span class="number">5</span>) &#123;</span><br><span class="line">                  logIdx = <span class="number">4</span> - ttl;</span><br><span class="line">                  <span class="keyword">if</span> (!watchLog[logIdx]) watchLog[logIdx] = [];</span><br><span class="line">                  watchLog[logIdx].<span class="title function_">push</span>(&#123;</span><br><span class="line">                    <span class="attr">msg</span>: <span class="title function_">isFunction</span>(watch.<span class="property">exp</span>) ? <span class="string">&#x27;fn: &#x27;</span> + (watch.<span class="property">exp</span>.<span class="property">name</span> || watch.<span class="property">exp</span>.<span class="title function_">toString</span>()) : watch.<span class="property">exp</span>,</span><br><span class="line">                    <span class="attr">newVal</span>: value,</span><br><span class="line">                    <span class="attr">oldVal</span>: last</span><br><span class="line">                  &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (watch === lastDirtyWatch) &#123;</span><br><span class="line">                <span class="comment">// If the most recently dirty watcher is now clean, short circuit since the remaining watchers</span></span><br><span class="line">                <span class="comment">// have already been tested.</span></span><br><span class="line">                dirty = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span> traverseScopesLoop;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            $exceptionHandler(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Insanity Warning: scope depth-first traversal</span></span><br><span class="line">      <span class="comment">// yes, this code is a bit crazy, but it works and we have tests to prove it!</span></span><br><span class="line">      <span class="comment">// this piece should be kept in sync with the traversal in $broadcast</span></span><br><span class="line">      <span class="keyword">if</span> (!(next = ((current.<span class="property">$$watchersCount</span> &amp;&amp; current.<span class="property">$$childHead</span>) ||</span><br><span class="line">          (current !== target &amp;&amp; current.<span class="property">$$nextSibling</span>)))) &#123;</span><br><span class="line">        <span class="keyword">while</span> (current !== target &amp;&amp; !(next = current.<span class="property">$$nextSibling</span>)) &#123;</span><br><span class="line">          current = current.<span class="property">$parent</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((current = next));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `break traverseScopesLoop;` takes us to here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((dirty || asyncQueue.<span class="property">length</span>) &amp;&amp; !(ttl--)) &#123;</span><br><span class="line">      <span class="title function_">clearPhase</span>();</span><br><span class="line">      <span class="keyword">throw</span> $rootScopeMinErr(<span class="string">&#x27;infdig&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;&#123;0&#125; $digest() iterations reached. Aborting!\n&#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;Watchers fired in the last 5 iterations: &#123;1&#125;&#x27;</span>,</span><br><span class="line">          <span class="variable constant_">TTL</span>, watchLog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">while</span> (dirty || asyncQueue.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clearPhase</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (postDigestQueue.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      postDigestQueue.<span class="title function_">shift</span>()();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      $exceptionHandler(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><code>$apply</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">$apply</span>: <span class="keyword">function</span>(<span class="params">expr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">beginPhase</span>(<span class="string">&#x27;$apply&#x27;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.$eval(expr);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="title function_">clearPhase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    $exceptionHandler(e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      $rootScope.$digest();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      $exceptionHandler(e);</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="脏检查的触发"><a href="#脏检查的触发" class="headerlink" title="脏检查的触发"></a>脏检查的触发</h2><p>angularjs 会在视图(view)或model(模型)发生变更的时候触发脏检查,即脏检查是<code>$digest</code>或<code>$apply</code>的执行。</p>
<p>angularjs使用<code>$watch</code>函数为<code>scope</code>添加一个监视器。当这个<code>scope</code>中有变化发生时，监视器便会提醒你。<br>在<code>Scope</code>中有一个对象数组<code>$$watchers</code>，里面保存着我们定义的所有的监视器对象<code>watcher</code>。</p>
<p>而<code>$apply</code>方法会触发 <code>$digest</code>,它将会在 <code>$rootScope</code>中运行digest循环,然后向下遍历每一个作用域并在每个作用域上运行循环.</p>
<p>angular中的一些所有方法都 scope.apply()里面，像ng−click http的回调函数等：</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20170804011447.png" alt="image"></p>
<p>在这些情况下，我们不需要自己调用,实际上我们也不能自己调用，否则在apply()方法里面再调用apply()方法会抛出错误,仅当这个新的执行序列不是被angular JS的库的方法创建的，这个时候我们需要将代码用scope.apply()包起来,如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$scope.<span class="property">message</span> =<span class="string">&quot;等2000ms后更新&quot;</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">　　$scope.$apply(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   　　$scope.<span class="property">message</span> =<span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<p>而 <code>$digest</code> 方法的执行即是遍历 <code>scope</code> 上绑定的所有 <code>watcher</code>，并执行相应的 <code>watch</code>（指定想要监控的对象） 和 listener（当数据改变时触发的回调） 方法。<code>$watch</code>这个函数的前两个，它指明了要观察什么(watchExp)，在变化时要发生什么(listener)。第三个参数是否深度监听:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$watch(watchExpression, listener, objectEquality);</span><br></pre></td></tr></table></figure>
<h2 id="循环进行脏值检查-脏值"><a href="#循环进行脏值检查-脏值" class="headerlink" title="循环进行脏值检查(脏值)"></a>循环进行脏值检查(脏值)</h2><p>当<code>digest</code>循环运行时，它将会遍历所有的监听器然后再次循环，只要这次循环发现了”脏值”，循环就会继续下去。如果watchExp的值和最新的值不相同，那么这次循环就会被认为发现了“脏值”。</p>
<p>如果两个 <code>watcher</code> 之间互相影响彼此，则会导致无限循环的问题。把digest的运行控制在一个可接受的迭代数量内。如果这么多次之后，作用域还在变更，在这个点上，会抛出一个异常，因为不管作用域的状态变成怎样，它都不太可能是用户想要的结果。<br>迭代的最大值称为TTL（short for Time To Live）。这个值默认是10，可能有点小，但是记住这是一个性能敏感的地方，因为digest经常被执行，而且每个digest运行了所有的监听器。用户也不太可能创建10个以上链状的监听器。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>脏检查其实它像闪电般快，如果你在一个模版里有2000-3000个watch，它会开始变慢。</p>
<p>Angular 1.x 的机制下，脏检查的执行范围过大以及频率过频繁</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="http://www.morphzhou.cn/?p=367">AngularJS源码分析之</a></li>
<li><a href="http://teropa.info/build-your-own-angular/build_your_own_angularjs_sample.pdf">Scopes and DirtyChecking</a></li>
<li><a href="http://www.angularjs.cn/A0a6">理解$watch ，$apply 和 $digest — 理解数据绑定过程</a></li>
<li><a href="http://www.angularjs.cn/A00q#scope">AngularJS开发指南04：核心概览</a></li>
<li><a href="http://www.angularjs.cn/A00r">AngularJS开发指南05：指令</a></li>
<li><a href="http://www.angularjs.cn/A00z">AngularJS开发指南14：依赖注入</a></li>
<li><a href="https://segmentfault.com/a/1190000010374926">Angular 学习笔记：$digest 实现原理</a></li>
<li><a href="https://segmentfault.com/a/1190000010433675#articleHeader3">Angular 1 深度解析：脏数据检查与 angular 性能优化</a></li>
<li><a href="http://www.jb51.net/article/111811.htm">AngularJS的脏检查深入分析</a></li>
</ol>
]]></content>
      <categories>
        <category>angular</category>
      </categories>
      <tags>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title>bower使用</title>
    <url>/2016/11/06/bower%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="bower"><a href="#bower" class="headerlink" title="bower"></a>bower</h2><p>Bower一个好用的Web包管理器，可以搜索、安装和卸载如JavaScript、HTML、CSS等资源</p>
<span id="more"></span>

<p>bower官网地址-英文：<a href="https://bower.io/">https://bower.io/</a></p>
<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_1.png" class="" title="bower英文网">

<p>bower官网地址-中文：<a href="http://www.bowercn.com/">http://www.bowercn.com/</a></p>
<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_2.png" class="" title="bower中文网">

<h2 id="安装bower"><a href="#安装bower" class="headerlink" title="安装bower"></a>安装bower</h2><p>Bower是命令行工具，通过npm安装,Bower依赖node, npm 和git.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g bower <span class="comment">#全局安装bower</span></span><br><span class="line"></span><br><span class="line">bower <span class="built_in">help</span> <span class="comment">#查看帮助</span></span><br><span class="line">bower -v   <span class="comment">#查看版本</span></span><br><span class="line">bower cache <span class="comment">#缓存管理</span></span><br><span class="line">bower <span class="built_in">help</span> <span class="comment">#显示Bower命令的帮助信息</span></span><br><span class="line">bower home <span class="comment">#通过浏览器打开一个包的github发布页</span></span><br><span class="line">bower info <span class="comment">#查看包的信息</span></span><br><span class="line">bower init <span class="comment">#创建bower.json文件</span></span><br><span class="line">bower install <span class="comment">#安装包</span></span><br><span class="line">bower <span class="built_in">link</span> <span class="comment">#在本地bower库建立一个项目链接</span></span><br><span class="line">bower list <span class="comment">#列出项目已安装的包</span></span><br><span class="line">bower lookup <span class="comment">#根据包名查询包的URL</span></span><br><span class="line">bower prune <span class="comment">#删除项目无关的包</span></span><br><span class="line">bower register <span class="comment">#注册一个包</span></span><br><span class="line">bower search <span class="comment">#搜索包</span></span><br><span class="line">bower update <span class="comment">#更新项目的包</span></span><br><span class="line">bower uninstall <span class="comment">#删除项目的包</span></span><br></pre></td></tr></table></figure>

<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_3.png" class="" title="bower-help">

<h2 id="bower使用"><a href="#bower使用" class="headerlink" title="bower使用"></a>bower使用</h2><p>通过命令 bower install安装软件包，默认会安装到 bower_components&#x2F;目录.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower install &lt;package&gt;</span><br></pre></td></tr></table></figure>

<p>想要下载的包可以是GitHub上的短链接（如jquery&#x2F;jquery）、 .git 、 一个URL或者其它. 了解更多： bower install。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过 bower.json 文件安装</span></span><br><span class="line">$ bower install</span><br><span class="line"><span class="comment"># 通过在github上注册的包名安装</span></span><br><span class="line">$ bower install jquery</span><br><span class="line"><span class="comment"># GitHub短链接</span></span><br><span class="line">$ bower install desandro/masonry</span><br><span class="line"><span class="comment"># Github上的 .git</span></span><br><span class="line">$ bower install git://github.com/user/package.git</span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line">$ bower install http://example.com/script.js</span><br></pre></td></tr></table></figure>

<h2 id="搜索包"><a href="#搜索包" class="headerlink" title="搜索包"></a>搜索包</h2><p>官网地址: <a href="https://bower.io/search/">https://bower.io/search/</a></p>
<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_4.png" class="" title="bower搜索">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower search jquery <span class="comment">#搜索jquery</span></span><br></pre></td></tr></table></figure>
<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_5.png" class="" title="bower搜索">

<h2 id="设置bower-json"><a href="#设置bower-json" class="headerlink" title="设置bower.json"></a>设置bower.json</h2><p>可以通过bower init命令新建一个bower.json文件。会提示你输入一些基本信息，根据提示按回车或者空格即可，然后会生成一个bower.json文件，用来保存该项目的配置。<br>果想保存依赖信息(dependencies)到你的bower.json文件，可以使用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower init <span class="comment">#新建bower,json文件</span></span><br><span class="line">bower install PACKAGE --save <span class="comment">#安装包并添加到 bower.json dependencies中</span></span><br><span class="line">bower install &lt;package&gt; --save-dev <span class="comment">#安装包并添加到 bower.json devDependencies中</span></span><br></pre></td></tr></table></figure>
<p>bower init，出现错误</p>
<img src="/2016/11/06/bower%E4%BD%BF%E7%94%A8/bower_6.png" class="" title="init错误">

<p>问题链接：<a href="https://github.com/bower/bower/issues/802">https://github.com/bower/bower/issues/802</a></p>
<p>在 windows cmd 里面使用 bower init,而不是在 git bash 里面使用 bower init.</p>
<p>参考文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;testbower&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;2.1.2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;测试bower&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;test&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;authors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;test&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;test.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;ignore&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;**/.*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bower_components&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lib/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tests&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bootstrap&quot;</span>: <span class="string">&quot;3.3.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jquery&quot;</span>: <span class="string">&quot;^3.1.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="设置包的安装目录"><a href="#设置包的安装目录" class="headerlink" title="设置包的安装目录"></a>设置包的安装目录</h2><p>Bower的配置文件是.bowerrc,使用JSON格式进行描述。详细参数 :<a href="http://www.bowercn.com/docs/config/">http://www.bowercn.com/docs/config/</a></p>
<p>再项目目录下新建.bowerrc文件，内容为如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;directory&quot;</span>: <span class="string">&quot;lib/&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower install jquery -save <span class="comment">#安装jquery,默认安装最新版本</span></span><br><span class="line">bower info jquery <span class="comment">#查找jquery的相关信息</span></span><br><span class="line">bower info jquery<span class="comment">#1.11.1 #查看指定版本的信息</span></span><br><span class="line">bower install jquery<span class="comment">#1.12.4 --save #安装指定版本的jquery-如果与你项目不兼容，则不成功</span></span><br></pre></td></tr></table></figure>
<h3 id="切换jquery版本"><a href="#切换jquery版本" class="headerlink" title="切换jquery版本"></a>切换jquery版本</h3><p>修改bower.json文件中的jquery版本,执行：bower update jquery</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;jquery&quot;</span>: <span class="string">&quot;~1.11.3&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="卸载包"><a href="#卸载包" class="headerlink" title="卸载包"></a>卸载包</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower uninstall jquery --save  <span class="comment">#卸载jquery包</span></span><br><span class="line">bower prune <span class="comment">#根据bower.json文件来清除包</span></span><br></pre></td></tr></table></figure>

<h2 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h2><p>用bower安装包时，bower会把这个包缓存到本地，下次再安装同样的包时，bower就会从本地缓存去下载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower cache list <span class="comment">#查看包缓存</span></span><br></pre></td></tr></table></figure>

<p>使用本地缓存安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower install jquery --offline --save</span><br><span class="line">bower cache clean <span class="comment">#清除缓存</span></span><br><span class="line">bower cache clean jquery <span class="comment">#清除jquery缓存</span></span><br></pre></td></tr></table></figure>

<h2 id="修改项目版本号"><a href="#修改项目版本号" class="headerlink" title="修改项目版本号"></a>修改项目版本号</h2><ul>
<li>major :项目有很大变化</li>
<li>minor :项目添加了一些功能</li>
<li>patch :项目修正了一些错误</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">v1.0.0 <span class="comment">#起初版本</span></span><br><span class="line"></span><br><span class="line">bower version major <span class="comment">#升级一大版本2.0.0</span></span><br><span class="line">bower version minor <span class="comment">#升级一中版本2.1.0</span></span><br><span class="line">bower version patch <span class="comment">#升级一小版本2.1.1</span></span><br></pre></td></tr></table></figure>

<h2 id="修改版本号自定义提交信息呢"><a href="#修改版本号自定义提交信息呢" class="headerlink" title="修改版本号自定义提交信息呢"></a>修改版本号自定义提交信息呢</h2><p>前提是你项目使用了版本控制如git,使用如下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bower version patch -m <span class="string">&quot;%s 修正一些小错误&quot;</span></span><br><span class="line">git <span class="built_in">log</span> <span class="comment">#查看日志</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>c#中的委托和事件</title>
    <url>/2016/05/06/c-%E4%B8%AD%E7%9A%84%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="委托"><a href="#委托" class="headerlink" title="委托"></a>委托</h2><p>委托（Delegate）都派生自 System.Delegate 类</p>
<p>委托（Delegate）特别用于实现事件和回调方法</p>
<p>委托可以叫为函数指针</p>
<p><a href="http://www.cnblogs.com/OpenCoder/archive/2009/09/23/1572646.html#3423915">c#委托-博客园传送</a></p>
<p>写的很详细，我参考抄的学习一下，希望作者不要嫌弃</p>
<span id="more"></span>

<h2 id="委托信息"><a href="#委托信息" class="headerlink" title="委托信息"></a>委托信息</h2><h3 id="委托的声明"><a href="#委托的声明" class="headerlink" title="委托的声明"></a>委托的声明</h3><blockquote>
<p>定义委托相当于声明了一个类,类如果不实例化为对象，很多功能是没有办法使用的，委托也是如此.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;委托类型&gt; &lt;实例化名&gt; = new &lt;委托类型&gt;(&lt;注册函数&gt;)</span><br><span class="line">public delegate void TestDelegate(int number);</span><br></pre></td></tr></table></figure>

<h3 id="委托的实例化"><a href="#委托的实例化" class="headerlink" title="委托的实例化"></a>委托的实例化</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">方法一：</span><br><span class="line">&lt;委托类型&gt; &lt;实例化名&gt;=new &lt;委托类型&gt;(&lt;注册函数&gt;)</span><br><span class="line">TestDelegate _testDelegate=new TestDelegate(Method);</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">&lt;委托类型&gt; &lt;实例化名&gt;=&lt;注册函数&gt;</span><br><span class="line">TestDelegate _testDelegate=Method;</span><br></pre></td></tr></table></figure>

<h3 id="用匿名函数初始化委托"><a href="#用匿名函数初始化委托" class="headerlink" title="用匿名函数初始化委托"></a>用匿名函数初始化委托</h3><p>方法一：<br>&lt;委托类型&gt; &lt;实例化名&gt;&#x3D;new &lt;委托类型&gt;(delegate(&lt;函数参数&gt;){函数体});</p>
<p>方法二：<br>&lt;委托类型&gt; &lt;实例化名&gt;&#x3D;delegate(&lt;函数参数&gt;){函数体};</p>
<p>代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">delegate void Test1(int i);</span><br><span class="line">delegate int Test2(int j);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Test1 t1 = new Test1(delegate(int i)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">print</span>(i);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//调用方法</span><br><span class="line">private void <span class="function"><span class="title">TestDelegate</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">   Test2 t2 = delegate(int j)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="built_in">return</span> j;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   t1(5);</span><br><span class="line">   <span class="built_in">print</span>(t2(10));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型委托"><a href="#泛型委托" class="headerlink" title="泛型委托"></a>泛型委托</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"> * T2作为函数返回类型</span><br><span class="line"> * T1作为委托函数的参数类型</span><br><span class="line"> */</span><br><span class="line">delegate T2 Test&lt;T1, T2&gt;(T1 t);</span><br><span class="line">private int TestAdd(int i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//调用</span><br><span class="line">private void <span class="function"><span class="title">TestDelegate</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    Test&lt;int, int&gt; t = TestAdd;</span><br><span class="line">    <span class="built_in">print</span>(t(20));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="委托的多播"><a href="#委托的多播" class="headerlink" title="委托的多播"></a>委托的多播</h3><p>委托的多播（Multicasting of a Delegate）</p>
<p>使用 “+&#x3D;” 运算符进行合并<br>使用 “-&#x3D;” 运算符进行移除</p>
<p><strong>对注册了函数的委托实例重新使用&#x3D;号赋值，相当于是重新实例化了委托</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">delegate int Calculate(int i);</span><br><span class="line">private static int num = 10;</span><br><span class="line">private int AddNum(int p)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> num += p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private int MultNum(int q)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> num *= q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private int <span class="function"><span class="title">GetNum</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//调用</span><br><span class="line">private void <span class="function"><span class="title">TestDelegate</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    Calculate c;</span><br><span class="line">    Calculate c1 = AddNum;</span><br><span class="line">    Calculate c2 = MultNum;</span><br><span class="line"></span><br><span class="line">    c = c1;</span><br><span class="line">    c += c2;</span><br><span class="line"></span><br><span class="line">    //调用多播 =&gt; 24</span><br><span class="line">    c(2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(GetNum());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="事件event"><a href="#事件event" class="headerlink" title="事件event"></a>事件event</h3><p>事件（Event） 基本上说是一个用户操作，如按键、点击、鼠标移动等等，或者是一些出现，如系统生成的通知。应用程序需要在事件发生时响应事件。</p>
<p>event 关键字用于在发行者类中声明事件</p>
<p>所有的事件参数类都必须从 System.EventArgs类派生。<br>事件不含参数，可以直接用System.EventArgs类作为参数。</p>
<p>未完待续…</p>
]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title>cmder</title>
    <url>/2016/11/27/cmder/</url>
    <content><![CDATA[<h2 id="cmder简介"><a href="#cmder简介" class="headerlink" title="cmder简介"></a>cmder简介</h2><p>Cmder是一个软件包，它被创建出来替代极不满没有漂亮的控制台模拟器的Windows上<br>它是基于ConEmu与主要配置改革,附带了一个Monokai配色方案</p>
<img src="/2016/11/27/cmder/cmder.png" class="" title="cmder">

<p>它的官网：<a href="http://cmder.net/">http://cmder.net/</a><br>它的github地址：<a href="https://github.com/cmderdev/cmder">https://github.com/cmderdev/cmder</a></p>
<span id="more"></span>

<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>同一个窗口可以含有多个tab选项卡，类似浏览器那样。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>从官网下载文件，如下图：</p>
<img src="/2016/11/27/cmder/cmder_download.png" class="" title="cmder下载">
<p>从图上看,它有两个版本，一个mini版，一个是full版(xx.zip&#x2F;xx.7z)。</p>
<img src="/2016/11/27/cmder/git_forwindow.png" class="" title="git_for_window">
<p>mini版文件少一些，full版集成git-for-windows</p>
<p>这里下载mini版，下载完文件后解压到一个文件夹存储(文件夹名字自己起，如：cmder_mini)，<br>然后将这个文件夹放到你的某个目录下，运行方式有以下：</p>
<ul>
<li>文件里面有个Cmder.exe，点击直接运行。</li>
<li>创建桌面快捷方式，点击运行</li>
</ul>
<h3 id="将cmder添加到右键菜单"><a href="#将cmder添加到右键菜单" class="headerlink" title="将cmder添加到右键菜单"></a>将cmder添加到右键菜单</h3><ol>
<li>配置系统环境变量，将cmder安装路径添加到系统环境变量中，如下：</li>
</ol>
<img src="/2016/11/27/cmder/cmder_path.png" class="" title="配置cmder环境变量">

<p>点击确定</p>
<ol start="2">
<li>打开windows命令窗口，切换到cmder的安装目录下：</li>
</ol>
<img src="/2016/11/27/cmder/contentmenu.png" class="" title="添加到右键菜单">

<p>执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Cmder.exe /REGISTER ALL</span><br></pre></td></tr></table></figure>
<p>到此，ok,此时查看右键有没有cmder菜单</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>打开cmder,如果出现如下错误，可以不用管:</p>
<img src="/2016/11/27/cmder/cmder_error.png" class="" title="错误">

<h3 id="cmd的使用"><a href="#cmd的使用" class="headerlink" title="cmd的使用"></a>cmd的使用</h3><p>打开后，一般默认是cmd命令选项卡，此时你可以在这里使用cmd窗口的常用命令</p>
<img src="/2016/11/27/cmder/use_1.png" class="" title="cmd使用">

<h3 id="git-bash的使用"><a href="#git-bash的使用" class="headerlink" title="git bash的使用"></a>git bash的使用</h3><p>我们这里的cmder是mini版，里面没有集成git，此时，你要自己去下载git，并且安装它。<br>安装完成后，开始cmder配置git</p>
<p><strong>自动添加git bash</strong></p>
<img src="/2016/11/27/cmder/use_2.png" class="" title="配置">

<p>鼠标点击右下的绿色加号旁，会出现如下菜单，其中有个bash,我们，选择其中的任一项，都会出现如上图的提示，…git-for-windows…<br>此时我们已经装了git，但是cmder没有找到，所以会报这个错。上图提示有个快捷键 <strong>win+alt+t</strong>，</p>
<p>按下win+alt+t，出现如下界面，</p>
<img src="/2016/11/27/cmder/use_3.png" class="" title="设置界面">

<p>我们再点击下图中的 add default task,出现提示，然后击是，再点击save setting</p>
<img src="/2016/11/27/cmder/use_4.png" class="" title="重写默认任务">

<p>此时列表可能多了一些选项，此时没关闭设置窗口，再选择一次bash中的Git bash,就可以打开一个git bash的选项卡</p>
<img src="/2016/11/27/cmder/use_5.png" class="" title="git bash">

<p>到此你已经打开一个cmd 选项卡，和一个git bash选项卡了<br>我们这里使用了 add default task 的方式添加重写默认任务，这种方式快速简单</p>
<p><strong>手动添加git bash</strong><br>打开设置面板，点击+号,输入git bash ,设置git安装路径，如下图，保存设置</p>
<img src="/2016/11/27/cmder/use_6.png" class="" title="git bash">

<p>此时+号旁会的列表多出一个选项git bash ，点击后，也可以打开一个git bash的选项卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span> <span class="comment">#查看当前shell</span></span><br></pre></td></tr></table></figure>

<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Win + Alt + p <span class="comment">#打开设置面板</span></span><br><span class="line">Ctrl + w <span class="comment">#关闭选项卡</span></span><br><span class="line">Alt + Enter <span class="comment">#全屏切换</span></span><br><span class="line">Ctrl + n <span class="comment">#快速切换到第n个页签( n值无上限)</span></span><br><span class="line">Ctrl + Tab <span class="comment">#切换标签页</span></span><br></pre></td></tr></table></figure>

<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p>win + alt + p打开设置面板</p>
<h3 id="设置背景"><a href="#设置背景" class="headerlink" title="设置背景"></a>设置背景</h3><img src="/2016/11/27/cmder/cmder_bg.png" class="" title="设置背景">

<h3 id="设置主题"><a href="#设置主题" class="headerlink" title="设置主题"></a>设置主题</h3><img src="/2016/11/27/cmder/set_1.png" class="" title="设置主题">

<h3 id="设置快捷键"><a href="#设置快捷键" class="headerlink" title="设置快捷键"></a>设置快捷键</h3><img src="/2016/11/27/cmder/set_2.png" class="" title="设置快捷键">
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>c#中的数组与集合</title>
    <url>/2016/04/19/c-%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84%E4%B8%8E%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h2 id="得到想要的"><a href="#得到想要的" class="headerlink" title="得到想要的"></a>得到想要的</h2><p>数据的简单与复杂，我已经无法理解了</p>
<p>在生活中经常处理数据，不管用什么方法，方式，我们都希望：容易、高效、简单，就是想方便，就是想做很少的事情，把我们的目的达到，得到我们想要的东西。</p>
<p>废话多了。。。</p>
<span id="more"></span>

<h2 id="数组-Array"><a href="#数组-Array" class="headerlink" title="数组(Array)"></a>数组(Array)</h2><p>数组是一个存储相同类型元素的固定大小的顺序集合。</p>
<p>声明数组：type[] arrayName;</p>
<p><strong>数组的特点：</strong></p>
<ol>
<li>数组大小固定，不能伸缩</li>
<li>数值数组元素的默认值设置为零，而引用元素的默认值设置为 null</li>
<li>数组的索引从零开始</li>
<li>数组可读可写</li>
<li>数组要声明元素的类型</li>
</ol>
<p>看一些简单的使用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eg:例子1</span><br><span class="line">int[] a = new int[20];定义int数组</span><br><span class="line">a [2] = 100;</span><br><span class="line">Debug.Log (a[2]);           //返回 100</span><br><span class="line">Debug.Log (a[5]);           //返回 0</span><br><span class="line"></span><br><span class="line">eg:例子2</span><br><span class="line">string[] numbers = new string[10];</span><br><span class="line">numbers[2] = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">numbers[3] = <span class="string">&quot;b&quot;</span>;</span><br><span class="line">Debug.Log (numbers[0]);     //返回    null</span><br><span class="line">Debug.Log (numbers[2]);     //返回    a</span><br><span class="line">Debug.Log (numbers[5]);     //返回    null</span><br><span class="line"></span><br><span class="line">eg:例子3</span><br><span class="line">string[] numbers = new string[]&#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line">Debug.Log (numbers[2]);     //返回    c</span><br><span class="line">Debug.Log (numbers[5]);     //返回    引起错误</span><br><span class="line"></span><br><span class="line">eg:例子4</span><br><span class="line">string[] numbers = new string[]&#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line">Debug.Log (numbers[2]);     //返回    c</span><br><span class="line">Debug.Log (numbers[5]);     //返回    引起错误</span><br><span class="line"></span><br><span class="line">eg:例子5</span><br><span class="line">string[] numbers = &#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line">Debug.Log (numbers[0]);     //返回    a</span><br></pre></td></tr></table></figure>

<h2 id="集合（Collection）"><a href="#集合（Collection）" class="headerlink" title="集合（Collection）"></a>集合（Collection）</h2><p>集合（Collection）类是专门用于数据存储和检索的类。这些类有：<br>动态数组（ArrayList）、列表（List）、字典（Dictionary）、哈希表（Hashtable）、堆栈（Stack）、队列（Queue）、点阵列（BitArray）；</p>
<h3 id="动态数组（ArrayList）"><a href="#动态数组（ArrayList）" class="headerlink" title="动态数组（ArrayList）"></a>动态数组（ArrayList）</h3><p>动态数组（ArrayList）代表了可被单独索引的对象的有序集合。<br>与数组不同的是，您可以使用索引在指定的位置添加和移除项目，动态数组会自动重新调整它的大小。它也允许在列表中进行动态内存分配、增加、搜索、排序各项。</p>
<p>特点：可以根据需要进行扩充</p>
<p><strong>注意：ArrayList存在不安全类型与装箱拆箱的缺点</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eg:例子1</span><br><span class="line">ArrayList numbers = new ArrayList();</span><br><span class="line"></span><br><span class="line">//新增数据</span><br><span class="line">numbers.Add(100);</span><br><span class="line">numbers.Add(<span class="string">&quot;AAA&quot;</span>);</span><br><span class="line">numbers.Add(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">//删除数据</span><br><span class="line">numbers.Remove(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">//修改数据</span><br><span class="line">numbers[1] = <span class="string">&quot;修改数据&quot;</span>;</span><br><span class="line"></span><br><span class="line">//插入数据</span><br><span class="line">numbers.Insert(2, <span class="string">&quot;插入数据&quot;</span>);</span><br><span class="line"></span><br><span class="line">eg:例子2</span><br><span class="line">ArrayList numbers = new <span class="function"><span class="title">ArrayList</span></span>() &#123; 200,5,50,100,800&#125;;</span><br><span class="line">ArrayList letters = new <span class="function"><span class="title">ArrayList</span></span>() &#123; <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span> ,<span class="string">&quot;b&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">//排序</span><br><span class="line">numbers.Sort(); //返回 5 50 100 200 800</span><br><span class="line">letters.Sort(); //返回 a b b c d z</span><br><span class="line"></span><br><span class="line">//反转</span><br><span class="line">numbers.Reverse();  //返回 800 200 100 50 5</span><br><span class="line">letters.Reverse();  //返回 z d c b b a</span><br><span class="line"></span><br><span class="line">Clone()复制一个数组 。。。</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/system.collections.arraylist%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="列表List"><a href="#列表List" class="headerlink" title="列表List"></a>列表List</h3><p>List是一个泛型列表。<br>可通过索引访问的对象的强类型列表， 提供用于对列表进行搜索、排序和操作的方法。</p>
<ol>
<li>list与ArrayList功能类似</li>
<li>T如果为引用类型则要考虑装箱问题，就和ArrayList效果一样了</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">List&lt;T&gt; dinosaurs = new List&lt;T&gt;()</span><br><span class="line"></span><br><span class="line">eg：1</span><br><span class="line">List&lt;string&gt; numbers = new List&lt;string&gt;();</span><br><span class="line">numbers.Add(<span class="string">&quot;ZZZ&quot;</span>); //添加元素</span><br><span class="line">numbers.RemoveAt(0);//移除下标为0的元素</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/6sh2ey19%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="字典Dictionary"><a href="#字典Dictionary" class="headerlink" title="字典Dictionary"></a>字典Dictionary</h3><p>Dictionary表示键和值的集合，每个元素都是一个键值对。<br>是一个泛型列表。</p>
<ol>
<li>键（key）是唯一的</li>
<li>键（key）和值（Value）可以是任何类型（包括自定义类型）</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Dictionary&lt;TKey,TValue&gt; myDictionary = new Dictionary&lt;TKey,TValue&gt;();</span><br><span class="line"></span><br><span class="line">eg:1</span><br><span class="line">Dictionary&lt;string, string&gt; numbers = new Dictionary&lt;string, string&gt;() &#123;</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span>,<span class="string">&quot;100&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;name&quot;</span>,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;lev&quot;</span>,<span class="string">&quot;15&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;info&quot;</span>,<span class="string">&quot;text text&quot;</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//添加数据</span><br><span class="line">numbers.Add(<span class="string">&quot;sum&quot;</span>,<span class="string">&quot;1000&quot;</span>);</span><br><span class="line"></span><br><span class="line">//移除数据</span><br><span class="line">numbers.Remove(<span class="string">&quot;info&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/xfhwa508%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="排序列表SortedList"><a href="#排序列表SortedList" class="headerlink" title="排序列表SortedList"></a>排序列表SortedList</h3><p>SortedList 类代表了一系列按照键来排序的键&#x2F;值对，这些键值对可以通过键和索引来访问。</p>
<ol>
<li>如果您使用索引访问各项，则它是一个动态数组（ArrayList）</li>
<li>如果您使用键访问各项，则它是一个哈希表（Hashtable）。</li>
<li>集合中的各项总是按键值排序。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eg:1</span><br><span class="line">SortedList numbers = new <span class="function"><span class="title">SortedList</span></span>() &#123;</span><br><span class="line">    &#123;100,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">    &#123;500,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">    &#123;300,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">    &#123;1,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">    &#123;5,<span class="string">&quot;bbb&quot;</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">foreach (int index <span class="keyword">in</span> numbers.Keys)</span><br><span class="line">&#123;</span><br><span class="line">    Console.Write(index + <span class="string">&quot; &quot;</span> + numbers[index]+<span class="string">&quot;, &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">1 aaa, 5 bbb, 100 aaa, 300 aaa, 500 aaa,</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/ms132319%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="哈希表（Hashtable）"><a href="#哈希表（Hashtable）" class="headerlink" title="哈希表（Hashtable）"></a>哈希表（Hashtable）</h3><p>Hashtable 类代表了一系列基于键的哈希代码组织起来的键&#x2F;值对。它使用键来访问集合中的元素。</p>
<ol>
<li>HashTable可添加任意类型的元素</li>
<li>HashTable添加时装箱，读取时拆箱</li>
<li>HashTable不支持泛型</li>
<li>Hashtable 的元素属于 Object 类型</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Hashtable ht = new <span class="function"><span class="title">Hashtable</span></span>() &#123;</span><br><span class="line">   &#123;<span class="string">&quot;100&quot;</span>,<span class="string">&quot;aaa&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;101&quot;</span>,<span class="string">&quot;xxx&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;5&quot;</span>,<span class="string">&quot;dd&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;50&quot;</span>,<span class="string">&quot;cc&quot;</span>&#125;,</span><br><span class="line">   &#123;<span class="string">&quot;800&quot;</span>,<span class="string">&quot;dd&quot;</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/system.collections.hashtable%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="栈Stack"><a href="#栈Stack" class="headerlink" title="栈Stack"></a>栈Stack</h3><p>堆栈（Stack）代表了一个后进先出的对象集合。<br>当您需要对各项进行后进先出的访问时，则使用堆栈。<br>当您在列表中添加一项，称为推入元素，当您从列表中移除一项时，称为弹出元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Stack st = new Stack();</span><br><span class="line"></span><br><span class="line">st.Push(<span class="string">&quot;axdsax&quot;</span>);</span><br><span class="line">st.Push(<span class="string">&quot;sad&quot;</span>);</span><br><span class="line">st.Push(<span class="string">&quot;adasxx&quot;</span>);</span><br><span class="line">st.Push(<span class="string">&quot;a4&quot;</span>);</span><br><span class="line"></span><br><span class="line">foreach (string c <span class="keyword">in</span> st)</span><br><span class="line">&#123;</span><br><span class="line">   Console.Write(c + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/3278tedw%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="队列（Queue）"><a href="#队列（Queue）" class="headerlink" title="队列（Queue）"></a>队列（Queue）</h3><p>队列（Queue）代表了一个先进先出的对象集合。<br>当您需要对各项进行先进先出的访问时，则使用队列。<br>当您在列表中添加一项，称为入队，当您从列表中移除一项时，称为出队。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Queue que = new Queue();</span><br><span class="line"></span><br><span class="line">//向队列加入元素</span><br><span class="line">que.Enqueue(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">que.Enqueue(<span class="string">&quot;105&quot;</span>);</span><br><span class="line">que.Enqueue(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">que.Enqueue(<span class="string">&quot;500&quot;</span>);</span><br><span class="line"></span><br><span class="line">foreach (string c <span class="keyword">in</span> que)</span><br><span class="line">&#123;</span><br><span class="line">  Console.Write(c + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">100 105 100 500</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/7977ey2c%28v=vs.110%29.aspx">msdn传送</a></p>
<h3 id="点阵列（BitArray）"><a href="#点阵列（BitArray）" class="headerlink" title="点阵列（BitArray）"></a>点阵列（BitArray）</h3><p>BitArray 类管理一个紧凑型的位值数组，它使用布尔值来表示，其中 true 表示位是开启的（1），false 表示位是关闭的（0）。</p>
<p>当您需要存储位，但是事先不知道位数时，则使用点阵列。您可以使用整型索引从点阵列集合中访问各项，索引从零开始。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// 创建两个大小为 8 的点阵列</span><br><span class="line">BitArray ba1 = new BitArray(8);</span><br><span class="line">byte[] a = &#123; 60 &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 把值 60 存储到点阵列中</span><br><span class="line">ba1 = new BitArray(a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (int i = 0; i &lt; ba1.Count; i++)</span><br><span class="line">&#123;</span><br><span class="line">   Console.Write(<span class="string">&quot;&#123;0&#125; &quot;</span>, ba1[i]);</span><br><span class="line">&#125;</span><br><span class="line">返回：False False True True True True False False</span><br></pre></td></tr></table></figure>

<p>具体方法：<a href="https://msdn.microsoft.com/zh-cn/library/system.collections.bitarray%28v=vs.110%29.aspx">msdn传送</a></p>
]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title>css选择符</title>
    <url>/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>类选择符允许以一种独立于文档元素的方式来指定样式，该选择符可以单独使用，也可以与其他元素结合使用。像id、class、标签等选择符我们平时都很常用，可是css选择符有好多种，许多选择符我们不常用的话，就会忽略它。</p>
<h2 id="css选择符参考图"><a href="#css选择符参考图" class="headerlink" title="css选择符参考图"></a>css选择符参考图</h2><img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/w3school.png" class="" title="css选择符参考图">

<span id="more"></span>

<h2 id="元素选择符"><a href="#元素选择符" class="headerlink" title="元素选择符"></a>元素选择符</h2><h3 id="通用选择符"><a href="#通用选择符" class="headerlink" title="通用选择符 *"></a>通用选择符 *</h3><p>通用选择符*****会选中页面中所有的元素。可以发现许多网页用来重置浏览符样式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">* &#123;margin:0;padding:0;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#container * &#123;</span></span><br><span class="line"> border: 1px solid black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ID选择符"><a href="#ID选择符" class="headerlink" title="ID选择符(#)"></a>ID选择符(#)</h3><p>在选择符中使用“#”可以用id来定位某个元素。在使用的时候得注意的是ID选择符<br>一个文档里不能重复使用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#content &#123;width:1000px;margin:0 auto;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="class类选择符"><a href="#class类选择符" class="headerlink" title=".class类选择符"></a>.class类选择符</h3><p>class类选择符和id选择符的不同是，它可以无限复用，当页面中有很多元素需要用到相同的样式属性时，你可以通过.class来定义。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.old&#123;color:<span class="comment">#565656;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="标签选择符"><a href="#标签选择符" class="headerlink" title="标签选择符"></a>标签选择符</h3><p>使用标签选择符作用于作用域范围内的所有对应标签。优先级仅仅比*高。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a &#123;color:red;text-decoration:none;&#125;</span><br><span class="line">ul &#123;padding:0;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关系选择符"><a href="#关系选择符" class="headerlink" title="关系选择符"></a>关系选择符</h2><h3 id="后代选择符"><a href="#后代选择符" class="headerlink" title="后代选择符"></a>后代选择符</h3><p>当你需要更精确地定位时，可以使用后代选择符。例如，假如说你只想选择无序列表里的链接，而不是所有的链接？这种情况下你就应该使用后代选择符。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">li a &#123;text-decoration: none;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="子选择符"><a href="#子选择符" class="headerlink" title="子选择符"></a>子选择符</h3><p>有些时候后代选择器的功能过于强大，与我们想要的结果相比他匹配的更多。有时我们只需要选择父元素的直接子元素而不是一个祖先元素内部嵌套的所有元素。这时候子选择器闪亮登场，可以使用＞代替空白符号来放在父元素与子元素之间，就可以创建一个子选择器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">article &gt; p &#123;font-size:16px;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="相邻选择符"><a href="#相邻选择符" class="headerlink" title="相邻选择符"></a>相邻选择符</h3><p>选择第一个元素后紧跟的元素,两者拥有相同的父元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">h2 + p &#123;color:red;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="兄弟选择符"><a href="#兄弟选择符" class="headerlink" title="兄弟选择符"></a>兄弟选择符</h3><p>选择第一个元素后的兄弟元素,两者拥有相同的父元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">h2 ~ p&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="属性选择符"><a href="#属性选择符" class="headerlink" title="属性选择符"></a>属性选择符</h2><h3 id="E-att"><a href="#E-att" class="headerlink" title="E[att]"></a>E[att]</h3><p>选择具有att属性的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a[title]&#123;color: green;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”"><a href="#E-att-x3D-”val”" class="headerlink" title="E[att&#x3D;”val”]"></a>E[att&#x3D;”val”]</h3><p>选择具有att属性且属性值等于val的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input[<span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>]&#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”-1"><a href="#E-att-x3D-”val”-1" class="headerlink" title="E[att~&#x3D;”val”]"></a>E[att~&#x3D;”val”]</h3><p>选择具有att属性且属性值为一用空格分隔的字词列表，其中一个等于val的E元素（包含只有一个值且该值等于val的情况）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div[class~=<span class="string">&quot;col&quot;</span>]&#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”-2"><a href="#E-att-x3D-”val”-2" class="headerlink" title="E[att^&#x3D;”val”]"></a>E[att^&#x3D;”val”]</h3><p>选择具有att属性且属性值为以val开头的字符串的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div[class^=<span class="string">&quot;abc&quot;</span>] &#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”-3"><a href="#E-att-x3D-”val”-3" class="headerlink" title="E[att$&#x3D;”val”]"></a>E[att$&#x3D;”val”]</h3><p>选择具有att属性且属性值为以val结尾的字符串的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div[class$=<span class="string">&quot;ccc&quot;</span>] &#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”-4"><a href="#E-att-x3D-”val”-4" class="headerlink" title="E[att*&#x3D;”val”]"></a>E[att*&#x3D;”val”]</h3><p>选择具有att属性且属性值为包含val的字符串的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div[class*=<span class="string">&quot;bb&quot;</span>] &#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-att-x3D-”val”-5"><a href="#E-att-x3D-”val”-5" class="headerlink" title="E[att|&#x3D;”val”]"></a>E[att|&#x3D;”val”]</h3><p>选择具有att属性且属性值为以val开头并用连接符”-“分隔的字符串的E元素，如果属性值仅为val，也将被选择。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div[class|=<span class="string">&quot;a&quot;</span>] &#123;border: 2px solid <span class="comment">#000;&#125;</span></span><br><span class="line"></span><br><span class="line">&lt;div class=<span class="string">&quot;a-test&quot;</span>&gt;1&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="伪类选择符"><a href="#伪类选择符" class="headerlink" title="伪类选择符"></a>伪类选择符</h2><h3 id="E-link"><a href="#E-link" class="headerlink" title="E:link"></a>E:link</h3><p>指示未访问过的链接的样式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:<span class="built_in">link</span> &#123;color:red;&#125;   </span><br></pre></td></tr></table></figure>

<h3 id="E-visited"><a href="#E-visited" class="headerlink" title="E:visited"></a>E:visited</h3><p>设置超链接a在其链接地址已被访问过时的样式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:visited&#123;color: <span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-hover"><a href="#E-hover" class="headerlink" title="E:hover"></a>E:hover</h3><p>设置元素在其鼠标悬停时的样式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:hover&#123;background:red;color:<span class="comment">#f00;&#125;</span></span><br><span class="line">div:hover&#123;background: <span class="comment">#ddd;color:#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-active"><a href="#E-active" class="headerlink" title="E:active"></a>E:active</h3><p>设置元素在被用户激活（在鼠标点击与释放之间发生的事件）时的样式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a:active,</span><br><span class="line">div:active &#123;background:<span class="comment">#ddd;color:#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-focus"><a href="#E-focus" class="headerlink" title="E:focus"></a>E:focus</h3><p>设置元素在成为输入焦点（该元素的onfocus事件发生）时的样式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input:focus &#123;background: <span class="comment">#f6f6f6;color: #f60;border: 1px solid #f60;outline: none;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-lang-fr"><a href="#E-lang-fr" class="headerlink" title="E:lang(fr)"></a>E:lang(fr)</h3><p>匹配使用特殊语言的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:lang(zh-cmn-Hans) &#123;color: <span class="comment">#f00;&#125;</span></span><br><span class="line">p:lang(en) &#123;color: <span class="comment">#090;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-not-s"><a href="#E-not-s" class="headerlink" title="E:not(s)"></a>E:not(s)</h3><p>匹配不含有s选择符的元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.demo li:not(:last-child) &#123;border-bottom: 1px solid <span class="comment">#ddd;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-root"><a href="#E-root" class="headerlink" title="E:root"></a>E:root</h3><p>匹配E元素在文档的根元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.<span class="built_in">test</span>&#123;color:black; color: yellow\0; *color: blue; _color: red;&#125; html:root .<span class="built_in">test</span> &#123; color: purple\0; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="E-first-child"><a href="#E-first-child" class="headerlink" title="E:first-child"></a>E:first-child</h3><p>匹配父元素的第一个子元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:first-child&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-last-child"><a href="#E-last-child" class="headerlink" title="E:last-child"></a>E:last-child</h3><p>匹配父元素的最后一个子元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:last-child&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-only-child"><a href="#E-only-child" class="headerlink" title="E:only-child"></a>E:only-child</h3><p>匹配父元素仅有的一个子元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">li:only-child &#123;color: <span class="comment">#f00;&#125;</span></span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;伪类选择符 E:only-child&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">	&lt;li&gt;伪类选择符 E:only-child&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;伪类选择符 E:only-child&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;伪类选择符 E:only-child&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<h3 id="E-nth-child-n"><a href="#E-nth-child-n" class="headerlink" title="E:nth-child(n)"></a>E:nth-child(n)</h3><p>匹配父元素的第n个子元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">li:nth-child(2n)&#123;color:<span class="comment">#f00;&#125; // 偶数</span></span><br><span class="line">li:nth-child(2n+1)&#123;color:<span class="comment">#000;&#125; //奇数</span></span><br><span class="line"></span><br><span class="line">li:nth-child(even)&#123;color:<span class="comment">#f00;&#125;// 偶数</span></span><br><span class="line">li:nth-child(odd)&#123;color:<span class="comment">#000;&#125; //奇数</span></span><br></pre></td></tr></table></figure>

<p><strong>因为(n)代表一个乘法因子，可以是0, 1, 2, 3, …, 所以(2n)换算出来会是偶数，而(2n+1)换算出来会是奇数</strong></p>
<h3 id="E-nth-last-child-n"><a href="#E-nth-last-child-n" class="headerlink" title="E:nth-last-child(n)"></a>E:nth-last-child(n)</h3><p>匹配父元素的倒数第n个子元素E,要使该属性生效，E元素必须是某个元素的子元素，E的父元素最高是body，即E可以是body的子元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:nth-last-child(2)&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-first-of-type"><a href="#E-first-of-type" class="headerlink" title="E:first-of-type"></a>E:first-of-type</h3><p>匹配同类型中的第一个同级兄弟元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:first-of-type&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-last-of-type"><a href="#E-last-of-type" class="headerlink" title="E:last-of-type"></a>E:last-of-type</h3><p>匹配同类型中的最后一个同级兄弟元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:last-of-type&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-only-of-type"><a href="#E-only-of-type" class="headerlink" title="E:only-of-type"></a>E:only-of-type</h3><p>匹配同类型中的唯一的一个同级兄弟元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:only-of-type&#123;color: <span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-nth-of-type-n"><a href="#E-nth-of-type-n" class="headerlink" title="E:nth-of-type(n)"></a>E:nth-of-type(n)</h3><p>匹配同类型中的第n个同级兄弟元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">span:nth-of-type(1)&#123;color:<span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-nth-last-of-type-n"><a href="#E-nth-last-of-type-n" class="headerlink" title="E:nth-last-of-type(n)"></a>E:nth-last-of-type(n)</h3><p>匹配同类型中的倒数第n个同级兄弟元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:nth-last-of-type(1) &#123;color: <span class="comment">#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-empty"><a href="#E-empty" class="headerlink" title="E:empty"></a>E:empty</h3><p>匹配没有任何子元素（包括text节点）的元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:empty &#123;height:25px;border: 1px solid <span class="comment">#ddd;background:#eee;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-checked"><a href="#E-checked" class="headerlink" title="E:checked"></a>E:checked</h3><p>匹配用户界面上处于选中状态的元素E。(用于input type为radio与checkbox时)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input:checked + span &#123;background: <span class="comment">#f00;&#125;</span></span><br><span class="line">input:checked + span:after &#123;content: <span class="string">&quot; 我被选中了&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="E-enabled"><a href="#E-enabled" class="headerlink" title="E:enabled"></a>E:enabled</h3><p>匹配用户界面上处于可用状态的元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input[<span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>]:enabled &#123;border: 1px solid <span class="comment">#090;background: #fff;color: #000;&#125;</span></span><br><span class="line">input[<span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>]:disabled &#123;border: 1px solid <span class="comment">#ccc;background: #eee;color: #ccc;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-disabled"><a href="#E-disabled" class="headerlink" title="E:disabled"></a>E:disabled</h3><p>匹配用户界面上处于禁用状态的元素E。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input[<span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>]:enabled &#123;border: 1px solid <span class="comment">#090;background: #fff;color: #000;&#125;</span></span><br><span class="line">input[<span class="built_in">type</span>=<span class="string">&quot;text&quot;</span>]:disabled &#123;border: 1px solid <span class="comment">#ccc;background: #eee;color: #ccc;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-target"><a href="#E-target" class="headerlink" title="E:target"></a>E:target</h3><p>匹配相关URL指向的E元素。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#demo:target&#123;color:#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="page-first"><a href="#page-first" class="headerlink" title="@page:first"></a>@page:first</h3><p>设置在打印时页面容器第一页使用的样式。仅用于@page规则。该伪类选择符只允许定义margin, orphans, widows 和 page breaks相关属性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@page:first&#123;margin:100px 200px;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="page-left"><a href="#page-left" class="headerlink" title="@page:left"></a>@page:left</h3><p>设置页面容器位于装订线左边的所有页面使用的样式。仅用于@page规则。该伪类选择符只允许定义margin, padding, border 和 background属性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@page :left &#123;margin-left: 300px;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="page-right"><a href="#page-right" class="headerlink" title="@page:right"></a>@page:right</h3><p>设置页面容器位于装订线右边的所有页面使用的样式。仅用于@page规则。该伪类选择符只允许定义margin, padding, border 和 background属性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@page:right&#123;margin-right:300px;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="伪对象选择符"><a href="#伪对象选择符" class="headerlink" title="伪对象选择符"></a>伪对象选择符</h2><h3 id="E-first-letter-x2F-E-first-letter"><a href="#E-first-letter-x2F-E-first-letter" class="headerlink" title="E:first-letter&#x2F;E::first-letter"></a>E:first-letter&#x2F;E::first-letter</h3><p>设置对象内的第一个字符的样式。此伪对象仅作用于块对象。内联对象要使用该伪对象，必须先将其设置为块级对象。该伪类常被用来配合font-size属性和float属性制作首字下沉效果。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:first-letter &#123;<span class="built_in">float</span>:left;font-size:40px;font-weight:bold;line-height:1;&#125;</span><br><span class="line">p::first-letter &#123;<span class="built_in">float</span>:left;font-size:40px;font-weight:bold;line-height:1;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="E-first-line-x2F-E-first-line"><a href="#E-first-line-x2F-E-first-line" class="headerlink" title="E:first-line&#x2F;E::first-line"></a>E:first-line&#x2F;E::first-line</h3><p>设置对象内的第一行的样式。此伪对象仅作用于块对象。内联对象要使用该伪对象，必须先将其设置为块级对象。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:first-line &#123;color:<span class="comment">#090;&#125;</span></span><br><span class="line">p::first-line &#123;color:<span class="comment">#090;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-before-x2F-E-before"><a href="#E-before-x2F-E-before" class="headerlink" title="E:before&#x2F;E::before"></a>E:before&#x2F;E::before</h3><p>设置在对象前（依据对象树的逻辑结构）发生的内容。用来和content属性一起使用，并且必须定义content属性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:before&#123;position:absolute;background:<span class="comment">#fff;color:#000;content:&quot;如果你的能看到这段文字，说明你的浏览器只支持E:before&quot;;font-size:14px;&#125;</span></span><br><span class="line">p::before&#123;position:absolute;background:<span class="comment">#fff;color:#000;content:&quot;如果你的能看到这段文字，说明你的浏览器支持E:before和E::before&quot;;font-size:14px;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-after-x2F-E-after"><a href="#E-after-x2F-E-after" class="headerlink" title="E:after&#x2F;E::after"></a>E:after&#x2F;E::after</h3><p>设置在对象后（依据对象树的逻辑结构）发生的内容。用来和content属性一起使用，并且必须定义content属性</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p:after&#123;position:absolute;left:0;background:<span class="comment">#fff;color:#000;content:&quot;如果你的能看到这段文字，说明你的浏览器只支持E:after&quot;;font-size:14px;&#125;</span></span><br><span class="line">p::after&#123;position:absolute;left:0;background:<span class="comment">#fff;color:#000;content:&quot;如果你的能看到这段文字，说明你的浏览器支持E:after和E::after&quot;;font-size:14px;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-placeholder"><a href="#E-placeholder" class="headerlink" title="E::placeholder"></a>E::placeholder</h3><p>设置对象文字占位符的样式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;占位符&quot;</span> /&gt;</span><br><span class="line">input::-webkit-input-placeholder &#123; color:<span class="comment">#999; &#125;</span></span><br><span class="line">input:-ms-input-placeholder &#123; // IE10+ color:<span class="comment">#9999; &#125;</span></span><br><span class="line">input:-moz-placeholder &#123; // Firefox4-18 color:<span class="comment">#999; &#125;</span></span><br><span class="line">input::-moz-placeholder &#123; // Firefox19+ color:<span class="comment">#999; &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="E-selection"><a href="#E-selection" class="headerlink" title="E::selection"></a>E::selection</h3><p>设置对象被选择时的样式。<br>需要注意的是，::selection只能定义被选择时的background-color，color及text-shadow(IE11尚不支持定义该属性)。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">p::-moz-selection&#123;background:<span class="comment">#000;color:#f00;&#125;</span></span><br><span class="line">p::selection&#123;background:<span class="comment">#000;color:#f00;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="css选择符的分类"><a href="#css选择符的分类" class="headerlink" title="css选择符的分类"></a>css选择符的分类</h2><p>其实看了那么多选择符，其实有点晕，还是有点多，看一遍，复习一遍，分分类，有元素选择符、关系选择符 、属性选择符、伪类选择符、伪对象选择符，目前基本就这5种了。下边在看看这张表理理思路：</p>
<img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/css_select.png" class="" title="基本的css选择符">

<h2 id="选择符浏览器兼容"><a href="#选择符浏览器兼容" class="headerlink" title="选择符浏览器兼容"></a>选择符浏览器兼容</h2><p>这么多选择符，有的都毁在浏览器兼容性的手里了，这是从<strong>前端观察</strong>找的一些兼容数据，但是基本够用了，下边看图：</p>
<h3 id="css1兼容"><a href="#css1兼容" class="headerlink" title="css1兼容"></a>css1兼容</h3><img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/css1.png" class="" title="css1兼容">

<h3 id="css2兼容"><a href="#css2兼容" class="headerlink" title="css2兼容"></a>css2兼容</h3><img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/css2.png" class="" title="css2兼容">

<h3 id="css3兼容"><a href="#css3兼容" class="headerlink" title="css3兼容"></a>css3兼容</h3><img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/css3.png" class="" title="css3兼容">

<h3 id="引自前端观察"><a href="#引自前端观察" class="headerlink" title="引自前端观察"></a>引自前端观察</h3><h4 id="基本问题"><a href="#基本问题" class="headerlink" title="基本问题"></a>基本问题</h4><ol>
<li>:hover 在IE6中只有a元素可用。</li>
<li>E:empty 貌似在webkit核心浏览器中有些小bug。</li>
<li>如果这个bug依然存在，不太确定如何测试。</li>
<li>IE6不支持.class1{}.class2{}双类选择器。</li>
</ol>
<h4 id="IE8注意事项："><a href="#IE8注意事项：" class="headerlink" title="IE8注意事项："></a>IE8注意事项：</h4><ul>
<li>E[attr]选择器在值为空的时候或者写错的时候，将不会生效；</li>
<li>IE8支持CSS2.1的所有属性，支持伪类，但是不支持伪元素。</li>
</ul>
<h4 id="IE8中的IE7兼容模式"><a href="#IE8中的IE7兼容模式" class="headerlink" title="IE8中的IE7兼容模式"></a>IE8中的IE7兼容模式</h4><ul>
<li>E[attr] 和IE8一样，值为空或写错的时候，无效；</li>
<li>E[attr~&#x3D;val]这里唯一需要注意的是，属性的值，区分大小写；</li>
<li>E[attr|&#x3D;val]IE7有一些大小写敏感的问题，但是通常可以正常使用；</li>
<li>:first-child IE7 会将一个注释或者文字节点当成first-child，而不是只有元素才是“子”元素。所以，如果在第一个子元素前有注释或文字，IE7会匹配之而不是去匹配第一个子元素。</li>
</ul>
<h4 id="Safari-x2F-Chrome"><a href="#Safari-x2F-Chrome" class="headerlink" title="Safari&#x2F;Chrome"></a>Safari&#x2F;Chrome</h4><ul>
<li>Safari3.2(事实上可以追溯到3.1)以上的版本已经完全的支持所有CSS选择器了。</li>
<li>Safari3.0基本上对CSS 2的选择器支持很好，但不支持CSS3大部分新增的选择器，而且对属性选择器的支持不是很完整。</li>
<li>iPhone中的Safari有3.0和3.2两个版本，对CSS的支持情况与PC&#x2F;Mac版的支持情况一致。</li>
<li>Android系统自带的浏览器基本上也是基于webkit核心的，其对于CSS选择器的支持情况待测。</li>
</ul>
<h2 id="CSS兼容性和Internet-Explorer"><a href="#CSS兼容性和Internet-Explorer" class="headerlink" title="CSS兼容性和Internet Explorer"></a>CSS兼容性和Internet Explorer</h2><p>好多人都死在了IE手里，或者说会产生疑惑，而第三方资料，难免会有误差，IE版本比较低，我们还得处理，所以这里有个网站可以查查，它可以查到css选择符对IE5的支出程度：</p>
<p>链接地址：<a href="https://msdn.microsoft.com/zh-cn/library/cc351024%28v=vs.85%29.aspx">CSS兼容性和Internet Explorer</a></p>
<h3 id="部分内容"><a href="#部分内容" class="headerlink" title="部分内容"></a>部分内容</h3><img src="/2015/11/10/css%E9%80%89%E6%8B%A9%E5%99%A8/cssie.png" class="" title="css选择符与IE">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://code.tutsplus.com/tutorials/the-30-css-selectors-you-must-memorize--net-16048">The 30 CSS Selectors you Must Memorize</a></li>
<li><a href="http://www.w3school.com.cn/cssref/css_selectors.asp">CSS 选择器参考手册</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Child_selectors">MDN选择符</a></li>
<li><a href="http://labs.qianduan.net/css-selector/">CSS选择器的浏览器支持</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/cc351024%28v=vs.85%29.aspx">CSS兼容性和Internet Explorer</a></li>
<li><a href="https://en.wikipedia.org/wiki/Comparison_of_layout_engines_(Cascading_Style_Sheets)">Comparison of layout engines</a></li>
</ol>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>cygwin安装</title>
    <url>/2016/11/05/cygwin%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="cygwin"><a href="#cygwin" class="headerlink" title="cygwin"></a>cygwin</h2><p>Cygwin是一个在windows平台上运行的类UNIX模拟环境；<br>Cygwin是可以在Windows下执行的Linux运行环境；<br>官网地址：<a href="https://cygwin.com/index.html">https://cygwin.com/index.html</a><br>国内地址：<a href="http://www.cygwin.cn/">http://www.cygwin.cn/</a></p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin.png" class="" title="Cygwin工具">

<p>选择合适的系统位数下载，下载完后，大约889KB。</p>
<span id="more"></span>

<h3 id="cygwin下载"><a href="#cygwin下载" class="headerlink" title="cygwin下载"></a>cygwin下载</h3><p>1、运行setup.exe程序，则下一步出现，三中安装方式。</p>
<ul>
<li>Install from Internet，这种模式直接从Internet安装，适合网速较快的情况；</li>
<li>Download Without Installing，这种模式只从网上下载Cygwin的组件包，但不安装；</li>
<li>Install from Local Directory，这种模式与上面第二种模式对应，当你的Cygwin组件包已经下载到本地，则可以使用此模式从本地安装Cygwin。</li>
</ul>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_1.png" class="" title="cygwin安装1">

<p>选择合适的安装方式,这里我选则第二种</p>
<p>2、选择安装过程中从网上下载的Cygwin组件包的保存位置</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_2.png" class="" title="cygwin安装2">

<p>然后下一步</p>
<p>3、选择连接的方式，然后下一步</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_3.png" class="" title="cygwin安装3">

<p>4、选择下载源，并添加</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_4.png" class="" title="cygwin安装4">

<p>为了获得较快的下载速度，当然使用国内的镜像源，这里我们使用<strong>网易163</strong>镜像源</p>
<p>把以下地址添加进去，<a href="http://mirrors.163.com/cygwin/">http://mirrors.163.com/cygwin/</a>，然后Add,选择163镜像,则下一步</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_5.png" class="" title="cygwin安装5">

<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_6.png" class="" title="cygwin安装6">

<p>5、选择需要下载安装的组件包</p>
<p>Devel：包括gcc、make等编译工具<br>Utils: 包括bzip2等实用工具</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_8.png" class="" title="选择组件">

<p>在这里选择要安装的组件，不安装自然就不可能工作。可以使用搜索框找到要安装的软件；<br>默认情况下，Cygwin 基本包将不会安装 GCC，不安装GCC就不可能编译软件，<br>而Devel的分支下有很多组件，其中我们必须安装的组件包含：Binutils，gcc，gcc-mingw，gdb<br>如上图所示，你在这个TreeView的某个节点上（循环按钮）双击，就可以改变它的状态，如Default、Install、Uninstall、Reinstall四种状态。默认的都是Default状态，很多工具的默认状态都是不安装。</p>
<ul>
<li>选择了在All这一行上后面的Default上点Install，全部安装，以免后患，但是速度自然慢一些</li>
<li>我选择以下的主要组件</li>
</ul>
<p>选择binutils组件</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_11.png" class="" title="Binutils">

<p>选择gcc组件</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_12.png" class="" title="gcc组件">

<p>选择gcc-mingw组件</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_13.png" class="" title="gcc-mingw组件">

<p>选择gdb组件</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_14.png" class="" title="gdb组件">

<p>然后下一步，出现提示，下一步</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_9.png" class="" title="你选择的安装包">

<p>7、等待下载进度</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_10.png" class="" title="下载进度">

<p>8、下载完成,关闭窗口</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_15.png" class="" title="下载完成">

<h3 id="cygwin安装"><a href="#cygwin安装" class="headerlink" title="cygwin安装"></a>cygwin安装</h3><p>记得第一次下载的setup-x86_64.exe，点击运行</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_16.png" class="" title="选择本地安装">

<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_17.png" class="" title="选择安装目录">

<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_18.png" class="" title="选择本地包目录">

<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_19.png" class="" title="选择所有组件">

<p>一路下一步，中间稍等一会，直到完成。</p>
<ul>
<li>可以直接双击生成的cygwin的快捷方式（快捷方式在安装完成时生成的）</li>
<li>将cygwin安装目录下的bin目录，如：D:&#x2F;cygwin&#x2F;bin加入到你系统的环境变量path中，那么就可以直接通过启动cmd，打开dos界面进行操作了</li>
</ul>
<h3 id="检测是否安装成功"><a href="#检测是否安装成功" class="headerlink" title="检测是否安装成功"></a>检测是否安装成功</h3><p>检验是否安装完成，在cygwin终端执行命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cygcheck -c cygwin</span><br></pre></td></tr></table></figure>
<p>若打印Version（版本号）和Status(状态ok)，则表示安装成功！</p>
<p>cygwin 访问 Windows 的各个磁盘目录。执行mount命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount</span><br></pre></td></tr></table></figure>

<p>在系统环境变量增加PATH路径C:\cygwin64\bin</p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_20.png" class="" title="配置环境变量">

<p>到此所以安装已经结束了</p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>开始运行bash之前，应该设置一些环境变量。cygwin提供了一个.bat文件，里面已经设置好了最重要的环境变量。通过它来启动bash是最安全的办法。<br>这个.bat文件安装在cygwin所在的根目录下。 可以随意编辑该文件。<br>CYGWIN变量用来针对cygwin运行时系统进行多种全局设置；<br>开始时，可以不设置CYGWIN或者在执行bash前用类似下面的格式在dos命令下把它设为tty ；</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\&gt; <span class="built_in">set</span> CYGWIN=<span class="built_in">tty</span> notitle glob</span><br></pre></td></tr></table></figure>
<p>PATH变量被cygwin应用程序作为搜索可知性文件的路径列表</p>
<p>当一个cygwin进程启动时，该变量被从windows格式(e.g.C:\WinNT\system32;C:\WinNT)转换成unix格式(e.g.,&#x2F;WinNT&#x2F;system32:&#x2F;WinNT)。<br>如果想在不运行bash的时候也能够使用cygwin工具集;<br>PATH起码应该包含x:\cygwin\bin，其中x:\cygwin 是你的系统中的cygwin目录。</p>
<p>HOME变量用来指定主目录，推荐在执行bash前定义该变量。<br>当cygwin进程启动时，该变量也被从windows格式转换成unix格式,<br>例如，作者的机器上HOME的值为C:\（dos命令set HOME就可以看到他的值，set HOME&#x3D;XXX可以进行设置），在bash中用echo $HOME看，其值为&#x2F;cygdrive&#x2F;c.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> HOME=C:\Users\Administrator //这个根据你自己的目录来设置</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$HOME</span> <span class="comment">#查看主目录</span></span><br></pre></td></tr></table></figure>

<p>TERM变量指定终端型态。如果没对它进行设置，它将自动设为cygwin。<br>LD_LIBRARY_PATH被cygwin函数dlopen()作为搜索.dll文件的路径列表，该变量也被从windows格式转换成unix格式。多数Cygwin应用程序不使用dlopen,因而不需要该变量。</p>
<h3 id="setup-exe"><a href="#setup-exe" class="headerlink" title="setup.exe"></a>setup.exe</h3><p>必须通过cygwin提供的setup.exe进行安装，可根据安装提示一步一步进行，提供通过internet安装方式或本地安装方式。建议把cygwin整个安装包下载到本地再进行本地安装比较方便。如果无特殊需求，可简单按它的缺省安装方式安装最少数量的软件包。建议不要安装到c:\下</p>
<h3 id="镜像列表"><a href="#镜像列表" class="headerlink" title="镜像列表"></a>镜像列表</h3><p>官网镜像列表地址：<a href="https://cygwin.com/mirrors.html">https://cygwin.com/mirrors.html</a></p>
<img src="/2016/11/05/cygwin%E5%AE%89%E8%A3%85/cygwin_7.png" class="" title="官网镜像列表地址">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://cygwin.com/mirrors.html">镜像列表</a></li>
<li><a href="https://cygwin.com/index.html">官网地址-en</a></li>
<li><a href="http://www.cygwin.cn/">官网地址-cn</a></li>
<li><a href="http://www.cygwin.cn/site/info/show.php?IID=1006">Cygwin设置中文</a></li>
<li><a href="http://www.cygwin.cn/site/info/show.php?IID=1005">Cygwin中文配置</a></li>
<li><a href="http://www.cygwin.cn/site/info/show.php?IID=1004">Cygwin使用指南</a></li>
<li><a href="http://www.cygwin.cn/site/install/">Cygwin安装</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>认识fis3</title>
    <url>/2016/03/16/fis3/</url>
    <content><![CDATA[<h2 id="背景等信息"><a href="#背景等信息" class="headerlink" title="背景等信息"></a>背景等信息</h2><p>fis也是个前端工程构建工具，现在已经到fis3,是百度团队出的一个工具。下面给出一个张图 <strong>仅供参考</strong></p>
<img src="/2016/03/16/fis3/npm_tj.png" class="" title="截图时间为2016&#x2F;3&#x2F;16">

<span id="more"></span>

<p>然后没了。。。</p>
<p><a href="http://fis.baidu.com/fis3/index.html">fis3官方网址-传送</a><br><a href="https://github.com/fex-team/fis3">github项目地址-传送</a></p>
<h2 id="关于node与npm的一些信息"><a href="#关于node与npm的一些信息" class="headerlink" title="关于node与npm的一些信息"></a>关于node与npm的一些信息</h2><p>安装node(里面会自带npm),步骤…,已经成功了</p>
<p>有时使用npm安装一些包的过程可能会失败，那用国内的npm镜像试试，如淘宝的npm镜像，这有张官网截图：<br><a href="http://npm.taobao.org/">淘宝 NPM 镜像-官方网站</a></p>
<img src="/2016/03/16/fis3/npm_taobao.png" class="" title="淘宝npm镜像">

<p>去看看官网 <strong>首页</strong>，然后就是。。。你懂了</p>
<p>看一些基本命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">备注：如express模块</span><br><span class="line">npm list <span class="comment">#列出已安装模块</span></span><br><span class="line">npm show express  <span class="comment">#显示模块详情</span></span><br><span class="line">npm update <span class="comment">#升级当前目录下的项目的所有模块</span></span><br><span class="line">npm update express <span class="comment">#升级当前目录下的项目的指定模块</span></span><br><span class="line">npm update -g express  <span class="comment">#升级全局安装的express模块</span></span><br><span class="line">npm uninstall express  <span class="comment">#卸载指定的模块</span></span><br></pre></td></tr></table></figure>

<p>node有一个模块叫n,是专门用来管理node.js的版本的，安装命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g n</span><br></pre></td></tr></table></figure>
<p>windows总是不能安装n模块，老是报错，有人说是：n 的 github 上说目前不支持 Windows！，这里有个帖子<a href="http://cnodejs.org/topic/556fb2858ce3684b284b55fd">传送门</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">n stable <span class="comment">#升级node.js到最新稳定版</span></span><br><span class="line">n后面也可以跟随版本号比如：n v0.10.26或n 0.10.26</span><br></pre></td></tr></table></figure>

<h2 id="fis3的基本工作"><a href="#fis3的基本工作" class="headerlink" title="fis3的基本工作"></a>fis3的基本工作</h2><blockquote>
<p>Node 版本要求 0.8.x，0.10.x, 0.12.x，4.x，不在此列表中的版本不予支持。最新版本 node 支持会第一时间跟进，支持后更新支持列表。</p>
</blockquote>
<p>此处使用windows</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g fis3 <span class="comment">#安装</span></span><br><span class="line">fis3 -v <span class="comment">#安装完查看版本</span></span><br></pre></td></tr></table></figure>

<img src="/2016/03/16/fis3/fis3_v.png" class="" title="fis版本查看">

<h2 id="先上一段代码"><a href="#先上一段代码" class="headerlink" title="先上一段代码"></a>先上一段代码</h2><p>此处代码好坏我自己都不敢看</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><img src="/2016/03/16/fis3/dir_file.png" class="" title="目录结构">

<h3 id="html部分代码"><a href="#html部分代码" class="headerlink" title="html部分代码"></a>html部分代码</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;./less/common.less&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;./less/task1.less&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;./less/task2.less&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div class=<span class="string">&quot;common&quot;</span>&gt;</span><br><span class="line">		&lt;h2&gt;任务1：img图片&lt;/h2&gt;</span><br><span class="line">		&lt;p&gt;&lt;img src=<span class="string">&quot;img/xjh.jpg&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div class=<span class="string">&quot;task1&quot;</span>&gt;</span><br><span class="line">		&lt;h2&gt;任务2：这是一个很久的神话&lt;/h2&gt;</span><br><span class="line">   		&lt;p&gt;最终他们都消失了...............&lt;/p&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div class=<span class="string">&quot;task2&quot;</span>&gt;</span><br><span class="line">		&lt;h2&gt;任务3：这是一个人口很多的地方&lt;/h2&gt;</span><br><span class="line">		&lt;p&gt;好像已经无法控制了........&lt;/p&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div class=<span class="string">&quot;common&quot;</span>&gt;</span><br><span class="line">		&lt;h2&gt;任务4：雪碧图&lt;/h2&gt;</span><br><span class="line">		&lt;ul class=<span class="string">&quot;icon-list&quot;</span>&gt;</span><br><span class="line">		    &lt;li class=<span class="string">&quot;list-1&quot;</span>&gt;item1&lt;/li&gt;</span><br><span class="line">		    &lt;li class=<span class="string">&quot;list-2&quot;</span>&gt;item2&lt;/li&gt;</span><br><span class="line">		&lt;/ul&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;div class=<span class="string">&quot;common&quot;</span>&gt;</span><br><span class="line">		&lt;h2&gt;任务5：嵌入<span class="built_in">base64</span>&lt;/h2&gt;</span><br><span class="line">		&lt;img src=<span class="string">&quot;img/logo.png?__inline&quot;</span>&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/jquery/1.9.0/jquery.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;js/a.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;js/b.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="其他代码"><a href="#其他代码" class="headerlink" title="其他代码"></a>其他代码</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//common.less</span><br><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">ul,li&#123;list-style:none;&#125;</span><br><span class="line">body&#123;padding:30px;&#125;</span><br><span class="line">p&#123;line-height:40px;&#125;</span><br><span class="line">h2&#123;padding:20px 0;&#125;</span><br><span class="line">.icon-list&#123;</span><br><span class="line">	li&#123;position:relative;</span><br><span class="line">		&amp;:before&#123;display:block;content:<span class="string">&#x27;&#x27;</span>;width:16px;height:16px;position:absolute;left:-16px;top:3px;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	li.list-1:before &#123;</span><br><span class="line">		background-image: url(<span class="string">&#x27;../img/list-1.png?__sprite&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	li.list-2:before &#123;</span><br><span class="line">		background-image: url(<span class="string">&#x27;../img/list-2.png?__sprite&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//task1.less</span><br><span class="line">.task1&#123;</span><br><span class="line">	h2&#123;text-decoration:underline;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//task2.less</span><br><span class="line">.task2&#123;</span><br><span class="line">	h2&#123;color:red;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//a.js</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">aaa</span></span>()&#123;</span><br><span class="line">	console.log($);</span><br><span class="line">	console.log(<span class="string">&#x27;hello World!!!&#x27;</span>);</span><br><span class="line">	var img = __uri(<span class="string">&#x27;../img/icon_recon.jpg&#x27;</span>);</span><br><span class="line">	console.log(img);</span><br><span class="line">&#125;</span><br><span class="line">aaa();</span><br><span class="line"></span><br><span class="line">//b.js</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">bbb</span></span>()&#123;</span><br><span class="line">	console.log(<span class="string">&#x27;bb&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">bbb();</span><br></pre></td></tr></table></figure>

<h3 id="fis-conf-js"><a href="#fis-conf-js" class="headerlink" title="fis-conf.js"></a>fis-conf.js</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * default debug mode</span><br><span class="line"> * fis3 release debug</span><br><span class="line"> * fis3-postpackager-loader <span class="comment">#可对页面散列文件进行合并</span></span><br><span class="line"> * fis-spriter-csssprites <span class="comment">#对css文件,以及html文件css片段进行csssprites处理</span></span><br><span class="line"> * fis-optimizer-uglify-js 插件进行压缩，已内置</span><br><span class="line"> * fis-optimizer-clean-css 插件进行压缩，已内置</span><br><span class="line"> * fis-optimizer-png-compressor 插件进行压缩，已内置</span><br><span class="line"> */</span><br><span class="line">fis.match(<span class="string">&#x27;::package&#x27;</span>, &#123; //在package阶段所有文件分配某些属性</span><br><span class="line">		postpackager: fis.plugin(<span class="string">&#x27;loader&#x27;</span>),	//文件合并</span><br><span class="line">		spriter: fis.plugin(<span class="string">&#x27;csssprites&#x27;</span>)	//启用 fis-spriter-csssprites 插件</span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.&#123;js,css,png,jpg&#125;&#x27;</span>, &#123;//加md5</span><br><span class="line">		useHash: <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.less&#x27;</span>, &#123;	//合并图片</span><br><span class="line">		useSprite: <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.less&#x27;</span>, &#123;	//less转换为css</span><br><span class="line">		// fis-parser-less 插件进行解析</span><br><span class="line">		parser: fis.plugin(<span class="string">&#x27;less&#x27;</span>),</span><br><span class="line">		// .less 文件后缀构建后被改成 .css 文件</span><br><span class="line">		rExt: <span class="string">&#x27;.css&#x27;</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.less&#x27;</span>, &#123;	//将转换的less压缩</span><br><span class="line">		// 压缩css</span><br><span class="line">		optimizer: fis.plugin(<span class="string">&#x27;clean-css&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.less&#x27;</span>, &#123;	//将转换的less合并</span><br><span class="line">		packTo: <span class="string">&#x27;./css/task.css&#x27;</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.js&#x27;</span>, &#123;	//压缩js</span><br><span class="line">		optimizer: fis.plugin(<span class="string">&#x27;uglify-js&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.js&#x27;</span>, &#123;	//合并js</span><br><span class="line">		packTo: <span class="string">&#x27;./js/task.js&#x27;</span></span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.png&#x27;</span>, &#123;//压缩png图片</span><br><span class="line">		optimizer: fis.plugin(<span class="string">&#x27;png-compressor&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	.match(<span class="string">&#x27;*.&#123;png,gif,jpg&#125;&#x27;</span>, &#123;//设置图片路径</span><br><span class="line">	    release: <span class="string">&#x27;/images$0&#x27;</span>,</span><br><span class="line">	    url : <span class="string">&#x27;/images$0&#x27;</span></span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fis.media(<span class="string">&#x27;debug&#x27;</span>).match(<span class="string">&#x27;*.&#123;js,less,png&#125;&#x27;</span>, &#123;</span><br><span class="line">	useHash: <span class="literal">false</span>,</span><br><span class="line">	useSprite: <span class="literal">false</span>,</span><br><span class="line">	optimizer: null,</span><br><span class="line">	packTo:null</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="fis3的一些命令"><a href="#fis3的一些命令" class="headerlink" title="fis3的一些命令"></a>fis3的一些命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fis3 release <span class="comment">#发布到默认服务器目录下</span></span><br><span class="line">fis3 release -d ../output <span class="comment">#发布output目录下</span></span><br><span class="line">fis3 server open <span class="comment">#打开服务器目录</span></span><br><span class="line">fis3 server start <span class="comment">#启动服务器</span></span><br><span class="line">fis3 release -wL <span class="comment">#监听文件自动刷新</span></span><br><span class="line">fis3 server -h <span class="comment">#查看更多参数</span></span><br></pre></td></tr></table></figure>

<p>在文件目录下，使用命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fis3 server start <span class="comment">#启动服务器</span></span><br><span class="line">fis3 release <span class="comment">#发布到默认服务器目录下</span></span><br></pre></td></tr></table></figure>

<p>然后你会看到构建后的文件情况,代码上面有注释，这我就不说了。<br><a href="https://github.com/non-player/examples">github代码地址！！！</a></p>
<h2 id="资源定位"><a href="#资源定位" class="headerlink" title="资源定位"></a>资源定位</h2><p>定位JS：所有的 js   发布到&#x2F;static&#x2F;js&#x2F;xxx目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fis.match(<span class="string">&#x27;**.js&#x27;</span>, &#123;</span><br><span class="line">    release : <span class="string">&#x27;/static/js$0&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>定位CSS：所有的 css 发布到&#x2F;static&#x2F;css&#x2F;xxx目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fis.match(<span class="string">&#x27;**.css&#x27;</span>, &#123;</span><br><span class="line">    release : <span class="string">&#x27;/static/css$0&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>定位图片：所有image目录下的.png，.gif文件发布到&#x2F;static&#x2F;pic&#x2F;xxx目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fis.match(<span class="string">&#x27;/img/(*.&#123;png,gif&#125;)&#x27;</span>, &#123;</span><br><span class="line">    release: <span class="string">&#x27;/static/pic/$1$2&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="为止"><a href="#为止" class="headerlink" title="为止"></a>为止</h2><p>还有一部分， 暂时到这了。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://fex.baidu.com/fis-site/index.html">fis2官网地址</a></li>
<li><a href="http://npm.taobao.org/">淘宝 NPM 镜像</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2015/07/01/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>More info: <a href="http://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>http状态码知多少</title>
    <url>/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/</url>
    <content><![CDATA[<h2 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h2><p>HTTP状态码（HTTP Status Code）是用以表示网页服务器HTTP响应状态的3位数字代码。它由 RFC 2616 规范定义的，并得到RFC 2518、RFC 2817、RFC 2295、RFC 2774、RFC 4918等规范扩展。</p>
<p>所有状态码的第一个数字代表了响应的五种状态之一。</p>
<h2 id="常用的HTTP状态码"><a href="#常用的HTTP状态码" class="headerlink" title="常用的HTTP状态码"></a>常用的HTTP状态码</h2><ul>
<li>200 OK &#x3D;&gt; 请求成功（其后是对GET和POST请求的应答文档。）</li>
<li>301 Moved Permanently &#x3D;&gt; 所请求的页面已经转移至新的url。</li>
<li>302 Found &#x3D;&gt; 所请求的页面已经临时转移至新的url。</li>
<li>304 Not Modified &#x3D;&gt; 未按预期修改文档。客户端有缓冲的文档并发出了一个条件性的请求（一般是提供If-Modified-Since头表示客户只想比指定日期更新的文档）。服务器告诉客户，原来缓冲的文档还可以继续使用。</li>
<li>404 Not Found &#x3D;&gt; 服务器无法找到被请求的页面。</li>
<li>500 Internal Server Error &#x3D;&gt; 请求未完成。服务器遇到不可预知的情况。</li>
<li>502 Bad Gateway &#x3D;&gt; 请求未完成。服务器从上游服务器收到一个无效的响应。</li>
<li>503 Service Unavailable &#x3D;&gt; 请求未完成。服务器临时过载或当机。</li>
</ul>
<span id="more"></span>

<h2 id="1xx-信息"><a href="#1xx-信息" class="headerlink" title="1xx: 信息"></a>1xx: 信息</h2><p>这一类型的状态码，代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束。由于HTTP&#x2F;1.0协议中没有定义任何1xx状态码，所以除非在某些试验条件下，服务器禁止向此类客户端发送1xx响应。 这些状态码代表的响应都是信息性的，标示客户应该采取的其他行动。</p>
<img src="/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/http1.png" class="" title="1xx:信息">

<h3 id="100-Continue"><a href="#100-Continue" class="headerlink" title="100 Continue"></a>100 Continue</h3><p>客户端应当继续发送请求。这个临时响应是用来通知客户端它的部分请求已经被服务器接收，且仍未被拒绝。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。服务器必须在请求完成后向客户端发送一个最终响应。</p>
<h3 id="101-Switching-Protocols"><a href="#101-Switching-Protocols" class="headerlink" title="101 Switching Protocols"></a>101 Switching Protocols</h3><p>服务器已经理解了客户端的请求，并将通过Upgrade消息头通知客户端采用不同的协议来完成这个请求。在发送完这个响应最后的空行后，服务器将会切换到在Upgrade消息头中定义的那些协议。<br>只有在切换新的协议更有好处的时候才应该采取类似措施。例如，切换到新的HTTP版本比旧版本更有优势，或者切换到一个实时且同步的协议以传送利用此类特性的资源。</p>
<h3 id="102-Processing"><a href="#102-Processing" class="headerlink" title="102 Processing"></a>102 Processing</h3><p>由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。</p>
<h2 id="2xx-成功"><a href="#2xx-成功" class="headerlink" title="2xx: 成功"></a>2xx: 成功</h2><p>这一类型的状态码，代表请求已成功被服务器接收、理解、并接受。</p>
<img src="/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/http2.png" class="" title="2xx:成功">

<h3 id="200-OK"><a href="#200-OK" class="headerlink" title="200 OK"></a>200 OK</h3><p>请求已成功，请求所希望的响应头或数据体将随此响应返回。</p>
<h3 id="201-Created"><a href="#201-Created" class="headerlink" title="201 Created"></a>201 Created</h3><p>请求已经被实现，而且有一个新的资源已经依据请求的需要而创建，且其URI已经随Location头信息返回。假如需要的资源无法及时创建的话，应当返回’202 Accepted’。</p>
<h3 id="202-Accepted"><a href="#202-Accepted" class="headerlink" title="202 Accepted"></a>202 Accepted</h3><p>服务器已接受请求，但尚未处理。正如它可能被拒绝一样，最终该请求可能会也可能不会被执行。在异步操作的场合下，没有比发送这个状态码更方便的做法了。<br>返回202状态码的响应的目的是允许服务器接受其他过程的请求（例如某个每天只执行一次的基于批处理的操作），而不必让客户端一直保持与服务器的连接直到批处理操作全部完成。在接受请求处理并返回202状态码的响应应当在返回的实体中包含一些指示处理当前状态的信息，以及指向处理状态监视器或状态预测的指针，以便用户能够估计操作是否已经完成。</p>
<h3 id="203-Non-Authoritative-Information"><a href="#203-Non-Authoritative-Information" class="headerlink" title="203 Non-Authoritative Information"></a>203 Non-Authoritative Information</h3><p>服务器已成功处理了请求，但返回的实体头部元信息不是在原始服务器上有效的确定集合，而是来自本地或者第三方的拷贝。当前的信息可能是原始版本的子集或者超集。例如，包含资源的元数据可能导致原始服务器知道元信息的超集。使用此状态码不是必须的，而且只有在响应不使用此状态码便会返回200 OK的情况下才是合适的。</p>
<h3 id="204-No-Content"><a href="#204-No-Content" class="headerlink" title="204 No Content"></a>204 No Content</h3><p>服务器成功处理了请求，但不需要返回任何实体内容，并且希望返回更新了的元信息。响应可能通过实体头部的形式，返回新的或更新后的元信息。如果存在这些头部信息，则应当与所请求的变量相呼应。<br>如果客户端是浏览器的话，那么用户浏览器应保留发送了该请求的页面，而不产生任何文档视图上的变化，即使按照规范新的或更新后的元信息应当被应用到用户浏览器活动视图中的文档。<br>由于204响应被禁止包含任何消息体，因此它始终以消息头后的第一个空行结尾。</p>
<h3 id="205-Reset-Content"><a href="#205-Reset-Content" class="headerlink" title="205 Reset Content"></a>205 Reset Content</h3><p>服务器成功处理了请求，且没有返回任何内容。但是与204响应不同，返回此状态码的响应要求请求者重置文档视图。该响应主要是被用于接受用户输入后，立即重置表单，以便用户能够轻松地开始另一次输入。<br>与204响应一样，该响应也被禁止包含任何消息体，且以消息头后的第一个空行结束。</p>
<h3 id="206-Partial-Content"><a href="#206-Partial-Content" class="headerlink" title="206 Partial Content"></a>206 Partial Content</h3><p>服务器已经成功处理了部分GET请求。类似于FlashGet或者迅雷这类的HTTP 下载工具都是使用此类响应实现断点续传或者将一个大文档分解为多个下载段同时下载。<br>该请求必须包含Range头信息来指示客户端希望得到的内容范围，并且可能包含If-Range来作为请求条件。<br>响应必须包含如下的头部域：</p>
<ul>
<li>Content-Range用以指示本次响应中返回的内容的范围；如果是Content-Type为multipart&#x2F;byteranges的多段下载，则每一multipart段中都应包含Content-Range域用以指示本段的内容范围。假如响应中包含Content-Length，那么它的数值必须匹配它返回的内容范围的真实字节数。</li>
<li>Date</li>
<li>ETag和／或Content-Location，假如同样的请求本应该返回200响应。</li>
<li>Expires, Cache-Control，和／或Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。</li>
</ul>
<p>假如本响应请求使用了If-Range强缓存验证，那么本次响应不应该包含其他实体头；假如本响应的请求使用了If-Range弱缓存验证，那么本次响应禁止包含其他实体头；这避免了缓存的实体内容和更新了的实体头信息之间的不一致。否则，本响应就应当包含所有本应该返回200响应中应当返回的所有实体头部域。</p>
<h3 id="207-Multi-Status"><a href="#207-Multi-Status" class="headerlink" title="207 Multi-Status"></a>207 Multi-Status</h3><p>由WebDAV(RFC 2518)扩展的状态码，代表之后的消息体将是一个XML消息，并且可能依照之前子请求数量的不同，包含一系列独立的响应代码。</p>
<h2 id="3xx-重定向"><a href="#3xx-重定向" class="headerlink" title="3xx:重定向"></a>3xx:重定向</h2><p>这类状态码代表需要客户端采取进一步的操作才能完成请求。通常，这些状态码用来重定向，后续的请求地址（重定向目标）在本次响应的Location域中指明。</p>
<p>当且仅当后续的请求所使用的方法是GET或者HEAD时，用户浏览器才可以在没有用户介入的情况下自动提交所需要的后续请求。客户端应当自动监测无限循环重定向（例如：A→B→C→……→A或A→A），因为这会导致服务器和客户端大量不必要的资源消耗。按照HTTP&#x2F;1.0版规范的建议，浏览器不应自动访问超过5次的重定向。</p>
<img src="/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/http3.png" class="" title="3xx:重定向">

<h3 id="300-Multiple-Choices"><a href="#300-Multiple-Choices" class="headerlink" title="300 Multiple Choices"></a>300 Multiple Choices</h3><p>被请求的资源有一系列可供选择的回馈信息，每个都有自己特定的地址和浏览器驱动的商议信息。用户或浏览器能够自行选择一个首选的地址进行重定向。<br>除非这是一个HEAD请求，否则该响应应当包括一个资源特性及地址的列表的实体，以便用户或浏览器从中选择最合适的重定向地址。这个实体的格式由Content-Type定义的格式所决定。浏览器可能根据响应的格式以及浏览器自身能力，自动作出最合适的选择。当然，RFC 2616规范并没有规定这样的自动选择该如何进行。<br>如果服务器本身已经有了首选的回馈选择，那么在Location中应当指明这个回馈的URI；浏览器可能会将这个Location值作为自动重定向的地址。此外，除非额外指定，否则这个响应也是可缓存的。</p>
<h3 id="301-Moved-Permanently"><a href="#301-Moved-Permanently" class="headerlink" title="301 Moved Permanently"></a>301 Moved Permanently</h3><p>被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个URI之一。如果可能，拥有链接编辑功能的客户端应当自动把请求的地址修改为从服务器反馈回来的地址。除非额外指定，否则这个响应也是可缓存的。<br>新的永久性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>如果这不是一个GET或者HEAD请求，因此浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。<br>注意：对于某些使用HTTP&#x2F;1.0协议的浏览器，当它们发送的POST请求得到了一个301响应的话，接下来的重定向请求将会变成GET方式。</p>
<h3 id="302-Found"><a href="#302-Found" class="headerlink" title="302 Found"></a>302 Found</h3><p>请求的资源现在临时从不同的URI响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。<br>新的临时性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>如果这不是一个GET或者HEAD请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。<br>注意：虽然RFC 1945和RFC 2068规范不允许客户端在重定向时改变请求的方法，但是很多现存的浏览器将302响应视作为303响应，并且使用GET方式访问在Location中规定的URI，而无视原先请求的方法。状态码303和307被添加了进来，用以明确服务器期待客户端进行何种反应。</p>
<h3 id="303-See-Other"><a href="#303-See-Other" class="headerlink" title="303 See Other"></a>303 See Other</h3><p>对应当前请求的响应可以在另一个URI上被找到，而且客户端应当采用GET的方式访问那个资源。这个方法的存在主要是为了允许由脚本激活的POST请求输出重定向到一个新的资源。这个新的URI不是原始资源的替代引用。同时，303响应禁止被缓存。当然，第二个请求（重定向）可能被缓存。<br>新的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。<br>注意：许多HTTP&#x2F;1.1版以前的浏览器不能正确理解303状态。如果需要考虑与这些浏览器之间的互动，302状态码应该可以胜任，因为大多数的浏览器处理302响应时的方式恰恰就是上述规范要求客户端处理303响应时应当做的。</p>
<h3 id="304-Not-Modified"><a href="#304-Not-Modified" class="headerlink" title="304 Not Modified"></a>304 Not Modified</h3><p>如果客户端发送了一个带条件的GET请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个状态码。304响应禁止包含消息体，因此始终以消息头后的第一个空行结尾。<br>该响应必须包含以下的头信息：</p>
<ul>
<li>Date，除非这个服务器没有时钟。假如没有时钟的服务器也遵守这些规则，那么代理服务器以及客户端可以自行将Date字段添加到接收到的响应头中去（正如RFC 2068中规定的一样），缓存机制将会正常工作。</li>
<li>ETag和／或Content-Location，假如同样的请求本应返回200响应。</li>
<li>Expires, Cache-Control，和／或Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。</li>
</ul>
<p>假如本响应请求使用了强缓存验证，那么本次响应不应该包含其他实体头；否则（例如，某个带条件的GET请求使用了弱缓存验证），本次响应禁止包含其他实体头；这避免了缓存了的实体内容和更新了的实体头信息之间的不一致。<br>假如某个304响应指明了当前某个实体没有缓存，那么缓存系统必须忽视这个响应，并且重复发送不包含限制条件的请求。<br>假如接收到一个要求更新某个缓存条目的304响应，那么缓存系统必须更新整个条目以反映所有在响应中被更新的字段的值。</p>
<h3 id="305-Use-Proxy"><a href="#305-Use-Proxy" class="headerlink" title="305 Use Proxy"></a>305 Use Proxy</h3><p>被请求的资源必须通过指定的代理才能被访问。Location域中将给出指定的代理所在的URI信息，接收者需要重复发送一个单独的请求，通过这个代理才能访问相应资源。只有原始服务器才能创建305响应。<br>注意：RFC 2068中没有明确305响应是为了重定向一个单独的请求，而且只能被原始服务器创建。忽视这些限制可能导致严重的安全后果。</p>
<h3 id="306-Switch-Proxy"><a href="#306-Switch-Proxy" class="headerlink" title="306 Switch Proxy"></a>306 Switch Proxy</h3><p>在最新版的规范中，306状态码已经不再被使用。</p>
<h3 id="307-Temporary-Redirect"><a href="#307-Temporary-Redirect" class="headerlink" title="307 Temporary Redirect"></a>307 Temporary Redirect</h3><p>请求的资源现在临时从不同的URI响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。<br>新的临时性的URI应当在响应的Location域中返回。除非这是一个HEAD请求，否则响应的实体中应当包含指向新的URI的超链接及简短说明。因为部分浏览器不能识别307响应，因此需要添加上述必要信息以便用户能够理解并向新的URI发出访问请求。<br>如果这不是一个GET或者HEAD请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。</p>
<h2 id="4xx-客户端错误"><a href="#4xx-客户端错误" class="headerlink" title="4xx:客户端错误"></a>4xx:客户端错误</h2><p>这类的状态码代表了客户端看起来可能发生了错误，妨碍了服务器的处理。除非响应的是一个HEAD请求，否则服务器就应该返回一个解释当前错误状况的实体，以及这是临时的还是永久性的状况。这些状态码适用于任何请求方法。浏览器应当向用户显示任何包含在此类错误响应中的实体内容。<br>如果错误发生时客户端正在传送数据，那么使用TCP的服务器实现应当仔细确保在关闭客户端与服务器之间的连接之前，客户端已经收到了包含错误信息的数据包。如果客户端在收到错误信息后继续向服务器发送数据，服务器的TCP栈将向客户端发送一个重置数据包，以清除该客户端所有还未识别的输入缓冲，以免这些数据被服务器上的应用程序读取并干扰后者。</p>
<img src="/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/http4.png" class="" title="4xx:客户端错误">

<h3 id="400-Bad-Request"><a href="#400-Bad-Request" class="headerlink" title="400 Bad Request"></a>400 Bad Request</h3><p>由于包含语法错误，当前请求无法被服务器理解。除非进行修改，否则客户端不应该重复提交这个请求。</p>
<h3 id="401-Unauthorized"><a href="#401-Unauthorized" class="headerlink" title="401 Unauthorized"></a>401 Unauthorized</h3><p>当前请求需要用户验证。该响应必须包含一个适用于被请求资源的WWW-Authenticate信息头用以询问用户信息。客户端可以重复提交一个包含恰当的Authorization头信息的请求。如果当前请求已经包含了Authorization证书，那么401响应代表着服务器验证已经拒绝了那些证书。如果401响应包含了与前一个响应相同的身份验证询问，且浏览器已经至少尝试了一次验证，那么浏览器应当向用户展示响应中包含的实体信息，因为这个实体信息中可能包含了相关诊断信息。参见RFC 2617。</p>
<h3 id="402-Payment-Required"><a href="#402-Payment-Required" class="headerlink" title="402 Payment Required"></a>402 Payment Required</h3><p>该状态码是为了将来可能的需求而预留的。</p>
<h3 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h3><p>服务器已经理解请求，但是拒绝执行它。与401响应不同的是，身份验证并不能提供任何帮助，而且这个请求也不应该被重复提交。如果这不是一个HEAD请求，而且服务器希望能够讲清楚为何请求不能被执行，那么就应该在实体内描述拒绝的原因。当然服务器也可以返回一个404响应，假如它不希望让客户端获得任何信息。</p>
<h3 id="404-Not-Found"><a href="#404-Not-Found" class="headerlink" title="404 Not Found"></a>404 Not Found</h3><p>请求失败，请求所希望得到的资源未被在服务器上发现。没有信息能够告诉用户这个状况到底是暂时的还是永久的。假如服务器知道情况的话，应当使用410状态码来告知旧资源因为某些内部的配置机制问题，已经永久的不可用，而且没有任何可以跳转的地址。404这个状态码被广泛应用于当服务器不想揭示到底为何请求被拒绝或者没有其他适合的响应可用的情况下。</p>
<h3 id="405-Method-Not-Allowed"><a href="#405-Method-Not-Allowed" class="headerlink" title="405 Method Not Allowed"></a>405 Method Not Allowed</h3><p>请求行中指定的请求方法不能被用于请求相应的资源。该响应必须返回一个Allow头信息用以表示出当前资源能够接受的请求方法的列表。<br>鉴于PUT，DELETE方法会对服务器上的资源进行写操作，因而绝大部分的网页服务器都不支持或者在默认配置下不允许上述请求方法，对于此类请求均会返回405错误。</p>
<h3 id="406-Not-Acceptable"><a href="#406-Not-Acceptable" class="headerlink" title="406 Not Acceptable"></a>406 Not Acceptable</h3><p>请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。<br>除非这是一个HEAD请求，否则该响应就应当返回一个包含可以让用户或者浏览器从中选择最合适的实体特性以及地址列表的实体。实体的格式由Content-Type头中定义的媒体类型决定。浏览器可以根据格式及自身能力自行作出最佳选择。但是，规范中并没有定义任何作出此类自动选择的标准。</p>
<h3 id="407-Proxy-Authentication-Required"><a href="#407-Proxy-Authentication-Required" class="headerlink" title="407 Proxy Authentication Required"></a>407 Proxy Authentication Required</h3><p>与401响应类似，只不过客户端必须在代理服务器上进行身份验证。代理服务器必须返回一个Proxy-Authenticate用以进行身份询问。客户端可以返回一个Proxy-Authorization信息头用以验证。参见RFC 2617。</p>
<h3 id="408-Request-Timeout"><a href="#408-Request-Timeout" class="headerlink" title="408 Request Timeout"></a>408 Request Timeout</h3><p>请求超时。客户端没有在服务器预备等待的时间内完成一个请求的发送。客户端可以随时再次提交这一请求而无需进行任何更改。</p>
<h3 id="409-Conflict"><a href="#409-Conflict" class="headerlink" title="409 Conflict"></a>409 Conflict</h3><p>由于和被请求的资源的当前状态之间存在冲突，请求无法完成。这个代码只允许用在这样的情况下才能被使用：用户被认为能够解决冲突，并且会重新提交新的请求。该响应应当包含足够的信息以便用户发现冲突的源头。<br>冲突通常发生于对PUT请求的处理中。例如，在采用版本检查的环境下，某次PUT提交的对特定资源的修改请求所附带的版本信息与之前的某个（第三方）请求向冲突，那么此时服务器就应该返回一个409错误，告知用户请求无法完成。此时，响应实体中很可能会包含两个冲突版本之间的差异比较，以便用户重新提交归并以后的新版本。</p>
<h3 id="410-Gone"><a href="#410-Gone" class="headerlink" title="410 Gone"></a>410 Gone</h3><p>被请求的资源在服务器上已经不再可用，而且没有任何已知的转发地址。这样的状况应当被认为是永久性的。如果可能，拥有链接编辑功能的客户端应当在获得用户许可后删除所有指向这个地址的引用。如果服务器不知道或者无法确定这个状况是否是永久的，那么就应该使用404状态码。除非额外说明，否则这个响应是可缓存的。<br>410响应的目的主要是帮助网站管理员维护网站，通知用户该资源已经不再可用，并且服务器拥有者希望所有指向这个资源的远端连接也被删除。这类事件在限时、增值服务中很普遍。同样，410响应也被用于通知客户端在当前服务器站点上，原本属于某个个人的资源已经不再可用。当然，是否需要把所有永久不可用的资源标记为’410 Gone’，以及是否需要保持此标记多长时间，完全取决于服务器拥有者。</p>
<h3 id="411-Length-Required"><a href="#411-Length-Required" class="headerlink" title="411 Length Required"></a>411 Length Required</h3><p>服务器拒绝在没有定义Content-Length头的情况下接受请求。在添加了表明请求消息体长度的有效Content-Length头之后，客户端可以再次提交该请求。</p>
<h3 id="412-Precondition-Failed"><a href="#412-Precondition-Failed" class="headerlink" title="412 Precondition Failed"></a>412 Precondition Failed</h3><p>服务器在验证在请求的头字段中给出先决条件时，没能满足其中的一个或多个。这个状态码允许客户端在获取资源时在请求的元信息（请求头字段数据）中设置先决条件，以此避免该请求方法被应用到其希望的内容以外的资源上。</p>
<h3 id="413-Request-Entity-Too-Large"><a href="#413-Request-Entity-Too-Large" class="headerlink" title="413 Request Entity Too Large"></a>413 Request Entity Too Large</h3><p>服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。此种情况下，服务器可以关闭连接以免客户端继续发送此请求。<br>如果这个状况是临时的，服务器应当返回一个Retry-After的响应头，以告知客户端可以在多少时间以后重新尝试。</p>
<h3 id="414-Request-URI-Too-Long"><a href="#414-Request-URI-Too-Long" class="headerlink" title="414 Request-URI Too Long"></a>414 Request-URI Too Long</h3><p>请求的URI长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。这比较少见，通常的情况包括：</p>
<ul>
<li>本应使用POST方法的表单提交变成了GET方法，导致查询字符串（Query String）过长。</li>
<li>重定向URI“黑洞”，例如每次重定向把旧的URI作为新的URI的一部分，导致在若干次重定向后URI超长。</li>
<li>客户端正在尝试利用某些服务器中存在的安全漏洞攻击服务器。这类服务器使用固定长度的缓冲读取或操作请求的URI，当GET后的参数超过某个数值后，可能会产生缓冲区溢出，导致任意代码被执行[1]。没有此类漏洞的服务器，应当返回414状态码。</li>
</ul>
<h3 id="415-Unsupported-Media-Type"><a href="#415-Unsupported-Media-Type" class="headerlink" title="415 Unsupported Media Type"></a>415 Unsupported Media Type</h3><p>对于当前请求的方法和所请求的资源，请求中提交的实体并不是服务器中所支持的格式，因此请求被拒绝。</p>
<h3 id="416-Requested-Range-Not-Satisfiable"><a href="#416-Requested-Range-Not-Satisfiable" class="headerlink" title="416 Requested Range Not Satisfiable"></a>416 Requested Range Not Satisfiable</h3><p>如果请求中包含了Range请求头，并且Range中指定的任何数据范围都与当前资源的可用范围不重合，同时请求中又没有定义If-Range请求头，那么服务器就应当返回416状态码。<br>假如Range使用的是字节范围，那么这种情况就是指请求指定的所有数据范围的首字节位置都超过了当前资源的长度。服务器也应当在返回416状态码的同时，包含一个Content-Range实体头，用以指明当前资源的长度。这个响应也被禁止使用multipart&#x2F;byteranges作为其Content-Type。</p>
<h3 id="417-Expectation-Failed"><a href="#417-Expectation-Failed" class="headerlink" title="417 Expectation Failed"></a>417 Expectation Failed</h3><p>在请求头Expect中指定的预期内容无法被服务器满足，或者这个服务器是一个代理服务器，它有明显的证据证明在当前路由的下一个节点上，Expect的内容无法被满足。</p>
<h3 id="418-I’m-a-teapot"><a href="#418-I’m-a-teapot" class="headerlink" title="418 I’m a teapot"></a>418 I’m a teapot</h3><p>本操作码是在1998年作为IETF的传统愚人节笑话, 在RFC 2324 超文本咖啡壶控制协议中定义的，并不需要在真实的HTTP服务器中定义。当一个控制茶壶的HTCPCP收到BREW或POST指令要求其煮咖啡时应当回传此错误。</p>
<h3 id="421-There-are-too-many-connections-from-your-internet-address"><a href="#421-There-are-too-many-connections-from-your-internet-address" class="headerlink" title="421 There are too many connections from your internet address"></a>421 There are too many connections from your internet address</h3><p>从当前客户端所在的IP地址到服务器的连接数超过了服务器许可的最大范围。通常，这里的IP地址指的是从服务器上看到的客户端地址（比如用户的网关或者代理服务器地址）。在这种情况下，连接数的计算可能涉及到不止一个终端用户。</p>
<h3 id="422-Unprocessable-Entity"><a href="#422-Unprocessable-Entity" class="headerlink" title="422 Unprocessable Entity"></a>422 Unprocessable Entity</h3><p>请求格式正确，但是由于含有语义错误，无法响应。</p>
<h3 id="423-Locked"><a href="#423-Locked" class="headerlink" title="423 Locked"></a>423 Locked</h3><p>当前资源被锁定。</p>
<h3 id="424-Failed-Dependency"><a href="#424-Failed-Dependency" class="headerlink" title="424 Failed Dependency"></a>424 Failed Dependency</h3><p>由于之前的某个请求发生的错误，导致当前请求失败，例如PROPPATCH。</p>
<h3 id="425-Unordered-Collection"><a href="#425-Unordered-Collection" class="headerlink" title="425 Unordered Collection"></a>425 Unordered Collection</h3><p>在<a href="http://tools.ietf.org/html/draft-ietf-webdav-collection-protocol-04#section-5.3.2">WebDav Advanced Collections草案</a>中定义，但是未出现在《WebDAV顺序集协议》<a href="https://tools.ietf.org/html/rfc3658">RFC3658</a>中。</p>
<h3 id="426-Upgrade-Required"><a href="#426-Upgrade-Required" class="headerlink" title="426 Upgrade Required"></a>426 Upgrade Required</h3><p>客户端应当切换到<a href="https://zh.wikipedia.org/wiki/%E5%82%B3%E8%BC%B8%E5%B1%A4%E5%AE%89%E5%85%A8%E5%8D%94%E8%AD%B0">TLS&#x2F;1.0</a>。</p>
<h3 id="449-Retry-With"><a href="#449-Retry-With" class="headerlink" title="449 Retry With"></a>449 Retry With</h3><p>由<a href="https://zh.wikipedia.org/wiki/%E5%BE%AE%E8%BD%AF">微软</a>扩展，代表请求应当在执行完适当的操作后进行重试。</p>
<h2 id="5xx-服务器错误"><a href="#5xx-服务器错误" class="headerlink" title="5xx:服务器错误"></a>5xx:服务器错误</h2><p>这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生，也有可能是服务器意识到以当前的软硬件资源无法完成对请求的处理。除非这是一个HEAD请求，否则服务器应当包含一个解释当前错误状态以及这个状况是临时的还是永久的解释信息实体。浏览器应当向用户展示任何在当前响应中被包含的实体。</p>
<p>这些状态码适用于任何响应方法。</p>
<img src="/2015/11/20/http%E7%8A%B6%E6%80%81%E7%A0%81%E7%9F%A5%E5%A4%9A%E5%B0%91/http5.png" class="" title="5xx:服务器错误">

<h3 id="500-Internal-Server-Error"><a href="#500-Internal-Server-Error" class="headerlink" title="500 Internal Server Error"></a>500 Internal Server Error</h3><p>服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器的程序码出错时出现。</p>
<h3 id="501-Not-Implemented"><a href="#501-Not-Implemented" class="headerlink" title="501 Not Implemented"></a>501 Not Implemented</h3><p>服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。</p>
<h3 id="502-Bad-Gateway"><a href="#502-Bad-Gateway" class="headerlink" title="502 Bad Gateway"></a>502 Bad Gateway</h3><p>作为<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E5%85%B3">网关</a>或者<a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8">代理</a>工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。</p>
<h3 id="503-Service-Unavailable"><a href="#503-Service-Unavailable" class="headerlink" title="503 Service Unavailable"></a>503 Service Unavailable</h3><p>由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。如果能够预计延迟时间，那么响应中可以包含一个Retry-After头用以标明这个延迟时间。如果没有给出这个Retry-After信息，那么客户端应当以处理500响应的方式处理它。</p>
<h3 id="504-Gateway-Timeout"><a href="#504-Gateway-Timeout" class="headerlink" title="504 Gateway Timeout"></a>504 Gateway Timeout</h3><p>作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器（URI标识出的服务器，例如HTTP、FTP、LDAP）或者辅助服务器（例如DNS）收到响应。<br>注意：某些代理服务器在DNS查询超时时会返回400或者500错误。</p>
<h3 id="505-HTTP-Version-Not-Supported"><a href="#505-HTTP-Version-Not-Supported" class="headerlink" title="505 HTTP Version Not Supported"></a>505 HTTP Version Not Supported</h3><p>服务器不支持，或者拒绝支持在请求中使用的HTTP版本。这暗示着服务器不能或不愿使用与客户端相同的版本。响应中应当包含一个描述了为何版本不被支持以及服务器支持哪些协议的实体。</p>
<h3 id="506-Variant-Also-Negotiates"><a href="#506-Variant-Also-Negotiates" class="headerlink" title="506 Variant Also Negotiates"></a>506 Variant Also Negotiates</h3><p>由《透明内容协商协议》<a href="https://tools.ietf.org/html/rfc2295">RFC 2295</a>扩展，代表服务器存在内部配置错误：被请求的协商变元资源被配置为在透明内容协商中使用自己，因此在一个协商处理中不是一个合适的重点。</p>
<h3 id="507-Insufficient-Storage"><a href="#507-Insufficient-Storage" class="headerlink" title="507 Insufficient Storage"></a>507 Insufficient Storage</h3><p>服务器无法存储完成请求所必须的内容。这个状况被认为是临时的。（WebDAV RFC 4918）</p>
<h3 id="508-Loop-Detected"><a href="#508-Loop-Detected" class="headerlink" title="508 Loop Detected"></a>508 Loop Detected</h3><p>服务器发现请求中出现一个无穷循环</p>
<h3 id="509-Bandwidth-Limit-Exceeded"><a href="#509-Bandwidth-Limit-Exceeded" class="headerlink" title="509 Bandwidth Limit Exceeded"></a>509 Bandwidth Limit Exceeded</h3><p>服务器达到<a href="https://zh.wikipedia.org/wiki/%E5%B8%A6%E5%AE%BD">带宽</a>限制。这不是一个官方的状态码，但是仍被广泛使用。</p>
<h3 id="510-Not-Extended"><a href="#510-Not-Extended" class="headerlink" title="510 Not Extended"></a>510 Not Extended</h3><p>获取资源所需要的策略并没有被满足。</p>
<h2 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h2><p>本文http状态内容摘自维基百科中文版，作为笔记，以上状态码如果没有查到的话，可以去维基百科英文网站查询、或采用其他途径；<br>建议仅供参考：</p>
<ul>
<li>记住基本常用的状态码</li>
<li>了解状态码第一个数字代表状态</li>
<li>对于状态码的整体阅读一下，能记住多少是多少，忘记了，回过头来再查询</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.w3school.com.cn/tags/html_ref_httpmessages.asp">HTTP 状态消息-w3school</a></li>
<li><a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81">维基百科HTTP状态码-中文</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">维基百科HTTP状态码-英文</a></li>
</ol>
]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>getComputedStyle与currentStyle</title>
    <url>/2016/02/24/getComputedStyle%E4%B8%8EcurrentStyle/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>jQuery里面用 css()的一个方法获取页面样式，方便到家了，用它就是好，但是没有jQuery、或类似其他的类库那是什么情况呢？？？</p>
<span id="more"></span>

<h2 id="getComputedStyle-不支持ie678"><a href="#getComputedStyle-不支持ie678" class="headerlink" title="getComputedStyle(不支持ie678)"></a>getComputedStyle(不支持ie678)</h2><p><strong>摘要</strong>：获取当前元素有效的CSS属性值</p>
<p><strong>语法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var style = window.getComputedStyle(element, [pseudoElt]);</span><br><span class="line">element: 元素</span><br><span class="line">pseudoElt: 指定一个伪元素进行匹配。对于常规的元素来说可省略。支持伪类样式获取</span><br></pre></td></tr></table></figure>

<p><strong>例如</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//style</span><br><span class="line">.box&#123;width:200px;height:200px;padding:10px;margin:25px;border:2px solid red;&#125;</span><br><span class="line"></span><br><span class="line">//html</span><br><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;box&quot;</span> class=<span class="string">&quot;box&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">//js</span><br><span class="line">var dom = document.getElementById(<span class="string">&quot;box&quot;</span>),</span><br><span class="line">    style = window.getComputedStyle(dom , null);</span><br></pre></td></tr></table></figure>

<p><strong>参考图</strong>：</p>
<img src="/2016/02/24/getComputedStyle%E4%B8%8EcurrentStyle/style_pic_1.png" class="" title="css属性值">

<h3 id="getPropertyValue方法"><a href="#getPropertyValue方法" class="headerlink" title="getPropertyValue方法"></a>getPropertyValue方法</h3><p><strong>摘要</strong>：返回属性值</p>
<p><strong>不支持驼峰写法</strong></p>
<p><strong>例如</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var dom = document.getElementById(<span class="string">&quot;box&quot;</span>),</span><br><span class="line">    style = window.getComputedStyle(dom , null).getPropertyValue(<span class="string">&#x27;margin-top&#x27;</span>);   //25px</span><br></pre></td></tr></table></figure>

<p><strong>语法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var win = document.defaultView;  //该属性只读</span><br></pre></td></tr></table></figure>

<h3 id="document-defaultView"><a href="#document-defaultView" class="headerlink" title="document.defaultView"></a>document.defaultView</h3><p><strong>概述</strong>：在浏览器中，该属性返回当前 document 对象所关联的 window 对象，如果没有，会返回 null。</p>
<p>从下图可看出jQuery中没有直接写window.getComputedStyle( elem, null )，而是写的document.defaultView.getComputedView()。参考下图：</p>
<img src="/2016/02/24/getComputedStyle%E4%B8%8EcurrentStyle/style_pic_4.png" class="" title="css属性值">

<p>getComputedStyle 是通过 document.defaultView 对象来调用的。 大部分情况下，这是不需要的， 因为可以直接通过window对象调用。但有一种情况，你必需要使用 defaultView,  那是在firefox3.6上访问子框架内的样式 (iframe)</p>
<h3 id="getComputedStyle兼容"><a href="#getComputedStyle兼容" class="headerlink" title="getComputedStyle兼容"></a>getComputedStyle兼容</h3><img src="/2016/02/24/getComputedStyle%E4%B8%8EcurrentStyle/style_pic_2.png" class="" title="getComputedStyle兼容">

<h2 id="currentStyle"><a href="#currentStyle" class="headerlink" title="currentStyle"></a>currentStyle</h2><p><strong>摘要</strong>：返回了元素上的样式表，不能获取复合样式如background属性值</p>
<p><strong>例如</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//js</span><br><span class="line">var dom = document.getElementById(<span class="string">&quot;box&quot;</span>),</span><br><span class="line">    style = dom.currentStyle;  //返回对象 object，内容如下图</span><br></pre></td></tr></table></figure>

<p><strong>参考图</strong>：</p>
<img src="/2016/02/24/getComputedStyle%E4%B8%8EcurrentStyle/style_pic_3.png" class="" title="css属性值">

<h3 id="getAttribute方法"><a href="#getAttribute方法" class="headerlink" title="getAttribute方法"></a>getAttribute方法</h3><p><strong>摘要</strong>： 返回元素上指定的属性的值，如果指定的属性不存在，则返回  null 或 “”</p>
<p><strong>例如</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//js</span><br><span class="line">var dom = document.getElementById(<span class="string">&quot;box&quot;</span>),</span><br><span class="line">    style = dom.currentStyle.getAttribute(<span class="string">&quot;marginTop&quot;</span>);  //25</span><br><span class="line"></span><br><span class="line">属性名需驼峰写法</span><br></pre></td></tr></table></figure>

<p><strong>currentStyle兼容性</strong>：也不能被各大浏览器支持，但是弥补了上边的getComputedStyle方法的不支持ie678和欧鹏等浏览器。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>通过上边介绍的两个方法，基本上我们可以更方便的写出适合自己的方法来获取页面样式。了解更多，下面有提供的参考链接，如张鑫旭的文章,当然特殊情况要单独处理如透明度。</p>
<p><strong>代码参考</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> toCaps(style)&#123;</span><br><span class="line">    //将短杠后边的字母转换为大写</span><br><span class="line">    <span class="built_in">return</span> style.replace(/\-(\w)/g, <span class="keyword">function</span>(all, letter) &#123;</span><br><span class="line">        <span class="built_in">return</span> letter.toUpperCase();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getCssVal(elem,style)&#123;</span><br><span class="line">    <span class="keyword">if</span> (window.getComputedStyle) &#123;</span><br><span class="line">        <span class="built_in">return</span> window.getComputedStyle(elem, null).getPropertyValue(style);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> elem.currentStyle.getAttribute(toCaps(style));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var dom = document.getElementById(<span class="string">&quot;box&quot;</span>);</span><br><span class="line">    getCssVal(dom,<span class="string">&#x27;margin-top&#x27;</span>);    //25</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle">getComputedStyle-MDN</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2012/05/getcomputedstyle-js-getpropertyvalue-currentstyle/">获取元素CSS值之getComputedStyle方法熟悉-张鑫旭</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/ms535231%28v=vs.85%29.aspx">currentStyle-msdn</a></li>
<li><a href="http://caniuse.com/#feat=getcomputedstyle">getComputedStyle-caniuse</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/defaultView">Document.defaultView-MDN</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript-Date日期对象</title>
    <url>/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>Date对象：javascript的Date对象用来处理日期和时间。<br>协调世界时(Universal Time Coordinated)：简称UTC，由世界时同原子时协调而成的时间计算系统。它是当今世界无线电通讯中使用的标准时间。<br>格林威治标准时间(Greenwich Mean Time)：简称GMT, 现在计算机和一些电子设备时间的计算和显示是以距历元(即格林威治标准时间 1970 年 1 月 1 日的 00:00:00.000)的偏移量为标准的。</p>
<ol>
<li>Date对象是基于1970年1月1日00:00:00时世界协调时(UTC)起的毫秒数，正负的范围为基准时间前后各1亿天</li>
<li>人们通常所说的中国标准时间，就是协调世界时UTC</li>
<li>Date对象会自动把当前日期和时间保存为其初始值。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Date()  //返回当日的日期和时间</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_1.png" class="" title="网页响应头的GMT">

<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><p>1、 new Date();</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">new Date()              //如：Mon Jan 04 2016 13:47:57 GMT+0800 (中国标准时间)</span><br><span class="line">var today = new Date();</span><br></pre></td></tr></table></figure>

<p>2、new Date(value)</p>
<p>value:代表自世界协调时1970年1月1日00:00:00 经过的毫秒数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">new Date(1451886597656); // Mon Jan 04 2016 13:49:57 GMT+0800 (中国标准时间)</span><br><span class="line">var Jan_04 = new Date(1451886597656);</span><br></pre></td></tr></table></figure>

<p>3、new Date(dateString)</p>
<p>dateString：表示日期的字符串值。该字符串应该能被 Date.parse() 方法识别</p>
<p>推荐字符串格式：</p>
<img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_2.png" class="" title="字符串参考图">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">new Date(<span class="string">&#x27;2009/07/12&#x27;</span>);         // Sun Jul 12 2009 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(<span class="string">&#x27;2009/7/12&#x27;</span>);          // Sun Jul 12 2009 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(<span class="string">&#x27;2009/07/12 12:34&#x27;</span>);   // Sun Jul 12 2009 12:34:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(<span class="string">&#x27;2009/07/12 12:34:56&#x27;</span>);// Sun Jul 12 2009 12:34:56 GMT+0800 (中国标准时间)</span><br><span class="line"></span><br><span class="line">new Date(<span class="string">&#x27;07/02/2012&#x27;</span>);         // Mon Jul 02 2012 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(<span class="string">&#x27;7/2/2012&#x27;</span>);           // Mon Jul 02 2012 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(<span class="string">&#x27;7/2/2012 12:34&#x27;</span>);     // Mon Jul 02 2012 12:34:00 GMT+0800 (中国标准时间)</span><br></pre></td></tr></table></figure>

<p>4、new Date(year, month[, day[, hour[, minutes[, seconds[, milliseconds]]]]])</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">year</td>
<td align="center">代表年份的整数值。为了避免2000年问题最好指定4位数的年份; 使用 1998, 而不要用 98</td>
</tr>
<tr>
<td align="center">month</td>
<td align="center">月份，用从 0 到 11 的整数表示（1 月至 12 月）</td>
</tr>
<tr>
<td align="center">day</td>
<td align="center">日期，用从 1 到 31 的整数表示</td>
</tr>
<tr>
<td align="center">hour</td>
<td align="center">小时，从 0 到 23 的整数（午夜到 11pm）</td>
</tr>
<tr>
<td align="center">minute</td>
<td align="center">分钟,从 0 到 59 的整数</td>
</tr>
<tr>
<td align="center">second</td>
<td align="center">秒数,从 0 到 59 的整数</td>
</tr>
<tr>
<td align="center">millisecond</td>
<td align="center">毫秒, 从 0 到 999 的整数</td>
</tr>
</tbody></table>
<p>参数依次表示年、月、日、小时、分钟、秒和毫秒，这种格式至少需要提供 <strong>年月</strong> 两个参数，其他参数可选，默认为0。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">new Date(2015, 0);                  // Thu Jan 01 2015 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(2015, 0, 1, 0, 0, 0, 0);   // Thu Jan 01 2015 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line"></span><br><span class="line">//超出了正常范围</span><br><span class="line">new Date(2014, 16)                  // Fri May 01 2015 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(2014, -2)                  // Fri Nov 01 2013 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">new Date(2014, 0, -1)               // Mon Dec 30 2013 00:00:00 GMT+0800 (中国标准时间)</span><br></pre></td></tr></table></figure>

<h2 id="Date-对象属性"><a href="#Date-对象属性" class="headerlink" title="Date 对象属性"></a>Date 对象属性</h2><p>Date.prototype：允许为 Date 实例对象添加属性。<br>Date.length：Date.length 的值是 7。这是该构造函数可接受的参数个数。</p>
<img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_3.png" class="" title="Date对象属性">


<h2 id="Date对象的静态方法"><a href="#Date对象的静态方法" class="headerlink" title="Date对象的静态方法"></a>Date对象的静态方法</h2><h3 id="Date-now"><a href="#Date-now" class="headerlink" title="Date.now()"></a>Date.now()</h3><p>Date.now方法返回当前距离1970年1月1日 00:00:00 UTC的毫秒数（Unix时间戳乘以1000）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Date.now()                  // 如： 1451892741668</span><br><span class="line"></span><br><span class="line">毫秒更精确的时间,可精确到千分之一毫秒</span><br><span class="line">window.performance.now()    // 如： 4634702.617000002</span><br></pre></td></tr></table></figure>

<h3 id="Date-parse"><a href="#Date-parse" class="headerlink" title="Date.parse()"></a>Date.parse()</h3><p>Date.parse方法用来解析日期字符串，返回距离1970年1月1日 00:00:00的毫秒数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Date.parse(<span class="string">&#x27;Mon, 25 Dec 1995 13:30:00 +0430&#x27;</span>)   // 819882000000</span><br></pre></td></tr></table></figure>

<h3 id="Date-UTC"><a href="#Date-UTC" class="headerlink" title="Date.UTC()"></a>Date.UTC()</h3><p>默认情况下，Date对象返回的都是当前时区的时间,返回当前距离1970年1月1日 00:00:00 UTC的毫秒数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Date.UTC(2011, 0, 1, 2, 3, 4, 567)</span><br></pre></td></tr></table></figure>

<h2 id="to类方法"><a href="#to类方法" class="headerlink" title="to类方法"></a>to类方法</h2><img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_4.png" class="" title="to类方法">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//初始化日期</span><br><span class="line">var d = new Date(2013, 0, 1);</span><br><span class="line"></span><br><span class="line">d.toString();               // Tue Jan 01 2013 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">d.toLocaleString();         // 2013/1/1 上午12:00:00</span><br><span class="line">d.toLocaleDateString();     // 2013/1/1</span><br><span class="line">d.toLocaleTimeString();     // 上午12:00:00</span><br><span class="line"></span><br><span class="line">d.toDateString();           // Tue Jan 01 2013</span><br><span class="line">d.toTimeString();           // 00:00:00 GMT+0800 (中国标准时间)</span><br><span class="line">d.toGMTString();            // Mon, 31 Dec 2012 16:00:00 GMT</span><br><span class="line">d.toUTCString();            // Mon, 31 Dec 2012 16:00:00 GMT          </span><br><span class="line"></span><br><span class="line">把一个日期转换为符合 ISO 8601 扩展格式的字符串</span><br><span class="line">d.toISOString();            // 2012-12-31T16:00:00.000Z</span><br></pre></td></tr></table></figure>

<h2 id="get类方法"><a href="#get类方法" class="headerlink" title="get类方法"></a>get类方法</h2><img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_5.png" class="" title="get类方法">


<h3 id="根据本地时"><a href="#根据本地时" class="headerlink" title="根据本地时"></a>根据本地时</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var d = new Date(2013, 0, 1, 1, 45, 35,400);</span><br><span class="line"></span><br><span class="line">d.getTime();                // 毫秒：356969600000</span><br><span class="line">d.getFullYear();            // 年：2013</span><br><span class="line">d.getMonth();               // 月: 0</span><br><span class="line">d.getDate();                // 日：1</span><br><span class="line">d.getHours();               // 时：1</span><br><span class="line">d.getMinutes();             // 分：45</span><br><span class="line">d.getSeconds();             // 秒: 35</span><br><span class="line">getMilliseconds();          // 毫秒：400</span><br><span class="line"></span><br><span class="line">返回本地时间与格林威治标准时间 (GMT) 的分钟差</span><br><span class="line">d.getTimezoneOffset()       // -480</span><br><span class="line">d.getYear();                // 113</span><br></pre></td></tr></table></figure>

<h3 id="根据世界时"><a href="#根据世界时" class="headerlink" title="根据世界时"></a>根据世界时</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var d = new Date(2013, 0, 1, 1, 45, 35,400);    //2013/1/1 上午1:45:35</span><br><span class="line"></span><br><span class="line">d.getUTCFullYear();         // 年: 2012</span><br><span class="line">d.getUTCMonth();            // 月: 11</span><br><span class="line">d.getUTCDate();             // 日：31</span><br><span class="line">d.getUTCHours();            // 时：17</span><br><span class="line">d.getUTCMinutes();          // 分：45</span><br><span class="line">d.getUTCSeconds();          // 秒：35</span><br><span class="line">d.getUTCMilliseconds();     // 毫秒：400</span><br></pre></td></tr></table></figure>

<h2 id="set类方法"><a href="#set类方法" class="headerlink" title="set类方法"></a>set类方法</h2><img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_6.png" class="" title="set类方法">

<h3 id="根据本地时-1"><a href="#根据本地时-1" class="headerlink" title="根据本地时"></a>根据本地时</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var d = new Date(2013, 0, 1, 1, 45, 35,400);</span><br><span class="line"></span><br><span class="line">d.setTime(1451896870207);       // Mon Jan 04 2016 16:41:10 GMT+0800 (中国标准时间)</span><br><span class="line">d.setFullYear(2018);            // Mon Jan 01 2018 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setMonth(8);                  // Sun Sep 01 2013 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setDate(16)                   // Wed Jan 16 2013 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setHours(20);                 // Tue Jan 01 2013 20:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setMinutes(46)                // Tue Jan 01 2013 01:46:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setSeconds(36)                // Tue Jan 01 2013 01:45:36 GMT+0800 (中国标准时间)</span><br><span class="line">d.setMilliseconds(500);         // 500</span><br></pre></td></tr></table></figure>

<h3 id="根据世界时-1"><a href="#根据世界时-1" class="headerlink" title="根据世界时"></a>根据世界时</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var d = new Date(2013, 0, 1, 1, 45, 35,400);    </span><br><span class="line"></span><br><span class="line">d.setUTCFullYear(2015)          // Fri Jan 01 2016 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCMonth(1);               // Sat Mar 03 2012 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCDate(13);               // Fri Dec 14 2012 01:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCHours(3);               // Mon Dec 31 2012 11:45:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCMinutes(54);            // Tue Jan 01 2013 01:54:35 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCSeconds(44);            // Tue Jan 01 2013 01:45:44 GMT+0800 (中国标准时间)</span><br><span class="line">d.setUTCMilliseconds(100)       // 100</span><br></pre></td></tr></table></figure>

<h2 id="日期库"><a href="#日期库" class="headerlink" title="日期库"></a>日期库</h2><p>1、Datejs</p>
<p>Datejs是一个开源的JavaScript库解析日期,格式和处理。</p>
<p>地址：<a href="https://github.com/datejs/Datejs">https://github.com/datejs/Datejs</a></p>
<p>2、Moment.js</p>
<p>JavaScript 日期处理类库</p>
<img src="/2016/01/04/javascript-Date%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1/date_pic_7.png" class="" title="moment.js">

<p>中文地址：<a href="http://momentjs.cn/">http://momentjs.cn/</a><br>英文地址：<a href="http://momentjs.com/">http://momentjs.com/</a></p>
<p>3、jquery-countdown.js</p>
<p>jQuery倒计时是一个倒计时库</p>
<p>地址：<a href="https://github.com/Reflejo/jquery-countdown">https://github.com/Reflejo/jquery-countdown</a></p>
<ol start="4">
<li>xdate.js</li>
</ol>
<p>一个现代JavaScript库</p>
<p>地址：<a href="https://github.com/arshaw/xdate">https://github.com/arshaw/xdate</a></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date#.E6.8F.8F.E8.BF.B0">Date-MDN</a></li>
<li><a href="http://www.w3school.com.cn/jsref/jsref_obj_date.asp">w3school-Date</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/cd9w2te4.aspx">微软-Date</a></li>
<li><a href="http://dygraphs.com/date-formats.html">日期字符串解析</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>js编程试题</title>
    <url>/2016/05/23/js%E7%BC%96%E7%A8%8B%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<h2 id="最近遇到的试题"><a href="#最近遇到的试题" class="headerlink" title="最近遇到的试题"></a>最近遇到的试题</h2><p><strong>1.求字符串的字节长度(英文一个字节，汉字两个字节)</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*charCodeAt() 方法可返回指定位置的字符的 Unicode 编码。这个返回值是 0 - 65535 之间的整数。*/</span><br><span class="line"><span class="keyword">function</span> getByte(str) &#123;</span><br><span class="line">    var len = str.length,</span><br><span class="line">        bytes = 0;</span><br><span class="line">    <span class="keyword">for</span> (var i = 0; i &lt; str.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[i].charCodeAt() &gt; 255) &#123;</span><br><span class="line">            bytes++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> len + bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p><strong>2.specify(“hello world”)&#x2F;&#x2F; &#x3D;&gt; ‘h e l l o w o r l d’ 实现specify函数</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">String.prototype.specify = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> this.replace(/\s*/g, <span class="string">&quot;&quot;</span>).<span class="built_in">split</span>(<span class="string">&quot;&quot;</span>).<span class="built_in">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.数组去重</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> unique(arr) &#123;</span><br><span class="line">    var _obj = &#123;&#125;,</span><br><span class="line">        _arr = [],</span><br><span class="line">        len = arr.length;</span><br><span class="line">    <span class="keyword">for</span> (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_obj[arr[i]]) &#123;</span><br><span class="line">            _obj[arr[i]] = 1;</span><br><span class="line">            _arr.push(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> _arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.实现一个函数clone，可以对JavaScript中的5种主要的数据类型（包括Number、String、Object、Array、Boolean）进行值复制</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Object.prototype.clone = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    var o = typeof(this) === <span class="string">&quot;object&quot;</span> ? &#123;&#125; : [];</span><br><span class="line">    <span class="keyword">for</span> (e <span class="keyword">in</span> this) &#123;</span><br><span class="line">        o[e] = typeof(this[e]) === <span class="string">&quot;object&quot;</span> ? this[e].<span class="built_in">clone</span>() : this[e];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deepClone: <span class="keyword">function</span>(obj) &#123;</span><br><span class="line">    var buf,</span><br><span class="line">        _this = this;</span><br><span class="line">    <span class="keyword">if</span> (obj instanceof Array) &#123;</span><br><span class="line">        buf = []; //创建一个空数组</span><br><span class="line">        var len = obj.length;</span><br><span class="line">        <span class="keyword">while</span> (len--) &#123;</span><br><span class="line">            buf[len] = _this.deepClone(obj[len]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> buf;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj instanceof Object) &#123;</span><br><span class="line">        buf = &#123;&#125;; //创建一个空对象</span><br><span class="line">        <span class="keyword">for</span> (var k <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            buf[k] = _this.deepClone(obj[k]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> buf;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5.下面这个结构,点击每一列的时候alert其index?（最好使用闭包）</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;ul <span class="built_in">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">  &lt;li&gt;这是第一条&lt;/li&gt;</span><br><span class="line">  &lt;li这是第二条&lt;/li&gt;</span><br><span class="line">  &lt;li这是第三条&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">var domList = document.getElementById(<span class="string">&quot;test&quot;</span>).getElementsByTagName(<span class="string">&quot;li&quot;</span>),</span><br><span class="line">    len = domList.length;</span><br><span class="line"><span class="keyword">for</span> (var i = 0; i &lt; domList.length; i++) &#123;</span><br><span class="line">    domList[i].index = i;</span><br><span class="line">    domList[i].onclick = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        console.log(this.index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var domList = document.getElementById(<span class="string">&quot;test&quot;</span>).getElementsByTagName(<span class="string">&quot;li&quot;</span>),</span><br><span class="line">    len = domList.length;</span><br><span class="line"><span class="keyword">for</span> (var i = 0; i &lt; domList.length; i++) &#123;</span><br><span class="line">    domList[i].onclick = (<span class="keyword">function</span>(n) &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">            console.log(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6.将伪数组转化为标准数组</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">arrayLike</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> Array.prototype.slice.call(arguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>7.有这样一个URL：<a href="http://item.taobao.com/item.htm?a=1&b=2&c=&d=xxx&e%EF%BC%8C%E8%AF%B7%E5%86%99%E4%B8%80%E6%AE%B5JS%E7%A8%8B%E5%BA%8F%E6%8F%90%E5%8F%96URL%E4%B8%AD%E7%9A%84%E5%90%84%E4%B8%AAGET%E5%8F%82%E6%95%B0(%E5%8F%82%E6%95%B0%E5%90%8D%E5%92%8C%E5%8F%82%E6%95%B0%E4%B8%AA%E6%95%B0%E4%B8%8D%E7%A1%AE%E5%AE%9A)%EF%BC%8C%E5%B0%86%E5%85%B6%E6%8C%89key-value%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E%E5%88%B0%E4%B8%80%E4%B8%AAjson%E7%BB%93%E6%9E%84%E4%B8%AD">http://item.taobao.com/item.htm?a=1&amp;b=2&amp;c=&amp;d=xxx&amp;e，请写一段JS程序提取URL中的各个GET参数(参数名和参数个数不确定)，将其按key-value形式返回到一个json结构中</a></strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> serilizeUrl(url) &#123;</span><br><span class="line">    var result = &#123;&#125;;</span><br><span class="line">    url = url.split(<span class="string">&quot;?&quot;</span>)[1];</span><br><span class="line">    <span class="keyword">if</span> (!url) <span class="built_in">return</span> null;</span><br><span class="line">    var map = url.split(<span class="string">&quot;&amp;&quot;</span>),</span><br><span class="line">        len = map.length;</span><br><span class="line">    <span class="keyword">for</span> (var i = 0; i &lt; len; i++) &#123;</span><br><span class="line">        var _arr = map[i].<span class="built_in">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">        result[_arr[0]] = _arr[1];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>8.兔子数列是什么(前面相邻两项之和，构成了后一项)</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var result = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> rabbit(n) &#123; //月数 返回成对兔子数</span><br><span class="line">    <span class="keyword">if</span> (n == 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == 2) &#123;</span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result[n]) &#123;</span><br><span class="line">            <span class="built_in">return</span> result[n];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result[n] = arguments.callee(n - 1) + arguments.callee(n - 2);</span><br><span class="line">            <span class="built_in">return</span> result[n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>9.从一个给定的数组arr中,随机返回num个不重复项</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> getArrayItems(arr, num) &#123;</span><br><span class="line">    var _arr = [];</span><br><span class="line">    <span class="keyword">for</span> (var i = 0; i &lt; num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr.length &gt; 0) &#123;</span><br><span class="line">            var index = Math.floor(Math.random() * arr.length);</span><br><span class="line">            _arr[i] = arr[index];</span><br><span class="line">            arr.splice(index, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> _arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><strong>！！！：得让你用笔去答题</strong></p>
<p>上面的试题，虽然难度不高，<br>但是它考验了一个程序员基本的逻辑思维，当你思路都不清晰了，你能保证你的程序能正常运行吗？<br>上面并没有要求你用多精妙的方法去实现，只是要求实现而已。</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Matrix矩阵</title>
    <url>/2015/09/29/matrix/</url>
    <content><![CDATA[<h2 id="什么是Matrix？"><a href="#什么是Matrix？" class="headerlink" title="什么是Matrix？"></a>什么是Matrix？</h2><p>Matrix（矩阵）是一个有关数字，符号，表达式组合的有趣的数学词汇，广泛应用于数学和科技领域。物理学家们还将其纳入量子力学的学习范畴。在电脑图形方面，它们被用于线性变形和处理3D图像和2D映画。Matrix 函数中的matrix()可以用来创建线性变化，matrix3d()可以用css在二维画面里创建三维图像。（下图是一个matrix例子）</p>
<img src="/2015/09/29/matrix/matrix.png" class="" title="矩阵2D">

<p>2D变换矩阵为3x3 ,3D变换则是4x4的矩阵；<br>矩阵(matrix)可以完成，斜拉(skew)，缩放(scale)，旋转(rotate)以及位移(translate);<br>变换矩阵基于一个特定坐标点相乘表示为一个向量。</p>
<h2 id="坐标系统"><a href="#坐标系统" class="headerlink" title="坐标系统"></a>坐标系统</h2><blockquote>
<p>坐标系统。每一个文档视图都是一个坐标系统，左上角为视图的原点，坐标(0,0)。数值沿着X轴向右，沿着Y轴向下而递增。3D transform里面的Z轴决定了观察者所能觉察到的距离。数值越大，距离越近物象越大，数值越小，距离越远物象越小。</p>
</blockquote>
<span id="more"></span>

<p>一个transform应用在一个对象上，就形成了一个当前坐标系统，坐标系的原点(0,0)默认位置在对象的中央。<br>2D坐标：</p>
<img src="/2015/09/29/matrix/zb2d.png" class="" title="2D坐标">

<p>3D坐标：</p>
<img src="/2015/09/29/matrix/zb3d.png" class="" title="3D坐标">

<h2 id="transform-语法"><a href="#transform-语法" class="headerlink" title="transform 语法"></a>transform 语法</h2><p>它的所有语法如下图：</p>
<img src="/2015/09/29/matrix/yufa.png" class="" title="语法">

<h2 id="2D变换"><a href="#2D变换" class="headerlink" title="2D变换"></a>2D变换</h2><h3 id="矩阵等价函数"><a href="#矩阵等价函数" class="headerlink" title="矩阵等价函数"></a>矩阵等价函数</h3><p>所有其他的CSS3变换函数等价的矩阵表示，看下图：</p>
<img src="/2015/09/29/matrix/express.png" class="" title="矩阵等价函数">

<h3 id="位移-translate-变换分解"><a href="#位移-translate-变换分解" class="headerlink" title="位移[translate]变换分解"></a>位移[translate]变换分解</h3><ol>
<li><p>该函数写法如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">transform: matrix(a,b,c,d,e,f);</span><br></pre></td></tr></table></figure></li>
<li><p>上面对应参数表示成矩阵是这样的:<img src="/2015/09/29/matrix/matrix.png" class="" title="矩阵2D"></p>
</li>
<li><p>现在我们让上边的矩阵变换一下，3x3矩阵每一行的第1个值与后面1x3矩阵的第1个值相乘，第2个值与第2个相乘，第3个与第3个，然后相加，过程如下:<img src="/2015/09/29/matrix/pianyi.png" class="" title="矩阵2D变换"></p>
<blockquote>
<p>当我们应用一个2D tansfrom的时候，浏览器会把矩阵和一个向量（[x, y, 1]）相乘。x和y的值是当前坐标空间中特定的坐标点;<br>我们将每一列中的实体与向量中的列相乘得到最终的transform坐标;<br>此时ax+cy+e为变换后的水平坐标，bx+dy+f表示变换后的垂直位置。</p>
</blockquote>
</li>
<li><p>这样得出的一组数字和字符组合看起来毫无意义，但上文提到过，每一个transform都有一个矩阵：<img src="/2015/09/29/matrix/results.png" class="" title="矩阵变换结果"><br>tx和ty的值就是要变形的数值，我们也可以用向量来表示：[1 0 0 1 tx ty]。向量可以看做是matrix() 的参数。</p>
</li>
<li><p>把上面变换后的矩阵写成css代码就成了这样：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    transform: matrix(1, 0, 0, 1, tx, ty);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>从上边可以发，位移只要关心最后两个参数，公式如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    transform: matrix(与我无关, 与我无关,与我无关, 与我无关, 水平位移距离,垂直位移距离);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="缩放-scale"><a href="#缩放-scale" class="headerlink" title="缩放(scale)"></a>缩放(scale)</h3><blockquote>
<p>从matrix中的参数可以看到有两个数字1，对，这就是缩放相关的参数。<br>其中，第一个缩放x轴，第二个缩放y轴。写成公式：matrix(s, 0, 0, s, 0, 0),再套用上边的公式，就有：<br>x’ &#x3D; ax+cy+e &#x3D; s<em>x+0</em>y+0 &#x3D; s<em>x;<br>y’ &#x3D; bx+dy+f &#x3D; 0</em>x+s<em>y+0 &#x3D; s</em>y;<br>最后就是matrix(sx, 0, 0, sy, 0, 0);，等同于scale(sx, sy);</p>
</blockquote>
<h3 id="旋转-rotate"><a href="#旋转-rotate" class="headerlink" title="旋转(rotate)"></a>旋转(rotate)</h3><p>旋转使用如下（假设角度为θ）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">matrix(cosθ,sinθ,-sinθ,cosθ,0,0)</span><br></pre></td></tr></table></figure>
<p>然后就有了:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">x<span class="string">&#x27; = x*cosθ-y*sinθ+0 = x*cosθ-y*sinθ</span></span><br><span class="line"><span class="string">y&#x27;</span> = x*sinθ+y*cosθ+0 = x*sinθ+y*cosθ</span><br></pre></td></tr></table></figure>
<p>使用matrix表示则还要计算cos, sin值,最简单的写法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">transform:rotate(θ);</span><br></pre></td></tr></table></figure>

<h3 id="拉伸-skew"><a href="#拉伸-skew" class="headerlink" title="拉伸(skew)"></a>拉伸(skew)</h3><p>使用如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">matrix(1,tan(θy),tan(θx),1,0,0)</span><br></pre></td></tr></table></figure>

<p>然后就有了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">x<span class="string">&#x27; = x+y*tan(θx)+0 = x+y*tan(θx)</span></span><br><span class="line"><span class="string">y&#x27;</span> = x*tan(θy)+y+0 = x*tan(θy)+y</span><br></pre></td></tr></table></figure>
<p>对应于skew(θx + “deg”，θy+ “deg”)这种写法。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">transform:skew(θx + <span class="string">&quot;deg&quot;</span>，θy+ <span class="string">&quot;deg&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>注：其中，θx表示x轴倾斜的角度，θy表示y轴</p>
<h2 id="3D矩阵变换"><a href="#3D矩阵变换" class="headerlink" title="3D矩阵变换"></a>3D矩阵变换</h2><p>matrix3d() 函数是一个3d变换函数是用来描述一个三维的序列 转换 在一个4×4的矩阵中。这是一个4x4的矩阵，sx , sy, sz代表了乘数的比例，如下：</p>
<img src="/2015/09/29/matrix/matrix3d.png" class="" title="3D矩阵变换">

<p>代码表示这样的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">transform: matrix3d(sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1)</span><br></pre></td></tr></table></figure>

<p>从上可看出计算matrix3d()函数的值，不是很简单的，这要手工完成，那么也是很累的，也有人开发工具：</p>
<ol>
<li><p><a href="http://meyerweb.com/eric/tools/matrix/">Eric Meyer 和 Aaron Gustafson创造的工具</a></p>
<img src="/2015/09/29/matrix/tool1.jpg" class="" title="matrix工具">

</li>
<li><p><a href="http://ds-overdesign.com/transform/matrix3d.html">transform工具</a></p>
<img src="/2015/09/29/matrix/tool2.jpg" class="" title="matrix工具"></li>
</ol>
<h2 id="齐次坐标-homogeneous-coordinates"><a href="#齐次坐标-homogeneous-coordinates" class="headerlink" title="齐次坐标(homogeneous coordinates)"></a>齐次坐标(homogeneous coordinates)</h2><ul>
<li><strong>齐次坐标</strong>：所谓齐次坐标就是将一个原本是n维的向量用一个n+1维向量来表示。</li>
<li><strong>向量</strong>：既有方向又有大小的量叫做向量（物理学中叫做矢量）。</li>
<li><strong>平面向量</strong>：平面向量是在二维平面内既有方向(direction)又有大小(magnitude)的量，物理学中也称作矢量，与之相对的是只有大小、没有方向的数量（标量）。平面向量用小写加粗的字母a，b，c表示，也可以用表示向量的有向线段的起点和终点字母表示。<img src="/2015/09/29/matrix/plane.jpg" class="" title="平面向量"></li>
<li><strong>空间向量</strong>:空间中具有大小和方向的量叫做空间向量。向量的大小叫做向量的长度或模（moduius)。<img src="/2015/09/29/matrix/space.jpg" class="" title="空间向量"></li>
</ul>
<blockquote>
<p>在上面的矩阵中，我们可以看到平移的矩阵是相加的，而旋转跟缩放的矩阵都是相乘的，这样计算起来多麻烦呀！于是为了方便计算，大家都统一用一种方式来进行计算，聪明的计算机图形科学家，它们就设计出这样一种坐标系，叫齐次坐标(homogeneous coordinates)，而它的目的只是为了更加方便地去用矩阵来计算图形的变换，没有其他。</p>
</blockquote>
<p>那什么是齐次坐标呢？<br>其实就是在原来2D的维度，再加上一个新的维度，多出来的维度的值永远是1，比如点的矩阵就变成:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    ┌   ┐</span><br><span class="line">    │ x │</span><br><span class="line">P = │ y │</span><br><span class="line">    │ 1 │</span><br><span class="line">    └   ┘</span><br></pre></td></tr></table></figure>
<p>而Translation（平移）的矩阵表示就变成：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    ┌         ┐</span><br><span class="line">    │ 1  0 tx │</span><br><span class="line">T = │ 0  1 ty │</span><br><span class="line">    │ 0  0  1 │</span><br><span class="line">    └         ┘</span><br></pre></td></tr></table></figure>
<p>这样，平移变换的加法就可以变成乘法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">             ┌         ┐   ┌   ┐   ┌      ┐</span><br><span class="line">             │ 1  0 tx │   │ x │   │ x+tx │</span><br><span class="line">P<span class="string">&#x27; = T * P = │ 0  1 ty │ * │ y │ = │ y+ty │</span></span><br><span class="line"><span class="string">             │ 0  0  1 │   │ 1 │   │  1   │</span></span><br><span class="line"><span class="string">             └         ┘   └   ┘   └      ┘</span></span><br></pre></td></tr></table></figure>

<p>Scale（缩放）跟Rotation（旋转）相对应的矩阵也就变成：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">    ┌          ┐         ┌                    ┐</span><br><span class="line">    │ sx  0  0 │         │  cos(α)  sin(α)  0 │</span><br><span class="line">S = │ 0  xy  0 │     R = │ -sin(α)  cos(α)  1 │</span><br><span class="line">    │ 0  0   1 │         │    0       0     1 │</span><br><span class="line">    └          ┘         └                    ┘</span><br></pre></td></tr></table></figure>

<p>注：引入齐次坐标的目的主要是合并矩阵运算中的乘法和加法。</p>
<h2 id="浏览器支持情况"><a href="#浏览器支持情况" class="headerlink" title="浏览器支持情况"></a>浏览器支持情况</h2><h3 id="2D支持"><a href="#2D支持" class="headerlink" title="2D支持:"></a><a href="http://caniuse.com/transforms2d/embed/">2D支持</a>:</h3><img src="/2015/09/29/matrix/support2d.jpg" class="" title="2D支持">

<h3 id="3D支持"><a href="#3D支持" class="headerlink" title="3D支持:"></a><a href="http://caniuse.com/transforms3d/embed/">3D支持</a>:</h3><img src="/2015/09/29/matrix/support3d.jpg" class="" title="3D支持">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.zhangxinxu.com/wordpress/2012/06/css3-transform-matrix-%E7%9F%A9%E9%98%B5/comment-page-2/">张鑫旭-理解CSS3 transform中的Matrix</a></li>
<li>[<a href="http://www.zhangxinxu.com/wordpress/2012/09/css3-3d-transform-perspective-animate-transition/">张鑫旭-CSS3 3D transform变换，不过如此！</a></li>
<li><a href="https://dev.opera.com/articles/understanding-the-css-transforms-matrix/">Dev.Opera-CSS Transforms Matrix-英文</a></li>
<li><a href="http://www.zuixiami.com/translation/71">最虾米-CSS3 Transform Matrix-中文</a></li>
<li><a href="http://www.senocular.com/flash/tutorials/transformmatrix/">Flash 中的变换矩阵</a></li>
<li><a href="http://tympanus.net/codrops/css_reference/transform/">codrops-Transform</a></li>
<li><a href="http://tympanus.net/codrops/css_reference/matrix3d/">codrops-matrix3d</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-function">MDN-transform</a></li>
<li><a href="http://www.w3school.com.cn/cssref/pr_transform.asp">w3school-CSS3 transform 属性</a></li>
<li><a href="https://en.wikipedia.org/wiki/Matrix_%28mathematics%29">Matrix (mathematics) from Wikipedia</a></li>
<li><a href="http://www.useragentman.com/blog/2011/01/07/css3-matrix-transform-for-the-mathematically-challenged/">The CSS3 matrix() Transform for the Mathematically Challenged</a></li>
<li><a href="http://blog.csdn.net/linmiansheng/article/details/18801947">2D平面中关于矩阵（Matrix）跟图形变换的讲解 </a></li>
<li><a href="https://github.com/simaQ/cssfun/issues/2">CSS3之3d transform</a></li>
<li><a href="http://callmenick.com/post/css-transitions-transforms-animations-perspective">CSS Transitions, Transforms &amp; Animations – Perspective</a></li>
<li><a href="http://www.html-js.com/article/CSS-learning-CSS3-Transform">CSS3 Transform</a></li>
</ol>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript-Math对象</title>
    <url>/2015/12/23/javascript-Math%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h2 id="Math对象"><a href="#Math对象" class="headerlink" title="Math对象"></a>Math对象</h2><p>Math 对象用于执行数学任务，(复习一下)</p>
<ol>
<li>Math 对象并不像 Date 和 String 那样是对象的类，因此没有构造函数 Math()</li>
<li>如：Math.sin() 这样的函数只是函数</li>
<li>无需创建它，通过把 Math 作为对象使用就可以调用其所有属性和方法</li>
</ol>
<span id="more"></span>

<h2 id="Math对象的属性"><a href="#Math对象的属性" class="headerlink" title="Math对象的属性"></a>Math对象的属性</h2><img src="/2015/12/23/javascript-Math%E5%AF%B9%E8%B1%A1/math_pic_1.png" class="" title="Math对象的属性">

<h3 id="Math-E"><a href="#Math-E" class="headerlink" title="Math.E"></a>Math.E</h3><p>表示自然对数的底数（或称为基数），e，约等于 2.718</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.E); //2.718281828459045</span><br></pre></td></tr></table></figure>

<h3 id="Math-LN2"><a href="#Math-LN2" class="headerlink" title="Math.LN2"></a>Math.LN2</h3><p>2的自然对数, 约等于0.693</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.LN2); //0.6931471805599453</span><br></pre></td></tr></table></figure>

<h3 id="Math-LN10"><a href="#Math-LN10" class="headerlink" title="Math.LN10"></a>Math.LN10</h3><p>10的自然对数, 约等于 2.303</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.LN10); //2.302585092994046</span><br></pre></td></tr></table></figure>

<h3 id="Math-LOG2E"><a href="#Math-LOG2E" class="headerlink" title="Math.LOG2E"></a>Math.LOG2E</h3><p>以2为底E的对数, 约等于 1.443</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.LOG2E); //1.4426950408889634</span><br></pre></td></tr></table></figure>

<h3 id="Math-LOG10E"><a href="#Math-LOG10E" class="headerlink" title="Math.LOG10E"></a>Math.LOG10E</h3><p>以10为底E的对数, 约等于 0.434</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.LOG10E); //0.4342944819032518</span><br></pre></td></tr></table></figure>

<h3 id="Math-PI"><a href="#Math-PI" class="headerlink" title="Math.PI"></a>Math.PI</h3><p>圆周率，一个圆的周长和直径之比，约等于 3.14159.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.PI); //3.141592653589793</span><br></pre></td></tr></table></figure>

<h3 id="Math-SQRT1-2"><a href="#Math-SQRT1-2" class="headerlink" title="Math.SQRT1_2"></a>Math.SQRT1_2</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">console.log(Math.SQRT1_2); //0.7071067811865476</span><br></pre></td></tr></table></figure>

<h2 id="Math对象的方法"><a href="#Math对象的方法" class="headerlink" title="Math对象的方法"></a>Math对象的方法</h2><p><strong>note:三角函数（sin(), cos(), tan(),asin(), acos(), atan(), atan2()）是以弧度返回值的</strong></p>
<img src="/2015/12/23/javascript-Math%E5%AF%B9%E8%B1%A1/math_pic_2.png" class="" title="Math对象的方法">

<h3 id="数字取整"><a href="#数字取整" class="headerlink" title="数字取整"></a>数字取整</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. Math.floor(x) 函数返回小于或等于数 <span class="string">&quot;x&quot;</span> 的最大整数。</span><br><span class="line">Math.floor(23.15)              // 23</span><br><span class="line">Math.floor(23.95)              // 23</span><br><span class="line"></span><br><span class="line">2. Math.round(x) 返回四舍五入后的整数</span><br><span class="line">Math.round(23.15);             // 23</span><br><span class="line">Math.round(23.55);             // 24</span><br><span class="line"></span><br><span class="line">3. Math.ceil(x) 返回x向上取整后的值</span><br><span class="line">Math.ceil(23.15);             // 24</span><br><span class="line">Math.ceil(23.55);             // 24</span><br></pre></td></tr></table></figure>

<h3 id="常用三角函数"><a href="#常用三角函数" class="headerlink" title="常用三角函数"></a>常用三角函数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. Math.sin() 返回正弦值,x一个数值（以弧度为单位）</span><br><span class="line">Math.sin(Math.PI / 2)          // 1</span><br><span class="line">Math.sin(1);                   // 0.8414709848078965</span><br><span class="line"></span><br><span class="line">2. Math.cos() 函数返回一个数值的余弦值, x一个以弧度为单位的数值。</span><br><span class="line">Math.cos(0);                    // 1</span><br><span class="line">Math.cos(Math.PI);              // -1</span><br><span class="line">Math.cos(2 * Math.PI);          // 1</span><br><span class="line"></span><br><span class="line">3. Math.tan() 方法返回一个数值的正切值, x一个数值，表示一个角（单位：弧度）。</span><br><span class="line">Math.tan(30);                   // -6.405331196646276</span><br><span class="line"></span><br><span class="line">4. Math.asin() 方法返回一个数值的反正弦（单位为弧度）</span><br><span class="line">Math.asin(-2);              // NaN</span><br><span class="line"></span><br><span class="line">5. Math.acos() 返回一个数的反余弦值（单位为弧度）</span><br><span class="line">Math.acos(-1);              // 3.141592653589793</span><br><span class="line"></span><br><span class="line">6. Math.atan() 函数返回一个数值的反正切（以弧度为单位）</span><br><span class="line">Math.atan(0);               // 0</span><br></pre></td></tr></table></figure>

<h4 id="最大最小值，随机数"><a href="#最大最小值，随机数" class="headerlink" title="最大最小值，随机数"></a>最大最小值，随机数</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Math.max()函数返回 0 或 更多数的最大值</span><br><span class="line">Math.max(10,20,30);           // 30</span><br><span class="line">Math.max(30);                 // 30</span><br><span class="line">Math.max(-10,20);             // 20</span><br><span class="line"></span><br><span class="line">Math.min()返回0个到多个数值中最小值</span><br><span class="line">Math.min(10,20,30);           // 10</span><br><span class="line">Math.min(30);                 // 30</span><br><span class="line">Math.min(-10,20);             // -10</span><br><span class="line"></span><br><span class="line">Math.random()函数返回0到1的浮点值伪随机数(大于等于0，小于1)</span><br><span class="line"><span class="built_in">return</span> Math.random() * (max - min) + min;   //返回一个介于min和max之间的随机数</span><br></pre></td></tr></table></figure>

<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. Math.abs() 返回绝对值</span><br><span class="line">Math.abs(<span class="string">&#x27;-1&#x27;</span>);                 // 1</span><br><span class="line">Math.abs(null);                 // 0</span><br><span class="line">Math.abs(<span class="string">&quot;string&quot;</span>);             // NaN</span><br><span class="line">Math.abs();                     // NaN</span><br><span class="line"></span><br><span class="line">2. Math.sqrt(x) 返回x的平方根</span><br><span class="line">Math.sqrt(-1);                // NaN</span><br><span class="line">Math.sqrt(2);                 // 1.4142135623730951</span><br><span class="line">Math.sqrt(0);                 // 0</span><br><span class="line"></span><br><span class="line">3. Math.<span class="built_in">log</span>() 函数返回一个数的自然对数</span><br><span class="line">Math.<span class="built_in">log</span>(0);                // -Infinity</span><br><span class="line"></span><br><span class="line">4. Math.log2() 函数返回一个数字以 2 为底的对数</span><br><span class="line">Math.log2(0)                    // -Infinity</span><br><span class="line">Math.log2(-2)                   // NaN</span><br><span class="line">Math.log2(<span class="string">&quot;1024&quot;</span>)               // 10</span><br><span class="line">Math.log2(<span class="string">&quot;text&quot;</span>)               // NaN</span><br><span class="line"></span><br><span class="line">5. Math.pow(x,y) 返回x的y次幂</span><br><span class="line">Math.pow(7,2)                 // 49</span><br><span class="line"></span><br><span class="line">6. Math.exp() 函数返回 e 的指数。</span><br><span class="line">Math.exp(0);                // 1</span><br><span class="line"></span><br><span class="line">7. Math.cbrt() 函数返回任意数字的立方根.</span><br><span class="line">Math.cbrt(27)          // 3</span><br><span class="line"></span><br><span class="line">8. 忽略其他......</span><br></pre></td></tr></table></figure>

<h2 id="参考连接"><a href="#参考连接" class="headerlink" title="参考连接"></a>参考连接</h2><ol>
<li><a href="http://www.w3school.com.cn/jsref/jsref_obj_math.asp">w3school-JavaScript Math 对象</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math">MDN-Math对象</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>ngrok安装使用</title>
    <url>/2017/11/08/ngrok%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="ngrok安装使用"><a href="#ngrok安装使用" class="headerlink" title="ngrok安装使用"></a>ngrok安装使用</h2><h2 id="ngrok内网穿透"><a href="#ngrok内网穿透" class="headerlink" title="ngrok内网穿透"></a>ngrok内网穿透</h2><ol>
<li><p>注册账号，并且登陆</p>
</li>
<li><p>开通隧道，选择免费的<br> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202175011.png" alt="image"></p>
</li>
</ol>
<span id="more"></span>

<ol start="3">
<li><p>填写信息<br> <a href="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202175733.png">http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202175733.png</a></p>
</li>
<li><p>隧道管理 查看自己开通的隧道，可以修改并删除</p>
<p> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202180128.png" alt="image"></p>
</li>
<li><p>去首页下载适合自己系统的客户端，并且解压有以下文件,点击<code>.bat</code>文件启动</p>
<p> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202180623.png" alt="image"></p>
</li>
<li><p>在隧道管理页面里面复制 <code>隧道id</code> ,粘贴到启动到的客户端界面中，如下：</p>
<p> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202180939.png" alt="image"></p>
</li>
<li><p>回车如下，可以到信息</p>
<p> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202181217.png" alt="image"></p>
</li>
<li><p>访问外网地址，如下：</p>
<p> <img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180202181612.png" alt="image"></p>
</li>
<li><p>访问<code>http://127.0.0.1:4040</code>则可以看到请求记录</p>
</li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>开通隧道时选择的 域名类型 选择前置域名，访问时直接访问前置域名皆可以了</li>
</ul>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://www.ngrok.cc/">ngrok-中文官网</a></li>
<li><a href="https://ngrok.com/">ngrok-英文官网</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>ps的一些使用</title>
    <url>/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="photoshop脚本"><a href="#photoshop脚本" class="headerlink" title="photoshop脚本"></a>photoshop脚本</h2><p>PhotoShop脚本是指图像处理软件PhotoShop所支持的批处理程序，其英文为Photoshop Scripting。</p>
<p>它分别支持脚本编程语言有：</p>
<ol>
<li>Mac平台上的Apple Script脚本</li>
<li>Windows平台上的Visual Basic Script脚本</li>
<li>跨平台的JavaScript脚本</li>
</ol>
<p><strong>注：此处未说明使用的是ps cs6版本</strong>，</p>
<span id="more"></span>

<h3 id="参考图片"><a href="#参考图片" class="headerlink" title="参考图片"></a>参考图片</h3><img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/reference.png" class="" title="参考图片">

<h3 id="自己写一个脚本"><a href="#自己写一个脚本" class="headerlink" title="自己写一个脚本"></a>自己写一个脚本</h3><p>新建一个helle.js文件，写入如下代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var username = <span class="string">&quot;小明&quot;</span>;</span><br><span class="line">alert(<span class="string">&quot;hello world&quot;</span>+username);</span><br></pre></td></tr></table></figure>

<p>再紧接着, 文件 -&gt; 脚本 -&gt; 浏览 ，选择hello.js脚本，之后会出现提示内容</p>
<p>知道ps有这么一回事，有兴趣可以网上找找学习一下</p>
<h2 id="批量降低图片质量"><a href="#批量降低图片质量" class="headerlink" title="批量降低图片质量"></a>批量降低图片质量</h2><p>说到底就是压缩一下图片，网上工具一大批，这里用ps的脚本来做:</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/picture_1.png" class="" title="图像处理器">

<ol>
<li>菜单栏：”文件” -&gt; “脚本” -&gt; “图像处理器”,结果如上图：</li>
<li>选择要处理的图像文件夹①</li>
<li>选择要位置存储处理图像②</li>
<li>文件类型，如存储为JPEG,并且选择品质(0~12)③</li>
<li>点击<strong>运行</strong>④，处理结果对比图如下：</li>
</ol>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/result_1.png" class="" title="结果数据对比">

<h2 id="图片批量导入到图层"><a href="#图片批量导入到图层" class="headerlink" title="图片批量导入到图层"></a>图片批量导入到图层</h2><img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/load_layer.png" class="" title="载入图层">

<ol>
<li>菜单栏：”文件” -&gt; “脚本” -&gt; “将文件载入堆栈”,结果如上图：</li>
<li>下拉选择 <strong>文件夹</strong> ①</li>
<li><strong>浏览</strong> 选取批量图片的文件夹②,选取成功后④</li>
<li>点击 <strong>确定</strong> ③, 生成结果如下：</li>
</ol>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/load_layer_results.png" class="" title="生成结果界面">

<h2 id="批量图层导出到图片"><a href="#批量图层导出到图片" class="headerlink" title="批量图层导出到图片"></a>批量图层导出到图片</h2><img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/dis_ui_1.png" class="" title="批量图层导入到图片">

<ol>
<li>菜单栏：”文件” -&gt; “脚本” -&gt; “图层导出到文件”,结果如上图：</li>
<li>选择导出位①</li>
<li>每个要导出图层的前缀②</li>
<li>选择可见图层③</li>
<li>选择导出的文件类型④，如此出的jpeg</li>
<li>文件的选项，此处可设置图片质量(0~12)⑤</li>
<li>点击 <strong>运行</strong> ⑥,生成结果如下：</li>
</ol>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/result_jpeg.png" class="" title="图片结果">

<h2 id="自动生成图标"><a href="#自动生成图标" class="headerlink" title="自动生成图标"></a>自动生成图标</h2><p>此处使用的是photoshop cc 2015,切icon图标的psd文件。</p>
<p>1、菜单栏：”编辑” -&gt; “首选项” -&gt; “常规” -&gt; “增效工具”,勾选 <strong>生成器</strong>,点击 <strong>确定</strong>,如下图：</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/options.png" class="" title="首选项">

<p>2、菜单栏：”文件” -&gt; “生成” -&gt; “图像资源”,勾选中,如下图：</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/option_2.png" class="" title="勾选图像资源">

<p>3、修改icon图层名称,如下图：</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/option_3.png" class="" title="图层名称">

<p>4、图层命名参数说明</p>
<table>
<thead>
<tr>
<th align="center">格式</th>
<th align="center">图层名</th>
<th align="center">输出图片</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PNG</td>
<td align="center">book.png</td>
<td align="center">含alpha通道png-24(就是透明的png)</td>
</tr>
<tr>
<td align="center">PNG</td>
<td align="center">book.png8</td>
<td align="center">png-8</td>
</tr>
<tr>
<td align="center">PNG</td>
<td align="center">book.png24</td>
<td align="center">png-24(不透明的png)</td>
</tr>
<tr>
<td align="center">JPEG</td>
<td align="center">book.jpg</td>
<td align="center">质量?%,经测试非80%,但已优化</td>
</tr>
<tr>
<td align="center">JPEG</td>
<td align="center">book.jpg8</td>
<td align="center">质量80%</td>
</tr>
<tr>
<td align="center">JPEG</td>
<td align="center">book.jpg80</td>
<td align="center">质量80%</td>
</tr>
<tr>
<td align="center">JPEG</td>
<td align="center">book.jpg10</td>
<td align="center">质量100%</td>
</tr>
<tr>
<td align="center">JPEG</td>
<td align="center">book.jpg100%</td>
<td align="center">质量100%</td>
</tr>
</tbody></table>
<p>5、输出Retina @2x 图片,尺寸是原来的两倍，或三倍,如下图：</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/option_4.png" class="" title="@2x图">

<p>6、可以设置的输出格式目前有jpg,png,gif,svg</p>
<p>7、 设置可以输出webp图片格式,新建文件generator.json,内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;generator-assets&quot;</span>:  &#123;</span><br><span class="line">    <span class="string">&quot;webp-enabled&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Windows上：按Win+R -&gt; 输入 %USERPROFILE% -&gt; 拷贝generator.json到此目录 -&gt; 结果资源文件下出现errors.txt -&gt; Windows 不支持</p>
<p>Mac上：未测，据说支持</p>
<p>8、ps的webp插件，下载地址：<a href="http://www.fnordware.com/downloads/WebP_v0.5b5_win.zip">Win</a> 和 <a href="http://www.fnordware.com/downloads/WebP_v0.5b5_mac.zip">MAC</a></p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/webp.png" class="" title="webp插件拷贝路径">

<p>安装后, 文件-&gt;另存为-&gt;选择webp格式</p>
<h2 id="批量修改图片大小"><a href="#批量修改图片大小" class="headerlink" title="批量修改图片大小"></a>批量修改图片大小</h2><p>ps动作还是那么的好,<strong>此处使用的是ps cc 2015</strong></p>
<p>1、ps打开要修改的图片<br>2、菜单栏：”窗口” -&gt; 勾选 <strong>动作</strong> 如下图：</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_1.png" class="" title="勾选动作">

<p>3、新建动作后，可设置功能健，名称，之后点击 <strong>记录</strong></p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_2.png" class="" title="新建动作">

<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_3.png" class="" title="设置动作">

<p>4、动作记录开始了，现在开始设置图片大小，设置完成 <strong>确定</strong> 闭并 <strong>保存</strong> 到指定文件夹，最后 <strong>关闭</strong> 修改的图片的选项卡</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_5.png" class="" title="设置图片">

<p>5、此时点击 <strong>停止</strong>,如下图，之后这个动作就完成了</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_5.png" class="" title="停止">

<p>6、现在开始批量设置,菜单栏：”文件” -&gt; “自动” -&gt; “批处理” 如下图,设置必要的参数，点击 <strong>确定</strong> 完成。</p>
<img src="/2015/12/11/ps%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8/action_6.png" class="" title="批处理">

<p>7、根据你的文件夹设置，所有图片大小都修改为你设置的大小了，到此就完了。</p>
<h2 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h2><p>此处使用的是 <strong>ps cc 2015</strong></p>
<p>在图层上右键单击，有一个 <strong>导出为</strong>，<strong>有一个快速到处为xxx</strong>,看看有什么用</p>
<h2 id="ps插件-扩展推荐"><a href="#ps插件-扩展推荐" class="headerlink" title="ps插件 扩展推荐"></a>ps插件 扩展推荐</h2><ol>
<li><a href="https://github.com/Linrstudio/PhotoshopCopyCSS">PhotoshopCopyCSS-复制css插件</a></li>
<li><a href="http://pan.baidu.com/s/1jGkvENs">Corner Editor-修改路径圆角插件</a></li>
<li><a href="http://www.cutterman.cn/v2/cutterman">CUTTERMAN-切图工具</a></li>
<li><a href="http://css3ps.com/">css3ps-生成图层样式</a></li>
<li><a href="http://guideguide.me/">GuideGuide-参考线插件</a></li>
</ol>
]]></content>
      <categories>
        <category>PS</category>
      </categories>
      <tags>
        <tag>PS</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks</title>
    <url>/2019/05/19/react-hooks/</url>
    <content><![CDATA[<h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><p><code>Hook</code> 是 <code>React 16.8</code> 的新增特性。它可以让你在不编写 <code>class</code> 的情况下使用 <code>state</code> 以及其他的 <code>React</code> 特性。</p>
<ol>
<li>只在最顶层使用 <code>Hook</code></li>
<li>只在 <code>React</code> 函数中调用 <code>Hook</code></li>
</ol>
<span id="more"></span>
<h4 id="基础-Hook"><a href="#基础-Hook" class="headerlink" title="基础 Hook"></a>基础 Hook</h4><ol>
<li><code>useState</code></li>
<li><code>useEffect</code></li>
<li><code>useContext</code></li>
</ol>
<h4 id="额外的-Hook"><a href="#额外的-Hook" class="headerlink" title="额外的 Hook"></a>额外的 Hook</h4><ol>
<li><code>useReducer</code></li>
<li><code>useCallback</code></li>
<li><code>useMemo</code></li>
<li><code>useRef</code></li>
<li><code>useImperativeHandle</code></li>
<li><code>useLayoutEffect</code></li>
<li><code>useDebugValue</code></li>
</ol>
<p><strong>注意</strong></p>
<p><code>React 16.8.0</code> 是第一个支持 <code>Hook</code> 的版本。升级时，请注意更新所有的 <code>package</code>，包括 <code>React DOM</code> <code>React Native</code> 从 <code>0.59</code> 版本开始支持 <code>Hook</code>。</p>
<h2 id="ESLint-插件"><a href="#ESLint-插件" class="headerlink" title="ESLint 插件"></a>ESLint 插件</h2><p>一个名为 <code>eslint-plugin-react-hooks</code> 的 <code>ESLint</code> 插件来强制执行这两条规则。如果你想尝试一下，可以将此插件添加到你的项目中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install eslint-plugin-react-hooks --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// 你的 ESLint 配置</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    // ...</span><br><span class="line">    <span class="string">&quot;react-hooks&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    // ...</span><br><span class="line">    <span class="string">&quot;react-hooks/rules-of-hooks&quot;</span>: <span class="string">&quot;error&quot;</span>, // 检查 Hook 的规则</span><br><span class="line">    <span class="string">&quot;react-hooks/exhaustive-deps&quot;</span>: <span class="string">&quot;warn&quot;</span> // 检查 effect 的依赖</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后续版本默认添加此插件到 <code>Create React App</code> 及其他类似的工具包中。</p>
<h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a><code>useState</code></h2><p><code>useState</code> 是最基本的 <code>API</code>，它传入一个初始值，每次函数执行都能拿到新值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PageCount</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.PageMain&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count - 1)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageCount</span>;</span><br></pre></td></tr></table></figure>

<h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a><code>useReducer</code></h2><p><code>useReducer</code> 和 <code>useState</code> 几乎是一样的，需要外置外置 <code>reducer</code> (全局)，通过这种方式可以对多个状态同时进行控制。仔细端详起来，其实跟 <code>redux</code> 中的数据流的概念非常接近。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">	<span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;up&#x27;</span>:</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;down&#x27;</span>:</span><br><span class="line">			<span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">		<span class="attr">default</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PageCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;)</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.PageMain&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;up&#x27; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;state.count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;down&#x27; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageCount</span>;</span><br></pre></td></tr></table></figure>

<h2 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a><code>useEffect</code></h2><p>在 <code>React hook</code> 中，<code>useEffect</code> 用来取代 <code>componentDidMount</code> 和 <code>componentDidUpdate</code>。主要作用是当页面渲染后，进行一些副作用操作（比如访问 <code>DOM</code>，请求数据）。</p>
<p>数据获取，设置订阅或者手动直接更改 <code>React</code> 组件中的 <code>DOM</code> 都属于副作用。有的人习惯成这种行为为 <code>effect</code></p>
<p><code>Effect Hook</code> 可以让你能够在 <code>Function</code> 组件中执行副作用</p>
<p><code>React</code> 组件中有两种常见的副作用：</p>
<ol>
<li>需要清理的副作用</li>
<li>不需要清理的副作用。</li>
</ol>
<p>如果在重新渲染之间没有更新某些值，则可以告诉 <code>React</code> 跳过 <code>effect</code> ，为了实现这种方式，需要将数组作为可选的第二个参数传递给 <code>useEffect</code></p>
<p>从 <code>effect</code> 中返回一个 <code>function</code> ,这是 <code>effect</code> 可选的清理机制。每个 <code>effect</code> 都可以返回一个在它之后清理的 <code>function</code></p>
<ul>
<li><code>useEffect</code>最后，不加<code>[]</code>就表示每一次渲染都执行</li>
<li><code>useEffect</code>最后，加了<code>[]</code>就表示只第一次执行</li>
<li><code>useEffect</code>最后，加<code>[]</code>，并且<code>[]</code>里面加的字段就表示，这个字段更改了，我这个<code>effect</code>才执行</li>
<li><code>useEffect</code>不能被判断包裹</li>
<li><code>useEffect</code>不能被打断</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PageCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// =&gt; componentDidMount/componentDidUpdate</span></span><br><span class="line">	<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="comment">// update</span></span><br><span class="line">		<span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</span><br><span class="line">		<span class="comment">// =&gt; componentWillUnMount</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">cleanup</span>(<span class="params"></span>) &#123;</span><br><span class="line">			<span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;app&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, [count]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.PageMain&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;	Click me <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PageCount</span>;</span><br></pre></td></tr></table></figure>

<h3 id="React-何时清除-effect？"><a href="#React-何时清除-effect？" class="headerlink" title="React 何时清除 effect？"></a><code>React</code> 何时清除 <code>effect？</code></h3><p><code>React</code> 会在组件卸载的时候执行清除操作。正如之前学到的，<code>effect</code> 在每次渲染的时候都会执行。这就是为什么 <code>React</code> 会在执行当前 <code>effect</code> 之前对上一个 <code>effect</code> 进行清除。</p>
<p>这将助于避免 <code>bug</code>以及如何在遇到性能问题时跳过此行为。</p>
<h2 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a><code>useMemo</code></h2><p><code>useMemo</code>缓存计算数据的值</p>
<p><code>useMemo</code> 主要用于渲染过程优化，两个参数依次是计算函数（通常是组件函数）和依赖状态列表，当依赖的状态发生改变时，才会触发计算函数的执行。如果没有指定依赖，则每一次渲染过程都会执行该计算函数。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./index.module.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">WithMemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">const</span> [val, setValue] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="keyword">const</span> expensive = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count * <span class="number">100</span>; i++) &#123;</span><br><span class="line">			sum += i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sum;</span><br><span class="line">	&#125;, [count]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.PageMain&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;count&#125;-&#123;expensive&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;val&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;click me +1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;val&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setValue(event.target.value)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a><code>useContext</code></h2><p><code>useContext</code>与<code>useReducer</code>的使用</p>
<p>调用<code>useContext</code>，传入从<code>React.createContext</code>获取的上下文对象。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; createContext, useContext, useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//默认状态</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">	<span class="attr">value</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reducer</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">	<span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;ADD_NUM&#x27;</span>:</span><br><span class="line">			<span class="keyword">return</span> &#123; ...state, <span class="attr">value</span>: state.<span class="property">value</span> + <span class="number">1</span> &#125;;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;REDUCE_NUM&#x27;</span>:</span><br><span class="line">			<span class="keyword">return</span> &#123; ...state, <span class="attr">value</span>: state.<span class="property">value</span> - <span class="number">1</span> &#125;;</span><br><span class="line">		<span class="attr">default</span>:</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//存储</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StoreContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件一</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ChildFirst</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title function_">useContext</span>(<span class="title class_">StoreContext</span>)</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">				AppContext.dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">					type: &quot;ADD_NUM&quot;,</span></span><br><span class="line"><span class="language-xml">					payload: &#123;&#125;</span></span><br><span class="line"><span class="language-xml">				&#125;)</span></span><br><span class="line"><span class="language-xml">			&#125;&#125;&gt;增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">				AppContext.dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">					type: &quot;REDUCE_NUM&quot;,</span></span><br><span class="line"><span class="language-xml">					payload: &#123;&#125;</span></span><br><span class="line"><span class="language-xml">				&#125;)</span></span><br><span class="line"><span class="language-xml">			&#125;&#125;&gt;递减<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件二</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ChildSecond</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title function_">useContext</span>(<span class="title class_">StoreContext</span>)</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			&#123;AppContext.state.value + &#x27;s&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//其他页面只需要引入根组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, defaultState)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">StoreContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">state</span>, <span class="attr">dispatch:</span> <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">ChildFirst</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">ChildSecond</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">StoreContext.Provider</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a><code>useRef</code></h2><p>在函数式组件里没有了 <code>this</code> 来存放一些实例的变量，所以 <code>React</code> 建议使用 <code>useRef</code> 来存放一些会发生变化的值，<code>useRef</code> 并不再单单是为了 <code>DOM</code> 的 <code>ref</code> 准备的，同时也会用来存放组件实例的属性。</p>
<p><code>useRef</code> 主要有两个使用场景：</p>
<ol>
<li>获取子组件或者 <code>DOM</code> 节点的句柄</li>
<li>渲染周期之间的共享数据的存储</li>
</ol>
<h4 id="createRef与useRef"><a href="#createRef与useRef" class="headerlink" title="createRef与useRef"></a><code>createRef</code>与<code>useRef</code></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, createRef, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [renderIndex, setRenderIndex] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">const</span> fromUseRef = <span class="title function_">useRef</span>();</span><br><span class="line">	<span class="keyword">const</span> fromCreateRef = <span class="title function_">createRef</span>();</span><br><span class="line">	<span class="keyword">if</span> (!fromUseRef.<span class="property">current</span>) &#123;</span><br><span class="line">		fromUseRef.<span class="property">current</span> = renderIndex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!fromCreateRef.<span class="property">current</span>) &#123;</span><br><span class="line">		fromCreateRef.<span class="property">current</span> = renderIndex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>当前渲染index : &#123;renderIndex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>fromUseRef : &#123;fromUseRef.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>fromCreateRef &#123;fromCreateRef.current&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">				setRenderIndex(prev =&gt; prev + 1);</span></span><br><span class="line"><span class="language-xml">			&#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">				点击</span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useRef经典例子"><a href="#useRef经典例子" class="headerlink" title="useRef经典例子"></a><code>useRef</code>经典例子</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">const</span> lastCount = <span class="title function_">useRef</span>(count)</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">&quot;你点击了&quot;</span> + count + <span class="string">&quot;次&quot;</span>);</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">&quot;你点击了&quot;</span> + lastCount.<span class="property">current</span> + <span class="string">&quot;次&quot;</span>);</span><br><span class="line">		&#125;, <span class="number">1000</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		lastCount.<span class="property">current</span> = count;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了 : &#123;count&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(count + 1) &#125;&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; handleClick() &#125;&#125;&gt;显示提示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>useRef</code> 每次都会返回同一个引用, 所以在 <code>useEffect</code> 中修改的时候 ,在 <code>alert</code> 中也会同时被修改. 这样子, 点击的时候就可以弹出实时的 <code>count</code> 了.</p>
<h4 id="useRef获取上一次的值"><a href="#useRef获取上一次的值" class="headerlink" title="useRef获取上一次的值"></a><code>useRef</code>获取上一次的值</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">const</span> prevtCount = <span class="title function_">useRef</span>()</span><br><span class="line"></span><br><span class="line">	<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		prevtCount.<span class="property">current</span> = count;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>prevtCount : &#123;prevtCount.current&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了 : &#123;count&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(count + 1) &#125;&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="将获取上一次的值封装成自定义钩子"><a href="#将获取上一次的值封装成自定义钩子" class="headerlink" title="将获取上一次的值封装成自定义钩子"></a>将获取上一次的值封装成自定义钩子</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取以前的状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">usePrevious</span>(<span class="params">state</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> ref = <span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">	<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		ref.<span class="property">current</span> = state;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> ref.<span class="property">current</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//其他页面只需要引入功能根组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">const</span> prevtCount = <span class="title function_">usePrevious</span>(count)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>prevtCount : &#123;prevtCount&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>你点击了 : &#123;count&#125;次<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(count + 1) &#125;&#125;&gt;点击加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(count - 1) &#125;&#125;&gt;点击减<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a><code>useCallback</code></h2><p><code>useCallback</code>缓存函数的引用</p>
<p>使用<code>useCallback</code>去缓存我们的 <code>handleClick</code></p>
<p><code>setCount</code>方法支持接收一个函数，通过这个函数可以获取最新的<code>state</code>值</p>
<p><code>useCallback</code>是基于<code>useMemo</code>的封装。只有当依赖数组产生变化时，<code>useCallback</code>才会返回一个新的函数，否则始终返回第一次的传入<code>callback</code>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//子组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; onClick &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//其他页面只需要引入功能根组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在setCount 这样操作的时候，不用闭包中的变量，而是使用函数，获取最新的值。</span></span><br><span class="line">	<span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">	&#125;, [])</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">Child</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">``</span></span><br><span class="line"></span><br><span class="line"><span class="string">`useCallback`</span> 的真正目的还是在于缓存了每次渲染时 <span class="string">`inline callback`</span> 的实例，这样方便配合上子组件的 <span class="string">`shouldComponentUpdate`</span> 或者 <span class="string">`React.memo`</span> 起到减少不必要的渲染的作用。</span><br><span class="line"></span><br><span class="line">需要不断提醒自己注意的是，在大部分 <span class="string">`callback`</span> 都会是 <span class="string">`inline callback`</span> 的未来，<span class="string">`React.memo`</span>和 <span class="string">`React.useCallback`</span> 一定记得需要配对使用，缺了一个都可能导致性能不升反“降”，毕竟无意义的浅比较也是要消耗那么一点点点的性能。</span><br><span class="line"></span><br><span class="line">只有对于大计算量的函数来说，利用<span class="string">`useCallback`</span>才能起到良好的优化效果</span><br><span class="line"></span><br><span class="line">## <span class="string">`useLayoutEffect`</span></span><br><span class="line"></span><br><span class="line">其函数签名与 <span class="string">`useEffect`</span> 相同，但它会在所有的 <span class="string">`DOM`</span> 变更之后同步调用 <span class="string">`effect`</span>。可以使用它来读取 <span class="string">`DOM`</span> 布局并同步触发重渲染。</span><br><span class="line"></span><br><span class="line">在浏览器执行绘制之前，<span class="string">`useLayoutEffect`</span> 内部的更新计划将被同步刷新。</span><br><span class="line"></span><br><span class="line">### 提示</span><br><span class="line"></span><br><span class="line">* <span class="string">`useLayoutEffect`</span> 与 <span class="string">`componentDidMount、componentDidUpdate`</span> 的调用阶段是一样的。但是，我们推荐你一开始先用 <span class="string">`useEffect`</span>，只有当它出问题的时候再尝试使用 <span class="string">`useLayoutEffect`</span></span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`javascript</span></span><br><span class="line"><span class="string">//当你每次点击 div， count 会更新为 0， 之后 useEffect 内又把 count 改为一串随机数。</span></span><br><span class="line"><span class="string">//所以页面会先渲染成0，然后再渲染成随机数，由于更新很快，所以出现了闪烁</span></span><br><span class="line"><span class="string">function RootCompent() &#123;</span></span><br><span class="line"><span class="string">	const [count, setCount] = useState(0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="string">		if (count === 0) &#123;</span></span><br><span class="line"><span class="string">			const randomNum = 10 + Math.random() * 200</span></span><br><span class="line"><span class="string">			setCount(10 + Math.random() * 200);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;, [count]);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	return (</span></span><br><span class="line"><span class="string">		&lt;div&gt;</span></span><br><span class="line"><span class="string">			&lt;p&gt;&#123;count&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">			&lt;div onClick=&#123;() =&gt; setCount(0)&#125;&gt;点击&lt;/div&gt;</span></span><br><span class="line"><span class="string">		&lt;/div&gt;</span></span><br><span class="line"><span class="string">	);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用useLayoutEffect之后</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (count === <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">const</span> randomNum = <span class="number">10</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">200</span></span><br><span class="line">			<span class="title function_">setCount</span>(<span class="number">10</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">200</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, [count]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(0)&#125;&gt;点击<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a><code>useDebugValue</code></h2><p><code>useDebugValue</code> 可用于在 <code>React</code> 开发者工具中显示自定义 <code>hook</code> 的标签。</p>
<h3 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h3><p>不推荐你向每个自定义 <code>Hook</code> 添加 <code>debug</code> 值。当它作为共享库的一部分时才最有价值。</p>
<p><code>useDebugValue</code>接受一个格式化函数作为可选的第二个参数。该函数只有在 <code>Hook</code> 被检查时才会被调用。它接受 <code>debug</code> 值作为参数，并且会返回一个格式化的显示值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">useDebugValue</span>(date, <span class="function"><span class="params">date</span> =&gt;</span> date.<span class="title function_">toDateString</span>());</span><br></pre></td></tr></table></figure>

<h2 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a><code>useImperativeHandle</code></h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">useImperativeHandle</span>(ref, createHandle, [deps])</span><br></pre></td></tr></table></figure>

<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时自定义暴露给父组件的实例值。在大多数情况下，应当避免使用 <code>ref</code> 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> kun = <span class="title function_">useRef</span>()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> introduce = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;i can sing, jump, rap, play basketball&#x27;</span>)</span><br><span class="line">	&#125;, [])</span><br><span class="line"></span><br><span class="line">	<span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">		<span class="attr">introduce</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">introduce</span>()</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;kun&#125;</span>&gt;</span> &#123;props.count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FChild</span> = <span class="title function_">forwardRef</span>(<span class="title class_">Child</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">const</span> fcRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> onClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">setCount</span>(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>)</span><br><span class="line">		fcRef.<span class="property">current</span>.<span class="title function_">introduce</span>()</span><br><span class="line">	&#125;, [])</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			点击次数: &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">FChild</span> <span class="attr">ref</span>=<span class="string">&#123;fcRef&#125;</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">FChild</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义钩子"><a href="#自定义钩子" class="headerlink" title="自定义钩子"></a>自定义钩子</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 编写我们自己的hook，名字以use开头</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useCounter</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">	<span class="comment">// 接受初始化的值生成state</span></span><br><span class="line">	<span class="keyword">const</span> [count, changeCount] = <span class="title function_">useState</span>(initialValue);</span><br><span class="line">	<span class="comment">// 声明减少的方法</span></span><br><span class="line">	<span class="keyword">const</span> <span class="title function_">decrease</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">		<span class="title function_">changeCount</span>(count - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 声明增加的方法</span></span><br><span class="line">	<span class="keyword">const</span> <span class="title function_">increase</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">		<span class="title function_">changeCount</span>(count + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 声明重置计数器方法</span></span><br><span class="line">	<span class="keyword">const</span> <span class="title function_">resetCounter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">		<span class="title function_">changeCount</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 将count数字与方法返回回去</span></span><br><span class="line">	<span class="keyword">return</span> [count, &#123; decrease, increase, resetCounter &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">RootCompent</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// 在函数组件中使用我们自己编写的hook生成一个计数器，并拿到所有操作方法的对象</span></span><br><span class="line">	<span class="keyword">const</span> [count, controlCount] = <span class="title function_">useCounter</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			当前数量：&#123;count&#125;</span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;controlCount.decrease&#125;</span>&gt;</span>减少<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;controlCount.increase&#125;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;controlCount.resetCounter&#125;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://juejin.im/post/5de11deb5188256eaa0ebd5e">React-Hooks</a></li>
<li><a href="https://zh-hans.reactjs.org/docs/hooks-intro.html">官方文档</a></li>
<li><a href="https://www.sitixi.com/useHooks%20%E7%AC%AC%E4%B8%80%E6%9C%9F/">聊聊 useCallback</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>turborepo</title>
    <url>/2022/12/08/turborepo/</url>
    <content><![CDATA[<h2 id="Turborepo-高性能构建系统"><a href="#Turborepo-高性能构建系统" class="headerlink" title="Turborepo 高性能构建系统"></a>Turborepo 高性能构建系统</h2><p><code>Turborepo</code> 是一个用于 <code>JavaScript</code> 和 <code>TypeScript monorepos</code> 的高性能构建系统。<code>Turborepo</code> 重新设计了 <code>Facebook</code> 和谷歌使用的构建系统技术，以消除维护负担和开销。</p>
<span id="more"></span>

<p><strong>特性：</strong></p>
<ul>
<li>增量构建: 构建一次已经足够痛苦了，<code>Turborepo</code>会记住您构建的内容，并跳过已经计算过的内容。</li>
<li>内容<code>hash</code>：<code>Turborepo</code>查看您的文件内容，而不是时间戳来找出需要构建的内容。</li>
<li>远程缓存：与您的团队和<code>CI/CD</code>共享远程构建缓存以获得更快的构建。</li>
<li>并行执行：在不浪费空闲<code>cpu</code>的情况下，以最大的并行度使用每个核执行构建。</li>
<li>零运行时开销：<code>Turborepo</code>不会干扰您的运行时代码或触及您的源代码映射。</li>
<li>删减子集：通过生成一个只需要构建特定目标的 <code>monorepo</code> 的子集来加快 <code>PaaS</code> 的部署速度</li>
<li>任务管道：定义任务之间的关系，然后让<code>Turborepo</code>优化要构建的内容和时间。</li>
<li>基于约定的配置：通过约定来降低配置的复杂度，只需要几行简单的 <code>JSON</code> 就能完成配置</li>
<li>浏览器中的配置文件：生成构建配置文件并在 <code>Chrome</code> 或 <code>Edge</code> 中导入，以了解哪些任务花费的时间最长</li>
</ul>
<h2 id="缓存任务"><a href="#缓存任务" class="headerlink" title="缓存任务"></a>缓存任务</h2><p>每个<code>JavaScript</code>或<code>TypeScript</code>代码库都需要运行<code>package.json</code>脚本，如<code>build</code>, <code>test</code>和<code>lint</code>。在<code>Turborepo</code>中，我们称之为任务。</p>
<p><code>Turborepo</code>可以缓存任务的结果和日志-对于慢速任务可以极大地加速。</p>
<h3 id="丢失缓存"><a href="#丢失缓存" class="headerlink" title="丢失缓存"></a>丢失缓存</h3><p>假设你在<code>Turborepo</code>中使用<code>turbo run build</code>运行一个构建任务:</p>
<p><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/202212091726.png" alt="image"></p>
<ol>
<li><code>Turborepo</code>将计算任务的输入(默认是工作区文件夹中的所有非<code>git</code>忽略文件)并将它们转换为哈希值(例如<code>78awdk123</code>)。</li>
<li>检查本地文件系统缓存中以散列命名的文件夹(例如<code>../node_modules/.cache/turbo/78awdk123</code>)。</li>
<li>如果<code>Turborepo</code>没有为计算的散列找到任何匹配的工件，那么<code>Turborepo</code>将执行该任务。</li>
<li>任务结束后，<code>Turborepo</code>将所有输出(包括文件和日志)保存到哈希下的缓存中。</li>
</ol>
<h3 id="命中缓存"><a href="#命中缓存" class="headerlink" title="命中缓存"></a>命中缓存</h3><p>假设你在不改变任何输入的情况下再次运行任务:</p>
<ol>
<li>散列将是相同的，因为输入没有改变(例如<code>78awdk123</code>)</li>
<li><code>Turborepo</code>将在其缓存中找到带有计算散列的文件夹(例如:<code>/node_modules/.cache/turbo/78awdk123</code>)</li>
<li><code>Turborepo</code>不运行任务，而是重播输出——将保存的日志打印到标准输出，并将保存的输出文件恢复到文件系统中各自的位置。</li>
</ol>
<p>从缓存中恢复文件和日志几乎是瞬间发生的。这可以将构建时间从几分钟或几小时缩短到几秒或几毫秒。尽管具体的结果会根据代码库依赖关系图的形状和粒度而有所不同，但大多数团队发现，使用<code>Turborepo</code>的缓存，他们可以将每月的总体构建时间缩短约<code>40-85%</code>。</p>
<h3 id="配置缓存输出"><a href="#配置缓存输出" class="headerlink" title="配置缓存输出"></a>配置缓存输出</h3><p>使用管道，您可以在<code>Turborepo</code>中配置缓存约定。</p>
<p>要覆盖默认的缓存输出行为，将一个<code>glob</code>数组传递给管道。输出数组。任何满足任务<code>glob</code>模式的文件都将被视为工件。</p>
<p>如果你的任务不产生任何文件(例如使用<code>jest</code>进行单元测试)，将输出设置为空数组(即<code>[]</code>)，<code>Turborepo</code>将为你缓存日志。</p>
<p>当您运行<code>turbo</code>运行构建测试时，<code>Turborepo</code>将执行您的构建和测试脚本，并将其输出缓存到<code>./node_modules/.cache/turbo</code>中。</p>
<h3 id="配置缓存输入"><a href="#配置缓存输入" class="headerlink" title="配置缓存输入"></a>配置缓存输入</h3><p>当工作空间中的任何文件发生更改时，就认为该工作空间已经更新。但是，对于某些任务，我们只希望在相关文件发生更改时重新运行该任务。指定输入可以让我们定义哪些文件与特定任务相关。例如，下面的测试配置声明，测试任务只需要<br>在<code>src/</code>和<code>test/</code>子目录中的<code>.tsx</code>或<code>.ts</code>文件自上次执行以来发生更改时才需要执行。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ... omitted for brevity</span></span><br><span class="line"> </span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A workspace&#x27;s `test` task depends on that workspace&#x27;s</span></span><br><span class="line">      <span class="comment">// own `build` task being completed first.</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// A workspace&#x27;s `test` task should only be rerun when</span></span><br><span class="line">      <span class="comment">// either a `.tsx` or `.ts` file has changed.</span></span><br><span class="line">      <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test/**/*.ts&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="关闭高速缓存"><a href="#关闭高速缓存" class="headerlink" title="关闭高速缓存"></a>关闭高速缓存</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">turbo run dev --parallel --no-cache</span><br><span class="line"><span class="comment"># 注意`--no-cache`禁用缓存写，但不禁用缓存读。如果你想禁用缓存读取，使用`--force`标志。</span></span><br><span class="line"><span class="comment"># 在所有工作区中并行运行“dev”npm脚本</span></span><br><span class="line"><span class="comment"># 但不缓存输出</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;cache&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="基于文件更改缓存"><a href="#基于文件更改缓存" class="headerlink" title="基于文件更改缓存"></a>基于文件更改缓存</h3><p>对于某些任务，如果不相关的文件发生更改，您可能不希望缓存丢失。例如，更新<code>README.md</code>可能不需要为测试任务触发缓存缺失。您可以使用输入来限制<code>turbo</code>为特定任务考虑的文件集。</p>
<p>在这种情况下，只考虑与确定测试任务上的缓存命中相关的<code>.ts</code>和<code>.tsx</code>文件:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ...other tasks</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// leave empty to only cache logs</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test/**/*.ts&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="基于环境变量修改缓存"><a href="#基于环境变量修改缓存" class="headerlink" title="基于环境变量修改缓存"></a>基于环境变量修改缓存</h3><p>你可以根据环境变量的值来控制<code>turbo</code>的缓存行为:</p>
<p>在管道定义中的<code>env</code>键中包含环境变量将影响每个任务或每个工作空间任务的缓存指纹。</p>
<p>任何在其名称中包含<code>THASH</code>的环境变量的值都会影响所有任务的缓存指纹。</p>
<h3 id="强制覆盖缓存"><a href="#强制覆盖缓存" class="headerlink" title="强制覆盖缓存"></a>强制覆盖缓存</h3><p>相反，如果你想禁止读取缓存并强制<code>turbo</code>重新执行之前缓存的任务，添加<code>--force</code>标志:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Run `build` npm script in all workspaces,</span></span><br><span class="line"><span class="comment"># ignoring cache hits.</span></span><br><span class="line">turbo run build --force</span><br></pre></td></tr></table></figure>

<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p><code>turbo</code>不仅缓存任务的输出，它还记录终端输出(即结合<code>stdout</code>和<code>stderr</code>)到(<code>&lt;package&gt;/.turbo/run-&lt;command&gt;.log</code>)。当<code>turbo</code>遇到一个缓存的任务时，它会重新播放输出，就像它再次发生一样，但是是即时的，包的名称略微暗淡。</p>
<h3 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h3><p>您可能想知道<code>turbo</code>如何决定给定任务的缓存命中和未命中。</p>
<ol>
<li>首先，<code>turbo</code>构造了代码库当前全局状态的哈希值</li>
<li>然后它添加了更多与给定工作空间任务相关的因素</li>
</ol>
<p>一旦<code>turbo</code>在执行过程中遇到给定工作区的任务，它就会检查缓存(本地和远程)以查找匹配的散列。如果匹配，则跳过执行该任务，将缓存的输出移动或下载到合适的位置，并立即重放先前记录的日志。如果缓存(本地或远程)中没有任何与计算的哈希匹配的内容，<code>turbo</code>将在本地执行任务，然后使用哈希作为索引缓存指定的输出。</p>
<p>给定任务的哈希值在执行时作为环境变量<code>TURBO_HASH</code>注入。这个值在打印输出或标记<code>Dockerfile</code>等方面很有用。</p>
<h2 id="远程缓存"><a href="#远程缓存" class="headerlink" title="远程缓存"></a>远程缓存</h2><p><code>Turborepo</code>的任务缓存可以节省大量时间，因为它不会重复同样的工作。</p>
<p>但是有一个问题-缓存是本地的。当您使用<code>CI</code>时，这可能会导致大量重复工作</p>
<p>因为默认情况下<code>Turborepo</code>只缓存到本地文件系统，所以相同的任务(<code>Turbo</code>运行构建)必须在每台机器上(由您、您的队友、您的<code>CI</code>、您的<code>PaaS</code>等)重新执行，即使所有的任务输入都是相同的–这浪费了时间和资源。</p>
<blockquote>
<p>远程缓存是<code>Turborepo</code>的一个强大特性，但是能力越大责任越大。首先要确保缓存正确，并仔细检查环境变量的处理情况。还请记住，<code>Turborepo</code>将日志视为工件，因此要注意打印到控制台的内容。</p>
</blockquote>
<h3 id="一个单一的共享缓存"><a href="#一个单一的共享缓存" class="headerlink" title="一个单一的共享缓存"></a>一个单一的共享缓存</h3><p>通过与<code>Vercel</code>等提供商合作，<code>Turborepo</code>可以安全地与远程缓存(存储任务结果的云服务器)通信。</p>
<p>这可以通过防止整个组织中的重复工作来节省大量的时间。</p>
<h3 id="Vercel"><a href="#Vercel" class="headerlink" title="Vercel"></a>Vercel</h3><p>本地开发，如果您想将本地<code>turborepo</code>链接到远程缓存，请先使用您的<code>Vercel</code>帐户验证<code>turborepo CLI</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx turbo login</span><br></pre></td></tr></table></figure>

<p>启用后，对当前正在缓存的工作空间进行一些更改，并使用<code>turbo run</code>对其运行任务。您的缓存工件现在将存储在本地和远程缓存中。</p>
<p>为了验证，删除您的本地<code>Turborepo</code>缓存:</p>
<p>然后再次运行相同的构建。如果一切正常，<code>turbo</code>不应该在本地执行任务，而是从远程缓存下载日志和工件，并将它们重放给您。</p>
<h3 id="自定义远程缓存"><a href="#自定义远程缓存" class="headerlink" title="自定义远程缓存"></a>自定义远程缓存</h3><p>您可以自行托管自己的远程缓存或使用其他远程缓存服务提供商，只要他们符合<code>Turborepo</code>的远程缓存服务器<code>API</code>。</p>
<p>您可以通过指定<code>--api</code>和<code>--token</code>标志来设置远程缓存域，其中<code>--api</code>是主机名，<code>--token</code>是承载令牌。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">turbo run build --api=<span class="string">&quot;https://my-server.example.com&quot;</span> --token=<span class="string">&quot;xxxxxxxxxxxxxxxxx&quot;</span></span><br></pre></td></tr></table></figure>

<p>您可以在这里看到所需的端点&#x2F;请求<a href="https://github.com/vercel/turbo/blob/main/cli/internal/client/client.go">在一个新选项卡中打开</a>。</p>
<h2 id="拓扑"><a href="#拓扑" class="headerlink" title="拓扑"></a>拓扑</h2><p>拓扑排序通常用来“排序”具有依赖关系的任务， 如果 <code>A</code> 依赖于 <code>B</code>，<code>B</code> 依赖于 <code>C</code>，则拓扑顺序为 <code>C、B、A</code>。</p>
<h2 id="配置文件turbo-json"><a href="#配置文件turbo-json" class="headerlink" title="配置文件turbo.json"></a>配置文件<code>turbo.json</code></h2><p>在<code>monorepo</code>的根目录中，创建一个名为<code>turbo.json</code>的空文件。这将保持<code>Turborepo</code>的配置。</p>
<p>要定义<code>monorepo</code>的任务依赖关系图，请使用<code>turbo</code>中的<code>pipeline</code>键。<code>Turbo</code>解释这个配置，以优化调度、执行和缓存每个包的输出。在工作空间中定义的<code>Json</code>脚本。</p>
<p><code>./turbo.json：</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A package&#x27;s `build` script depends on that package&#x27;s</span></span><br><span class="line">      <span class="comment">// dependencies and devDependencies</span></span><br><span class="line">      <span class="comment">// `build` tasks  being completed first</span></span><br><span class="line">      <span class="comment">// (the `^` symbol signifies `upstream`).</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// note: output globs are relative to each package&#x27;s `package.json`</span></span><br><span class="line">      <span class="comment">// (and not the monorepo root)</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;.next/**&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A package&#x27;s `test` script depends on that package&#x27;s</span></span><br><span class="line">      <span class="comment">// own `build` script being completed first.</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// A package&#x27;s `test` script should only be rerun when</span></span><br><span class="line">      <span class="comment">// either a `.tsx` or `.ts` file has changed in `src` or `test` folders.</span></span><br><span class="line">      <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test/**/*.tsx&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A package&#x27;s `lint` script has no dependencies and</span></span><br><span class="line">      <span class="comment">// can be run whenever. It also has no filesystem outputs.</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deploy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A package&#x27;s `deploy` script depends on the `build`,</span></span><br><span class="line">      <span class="comment">// `test`, and `lint` scripts of the same package</span></span><br><span class="line">      <span class="comment">// being completed. It also has no filesystem outputs.</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lint&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="全局依赖-globalDependencies"><a href="#全局依赖-globalDependencies" class="headerlink" title="全局依赖(globalDependencies)"></a>全局依赖(<code>globalDependencies</code>)</h3><p>用于隐式全局哈希依赖的文件<code>glob</code>列表。这些文件的内容将包含在全局哈希算法中，并影响所有任务的哈希。</p>
<p>这对于基于<code>.env</code>文件(不在<code>Git</code>中)或任何影响工作空间任务的根级文件(但在传统的依赖关系图中没有表示)破坏缓存非常有用(例如根<code>tsconfig</code>)。<code>Json, jest.config.js， .eslintrc</code>等))。</p>
<p>例子：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ... omitted for brevity</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">&quot;globalDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;.env&quot;</span><span class="punctuation">,</span> <span class="comment">// contents will impact hashes of all tasks</span></span><br><span class="line">    <span class="string">&quot;tsconfig.json&quot;</span> <span class="comment">// contents will impact hashes of all tasks</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="全局环境-globalEnv"><a href="#全局环境-globalEnv" class="headerlink" title="全局环境(globalEnv)"></a>全局环境(<code>globalEnv</code>)</h3><p>用于隐式全局哈希依赖关系的环境变量列表。这些环境变量的内容将包含在全局哈希算法中，并影响所有任务的哈希值。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ... omitted for brevity</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">&quot;globalEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;GITHUB_TOKEN&quot;</span><span class="punctuation">]</span> <span class="comment">// value will impact the hashes of all tasks</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="管道-pipeline"><a href="#管道-pipeline" class="headerlink" title="管道(pipeline)"></a>管道(<code>pipeline</code>)</h3><p>表示项目的任务依赖关系图的对象。<code>Turbo</code>解释这些约定，以正确地调度、执行和缓存项目中任务的输出。</p>
<p>管道对象中的每个键都是<code>turbo</code>运行可以执行的任务的名称。如果<code>turbo</code>找到一个带有包的工作空间。对象，它将在执行期间将管道任务配置应用到该NPM脚本。这允许您使用管道在整个<code>Turborepo</code>中设置约定。</p>
<h4 id="依赖于-DependsOn"><a href="#依赖于-DependsOn" class="headerlink" title="依赖于(DependsOn)"></a>依赖于(<code>DependsOn</code>)</h4><p>在<code>dependsOn</code>中的一个项目前面加上<code>^</code>，告诉<code>turbo</code>这个管道任务依赖于工作空间的拓扑依赖关系，首先用<code>^</code>前缀完成任务(例如:“一个工作空间的构建任务应该只在它的所有依赖项和<code>devDependencies</code>完成了它们自己的构建命令后运行”)。</p>
<p><code>dependsOn</code>中没有<code>^</code>前缀的项表示工作空间级别任务之间的关系(例如:“工作区的<code>test</code>和<code>lint</code>命令依赖于<code>build</code>首先完成”)。</p>
<p>在<code>dependsOn</code>中的项前面加上<code>$</code>可以告诉<code>turbo</code>这个管道任务依赖于该环境变量的值。</p>
<blockquote>
<p>不建议在<code>dependsOn</code>配置中使用<code>$</code>声明环境变量。请使用<code>env</code>键。</p>
</blockquote>
<p>例子：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;A workspace&#x27;s `build` command depends on its dependencies&#x27;</span></span><br><span class="line">      <span class="comment">// or devDependencies&#x27; `build` command being completed first&quot;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;A workspace&#x27;s `test` command depends on its own `lint` and</span></span><br><span class="line">      <span class="comment">// `build` commands first being completed&quot;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;lint&quot;</span><span class="punctuation">,</span> <span class="string">&quot;build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deploy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;A workspace&#x27;s `deploy` command, depends on its own `build`</span></span><br><span class="line">      <span class="comment">// and `test` commands first being completed&quot;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// A workspace&#x27;s `lint` command has no dependencies</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>空依赖: 如果一个任务的<code>dependsOn</code>为<code>[]</code> 或者不声明这个属性，那么表明这个任务可以在任意时间被执行</li>
</ul>
<h4 id="env"><a href="#env" class="headerlink" title="env"></a>env</h4><p>类型：<code>string []</code></p>
<p>任务所依赖的环境变量列表。</p>
<p>例子：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;SOMETHING_ELSE&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// value will impact the hashes of all build tasks</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;dist/**&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.next/**&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;web#build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;STRIPE_SECRET_KEY&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// value will impact hash of only web&#x27;s build task</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;.next/**&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;globalEnv&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;GITHUB_TOKEN&quot;</span> <span class="comment">// value will impact the hashes of all tasks</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="outputs"><a href="#outputs" class="headerlink" title="outputs"></a>outputs</h4><p>类型：<code>string []</code></p>
<p>默认为<code>[&quot;dist/**&quot;， &quot;build/**&quot;]</code>。任务的可缓存文件系统输出的<code>glob</code>模式集。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;Cache all files emitted to workspace&#x27;s dist/** or .next</span></span><br><span class="line">      <span class="comment">// directories by a `build` task&quot;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;dist/**&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.next/**&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;Don&#x27;t cache any artifacts of `test` tasks (aside from</span></span><br><span class="line">      <span class="comment">// logs)&quot;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test:ci&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// &quot;Cache the coverage report of a `test:ci` command&quot;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;coverage/**&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// Never cache anything (including logs) emitted by a</span></span><br><span class="line">      <span class="comment">// `dev` task</span></span><br><span class="line">      <span class="attr">&quot;cache&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h4><p>默认为<code>true</code>。是否缓存任务输出。将缓存设置为<code>false</code>对于不希望缓存的守护进程或长时间运行的“监视”或开发模式任务非常有用。</p>
<p>例子：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;cache&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="inputs"><a href="#inputs" class="headerlink" title="inputs"></a>inputs</h4><p>默认为<code>[]</code>。告诉<code>turbo</code>在确定工作空间是否为特定任务更改时要考虑的文件集。将此设置为一个<code>glob</code>列表将导致仅当匹配这些<code>glob</code>的文件发生更改时才重新运行任务。例如，如果您希望跳过运行测试，除非源文件发生了更改，那么这将很有帮助。</p>
<p>指定<code>[]</code>将导致在工作区中的任何文件更改时重新运行任务</p>
<p>例子：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ... omitted for brevity</span></span><br><span class="line"> </span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// A workspace&#x27;s `test` task depends on that workspace&#x27;s</span></span><br><span class="line">      <span class="comment">// own `build` task being completed first.</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// A workspace&#x27;s `test` task should only be rerun when</span></span><br><span class="line">      <span class="comment">// either a `.tsx` or `.ts` file has changed.</span></span><br><span class="line">      <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;test/**/*.ts&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="outputMode"><a href="#outputMode" class="headerlink" title="outputMode"></a>outputMode</h4><p><code>outputMode</code>代表输出的模式类型是字符串</p>
<ul>
<li><code>full：</code>默认值。显示所有输出</li>
<li><code>hash-only：</code>只显示任务的哈希值</li>
<li><code>new-only：</code>只显示缓存未命中的输出</li>
<li><code>none：</code>隐藏所有任务输出</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pipeline&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;^build&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;outputMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;new-only&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dependsOn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;build&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h2><p>在安装<code>turbo</code>包(或克隆一个启动器)之后，您可以开始使用<code>Turborepo</code>的命令行界面(CLI) <code>turbo</code>在您的<code>monorepo</code>中做各种事情。</p>
<h3 id="全局参数"><a href="#全局参数" class="headerlink" title="全局参数"></a>全局参数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">turbo run build --color</span><br><span class="line"><span class="comment"># 为CI运行器启用turbo的颜色输出，这些运行器支持在日志输出中呈现颜色。</span></span><br><span class="line"></span><br><span class="line">turbo run build --no-color</span><br><span class="line"><span class="comment"># 禁止在输出中使用颜色</span></span><br></pre></td></tr></table></figure>

<h3 id="任务参数"><a href="#任务参数" class="headerlink" title="任务参数"></a>任务参数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">turbo run build --cache-dir=<span class="string">&quot;./my-cache&quot;</span></span><br><span class="line"><span class="comment"># 默认为。/node_modules/.cache/turbo。指定本地文件系统缓存目录。如果更改默认值，请确保将此文件夹添加到.gitignore中</span></span><br><span class="line"></span><br><span class="line">turbo run build --concurrency=50%</span><br><span class="line"><span class="comment"># 默认值为10。设置/限制任务执行的最大并发数。这必须是大于等于1的整数或百分比值，如50%,如果还传递了--parallel标志，则忽略此选项。</span></span><br><span class="line"></span><br><span class="line">turbo run build --<span class="built_in">continue</span></span><br><span class="line"><span class="comment"># 默认为false。这个标志告诉turbo在出现错误(即任务的非零退出码)时是否继续执行。默认情况下，指定--parallel标志将自动设置--continue为true，除非显式设置为false。当--continue为true时，turbo将以执行期间遇到的最高退出码值退出。</span></span><br><span class="line"></span><br><span class="line">turbo run build --cwd=./somewhere/else</span><br><span class="line"><span class="comment"># 设置命令的工作目录。</span></span><br><span class="line"></span><br><span class="line">turbo run build --filter=my-pkg --filter=my-app</span><br><span class="line"><span class="comment"># 你可以通过给命令传递多个--filter标志来指定多个过滤器</span></span><br><span class="line"></span><br><span class="line">turbo run build --filter=admin-*</span><br><span class="line"><span class="comment"># 构建所有以“admin-”开头的工作区，让turbo推断任务</span></span><br><span class="line"></span><br><span class="line">turbo run <span class="built_in">test</span> --filter=...my-lib</span><br><span class="line"><span class="comment"># 测试&#x27;my-lib&#x27;和所有依赖于&#x27;my-lib&#x27;的东西</span></span><br><span class="line"></span><br><span class="line">turbo run <span class="built_in">test</span> --filter=...^my-lib</span><br><span class="line"><span class="comment"># 测试所有依赖于&#x27;my-lib&#x27;的东西，而不是&#x27;my-lib&#x27;本身</span></span><br><span class="line"></span><br><span class="line">turbo run build --filter=./apps/*</span><br><span class="line"><span class="comment"># 在&quot;apps&quot;目录下构建所有的工作空间</span></span><br><span class="line"></span><br><span class="line">turbo run build --graph</span><br><span class="line"><span class="comment"># 该命令将生成当前任务图的svg、png、jpg、pdf、json、html或其他支持的输出格式(在新选项卡中打开)。输出文件格式默认为jpg，但可以通过指定文件名的扩展名来控制。</span></span><br><span class="line"></span><br><span class="line">turbo run build --force</span><br><span class="line"><span class="comment"># 忽略现有的缓存工件并强制重新执行所有任务</span></span><br><span class="line"></span><br><span class="line">turbo run build --global-deps=<span class="string">&quot;.env.*&quot;</span> --global-deps=<span class="string">&quot;.eslintrc&quot;</span> --global-deps=<span class="string">&quot;jest.config.js&quot;</span></span><br><span class="line"><span class="comment"># 指定要散列的全局文件系统依赖项的`glob`。适用于`.env`和根目录下影响多个包/应用程序的文件。可以多次指定。</span></span><br><span class="line"></span><br><span class="line">turbo run build --ignore=<span class="string">&quot;apps/**/*&quot;</span></span><br><span class="line"><span class="comment"># 忽略影响作用域的文件或目录。在盖下使用glob模式</span></span><br><span class="line"></span><br><span class="line">turbo run build --no-cache</span><br><span class="line"><span class="comment"># 默认的错误。不要缓存任务的结果。这对于监视命令(如next dev或react-scripts start)非常有用。</span></span><br><span class="line"></span><br><span class="line">turbo run build --output-logs=full</span><br><span class="line"><span class="comment"># full默认值。显示所有输出；hash-only只显示任务的哈希值；new-only只显示缓存未命中的输出；none隐藏所有任务输出</span></span><br><span class="line"></span><br><span class="line">turbo run <span class="built_in">test</span> --only</span><br><span class="line"><span class="comment"># 默认的错误。限制执行只包括指定的任务。这与lerna和pnpm默认运行任务的方式非常相似。</span></span><br><span class="line"></span><br><span class="line">turbo run lint --parallel --no-cache</span><br><span class="line"><span class="comment"># 默认的错误。跨工作空间并行运行命令并忽略依赖关系图。这对于实时重载开发非常有用。</span></span><br><span class="line"></span><br><span class="line">turbo run build --remote-only</span><br><span class="line"><span class="comment"># 默认的错误。忽略所有任务的本地文件系统缓存。只允许读取和缓存使用远程缓存的工件。</span></span><br><span class="line"></span><br><span class="line">turbo run build --team=my-team --token=xxxxxxxxxxxxxxxxx</span><br><span class="line"><span class="comment"># 用于远程缓存的承载令牌。用于在非交互式shell(例如CI/CD)中结合——team标志运行。</span></span><br><span class="line"></span><br><span class="line">turbo run build --team=my-team</span><br><span class="line"><span class="comment"># 远程缓存团队的蛞蝓。与--token和--team标志结合在非交互式shell中运行时非常有用。</span></span><br><span class="line"></span><br><span class="line">turbo run build --preflight</span><br><span class="line"><span class="comment"># 仅适用于配置远程工件缓存时。允许在每个缓存工件和分析请求之前发送预飞行请求。后续的上传和下载将遵循重定向。</span></span><br><span class="line"></span><br><span class="line">turbo run build --trace=<span class="string">&quot;&lt;trace-file-name&gt;&quot;</span></span><br><span class="line"><span class="comment"># 要查看CPU跟踪，输出跟踪到给定的文件，使用go工具trace [file]。</span></span><br><span class="line"></span><br><span class="line">turbo run build --heap=<span class="string">&quot;&lt;heap-file-name&gt;&quot;</span></span><br><span class="line"><span class="comment"># 要查看堆跟踪，将跟踪输出到给定文件，使用go工具pprof [file]并输入top。你也可以将它放入speedscope(在一个新选项卡中打开)，并使用左重视图或三明治视图模式。</span></span><br><span class="line"></span><br><span class="line">turbo run build --cpuprofile=<span class="string">&quot;&lt;cpu-profile-file-name&gt;&quot;</span></span><br><span class="line"><span class="comment"># 要查看CPU配置文件，将配置文件输出到给定文件中，将文件放入speedscope</span></span><br><span class="line"></span><br><span class="line">turbo run build -v</span><br><span class="line">turbo run build -vv</span><br><span class="line">turbo run build -vvv</span><br><span class="line"><span class="comment"># 要指定日志级别，使用-v表示信息，-vv表示调试，-vvv表示跟踪标志</span></span><br></pre></td></tr></table></figure>

<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="创建新的monorepo"><a href="#创建新的monorepo" class="headerlink" title="创建新的monorepo"></a>创建新的<code>monorepo</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npx create-turbo@latest</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; TURBOREPO</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; Welcome to Turborepo! Let<span class="string">&#x27;s get you set up with a new codebase.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">? Where would you like to create your turborepo? ./my-turborepo</span></span><br><span class="line"><span class="string">? Which package manager do you want to use? pnpm</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; Created a new turborepo with the following:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> - apps/web: Next.js with TypeScript</span></span><br><span class="line"><span class="string"> - apps/docs: Next.js with TypeScript</span></span><br><span class="line"><span class="string"> - packages/ui: Shared React component library</span></span><br><span class="line"><span class="string"> - packages/eslint-config-custom: Shared configuration (ESLint)</span></span><br><span class="line"><span class="string"> - packages/tsconfig: Shared TypeScript `tsconfig.json`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; Success! Created a new Turborepo at &quot;my-turborepo&quot;.</span></span><br><span class="line"><span class="string">Inside that directory, you can run several commands:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  pnpm run build</span></span><br><span class="line"><span class="string">     Build all apps and packages</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  pnpm run dev</span></span><br><span class="line"><span class="string">     Develop all apps and packages</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Turborepo will cache locally by default. For an additional</span></span><br><span class="line"><span class="string">speed boost, enable Remote Caching with Vercel by</span></span><br><span class="line"><span class="string">entering the following command:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  pnpm dlx turbo login</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">We suggest that you begin by typing:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  cd my-turborepo</span></span><br><span class="line"><span class="string">  pnpm dlx turbo login</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建我们的工程名</li>
<li>推荐使用<code>pnpm</code> 构建</li>
</ul>
<p><code>turbo</code> 会自动根据我们选择的包管理器为我们创建相对应的项目 然后我们进入项目</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm run dev</span><br><span class="line"><span class="comment"># 只会执行两个脚本——docs:dev和web:dev。这是仅有的两个指定dev的工作空间。</span></span><br><span class="line"><span class="comment"># 两个开发脚本同时运行，在端口3000和3001上启动Next.js应用程序。</span></span><br><span class="line"><span class="comment"># 在终端中，您将看到缓存绕过，强制执行。</span></span><br><span class="line"></span><br><span class="line">pnpm run dev --filter docs</span><br><span class="line"><span class="comment"># 你会注意到它现在只运行docs:dev</span></span><br></pre></td></tr></table></figure>
<h3 id="添加到现有的monorepo"><a href="#添加到现有的monorepo" class="headerlink" title="添加到现有的monorepo"></a>添加到现有的<code>monorepo</code></h3><p>安装<code>turbo</code>，添加<code>turbo</code>作为<code>monorepo</code>根目录的开发依赖项。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm add turbo -Dw</span><br></pre></td></tr></table></figure>

<h3 id="创建-turbo-json"><a href="#创建-turbo-json" class="headerlink" title="创建 turbo.json"></a>创建 <code>turbo.json</code></h3><p>在<code>monorepo</code>的根目录中，创建一个名为<code>turbo.json</code>的空文件。这将保存<code>Turborepo</code>的配置。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://turbo.build/schema.json&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>创建管道</li>
<li>编辑<code>.gitignore</code></li>
<li>创建<code>package. json</code>脚本</li>
<li>构建 <code>monorepo</code></li>
<li>配置远程缓存</li>
</ul>
<p>按照以上的步骤，你的项目基本已经配置完成。</p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>您现在已经启动并运行<code>Turborepo</code>，但仍有几件事要做:</p>
<ul>
<li>了解<code>Turborepo</code>缓存的工作原理</li>
<li>正确处理环境变量</li>
<li>学会用管道编排任务运行</li>
<li>高效筛选包任务</li>
<li>使用<code>CI</code>提供商配置<code>Turborepo</code></li>
</ul>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://turbo.build/">turbo官网</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>rn蓝牙打印</title>
    <url>/2018/11/27/rn%E8%93%9D%E7%89%99%E6%89%93%E5%8D%B0/</url>
    <content><![CDATA[<h2 id="蓝牙4-0"><a href="#蓝牙4-0" class="headerlink" title="蓝牙4.0"></a>蓝牙<code>4.0</code></h2><p>蓝牙<code>4.0</code>标准包含两个蓝牙标准，准确的说，是一个双模的标准</p>
<p>现在移动设备上使用的蓝牙大多是<code>4.0</code>，而蓝牙 <code>4.0</code> 有两个分支，经典 <code>4.0</code> 和 <code>BLE4.0</code></p>
<h3 id="经典蓝牙-classic-Bluetooth"><a href="#经典蓝牙-classic-Bluetooth" class="headerlink" title="经典蓝牙(classic Bluetooth)"></a>经典蓝牙(<code>classic Bluetooth</code>)</h3><p>经典蓝牙可以用与数据量比较大的传输，如语音，音乐，较高数据量传输</p>
<span id="more"></span>

<h4 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h4><p>经典蓝牙建立连接的方式实际上就是<code>Socket</code>的连接的建立。只不过这里不是直接用<code>Socket</code>，而是<code>BluetoothSocket</code>。</p>
<p>获取<code>BluetoothSocket</code>的方式也很简单，利用搜索找到的<code>BluetoothDevice</code>，调用其方法<code>createRfcommSocketToServiceRecord(UUID)</code>。</p>
<p>最后，使用获取到的<code>BluetoothDevice</code>调用其方法<code>connect()</code>就建立了经典蓝牙设备之间的连接通道。</p>
<h4 id="数据通信"><a href="#数据通信" class="headerlink" title="数据通信"></a>数据通信</h4><p>当建立连接后，就可以直接使用<code>BluetoothSocket</code>的<code>getOutputStream()</code>方法获取输出流写入需要发送的数据。读取发送回来的数据，则是调用<code>BluetoothSocket</code>的<code>getInputStream()</code>方法获取输入流读取</p>
<h3 id="低功耗蓝牙（Bluetooth-low-energy，简称BLE或者LE）"><a href="#低功耗蓝牙（Bluetooth-low-energy，简称BLE或者LE）" class="headerlink" title="低功耗蓝牙（Bluetooth low energy，简称BLE或者LE）"></a>低功耗蓝牙（Bluetooth low energy，简称BLE或者LE）</h3><p>低功耗蓝牙应用于实时性要求比较高，但是数据速率比较低的产品，如遥控类的，如鼠标，键盘，遥控鼠标(Air Mouse)，传感设备的数据发送，如心跳带，血压计，温度传感器等</p>
<p>BLE的优点是快速搜索，快速连接，超低功耗保持连接和传输数据，弱点是数据传输速率低</p>
<h4 id="建立连接-1"><a href="#建立连接-1" class="headerlink" title="建立连接"></a>建立连接</h4><p>硬件条件是，蓝牙得至少是低功耗蓝牙版本，然后安卓系统的话，至少得是<code>Android 4.3</code>以上系统才行</p>
<h4 id="数据通信-1"><a href="#数据通信-1" class="headerlink" title="数据通信"></a>数据通信</h4><p><code>BLE</code>分为三部分<code>Service</code>（服务）、<code>Characteristic</code>（特征）、<code>Descriptor</code>（描述符），这三部分都由<code>UUID</code>作为唯一标示符。</p>
<p>一个蓝牙<code>4.0</code>的终端可以包含多个<code>Service</code>;</p>
<p>一个<code>Service</code>可以包含多个<code>Characteristic</code>;</p>
<p>一个<code>Characteristic</code>包含一个<code>Value</code>和多个<code>Descriptor</code>;</p>
<p>一个<code>Descriptor</code>包含一个<code>Value</code> 一般来说;</p>
<p><code>Characteristic</code>是手机与BLE终端交换数据的关键，<code>Characteristic</code>有跟权限相关的字段，如<code>Property，Property</code>有读写等各种属性，如<code>Notify、Read、Write、WriteWithoutResponse</code></p>
<p>调用<code>BluetoothGattCharacteristic</code>的方法<code>setValue(value)</code>进行,发送的命令值,其中<code>value</code>一般为<code>byte[]</code>;</p>
<p>使用<code>BluetoothGatt</code>的写入方法<code>writeCharacteristic(char)</code>完成命令发送</p>
<h2 id="react-native-ble-plx"><a href="#react-native-ble-plx" class="headerlink" title="react-native-ble-plx"></a>react-native-ble-plx</h2><p>一个支持低功耗的蓝牙类库</p>
<p>Android (example setup):</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save react-native-ble-plx</span><br><span class="line">react-native <span class="built_in">link</span> react-native-ble-plx</span><br><span class="line"><span class="comment">#安装依赖</span></span><br></pre></td></tr></table></figure>

<p>在app模块的<code>build.gradle</code>中，确保<code>min SDK</code>版本至少为18：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion 18</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加权限<code>AndroidManifest.xml</code>：</p>
<p><strong>注意:</strong> 添加GPS和网络定位权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!-- 允许程序连接到已配对的蓝牙设备--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span>/&gt;</span><br><span class="line">&lt;!-- 允许程序发现和配对蓝牙设备--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_ADMIN&quot;</span>/&gt;</span><br><span class="line">&lt;!-- GPS权限--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span><br><span class="line">&lt;!-- 网络定位--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="热敏打印机指令集"><a href="#热敏打印机指令集" class="headerlink" title="热敏打印机指令集"></a>热敏打印机指令集</h2><p>以下命令是部分命令，具体参考文百度文库<a href="https://wenku.baidu.com/view/187b1ad5690203d8ce2f0066f5335a8102d266a9">热敏打印机指令集文档</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> blePlxCommands = &#123;</span><br><span class="line">    <span class="attr">asciiFont</span>:[<span class="number">0x1b</span>, <span class="number">0x4d</span>, <span class="number">0x00</span>],<span class="comment">//标准ASCII字体</span></span><br><span class="line">    <span class="attr">compressAsciiFont</span>:[<span class="number">0x1b</span>, <span class="number">0x4d</span>, <span class="number">0x01</span>],<span class="comment">// 压缩ASCII字体</span></span><br><span class="line">    <span class="attr">fontWeight</span>:[<span class="number">0x1b</span>, <span class="number">0x45</span>, <span class="number">0x01</span>],<span class="comment">//选择加粗模式</span></span><br><span class="line">    <span class="attr">cancelFontWeight</span>:[<span class="number">0x1b</span>, <span class="number">0x45</span>, <span class="number">0x00</span>],<span class="comment">//取消加粗模式</span></span><br><span class="line">    <span class="attr">alignLeft</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x30</span>],<span class="comment">//左对齐</span></span><br><span class="line">    <span class="attr">alignRight</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x32</span>],<span class="comment">//右对齐</span></span><br><span class="line">    <span class="attr">alignCenter</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x31</span>],<span class="comment">//居中对齐</span></span><br><span class="line">    <span class="attr">cutPaper</span>:[<span class="number">0x1b</span>, <span class="number">0x69</span>],<span class="comment">//全切纸</span></span><br><span class="line">    <span class="attr">cutHalfPaper</span>:[<span class="number">0x1b</span>, <span class="number">0x6d</span>],<span class="comment">//半切纸</span></span><br><span class="line">    <span class="attr">nextOneLinePaper</span>:[<span class="number">0x0a</span>],<span class="comment">//走一行纸</span></span><br><span class="line">    <span class="attr">clockwiseDegree90</span>:[<span class="number">0x1b</span>, <span class="number">0x56</span>, <span class="number">0x01</span>], <span class="comment">//选择顺时针旋转90°</span></span><br><span class="line">    <span class="attr">reverseClockwise90</span>:[<span class="number">0x1b</span>, <span class="number">0x56</span>, <span class="number">0x00</span>],<span class="comment">//取消顺时针旋转90°</span></span><br><span class="line">    <span class="attr">imgBefore</span>:[<span class="number">0x1B</span>, <span class="number">0x33</span>, <span class="number">0x00</span>],<span class="comment">// 发送打印图片设置图片行距为0</span></span><br><span class="line">    <span class="attr">imgAfter</span>:[<span class="number">0x1d</span>, <span class="number">0x4c</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>],<span class="comment">//发送结束指令(选择左边空白)</span></span><br><span class="line">    <span class="attr">initClear</span>:[<span class="number">0x1b</span>,<span class="number">0x40</span>],<span class="comment">//初始化打印机，复位打印机,清除打印缓冲区</span></span><br><span class="line">    <span class="attr">setZhFontMode</span>:[<span class="number">0x1c</span>,<span class="number">0x26</span>]<span class="comment">//设置中文字符模式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="react-native-ble-plx简单使用"><a href="#react-native-ble-plx简单使用" class="headerlink" title="react-native-ble-plx简单使用"></a>react-native-ble-plx简单使用</h2><ul>
<li>蓝牙热敏打印的使用；</li>
<li>可以同时可以连接多个设备；</li>
<li>文档地址：<a href="https://github.com/Polidea/react-native-ble-plx">https://github.com/Polidea/react-native-ble-plx</a></li>
<li><code>react-native-ble-plx</code>接收的数据格式是<code>base64</code></li>
</ul>
<p><a href="https://apkdownloadforandroid.com/com.BlueLoupe.DreamOn.mh/"><code>BlueLoupe.apk</code></a>APP可以检测设备是否支持低功耗蓝牙</p>
<p>蓝牙服务于特征的获取并与数据的通信</p>
<h3 id="react-native"><a href="#react-native" class="headerlink" title="react-native"></a><code>react-native</code></h3><p><code>bleplx.js</code>(简要代码):</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Platform</span>,<span class="title class_">Alert</span>,<span class="title class_">NativeModules</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Buffer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;buffer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BleManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native-ble-plx&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">XToast</span> <span class="keyword">from</span> <span class="string">&#x27;@app/widget/x-toast/&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> lodash <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span></span><br><span class="line"><span class="keyword">import</span> iconv <span class="keyword">from</span> <span class="string">&quot;iconv-lite&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">BlePlxPrint</span> = <span class="title class_">NativeModules</span>.<span class="property">BlePlxPrint</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [bluetoothCommands 蓝牙打印命令]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type</span> &#123;<span class="type">Object</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> blePlxCommands = &#123;</span><br><span class="line">    <span class="attr">asciiFont</span>:[<span class="number">0x1b</span>, <span class="number">0x4d</span>, <span class="number">0x00</span>],<span class="comment">//标准ASCII字体</span></span><br><span class="line">    <span class="attr">compressAsciiFont</span>:[<span class="number">0x1b</span>, <span class="number">0x4d</span>, <span class="number">0x01</span>],<span class="comment">// 压缩ASCII字体</span></span><br><span class="line">    <span class="attr">fontWeight</span>:[<span class="number">0x1b</span>, <span class="number">0x45</span>, <span class="number">0x01</span>],<span class="comment">//选择加粗模式</span></span><br><span class="line">    <span class="attr">cancelFontWeight</span>:[<span class="number">0x1b</span>, <span class="number">0x45</span>, <span class="number">0x00</span>],<span class="comment">//取消加粗模式</span></span><br><span class="line">    <span class="attr">alignLeft</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x30</span>],<span class="comment">//左对齐</span></span><br><span class="line">    <span class="attr">alignRight</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x32</span>],<span class="comment">//右对齐</span></span><br><span class="line">    <span class="attr">alignCenter</span>:[<span class="number">0x1b</span>, <span class="number">0x61</span>, <span class="number">0x31</span>],<span class="comment">//居中对齐</span></span><br><span class="line">    <span class="attr">cutPaper</span>:[<span class="number">0x1b</span>, <span class="number">0x69</span>],<span class="comment">//全切纸</span></span><br><span class="line">    <span class="attr">cutHalfPaper</span>:[<span class="number">0x1b</span>, <span class="number">0x6d</span>],<span class="comment">//半切纸</span></span><br><span class="line">    <span class="attr">nextOneLinePaper</span>:[<span class="number">0x0a</span>],<span class="comment">//走一行纸</span></span><br><span class="line">    <span class="attr">clockwiseDegree90</span>:[<span class="number">0x1b</span>, <span class="number">0x56</span>, <span class="number">0x01</span>], <span class="comment">//选择顺时针旋转90°</span></span><br><span class="line">    <span class="attr">reverseClockwise90</span>:[<span class="number">0x1b</span>, <span class="number">0x56</span>, <span class="number">0x00</span>],<span class="comment">//取消顺时针旋转90°</span></span><br><span class="line">    <span class="attr">imgBefore</span>:[<span class="number">0x1B</span>, <span class="number">0x33</span>, <span class="number">0x00</span>],<span class="comment">// 发送打印图片设置图片行距为0</span></span><br><span class="line">    <span class="attr">imgAfter</span>:[<span class="number">0x1d</span>, <span class="number">0x4c</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>],<span class="comment">//发送结束指令(选择左边空白)</span></span><br><span class="line">    <span class="attr">initClear</span>:[<span class="number">0x1b</span>,<span class="number">0x40</span>],<span class="comment">//初始化打印机，复位打印机,清除打印缓冲区</span></span><br><span class="line">    <span class="attr">setZhFontMode</span>:[<span class="number">0x1c</span>,<span class="number">0x26</span>]<span class="comment">//设置中文字符模式</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [_cacheConnectDeviceMap 缓存已连接的设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type</span> &#123;<span class="type">Map</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//缓存所有连接过的设备</span></span><br><span class="line"><span class="keyword">let</span> _cacheConnectDeviceMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="comment">//缓存设备的UUID</span></span><br><span class="line"><span class="keyword">let</span> _cacheConnectDeviceUUIDMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************ConnectDevice**************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 已连接成功的设备</span></span><br><span class="line"><span class="comment"> * [updateCacheConnectDevice 新增并更新缓存设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; connectDevice [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;               [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateCacheConnectDevice</span>(<span class="params">connectDevice</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!connectDevice || !connectDevice.<span class="property">id</span>)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;连接设备[id]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _cacheConnectDeviceMap.<span class="title function_">set</span>(connectDevice.<span class="property">id</span>,connectDevice); <span class="comment">//使用Map类型保存搜索到的蓝牙设备，确保列表不显示重复的设备</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [getCacheConnectDeviceById 获取指定连接设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; id [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;    [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCacheConnectDeviceById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;获取设备[id]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_cacheConnectDeviceMap.<span class="title function_">has</span>(id))&#123;</span><br><span class="line">        <span class="keyword">return</span> _cacheConnectDeviceMap.<span class="title function_">get</span>(id);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 已连接成功的设备</span></span><br><span class="line"><span class="comment"> * [removeCacheConnectDevice 移除缓存设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; connectDevice [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[Object]</span>&#125;               [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeCacheConnectDevice</span>(<span class="params">connectDevice</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!connectDevice || !connectDevice.<span class="property">id</span>)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;连接设备[id]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_cacheConnectDeviceMap.<span class="title function_">has</span>(connectDevice.<span class="property">id</span>))&#123;</span><br><span class="line">        _cacheConnectDeviceMap.<span class="title function_">delete</span>(connectDevice.<span class="property">id</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************UUID**************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [removeCacheConnectDeviceUUIDMap 移除缓存设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; connectDevice [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;               [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">removeCacheConnectDeviceUUID</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;连接设备[id]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_cacheConnectDeviceUUIDMap.<span class="title function_">has</span>(id))&#123;</span><br><span class="line">        _cacheConnectDeviceUUIDMap.<span class="title function_">delete</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [getCacheConnectDeviceUUIDById 返回设备UUID]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; id [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[Object]</span>&#125;    [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCacheConnectDeviceUUIDById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;获取设备[id]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_cacheConnectDeviceUUIDMap.<span class="title function_">has</span>(id))&#123;</span><br><span class="line">        <span class="keyword">return</span> _cacheConnectDeviceUUIDMap.<span class="title function_">get</span>(id);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [updateCacheConnectDeviceUUID 更新设备的UUID]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; id   [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; data [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;      [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateCacheConnectDeviceUUID</span>(<span class="params">id,data</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id || !data)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;连接设备[id]与 [data]不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _cacheConnectDeviceUUIDMap.<span class="title function_">set</span>(id,data); <span class="comment">//使用Map类型保存搜索到的蓝牙设备，的UUID</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [fetchServicesAndCharacteristicsForDevice 获取设备]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125;  device [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Promise</span>&#125;        [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchServicesAndCharacteristicsForDevice</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;[id]不存在无法获取服务&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> device = <span class="title function_">getCacheConnectDeviceById</span>(id);</span><br><span class="line">    <span class="keyword">if</span>(!device)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;连接设备不存在无法获取服务&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> servicesMap = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> characteristicsMap = &#123;&#125;;</span><br><span class="line">    <span class="comment">//获取所有服务</span></span><br><span class="line">    <span class="keyword">let</span> services = <span class="keyword">await</span> device.<span class="title function_">services</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> service <span class="keyword">of</span> services) &#123;</span><br><span class="line">        characteristicsMap = &#123;&#125;</span><br><span class="line">        <span class="comment">//获取该服务的所有特征</span></span><br><span class="line">        <span class="keyword">let</span> characteristics = <span class="keyword">await</span> service.<span class="title function_">characteristics</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> characteristic <span class="keyword">of</span> characteristics) &#123;</span><br><span class="line">            characteristicsMap[characteristic.<span class="property">uuid</span>] = &#123;</span><br><span class="line">                <span class="attr">uuid</span>: characteristic.<span class="property">uuid</span>,</span><br><span class="line">                <span class="attr">isReadable</span>: characteristic.<span class="property">isReadable</span>,</span><br><span class="line">                <span class="attr">isWritableWithResponse</span>: characteristic.<span class="property">isWritableWithResponse</span>,</span><br><span class="line">                <span class="attr">isWritableWithoutResponse</span>: characteristic.<span class="property">isWritableWithoutResponse</span>,</span><br><span class="line">                <span class="attr">isNotifiable</span>: characteristic.<span class="property">isNotifiable</span>,</span><br><span class="line">                <span class="attr">isNotifying</span>: characteristic.<span class="property">isNotifying</span>,</span><br><span class="line">                <span class="attr">value</span>: characteristic.<span class="property">value</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        servicesMap[service.<span class="property">uuid</span>] = &#123;</span><br><span class="line">            <span class="attr">uuid</span>: service.<span class="property">uuid</span>,</span><br><span class="line">            <span class="attr">isPrimary</span>: service.<span class="property">isPrimary</span>,</span><br><span class="line">            <span class="attr">characteristicsCount</span>: characteristics.<span class="property">length</span>,<span class="comment">//特征数量</span></span><br><span class="line">            <span class="attr">characteristics</span>: characteristicsMap</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> servicesMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [getBlePlxUUID 获取蓝牙UUID]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125; [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getBlePlxUUID</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> services = <span class="keyword">await</span> <span class="title function_">fetchServicesAndCharacteristicsForDevice</span>(id);</span><br><span class="line">    <span class="keyword">if</span>(!services)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;服务不存在，无法获取[UUID]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = &#123;</span><br><span class="line">        <span class="attr">readServiceUUID</span>:[],</span><br><span class="line">        <span class="attr">readCharacteristicUUID</span>:[],</span><br><span class="line"></span><br><span class="line">        <span class="attr">writeWithResponseServiceUUID</span>:[],</span><br><span class="line">        <span class="attr">writeWithResponseCharacteristicUUID</span>:[],</span><br><span class="line"></span><br><span class="line">        <span class="attr">writeWithoutResponseServiceUUID</span>:[],</span><br><span class="line">        <span class="attr">writeWithoutResponseCharacteristicUUID</span>:[],</span><br><span class="line"></span><br><span class="line">        <span class="attr">nofityServiceUUID</span>:[],</span><br><span class="line">        <span class="attr">nofityCharacteristicUUID</span>:[],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> services)&#123;</span><br><span class="line">        <span class="keyword">let</span> charchteristic = services[i].<span class="property">characteristics</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> j <span class="keyword">in</span> charchteristic)&#123;</span><br><span class="line">            <span class="comment">//读</span></span><br><span class="line">            <span class="keyword">if</span>(charchteristic[j].<span class="property">isReadable</span>)&#123;</span><br><span class="line">               result.<span class="property">readServiceUUID</span>.<span class="title function_">push</span>(services[i].<span class="property">uuid</span>);</span><br><span class="line">               result.<span class="property">readCharacteristicUUID</span>.<span class="title function_">push</span>(charchteristic[j].<span class="property">uuid</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//写并响应</span></span><br><span class="line">            <span class="keyword">if</span>(charchteristic[j].<span class="property">isWritableWithResponse</span>)&#123;</span><br><span class="line">               result.<span class="property">writeWithResponseServiceUUID</span>.<span class="title function_">push</span>(services[i].<span class="property">uuid</span>);</span><br><span class="line">               result.<span class="property">writeWithResponseCharacteristicUUID</span>.<span class="title function_">push</span>(charchteristic[j].<span class="property">uuid</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//写无响应</span></span><br><span class="line">            <span class="keyword">if</span>(charchteristic[j].<span class="property">isWritableWithoutResponse</span>)&#123;</span><br><span class="line">               result.<span class="property">writeWithoutResponseServiceUUID</span>.<span class="title function_">push</span>(services[i].<span class="property">uuid</span>);</span><br><span class="line">               result.<span class="property">writeWithoutResponseCharacteristicUUID</span>.<span class="title function_">push</span>(charchteristic[j].<span class="property">uuid</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//通知</span></span><br><span class="line">            <span class="keyword">if</span>(charchteristic[j].<span class="property">isNotifiable</span>)&#123;</span><br><span class="line">               result.<span class="property">nofityServiceUUID</span>.<span class="title function_">push</span>(services[i].<span class="property">uuid</span>);</span><br><span class="line">               result.<span class="property">nofityCharacteristicUUID</span>.<span class="title function_">push</span>(charchteristic[j].<span class="property">uuid</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// console.info(&quot;@getBlePlxUUID&quot;,result);</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [initBleplx 初始化蓝牙]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125; [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initBleplx</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//确保全局只有一个BleManager实例，BleModule类保存着蓝牙的连接信息</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">global</span>.<span class="property">BLEPlxMag</span>)&#123;</span><br><span class="line">        <span class="variable language_">global</span>.<span class="property">BLEPlxMag</span> = <span class="keyword">new</span> <span class="title class_">BleManager</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [blePlxWrite 写数据]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125; [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">blePlxWrite</span>(<span class="params">id,value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;[id]不能为空&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> uuidObj = <span class="title function_">getCacheConnectDeviceUUIDById</span>(id);</span><br><span class="line">    <span class="keyword">if</span>(!uuidObj)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;获取[UUID service Obejct]失败,请重新连接&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!uuidObj.<span class="property">writeWithResponseServiceUUID</span>[<span class="number">0</span>])&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;获取[UUID service]失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!uuidObj.<span class="property">writeWithResponseCharacteristicUUID</span>[<span class="number">0</span>])&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;获取[UUID characteristic]失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> deviceId = id;</span><br><span class="line">    <span class="keyword">let</span> serviceUUID = uuidObj.<span class="property">writeWithResponseServiceUUID</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> characteristicUUID = uuidObj.<span class="property">writeWithResponseCharacteristicUUID</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> base64Value = value;</span><br><span class="line">    <span class="keyword">let</span> transactionId = <span class="string">&#x27;write&#x27;</span>;</span><br><span class="line">    <span class="comment">// console.log(&quot;@deviceId,serviceUUID,characteristicUUID,base64Value&quot;,deviceId,serviceUUID,characteristicUUID,base64Value,&quot;参数结束&quot;);</span></span><br><span class="line">    <span class="keyword">let</span> pse = <span class="title class_">BLEPlxMag</span>.<span class="title function_">writeCharacteristicWithResponseForDevice</span>(deviceId,serviceUUID,characteristicUUID,base64Value)</span><br><span class="line">    <span class="keyword">return</span> pse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [getDeviceIdByTpltypeid 根据模板Id获取指定的打印设备Id]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; deviceList [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; tpltypeid  [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;            [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDeviceIdByTpltypeid</span>(<span class="params">deviceList,tpltypeid</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!deviceList || !deviceList.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;设备列表不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> findDevice = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> device <span class="keyword">of</span> deviceList)&#123;</span><br><span class="line">        <span class="keyword">if</span>(device.<span class="property">tpltypeid</span> == tpltypeid)&#123;</span><br><span class="line">            findDevice = device;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!findDevice)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;未找到设置的打印设备无法打印&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> findDevice.<span class="property">id</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [bleplxPrintTaskDeal 打印任务处理]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; printArr [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;          [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bleplxPrintTaskDeal</span>(<span class="params">id,printArr</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> writePromises = []</span><br><span class="line">    <span class="keyword">let</span> toWrite;</span><br><span class="line">    <span class="keyword">let</span> base64Value;</span><br><span class="line">    <span class="keyword">let</span> packetSize = <span class="number">512</span>;<span class="comment">//分包 此数值根据具体设备进行测试</span></span><br><span class="line">    <span class="keyword">let</span> packetCount;</span><br><span class="line">    <span class="keyword">let</span> packet;</span><br><span class="line">    <span class="keyword">let</span> byteArr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(lodash.<span class="title function_">isArray</span>(printArr))&#123;</span><br><span class="line">        printArr.<span class="title function_">forEach</span>( <span class="function">(<span class="params">item</span>) =&gt;</span>&#123;</span><br><span class="line">            <span class="comment">//执行命令</span></span><br><span class="line">            <span class="keyword">if</span>(item.<span class="property">type</span> == <span class="number">1</span>)&#123;</span><br><span class="line">                toWrite = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(item.<span class="property">values</span>);</span><br><span class="line">                base64Value = toWrite.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value));</span><br><span class="line">            <span class="comment">//执行字符串</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">type</span>==<span class="number">2</span>)&#123;</span><br><span class="line">                toWrite = iconv.<span class="title function_">encode</span>(item.<span class="property">values</span>, <span class="string">&#x27;GBK&#x27;</span>);</span><br><span class="line">                packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">                    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">                    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">                    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="comment">//生成二维码</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">type</span>==<span class="number">3</span>)&#123;</span><br><span class="line">                toWrite = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(item.<span class="property">byte</span>);</span><br><span class="line">                base64Value = toWrite.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">                    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">                    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">                    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="comment">//打印图片</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">type</span>==<span class="number">4</span>)&#123;</span><br><span class="line">                toWrite = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(item.<span class="property">byte</span>);</span><br><span class="line">                packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">                    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">                    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">                    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">type</span> == <span class="number">5</span>)&#123;</span><br><span class="line">                toWrite = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(item.<span class="property">byte</span>);</span><br><span class="line">                packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">                    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">                    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">                    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">type</span> == <span class="number">6</span> &amp;&amp; item.<span class="property">byte</span> &amp;&amp; item.<span class="property">byte</span>.<span class="property">length</span>)&#123;</span><br><span class="line">                toWrite = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(item.<span class="property">byte</span>);</span><br><span class="line">                packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">                    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">                    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">                    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">                    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(lodash.<span class="title function_">isString</span>(printArr))&#123;</span><br><span class="line">        toWrite = iconv.<span class="title function_">encode</span>(item.<span class="property">values</span>, <span class="string">&#x27;GBK&#x27;</span>);</span><br><span class="line">        packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">            packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">            toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">            base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">            writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(&quot;writePromises&quot;,writePromises)</span></span><br><span class="line">    <span class="keyword">return</span> writePromises;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [ConvertPrintImage description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">Promise</span>&#125; [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">convertPrintImage</span>(<span class="params">rows</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rows || !rows.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;数据不能为空&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title class_">BlePlxPrint</span>.<span class="title function_">getSingleConvertData</span>(rows);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    initBleplx,</span><br><span class="line">    updateCacheConnectDevice,</span><br><span class="line">    removeCacheConnectDevice,</span><br><span class="line">    getCacheConnectDeviceById,</span><br><span class="line"></span><br><span class="line">    getCacheConnectDeviceUUIDById,</span><br><span class="line">    removeCacheConnectDeviceUUID,</span><br><span class="line">    updateCacheConnectDeviceUUID,</span><br><span class="line"></span><br><span class="line">    fetchServicesAndCharacteristicsForDevice,</span><br><span class="line">    getBlePlxUUID,</span><br><span class="line">    blePlxWrite,</span><br><span class="line">    bleplxPrintTaskDeal,</span><br><span class="line">    blePlxCommands,</span><br><span class="line">    convertPrintImage,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>blecp.js</code>(简要代码)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Buffer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;buffer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&quot;moment&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    initBleplx,</span><br><span class="line">    updateCacheConnectDevice,</span><br><span class="line">    removeCacheConnectDevice,</span><br><span class="line">    getCacheConnectDeviceById,</span><br><span class="line">    getCacheConnectDeviceUUIDById,</span><br><span class="line">    removeCacheConnectDeviceUUID,</span><br><span class="line">    updateCacheConnectDeviceUUID,</span><br><span class="line"></span><br><span class="line">    fetchServicesAndCharacteristicsForDevice,</span><br><span class="line">    getBlePlxUUID,</span><br><span class="line">    bleplxPrintTaskDeal,</span><br><span class="line">    blePlxWrite,</span><br><span class="line">    blePlxCommands,</span><br><span class="line"></span><br><span class="line">    convertPrintImage,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./bleplx.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Blecp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">scaning</span>:<span class="literal">false</span>, <span class="comment">//是否扫描附近蓝牙</span></span><br><span class="line">            <span class="attr">isConnecting</span>:<span class="literal">false</span>,<span class="comment">//是否连接设备中</span></span><br><span class="line">            <span class="attr">writing</span>:<span class="literal">false</span>, <span class="comment">//正在写数据</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">deviceMap</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="title function_">initBleplx</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentWillMount</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 监听蓝牙开关</span></span><br><span class="line">        <span class="title class_">BLEPlxMag</span>.<span class="title function_">onStateChange</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(state == <span class="string">&#x27;PoweredOn&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">scan</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扫描设备 记得检查权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    scan = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">scaning</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">scaning</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">deviceMap</span>.<span class="title function_">clear</span>();</span><br><span class="line">            <span class="title class_">BLEPlxMag</span>.<span class="title function_">startDeviceScan</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="function">(<span class="params">error, device</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(error.<span class="property">errorCode</span> == <span class="number">102</span>)&#123;</span><br><span class="line">                        <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;请打开手机蓝牙后再搜索&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">scaning</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">// console.log(device.id,device.name);</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">deviceMap</span>.<span class="title function_">set</span>(device.<span class="property">id</span>,device); <span class="comment">//使用Map类型保存搜索到的蓝牙设备，确保列表不显示重复的设备</span></span><br><span class="line">                    <span class="keyword">let</span> arr = [...<span class="variable language_">this</span>.<span class="property">deviceMap</span>.<span class="title function_">values</span>()];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">scanTimer</span> &amp;&amp; <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">scanTimer</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">scanTimer</span> = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">scaning</span>)&#123;</span><br><span class="line">                   <span class="title class_">BLEPlxMag</span>.<span class="title function_">stopDeviceScan</span>();</span><br><span class="line">                   <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">scaning</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,<span class="number">6000</span>)  <span class="comment">//6秒后停止搜索</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">BLEPlxMag</span>.<span class="title function_">stopDeviceScan</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">scaning</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始连接设备</span></span><br><span class="line">    connect = <span class="function">(<span class="params">item,index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">scaning</span>)&#123;  <span class="comment">//连接的时候正在扫描，先停止扫描</span></span><br><span class="line">            <span class="title class_">BLEPlxMag</span>.<span class="title function_">stopDeviceScan</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">scaning</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isConnecting</span>)&#123;</span><br><span class="line">            <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;正在连接中...&quot;</span>);</span><br><span class="line">            <span class="comment">// console.log(&#x27;当前蓝牙正在连接时不能打开另一个连接进程&#x27;);</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(item.<span class="property">isConnecting</span>)&#123;</span><br><span class="line">            <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;该蓝牙正在连接中...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">isConnecting</span>:<span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title class_">BLEPlxMag</span>.<span class="title function_">connectToDevice</span>(item.<span class="property">id</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">device</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="comment">//发现所需要的服务和特点是只执行一次。 另外 它可以是一个漫长的过程取决于数量的特点和可用的服务。</span></span><br><span class="line">                <span class="keyword">return</span> device.<span class="title function_">discoverAllServicesAndCharacteristics</span>();</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">then</span>( <span class="title function_">async</span>(device) =&gt; &#123;</span><br><span class="line">                <span class="title function_">updateCacheConnectDevice</span>(device);</span><br><span class="line">                <span class="keyword">let</span> objUUID = <span class="keyword">await</span> <span class="title function_">getBlePlxUUID</span>(item.<span class="property">id</span>);</span><br><span class="line">                <span class="keyword">if</span>(objUUID &amp;&amp; device.<span class="property">id</span>)&#123;</span><br><span class="line">                    <span class="title function_">updateCacheConnectDevice</span>(device);</span><br><span class="line">                    <span class="title function_">updateCacheConnectDeviceUUID</span>(device.<span class="property">id</span>,objUUID);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                        <span class="attr">isConnecting</span>:<span class="literal">false</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    item.<span class="property">isConnected</span> = <span class="literal">true</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">onDisconnect</span>(item);</span><br><span class="line">                    <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;设备连接成功&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                        <span class="attr">isConnecting</span>:<span class="literal">false</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    item.<span class="property">isConnected</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;设备连接失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">isConnecting</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">                <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;设备连接失败&quot;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//监听蓝牙断开</span></span><br><span class="line">    onDisconnect = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;btconnectStore&#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">        <span class="title class_">BLEPlxMag</span>.<span class="title function_">onDeviceDisconnected</span>(item.<span class="property">id</span>,<span class="function">(<span class="params">error,device</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(error)&#123;</span><br><span class="line">                <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;蓝牙遇到错误自动断开&quot;</span>);</span><br><span class="line">                <span class="comment">//蓝牙遇到错误自动断开</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;蓝牙已断开&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(device)&#123;</span><br><span class="line">                <span class="title function_">removeCacheConnectDevice</span>(device);</span><br><span class="line">                <span class="title function_">removeCacheConnectDeviceUUID</span>(item.<span class="property">id</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//断开蓝牙设备</span></span><br><span class="line">    _disconnect = <span class="function">(<span class="params">item,index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">BLEPlxMag</span>.<span class="title function_">cancelDeviceConnection</span>(item.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function"><span class="params">device</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="comment">// console.log(&#x27;disconnect success&#x27;,device);</span></span><br><span class="line">           <span class="title function_">removeCacheConnectDevice</span>(device);</span><br><span class="line">           <span class="title function_">removeCacheConnectDeviceUUID</span>(item.<span class="property">id</span>);</span><br><span class="line">           <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;断开连接设备成功&quot;</span>);</span><br><span class="line">       &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">           <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;断开连接异常&quot;</span>);</span><br><span class="line">       &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写入数据</span></span><br><span class="line">    _write = <span class="function">(<span class="params">item,index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">writing</span>)&#123;</span><br><span class="line">            <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;正在写数据中，请稍后再操作...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">writing</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> printArr = [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">initClear</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">2</span>,</span><br><span class="line">                    <span class="attr">values</span>:<span class="string">`静女其姝，俟我于城隅。爱而不见，搔首踟蹰。静女其娈，贻我彤管。彤管有炜，说怿女美。自牧归荑，洵美且异...`</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//打印二维码</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">imgBefore</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">3</span>,</span><br><span class="line">                    <span class="attr">values</span>:&#123;</span><br><span class="line">                        <span class="attr">content</span>:<span class="string">&quot;我是二维码&quot;</span>,</span><br><span class="line">                        <span class="attr">size</span>:<span class="number">280</span>,</span><br><span class="line">                        <span class="attr">logo</span>:<span class="string">&quot;&quot;</span><span class="comment">//可选</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">initClear</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">imgBefore</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">4</span>,</span><br><span class="line">                    <span class="attr">values</span>:&#123;</span><br><span class="line">                        <span class="attr">base64Str</span>:<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJUAAACACAYAAAACuStnAAAQGElEQVR4Xu1de5QcVZn/fVU9M0nIzHT1giDCkky6mlUWFYHFx1EDuonIKkd5qFFmCQEzUz3JIZHIIq/wFNlg1EzXJJDwyAH2nCAicJBVUBf1nM3ReHRxF3a7esIrG0ggXT15kHl017enOpnZSTIzfav7Vk9P+taf09/3u9/3q99U3773q+8SxrqYKdqT+QIx5hPhHAbPJlBsTFv1x3pjYCczPeiRt67PSmwdK3k6/I/Gmt7TSS+sB+jv6o0tla84AwwwMT+xX+Ol+ztP/d/RnoeIyuju/Txp3uMAponDK8u6ZoCxg0mf51ptLw7zMCKq1pRzsUbYRMART6+6Jk0lX5oB5u2DmnbG3s74Tt+4KKBoj3MGMf5AgF4aQVkoBo5kgBlPu0nziyOiMlLOs0T4nCJLMVAJAx7hI7lO8080Y83rJ07TBw6ZaFUCrHzrmAHGhmzSvJIM20kS0F3HVKjUZTHA2JFNmidQLOWsB2GRLFyFU98MZPV4I8Vs518BzK9vKlT2shjINhVayEilXyCiT8kCVTj1zQDrWlSJqr41ID17JSrplCpAJSqlAekMKFFJp1QBKlEpDUhnQIlKOqUKUIlKaUA6A0pU0ilVgEpUSgPSGVCikk6pAlSiUhqQzoASlXRKFaASldKAdAaUqKRTqgCVqJQGpDOgRCWdUgUYuqiY+c9E5IBpOwMDAL8P4FNA9DH1OtjRKcCQRMVvMqibKfJornP2q2NR12q/ZugYvIgZS4lw+tFJb31mJVtU/Qxc4+rxe7GYhkQpjdrOFzXGvSAcL+qj7GqXAYmi4jc9ogv8FwnLSbfVTrfpwG8Ael85/sqndhiQJap380wf2p2MZypJLdq99RTS8lsIdGwlOMp3chmQIyoPX8l2mZtkpNK6tvcsveD9BoTpMvAURvUZqFxUzE9kk4kvyww9ZjvLAdwjE1NhVY+BikTF4CHoetxdPOd1qSGv4wYjn3mJCHGpuAqsKgxUJCoAj2Ut89IwIo32pJdqTD8MA1thhstARaJi5gVuMvEvYYQ4Y92r751WGNoeBrbCDJeBikQ10KCfsO+qth1hhRiznTQAMyx8hRsOA2WLipnzbjLREE5YB1CNlPMrIpwb5hgKWz4DZYsKjG3ZpHmy/JD+H9FIpR8loq+FOYbCls9A2aJi8DuulThOfkijRGU7TxJQ7CGprqnDQAWiArudcR1EHFa6sVT69yA6Oyz8auEy8AYxdoBwVrXGnMxxyhaVH3Sh0NDWt2TWK6EksIl1453MLgJaQ8GvHqjTX2ia++6uk9+KHucs0YA7QHRM9Yav/kgViYrBna6VWBtG2NEeZ67G+HUY2NXCZPCLeW/GeXu6Tto1PGbsR85JHOG1BLqgWnFUe5yKRAXm57LJxLwwgjbsTA+BO8LArhLmH5HHedml5u6xxmvtSV+kM9YA9N4qxVO1YSoTFYDhvtkyIz5YreAQKNQlC5kxj8Zi8G/dmS3no/2EfRONEfuR08IR3AWg42g6ZaNiUQHYnO2Mf1zmhN1IpZ8hos+HddPDxGXgWTePL2GpOSA6Tsx2Pgrm+0H0flGfWraTISoweJVrJVbISNRIORYRUjKwJgHjsezO+AKspHzgsf1N9EJmBRg3EaEpsH8NOUgRlZ+PjEl7tDv9KdLw/JT82mPcn7XiV1b6xPYrYDWm9VN5J0GaqIrCYlriJuNlnRwRtdMLiXEvEUVq6J9ONJQfZC1zmaixiF3UzvwjgVcTYIjY15KNVFEVE2N+sOA13iq6ftXa3fsZjbzrp/B/5q1Zy7w5jJvavO5/jo3ktXuI0B4GfliY8kVV1BU8AE+D8GPK46lDflZ//43pRtPgmYB3AQiXEDAnrOTCxvWAZTnL/IHIOMUyaa9wYdZK3ChiP9ommsqcS+StJ1BbUN/JsA9FVKMTKR6JCrzNzNsB8s8SPI0I2mQkK2tMPycmXJnrNO8XwTz46+75gyvpDoD2rGVuFvEdsXnglWnG/vyNYP52rU8RQhdVIOKmgLFf8kNEC7KW+ZhIuP7Xu06e/9Q+5EUOZl7nTvNWYNHf7BHBGbaZmUq/vxG0sZb3EZWoAtxRZgyA6EuuFX9WxM2wM+cT+Gfj2jJv9zStK9cZf0IEb8SGmYy1mQ5i/h5AzYF8q2CsRCVKMmM/kz7ftdp+K+ISs51LAAi9tsbgZwb0xqveXTzrTRHsYZsDJdeD/lbPRUH8wrZVohJhmLEbhPmi86Boj3OFxtggAj1sw0AfmK91k4l1Qfx8W8PuvYDYWwvCSUF9w7CvKVEx4z4CzwLR34eRbDmYzLwLFDnPtdpeFPE3epxOYtgituPYbM5rWvvujjn+hF78Su2cGcPu25l46WTvI9aEqJjxGki/zP9q8TdZofPmmtgHY96e1/W5ojfYSGWuJ+LbxZUwvqXHfFMumbgtKJa/dKF53gME/G1QX1n2kyoqfz2LQGuyA03XYfnJ+4eTOlhz9KfJ7KnAzK8gos8VfVE2ZjurAVwt68YUcZhfLuh6e1/HnC2BcDexHnu7dxnAt05G+4DJFJVT0LQF4xE2yT0VXhokOndvZ3ynyM00bMcmoFPEthwbZnS7zc3/VKqU5nBsv4RIo4LfoimUmrfxcqm6qPx1HoBWuccN3oxLTxuciGSjJ/0PYHqqmnMEv1qTBxo+nVs2OyciACPlPEyEr4vYVmTD2MakdbjWnGeC4hg9ma8Ss/+293uC+pZjX1VRMfCfKGgL3CVz/iIarGGnVxDoblH7Cu02I4/541VrHo4dsx1/ycBfOqjaxYxNQxotEX2KDgfmdy4kDN6tAVeGHWxVRMXgQQZuyx1rfheXUiFoUjHb8bdDFgb1C2TP/MvswPQvjJ7bTfgUtZ2fEXB+oDEkGTPgMuEa0W2i0cMa9tZPEgr+ckdob36HLyrGlryuLRD9BTUm7wferPklAZ+WdF8OgWHGk24kfolQS8nvvzE91rT/aRB9JoxYgmD6ZcsecHmfldgaxA+b/qsxtqvxOmb+DoEaA/kKGIcnKsZ+EG7IdsZXV1q45ucR1lIDMx5x3463YyX5lRUTXsUYIvg5gI+Wsq3i5/3MuMVNmn6te6CrZW2vqXuFDQT6ZCDHEsZhiWqz5+lfzXW1vSYzWOlLDQGqNaOrX4lS09ALBPqgzJxkYTHjLwxuzyUTfw6EyUyxnswiBlbJesdSsqh4DxNd63bE1wZ9OvkdinOW+VQpQiQuNQhXa87sybynwWO/WchppeKb7M89xj25gWk3is4Nh+M95r6txzcO5lfL6F0hTVTM+DUV0J5dam4LQuyMNa+f2KQPrPcnvaIvUFS61MBMN7jJ+B0icRbj0/p/R0SzRexrwcbfofCAb/YlzV8Ejac15czT4Jd145SgvsP2FYuq+EsEtCxnxR8KGkQslbkK4FUgtAz7euArclbigVJY5Sw1+MV1ICTdTrOnFL7/eeuaV2dr+tC/EfDXIva1ZuPPF/MR7+o9i099J1Bs67bPMAp7VwK0vJxTOSoSlV+yMUTaFUHXTGKpzMlMvJGAuWMl6wFzc5b5Qikigiw1HCxxbneT5iOlcP3P/UlsxPN+V60FQ5GYyrHxN8QZ2vJcMr4xqL+xpvd0aIWNRPThIL7lisrfvugSrX4cHZCRynQRvLsmbFLB2J3XtbNKLkMILjX4q/jMdHGuy3xShBzD3vpBcP5XRPRXIvZTwcafnjDrCwP/eFrJWvR4p0vzcKdoY5HAomLgYQ+NS/usU9wgZLakMnGd+EECPiHix+BXPTR9pNQ4pZYaglZrHqgnx89HfyWLxDtFbN4F083ZZHxV0HiDNBYJICp+s8B0eTmTv1gq8y2Abwu6Y86Mf3eT5sdLETDuUgPzPqbI+aLVmsXVZi74gjqqDwbwTzaDp7cH2S4bvgcijUWEROUXz7nTCt8KWqTfbG89tYHzD4HonFLCGO9zBh51LbPkhu3hSw3MyHlEn+2z4n8UGbtkPbkIyBSzYaa73YGmlUGXH4qNRXR8F4TOsTb7JxTV6OK5oHwZtvMd8ht8Sbg88I05K1Gy+G3UUsPb0HButsN8SWT4aLdzoabhpyK2R5uNf48ZtDCXjAfuBTZeY5ExRTVe8ZwIobFu5zTW+BECfUjEXtSmQHxxX2fi8VL2MTvzzUIh8pzoG9JGyvk6ER4uhXvUf+6/WU5Ny0vNYY/g4UBjkWvAuHm4schYopqweG4icmO2cwuAm8K6AQVNOztwFeQEwZTzgkJYudUI7k5mvrqcAxdGNxYZERUAv8fUP7vHDq4sVTx3OAGtduZMjfmhsLcx/I7IlKczgq7aj3XDorZztQb4JcDqOpwBxi9QwKJyeI72OJfljmn+CRm2042Ctq6cXwOG7dxFwLVVuzPML2ebW84OWlo7Or5YKnMriAP3NKhajrUwEPNeD7ghl0yUdT4QlZNDS3f6nIiGhwA6tRz/inwq6DUadj15RXnVojNjyyC4fW8y8XKQ8IKJqlik1n8HCFL7MQUJ2LdloMe1TCuIXyzlbADhiiA+yvYAAwzc6Vrm9aJ8CIvK6Ml8Auw9TKBZouBh2gVpsjYZ9eRh5j4Z2AzeCkQuF1lMLi2qjW8dY+zZczcRAj0ZqpF4QeN5fR2J5yYay0g5PyXChdWIpx7G8BfDEdFWuIvn9I2X74SiarV7P6vBu5+AUA83KvtmMO8bBM4e7zs/lkr7faEmvZ687Pxq1ZHxVgFY0pc0fzxWiGOLasN/N8f69dUgLKrVvEbiYmwbinhnHFI35D9d9+5+Vnb9dc1zUeUAx+tYc4Soivtg7K0H0YlVjrH84RhbskmzeDiSX0+uNeWfB3Bm+YDKU5gBxm4GrnOT5khjkhFRtax/I6YP9v+QgG8IA9aUIT8+pHNHQ0HzC/w+UFOh1UcwIx1riqKKpnq/rJHnl9lW5dXosDj2qxOIEA0LX+GWZiA7s3kmhdKxpPTYyuJoZSCPVn+bxi/uD+Xt36OVN5XXBAwoUSl5SGdAiUo6pQpQiUppQDoDSlTSKVWASlRKA9IZUKKSTqkCVKJSGpDOgBKVdEoVoBKV0oB0BpSopFOqAJWolAakM6BEJZ1SBahEpTQgnQElKumUKkAlKqUB6QwoUUmnVAEqUSkNSGdAiUo6pQpQiUppQDoDSlTSKVWASlRKA9IZUKKSTqkCVKJSGpDOgBKVdEoVoBKV0oB0BpSopFOqAJWolAakM+CLKpZy/EN+5kkHV4B1yUCx64thO/6BjpfVJQMqaekMZC2TfFFdR8Cd0tEVYN0xwOD/cK3Eh+ng0a7pumNAJSydgeFDz4ud9NS8Sjq/9QjYP9Cgz9p3VduOoqiKhzB63h/qkQmVsywG+PaslSie+TPSSFbmwY+ywlQ4U4UB/n3WSoycQHtIy2sj5awhQtdUSUXFWQMMMLYM8fTP7ek6addwNEf2UU+lFxPoFhCOr4GQVQi1y0A/g+9zpzd8Gwtn948Oc9xjRAzb+QYYFhE+Vrt5qciqzgBjGwOpfMRbf8gpG6MC+T9XMACZS/5RSwAAAABJRU5ErkJggg==&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">nextOneLinePaper</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="attr">values</span>:blePlxCommands.<span class="property">cutHalfPaper</span></span><br><span class="line">                &#125;</span><br><span class="line">            ];</span><br><span class="line">            <span class="title function_">convertPrintImage</span>(printArr).<span class="title function_">then</span>(<span class="function">(<span class="params">rows</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> writePromises = <span class="title function_">bleplxPrintTaskDeal</span>(item.<span class="property">id</span>,rows);</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">all</span>(writePromises).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">writing</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">                    <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;打印完成&quot;</span>)</span><br><span class="line">                &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">writing</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">                    <span class="title class_">XToast</span>.<span class="title function_">show</span>(<span class="string">&quot;打印任务失败&quot;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Android部分代码"><a href="#Android部分代码" class="headerlink" title="Android部分代码"></a><code>Android</code>部分代码</h3><p>对打印图片的数据进行处理</p>
<p>Android原生代码<code>BlePlxPrint.java</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xx.yy.print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.Arguments;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.Promise;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactContext;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactContextBaseJavaModule;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactMethod;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReadableArray;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReadableMap;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReadableType;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.WritableArray;</span><br><span class="line"><span class="keyword">import</span> com.facebook.react.bridge.WritableMap;</span><br><span class="line"><span class="keyword">import</span> com.xx.yy.utils.BaseUtil;</span><br><span class="line"><span class="keyword">import</span> com.xx.yy.utils.PictureUtils;</span><br><span class="line"><span class="keyword">import</span> com.xx.yy.utils.QRCodeUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2018/11/19.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlePlxPrint</span> <span class="keyword">extends</span> <span class="title class_">ReactContextBaseJavaModule</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ReactContext reactContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BlePlxPrint</span><span class="params">(ReactApplicationContext reactContext)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(reactContext);</span><br><span class="line">        <span class="built_in">this</span>.reactContext = reactContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * return string 这个名字在JavaScript端标记这个模块</span></span><br><span class="line"><span class="comment">     * 这样就可以在JavaScript中通过React.NativeModules.ToastForAndroid访问到这个模块</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BlePlxPrint&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canOverrideExistingModule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回打印图片的字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type=3=qrcode type=4=img type=5=barcode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> WritableArray <span class="title function_">ConvertPrintToImage</span><span class="params">(<span class="type">int</span> type ,ReadableMap map)</span>&#123;</span><br><span class="line">        <span class="type">byte</span>[] imgByte = &#123;&#125;;</span><br><span class="line">        <span class="type">WritableArray</span> <span class="variable">jsArr</span> <span class="operator">=</span> Arguments.createArray();</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">qrCodeContent</span> <span class="operator">=</span> map.getString(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">qrCodeSize</span> <span class="operator">=</span> map.getInt(<span class="string">&quot;size&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span>( map.hasKey(<span class="string">&quot;logo&quot;</span>) &amp;&amp; !TextUtils.isEmpty(map.getString(<span class="string">&quot;logo&quot;</span>)))&#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">logo</span> <span class="operator">=</span> map.getString(<span class="string">&quot;logo&quot;</span>);</span><br><span class="line">                        <span class="type">Bitmap</span> <span class="variable">bitmapLogo</span> <span class="operator">=</span> PictureUtils.base64StringToBitmap(logo);</span><br><span class="line">                        bitmap = QRCodeUtil.createQRCodeBitmap(qrCodeContent,qrCodeSize,bitmapLogo,<span class="number">0.2f</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        bitmap = QRCodeUtil.createQRCodeBitmap(qrCodeContent,qrCodeSize);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> map.getString(<span class="string">&quot;base64Str&quot;</span>);</span><br><span class="line">                    bitmap = PictureUtils.base64StringToBitmap(base64Str);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">barCodeContent</span> <span class="operator">=</span> map.getString(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">barCodeWidth</span> <span class="operator">=</span> map.getInt(<span class="string">&quot;width&quot;</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">barCodeHeight</span> <span class="operator">=</span> map.getInt(<span class="string">&quot;height&quot;</span>);</span><br><span class="line">                    bitmap = QRCodeUtil.createBarCodeBitmap(barCodeContent,barCodeWidth,barCodeHeight);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">base64Value</span> <span class="operator">=</span> map.getString(<span class="string">&quot;base64Str&quot;</span>);</span><br><span class="line">                    imgByte = Base64.decode(base64Value, Base64.DEFAULT);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(bitmap != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//拼接字节数组</span></span><br><span class="line">                <span class="type">byte</span>[] draw2PxPoint = PictureUtils.draw2PxPoint(bitmap);</span><br><span class="line">                imgByte = BaseUtil.byteMergerAll(draw2PxPoint);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;imgByte.length;i++)&#123;</span><br><span class="line">                    jsArr.pushInt(imgByte[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(type == <span class="number">6</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;imgByte.length;i++)&#123;</span><br><span class="line">                    jsArr.pushInt(imgByte[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jsArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换打印数据处理其中的图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> WritableArray <span class="title function_">getConvertData</span><span class="params">(ReadableArray rows)</span>&#123;</span><br><span class="line">        <span class="type">WritableArray</span> <span class="variable">writeArray</span> <span class="operator">=</span>  Arguments.createArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;rows.size() ;i++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">ReadableMap</span> <span class="variable">readMap</span> <span class="operator">=</span> rows.getMap(i);</span><br><span class="line">            <span class="type">Bundle</span> <span class="variable">bundle</span> <span class="operator">=</span> Arguments.toBundle(readMap);</span><br><span class="line">            <span class="type">WritableMap</span> <span class="variable">writeMap</span> <span class="operator">=</span> Arguments.fromBundle(bundle);</span><br><span class="line">            <span class="type">WritableArray</span> <span class="variable">jsArr</span> <span class="operator">=</span> Arguments.createArray();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> readMap.getInt(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">            <span class="type">ReadableType</span> <span class="variable">valuesType</span> <span class="operator">=</span> readMap.getType(<span class="string">&quot;values&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (valuesType) &#123;</span><br><span class="line">                <span class="keyword">case</span> Null:</span><br><span class="line">                <span class="keyword">case</span> Boolean:</span><br><span class="line">                <span class="keyword">case</span> String:</span><br><span class="line">                <span class="keyword">case</span> Array:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Map:</span><br><span class="line">                    <span class="type">ReadableMap</span> <span class="variable">values</span> <span class="operator">=</span> readMap.getMap(<span class="string">&quot;values&quot;</span>);</span><br><span class="line">                    jsArr = ConvertPrintToImage(type,values);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Could not convert object in Map.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            writeMap.putArray(<span class="string">&quot;byte&quot;</span>,jsArr);</span><br><span class="line">            writeArray.pushMap(writeMap);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> writeArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回打印图片的字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type=3=qrcode type=4=img type=barcode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> promise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ReactMethod</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getPrintImageByte</span><span class="params">(<span class="type">int</span> type, ReadableMap map, Promise promise)</span>&#123;</span><br><span class="line">        <span class="type">WritableArray</span> <span class="variable">jsArr</span> <span class="operator">=</span> ConvertPrintToImage(type,map);</span><br><span class="line">        promise.resolve(jsArr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换数据到新字段，并加入新字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> promise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ReactMethod</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getSingleConvertData</span><span class="params">(ReadableArray rows,Promise promise)</span>&#123;</span><br><span class="line">        <span class="type">WritableArray</span> <span class="variable">writeArray</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(rows != <span class="literal">null</span>)&#123;</span><br><span class="line">            writeArray = getConvertData(rows);</span><br><span class="line">        &#125;</span><br><span class="line">        promise.resolve(writeArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图片工具:</p>
<p><code>PictureUtils.java:</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xx.yy.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2018/11/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PictureUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把一张Bitmap图片转化为打印机可以打印的bit</span></span><br><span class="line"><span class="comment">     * 效率很高（相对于下面）</span></span><br><span class="line"><span class="comment">     * 传进去</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] draw2PxPoint(Bitmap bit) &#123;</span><br><span class="line">        <span class="type">int</span> nL;</span><br><span class="line">        <span class="type">int</span> nH;</span><br><span class="line">        <span class="type">int</span> yRow;</span><br><span class="line">        <span class="type">int</span> byteSum;<span class="comment">//总字节数</span></span><br><span class="line"></span><br><span class="line">        yRow = (<span class="type">int</span>) Math.ceil(bit.getHeight()/<span class="number">24</span>);</span><br><span class="line">        byteSum = yRow*<span class="number">3</span>*bit.getWidth() + <span class="number">5</span>*yRow+yRow;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 分辨率大于256时</span></span><br><span class="line"><span class="comment">         * n1=分辨率/256取余（n1%256）</span></span><br><span class="line"><span class="comment">         * n2=除得的整数</span></span><br><span class="line"><span class="comment">         * 分辨率小于256时</span></span><br><span class="line"><span class="comment">         * n1=自身</span></span><br><span class="line"><span class="comment">         * n2=0</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span>(bit.getWidth()&lt;<span class="number">256</span>)&#123;</span><br><span class="line">            nL = bit.getWidth();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nL = bit.getWidth()%<span class="number">256</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(bit.getHeight()&lt;<span class="number">256</span>)&#123;</span><br><span class="line">            nH = <span class="number">0x00</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nH = (<span class="type">int</span>) Math.floor(bit.getHeight()/<span class="number">256</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[byteSum];</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//对于每一行，逐列打印</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; yRow; j++) &#123;</span><br><span class="line">            <span class="comment">//选择位图模式</span></span><br><span class="line">            data[k++] = <span class="number">0x1B</span>;</span><br><span class="line">            data[k++] = <span class="number">0x2A</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *  m=33时，选择24点双密度打印，分辨率达到200DPI。</span></span><br><span class="line"><span class="comment">             *  如果m的值超出了指定的范围，那么nL和之后的数据被当作常规数据处理。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            data[k++] = <span class="number">33</span>; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 位图的点数由 nL和 nH指定</span></span><br><span class="line"><span class="comment">             * nL和 nH表示水平方向上位图中的点数。通过nL+ nH´ 256计算出点数。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            data[k++] = (<span class="type">byte</span>) nL;</span><br><span class="line">            data[k++] = (<span class="type">byte</span>) nH;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * d表示位图数据。设置相应的位为 1去打印某点，或设置为 0以不打印某点。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bit.getWidth(); i++) &#123;</span><br><span class="line">                <span class="comment">//每一列24个像素点，分为3个字节存储</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0</span>; m &lt; <span class="number">3</span>; m++) &#123;</span><br><span class="line">                    <span class="comment">//每个字节表示8个像素点，0表示白色，1表示黑色</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>; n &lt; <span class="number">8</span>; n++) &#123;</span><br><span class="line">                        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> px2Byte(i, j * <span class="number">24</span> + m * <span class="number">8</span> + n, bit);</span><br><span class="line">                        data[k] += data[k] + b;</span><br><span class="line">                    &#125;</span><br><span class="line">                    k++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//换行</span></span><br><span class="line">            data[k++] = <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片二值化，黑色是1，白色是0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x  横坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> y     纵坐标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bit 位图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span> <span class="title function_">px2Byte</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Bitmap bit)</span> &#123;</span><br><span class="line">        <span class="type">byte</span> b;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pixel</span> <span class="operator">=</span> bit.getPixel(x, y);</span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (pixel &amp; <span class="number">0x00ff0000</span>) &gt;&gt; <span class="number">16</span>; <span class="comment">// 取高两位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (pixel &amp; <span class="number">0x0000ff00</span>) &gt;&gt; <span class="number">8</span>; <span class="comment">// 取中两位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> pixel &amp; <span class="number">0x000000ff</span>; <span class="comment">// 取低两位</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">gray</span> <span class="operator">=</span> RGB2Gray(red, green, blue);</span><br><span class="line">        <span class="keyword">if</span> ( gray &lt; <span class="number">128</span> )&#123;</span><br><span class="line">            b = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            b = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片灰度的转化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> r</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> g</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> b</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">RGB2Gray</span><span class="params">(<span class="type">int</span> r, <span class="type">int</span> g, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">gray</span> <span class="operator">=</span> (<span class="type">int</span>) (<span class="number">0.29900</span> * r + <span class="number">0.58700</span> * g + <span class="number">0.11400</span> * b);  <span class="comment">//灰度转化公式</span></span><br><span class="line">        <span class="keyword">return</span>  gray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * base64字符串转位图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base64String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">base64StringToBitmap</span><span class="params">(String base64String)</span> &#123;</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Value</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] strArr =base64String.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(strArr.length==<span class="number">1</span>)&#123;</span><br><span class="line">                base64Value = strArr[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(strArr.length==<span class="number">2</span>)&#123;</span><br><span class="line">                base64Value = strArr[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] bitmapArray = Base64.decode(base64Value, Base64.DEFAULT);</span><br><span class="line">            bitmap = BitmapFactory.decodeByteArray(bitmapArray, <span class="number">0</span>, bitmapArray.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回base64字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bitmap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">bitmaptoBase64String</span><span class="params">(Bitmap bitmap)</span> &#123;</span><br><span class="line">        <span class="comment">//将Bitmap转换成字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        bitmap.compress(Bitmap.CompressFormat.PNG, <span class="number">100</span>, bStream);</span><br><span class="line">        <span class="type">byte</span>[] bytes = bStream.toByteArray();</span><br><span class="line">        string = Base64.encodeToString(bytes, Base64.DEFAULT);</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成二维码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xx.yy.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.ColorInt;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.zxing.BarcodeFormat;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.EncodeHintType;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.MultiFormatWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.WriterException;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.common.BitMatrix;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.qrcode.QRCodeWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: QRCodeUtil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 二维码工具类</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2018/11/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QRCodeUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建条形码位图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createBarCodeBitmap</span><span class="params">(<span class="meta">@Nullable</span> String content, <span class="type">int</span> width, <span class="type">int</span> height)</span>&#123;</span><br><span class="line">        <span class="comment">//配置参数</span></span><br><span class="line">        Map&lt;EncodeHintType,Object&gt; hints = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 容错级别 这里选择最高H级别</span></span><br><span class="line">        hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">BitMatrix</span> <span class="variable">bitMatrix</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiFormatWriter</span>().encode(content,BarcodeFormat.CODE_128, width, height, hints);</span><br><span class="line">            <span class="comment">/** 1.根据BitMatrix(位矩阵)对象为数组元素赋颜色值 */</span></span><br><span class="line">            <span class="type">int</span>[] pixels = <span class="keyword">new</span> <span class="title class_">int</span>[width * height];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; height; y++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; width; x++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(bitMatrix.get(x, y))&#123; <span class="comment">// 黑色色块像素设置</span></span><br><span class="line">                        pixels[y * width + x] = Color.BLACK;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 白色色块像素设置</span></span><br><span class="line">                        pixels[y * width + x] = Color.WHITE;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/** 4.创建Bitmap对象,根据像素数组设置Bitmap每个像素点的颜色值,之后返回Bitmap对象 */</span></span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);</span><br><span class="line">            bitmap.setPixels(pixels, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> bitmap;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建二维码位图</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 字符串内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 位图宽&amp;高(单位:px)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createQRCodeBitmap</span><span class="params">(<span class="meta">@Nullable</span> String content, <span class="type">int</span> size)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createQRCodeBitmap(content, size, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;4&quot;</span>, Color.BLACK, Color.WHITE, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0F</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建二维码位图 (自定义黑、白色块颜色)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 字符串内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 位图宽&amp;高(单位:px)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color_black 黑色色块的自定义颜色值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color_white 白色色块的自定义颜色值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createQRCodeBitmap</span><span class="params">(<span class="meta">@Nullable</span> String content, <span class="type">int</span> size, <span class="meta">@ColorInt</span> <span class="type">int</span> color_black, <span class="meta">@ColorInt</span> <span class="type">int</span> color_white)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createQRCodeBitmap(content, size, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;4&quot;</span>, color_black, color_white, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0F</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建二维码位图 (带Logo小图片)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 字符串内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 位图宽&amp;高(单位:px)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoBitmap logo图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoPercent logo小图片在二维码图片中的占比大小,范围[0F,1F]。超出范围-&gt;默认使用0.2F</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createQRCodeBitmap</span><span class="params">(String content, <span class="type">int</span> size, <span class="meta">@Nullable</span> Bitmap logoBitmap, <span class="type">float</span> logoPercent)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createQRCodeBitmap(content, size, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;4&quot;</span>, Color.BLACK, Color.WHITE, <span class="literal">null</span>, logoBitmap, logoPercent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建二维码位图 (Bitmap颜色代替黑色) 注意!!!注意!!!注意!!! 选用的Bitmap图片一定不能有白色色块,否则会识别不出来!!!</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 字符串内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 位图宽&amp;高(单位:px)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetBitmap 目标图片 (如果targetBitmap != null, 黑色色块将会被该图片像素色值替代)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createQRCodeBitmap</span><span class="params">(String content, <span class="type">int</span> size, Bitmap targetBitmap)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createQRCodeBitmap(content, size, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;4&quot;</span>, Color.BLACK, Color.WHITE, targetBitmap, <span class="literal">null</span>, <span class="number">0F</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建二维码位图 (支持自定义配置和自定义样式)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 字符串内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size 位图宽&amp;高(单位:px)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> character_set 字符集/字符转码格式 (支持格式:&#123;<span class="doctag">@link</span> CharacterSetECI &#125;)。传null时,zxing源码默认使用 &quot;ISO-8859-1&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> error_correction 容错级别 (支持级别:&#123;<span class="doctag">@link</span> ErrorCorrectionLevel &#125;)。传null时,zxing源码默认使用 &quot;L&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> margin 空白边距 (可修改,要求:整型且&gt;=0), 传null时,zxing源码默认使用&quot;4&quot;。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color_black 黑色色块的自定义颜色值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color_white 白色色块的自定义颜色值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetBitmap 目标图片 (如果targetBitmap != null, 黑色色块将会被该图片像素色值替代)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoBitmap logo小图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoPercent logo小图片在二维码图片中的占比大小,范围[0F,1F],超出范围-&gt;默认使用0.2F。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">createQRCodeBitmap</span><span class="params">(<span class="meta">@Nullable</span> String content, <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@Nullable</span> String character_set, <span class="meta">@Nullable</span> String error_correction, <span class="meta">@Nullable</span> String margin,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@ColorInt</span> <span class="type">int</span> color_black, <span class="meta">@ColorInt</span> <span class="type">int</span> color_white, <span class="meta">@Nullable</span> Bitmap targetBitmap,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@Nullable</span> Bitmap logoBitmap, <span class="type">float</span> logoPercent)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 1.参数合法性判断 */</span></span><br><span class="line">        <span class="keyword">if</span>(TextUtils.isEmpty(content))&#123; <span class="comment">// 字符串内容判空</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(size &lt;= <span class="number">0</span>)&#123; <span class="comment">// 宽&amp;高都需要&gt;0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/** 2.设置二维码相关配置,生成BitMatrix(位矩阵)对象 */</span></span><br><span class="line">            Hashtable&lt;EncodeHintType, String&gt; hints = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!TextUtils.isEmpty(character_set)) &#123;</span><br><span class="line">                hints.put(EncodeHintType.CHARACTER_SET, character_set); <span class="comment">// 字符转码格式设置</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!TextUtils.isEmpty(error_correction))&#123;</span><br><span class="line">                hints.put(EncodeHintType.ERROR_CORRECTION, error_correction); <span class="comment">// 容错级别设置</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!TextUtils.isEmpty(margin))&#123;</span><br><span class="line">                hints.put(EncodeHintType.MARGIN, margin); <span class="comment">// 空白边距设置</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">BitMatrix</span> <span class="variable">bitMatrix</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QRCodeWriter</span>().encode(content, BarcodeFormat.QR_CODE, size, size, hints);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/** 3.根据BitMatrix(位矩阵)对象为数组元素赋颜色值 */</span></span><br><span class="line">            <span class="keyword">if</span>(targetBitmap != <span class="literal">null</span>)&#123;</span><br><span class="line">                targetBitmap = Bitmap.createScaledBitmap(targetBitmap, size, size, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span>[] pixels = <span class="keyword">new</span> <span class="title class_">int</span>[size * size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; size; y++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; size; x++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(bitMatrix.get(x, y))&#123; <span class="comment">// 黑色色块像素设置</span></span><br><span class="line">                        <span class="keyword">if</span>(targetBitmap != <span class="literal">null</span>) &#123;</span><br><span class="line">                            pixels[y * size + x] = targetBitmap.getPixel(x, y);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            pixels[y * size + x] = color_black;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 白色色块像素设置</span></span><br><span class="line">                        pixels[y * size + x] = color_white;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/** 4.创建Bitmap对象,根据像素数组设置Bitmap每个像素点的颜色值,之后返回Bitmap对象 */</span></span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> Bitmap.createBitmap(size, size, Bitmap.Config.ARGB_8888);</span><br><span class="line">            bitmap.setPixels(pixels, <span class="number">0</span>, size, <span class="number">0</span>, <span class="number">0</span>, size, size);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/** 5.为二维码添加logo小图标 */</span></span><br><span class="line">            <span class="keyword">if</span>(logoBitmap != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> addLogo(bitmap, logoBitmap, logoPercent);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> bitmap;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WriterException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张图片中间添加logo小图片(图片合成)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> srcBitmap 原图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoBitmap logo图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> logoPercent 百分比 (用于调整logo图片在原图片中的显示大小, 取值范围[0,1], 传值不合法时使用0.2F)</span></span><br><span class="line"><span class="comment">     *                    原图片是二维码时,建议使用0.2F,百分比过大可能导致二维码扫描失败。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Bitmap <span class="title function_">addLogo</span><span class="params">(<span class="meta">@Nullable</span> Bitmap srcBitmap, <span class="meta">@Nullable</span> Bitmap logoBitmap, <span class="type">float</span> logoPercent)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 1. 参数合法性判断 */</span></span><br><span class="line">        <span class="keyword">if</span>(srcBitmap == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(logoBitmap == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> srcBitmap;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(logoPercent &lt; <span class="number">0F</span> || logoPercent &gt; <span class="number">1F</span>)&#123;</span><br><span class="line">            logoPercent = <span class="number">0.2F</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 2. 获取原图片和Logo图片各自的宽、高值 */</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">srcWidth</span> <span class="operator">=</span> srcBitmap.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">srcHeight</span> <span class="operator">=</span> srcBitmap.getHeight();</span><br><span class="line">        <span class="type">int</span> <span class="variable">logoWidth</span> <span class="operator">=</span> logoBitmap.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">logoHeight</span> <span class="operator">=</span> logoBitmap.getHeight();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 3. 计算画布缩放的宽高比 */</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">scaleWidth</span> <span class="operator">=</span> srcWidth * logoPercent / logoWidth;</span><br><span class="line">        <span class="type">float</span> <span class="variable">scaleHeight</span> <span class="operator">=</span> srcHeight * logoPercent / logoHeight;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 4. 使用Canvas绘制,合成图片 */</span></span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> Bitmap.createBitmap(srcWidth, srcHeight, Bitmap.Config.ARGB_8888);</span><br><span class="line">        <span class="type">Canvas</span> <span class="variable">canvas</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Canvas</span>(bitmap);</span><br><span class="line">        canvas.drawBitmap(srcBitmap, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">        canvas.scale(scaleWidth, scaleHeight, srcWidth/<span class="number">2</span>, srcHeight/<span class="number">2</span>);</span><br><span class="line">        canvas.drawBitmap(logoBitmap, srcWidth/<span class="number">2</span> - logoWidth/<span class="number">2</span>, srcHeight/<span class="number">2</span> - logoHeight/<span class="number">2</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用注意"><a href="#使用注意" class="headerlink" title="使用注意"></a>使用注意</h3><ul>
<li><p>有些设备使用蓝牙连接的时候木有出现 <strong>配对</strong> 这个过程，而且连接成功了，这个是正确的。</p>
</li>
<li><p>官方的此方法只接受<code>base64</code>格式的值</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">BLEPlxMag</span>.<span class="title function_">writeCharacteristicWithResponseForDevice</span>(deviceId,serviceUUID,characteristicUUID,base64Value)</span><br></pre></td></tr></table></figure></li>
<li><p>分包，数据如果过多必须进行分包处理、分包大小取决设备</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">toWrite = iconv.<span class="title function_">encode</span>(item.<span class="property">values</span>, <span class="string">&#x27;GBK&#x27;</span>);</span><br><span class="line">packetCount = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(toWrite.<span class="property">length</span> / packetSize);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; packetCount; i++) &#123;</span><br><span class="line">    packet = <span class="keyword">new</span> <span class="title class_">Buffer</span>(packetSize)</span><br><span class="line">    toWrite.<span class="title function_">copy</span>(packet, <span class="number">0</span>, i * packetSize, (i + <span class="number">1</span>) * packetSize)</span><br><span class="line">    base64Value = packet.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    writePromises.<span class="title function_">push</span>(<span class="title function_">blePlxWrite</span>(id,base64Value))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2><p>低功耗蓝牙通信数据慢、过程比较繁琐</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://github.com/Polidea/react-native-ble-plx">react-native-ble-plx</a></li>
<li><a href="https://wenku.baidu.com/view/187b1ad5690203d8ce2f0066f5335a8102d266a9">热敏打印机指令集</a></li>
</ol>
]]></content>
      <categories>
        <category>react-native</category>
      </categories>
      <tags>
        <tag>react-native</tag>
      </tags>
  </entry>
  <entry>
    <title>underscore模版</title>
    <url>/2015/12/31/underscore%E6%A8%A1%E7%89%88/</url>
    <content><![CDATA[<h2 id="Underscore"><a href="#Underscore" class="headerlink" title="Underscore"></a>Underscore</h2><p>Underscore一个JavaScript实用库，提供了一整套函数式编程的实用功能，但是没有扩展任何JavaScript内置对象。</p>
<ul>
<li>Underscore提供了100多个函数，包括each、map、reduce、 reduceRight、等</li>
<li>还有辅助函数，函数绑定、JavaScript模板功能、强类型相等测试、创建快速索引等</li>
</ul>
<p>英文地址：<a href="http://underscorejs.org/">http://underscorejs.org/</a><br>中文地址：<a href="http://www.bootcss.com/p/underscore/">http://www.bootcss.com/p/underscore/</a></p>
<span id="more"></span>

<h2 id="Underscore模版的使用"><a href="#Underscore模版的使用" class="headerlink" title="Underscore模版的使用"></a>Underscore模版的使用</h2><p>1、视图层展示</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;wrap&quot;</span>&gt;&lt;/div&gt;//容器</span><br><span class="line"></span><br><span class="line">&lt;script <span class="built_in">id</span>=<span class="string">&quot;template&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/template&quot;</span>&gt;</span><br><span class="line">&lt;h2&gt;&lt;%= title %&gt;&lt;/h2&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;% _.each(peoples,<span class="keyword">function</span>(item)&#123; %&gt;</span><br><span class="line">    &lt;li&gt;姓名：&lt;%= item.name %&gt;-------描述:&lt;%= item.des %&gt; -----------钱：&lt;%= item.money %&gt;&lt;/li&gt;</span><br><span class="line">&lt;% &#125;); %&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;underscore-min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2、数据填充</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var data = &#123;</span><br><span class="line">    title:<span class="string">&#x27;金钱排行榜&#x27;</span>,</span><br><span class="line">    peoples:[</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主1号&#x27;</span>,des:<span class="string">&#x27;拥有500万土地&#x27;</span>,money:<span class="string">&#x27;250&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主2号&#x27;</span>,des:<span class="string">&#x27;拥有600万土地&#x27;</span>,money:<span class="string">&#x27;360&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主3号&#x27;</span>,des:<span class="string">&#x27;拥有800万土地&#x27;</span>,money:<span class="string">&#x27;390&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主4号&#x27;</span>,des:<span class="string">&#x27;拥有1000万土地&#x27;</span>,money:<span class="string">&#x27;2000&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主5号&#x27;</span>,des:<span class="string">&#x27;拥有500万土地&#x27;</span>,money:<span class="string">&#x27;1050&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主6号&#x27;</span>,des:<span class="string">&#x27;拥有200万土地&#x27;</span>,money:<span class="string">&#x27;40&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主7号&#x27;</span>,des:<span class="string">&#x27;拥有10万土地&#x27;</span>,money:<span class="string">&#x27;100&#x27;</span>&#125;,</span><br><span class="line">        &#123;name:<span class="string">&#x27;地主8号&#x27;</span>,des:<span class="string">&#x27;&#x27;</span>,money:<span class="string">&#x27;1000&#x27;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line">var wrap = document.getElementById(<span class="string">&#x27;wrap&#x27;</span>);</span><br><span class="line">    tpl = document.getElementById(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">var <span class="built_in">source</span> = tpl.innerHTML;</span><br><span class="line">var render = _.template(<span class="built_in">source</span>);</span><br><span class="line"></span><br><span class="line">var sortResults = _.sortBy(data.peoples,<span class="keyword">function</span>(item)&#123;</span><br><span class="line">    <span class="built_in">return</span> -item.money;//hight-&gt;low :+item.money</span><br><span class="line">&#125;);</span><br><span class="line">data.peoples = sortResults;</span><br><span class="line">var html = render(data);</span><br><span class="line">wrap.innerHTML = html;</span><br></pre></td></tr></table></figure>

<p>3、UI展示</p>
<img src="/2015/12/31/underscore%E6%A8%A1%E7%89%88/und_pic.png" class="" title="UI-结果">

<h2 id="默认模板标签"><a href="#默认模板标签" class="headerlink" title="默认模板标签"></a>默认模板标签</h2><ol>
<li>&lt;%  %&gt; ：包含JavaScript代码，代码将在渲染数据时被执行</li>
<li>&lt;%&#x3D; %&gt; : 用于输出数据，可以是一个变量、某个对象的属性、或函数调用（将输出函数的返回值）</li>
<li>&lt;%- %&gt; : 用于输出数据，同时会将数据中包含的HTML字符转换为实体形式</li>
</ol>
<h2 id="修改模版标签"><a href="#修改模版标签" class="headerlink" title="修改模版标签"></a>修改模版标签</h2><p>通过templateSettings来修改模版标签，如下:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">_.templateSettings = &#123;  </span><br><span class="line">    evaluate : /\&#123;%([\s\S]+?)\%\&#125;/g,  </span><br><span class="line">    interpolate : /\&#123;%=([\s\S]+?)\%\&#125;/g,  </span><br><span class="line">    escape : /\&#123;%-([\s\S]+?)%\&#125;/g  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">设置后的标签</span><br><span class="line">&lt;%  %&gt; =&gt; &#123;%  %&#125;</span><br><span class="line">&lt;%= %&gt; =&gt; &#123;%= %&#125;</span><br><span class="line">&lt;%- %&gt; =&gt; &#123;%- %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解析模版"><a href="#解析模版" class="headerlink" title="解析模版"></a>解析模版</h2><p>模版执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//获取模版内容</span><br><span class="line">var <span class="built_in">source</span> = tpl.innerHTML;</span><br><span class="line"></span><br><span class="line">//解析模版</span><br><span class="line">var render = _.template(<span class="built_in">source</span>);</span><br><span class="line">var html = render(data);</span><br><span class="line"></span><br><span class="line">//解析后的内容填充到dom节点</span><br><span class="line">wrap.innerHTML = html;</span><br></pre></td></tr></table></figure>

<h2 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h2><p>然而这是underscore中自带的模版功能，而它的强大之处，在于提供的100多个函数，里面包括了:</p>
<ul>
<li>集合(each、map、find…)</li>
<li>数组(first、last、rest…)</li>
<li>函数(bind、bindAll、delay…)</li>
<li>对象(keys、allKeys、mapObject…)</li>
<li>功能(random、times、noConflict、template…)</li>
<li>支持链式语法</li>
<li>……</li>
</ul>
<p>十分有用,Gzip压缩后5.7kb</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>rn蓝牙打印2</title>
    <url>/2018/12/27/rn%E8%93%9D%E7%89%99%E6%89%93%E5%8D%B02/</url>
    <content><![CDATA[<h2 id="rn蓝牙打印2"><a href="#rn蓝牙打印2" class="headerlink" title="rn蓝牙打印2"></a>rn蓝牙打印2</h2><p>本文是 <strong>rn蓝牙打印</strong> 的补充</p>
<p>上一篇文章里面主要说了蓝牙打印用<code>ESC</code>指令，这一篇补充一下<code>TSC</code>指令</p>
<p>以下大部分代码来源于佳博<code>SDK</code></p>
<span id="more"></span>

<h2 id="测试代码执行入口"><a href="#测试代码执行入口" class="headerlink" title="测试代码执行入口"></a>测试代码执行入口</h2><ul>
<li>测试发送<code>TSC</code>数据</li>
<li>测试发送<code>ESC</code>数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xx.yy.gpbt;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.app.MainActivity;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.app.R;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.utils.BaseUtil;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.utils.PictureUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2018/12/14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GpPrint</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试发送TSC数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] sendTSCData() &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> <span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAEECAIAAABBat1dAAAD+UlEQVR4nO3dwY7TMBRA0Rbx/788bK5GiAUOsmWc9Jw1omk6V948Pb+/vr5ewOv1438/AJxCDBAxQMQAEQNEDBAxQMQAEQNEDJCfw3/xfr83PMch9gynDF/pIY/xJFdeqZMBIgaIGCBigIgBIgaIGCBigIgBIgbIeBxj6Eb7Ne4ygHDIvMan/bJOBogYIGKAiAEiBogYIGKAiAEiBogYIAvGMYb2DEGcMzswP0wx/B+uvNInrdjY812cDBAxQMQAEQNEDBAxQMQAEQNEDBAxQMQA2TGb9GnmR4/4L5wMEDFAxAARA0QMEDFAxAARA0QMEDFAjGP8myU7Ws7ZasPvnAwQMUDEABEDRAwQMUDEABEDRAwQMUB2jGM8afrgkOtwznml5zzJPCcDRAwQMUDEABEDRAwQMUDEABEDRAwQMUAWzCZ91D00S1bFzI8eLXmMoY/6ZV9OBvgmBogYIGKAiAEiBogYIGKAiAEiBsh4HONJu0D2uMsUg1/2D04GiBggYoCIASIGiBggYoCIASIGiBggO27uWTKesGR24C6DEkNX3sb8l13yKTca+nAyQMQAEQNEDBAxQMQAEQNEDBAxQMQAEQPkveSSmL87Z6xow506VzxmROq16JKhDa78cE4GiBggYoCIASIGiBggYoCIASIGiBggC8YxDtkFcs5CmnmHfJdDHmMbJwNEDBAxQMQAEQNEDBAxQMQAEQNEDJDb3NyzxI1GA+bNz9HseV17/jxsx4B/IAaIGCBigIgBIgaIGCBigIgBIgbIeBxjz20Uez5lfkLh0xZGDB2yPGXJpzgZIGKAiAEiBogYIGKAiAEiBogYIGKAiAEyvrmH312ZTTrklc6PUS35Ijea5nIyQMQAEQNEDBAxQMQAEQNEDBAxQMQAGa+KOefenQ0OuavmRhtrDvnzWLKxxskAEQNEDBAxQMQAEQNEDBAxQMQAEQNkPI4xdMgyiCv2LIzYMG2xZ5Liyqcc8l2WcDJAxAARA0QMEDFAxAARA0QMEDFAxAARA2TBbNLQnm0i54y4HPIkexbSzH/ZQ5bNvJwM8E0MEDFAxAARA0QMEDFAxAARA0QMkB3jGE+yZEJhfgDhnBGGJ91C5GSAiAEiBogYIGKAiAEiBogYIGKAiAFiHONEe/ZrnDPTMbTnhTgZIGKAiAEiBogYIGKAiAEiBogYIGKAiAGyYzbpkJtslljyXQ7ZnrLnMfZMQM1vrHk5GeCbGCBigIgBIgaIGCBigIgBIgaIGCALxjFutHFkjyWjAXd5jPn/xM09cBwxQMQAEQNEDBAxQMQAEQNEDBAxQN5PWl0BM5wMEDFAxAARA0QMEDFAxAARA0QMEDFAxAD5BVn2+wfjFK/cAAAAAElFTkSuQmCC&quot;</span>;</span><br><span class="line">        <span class="type">LabelCommand</span> <span class="variable">tsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LabelCommand</span>();</span><br><span class="line">        <span class="comment">// 设置标签尺寸，按照实际尺寸设置</span></span><br><span class="line">        tsc.addSize(<span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="comment">// 设置标签间隙，按照实际尺寸设置，如果为无间隙纸则设置为0</span></span><br><span class="line">        tsc.addGap(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 设置打印方向</span></span><br><span class="line">        tsc.addDirection(LabelCommand.DIRECTION.BACKWARD, LabelCommand.MIRROR.NORMAL);</span><br><span class="line">        <span class="comment">// 开启带Response的打印，用于连续打印</span></span><br><span class="line">        tsc.addQueryPrinterStatus(LabelCommand.RESPONSE_MODE.ON);</span><br><span class="line">        <span class="comment">// 设置原点坐标</span></span><br><span class="line">        tsc.addReference(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 撕纸模式开启</span></span><br><span class="line">        tsc.addTear(EscCommand.ENABLE.ON);</span><br><span class="line">        <span class="comment">// 清除打印缓冲区</span></span><br><span class="line">        tsc.addCls();</span><br><span class="line">        <span class="comment">// 绘制简体中文</span></span><br><span class="line">        tsc.addText(<span class="number">20</span>, <span class="number">20</span>, LabelCommand.FONTTYPE.SIMPLIFIED_CHINESE, LabelCommand.ROTATION.ROTATION_0, LabelCommand.FONTMUL.MUL_1, LabelCommand.FONTMUL.MUL_1,</span><br><span class="line">                <span class="string">&quot;Welcome to use SMARNET printer!&quot;</span>);</span><br><span class="line">        <span class="comment">// 绘制图片</span></span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">b</span> <span class="operator">=</span> PictureUtils.base64StringToBitmap(base64Str);</span><br><span class="line"><span class="comment">//        Bitmap b = BitmapFactory.decodeResource(MainActivity.getMainActivity().getResources(), R.mipmap.ic_launcher);</span></span><br><span class="line">        tsc.addBitmap(<span class="number">20</span>, <span class="number">50</span>, LabelCommand.BITMAP_MODE.OVERWRITE, b.getWidth(), b);</span><br><span class="line"></span><br><span class="line">        tsc.addQRCode(<span class="number">250</span>, <span class="number">80</span>, LabelCommand.EEC.LEVEL_L, <span class="number">5</span>, LabelCommand.ROTATION.ROTATION_0, <span class="string">&quot; www.smarnet.cc&quot;</span>);</span><br><span class="line">        <span class="comment">// 绘制一维条码</span></span><br><span class="line">        tsc.add1DBarcode(<span class="number">20</span>, <span class="number">250</span>, LabelCommand.BARCODETYPE.CODE128, <span class="number">100</span>, LabelCommand.READABEL.EANBEL, LabelCommand.ROTATION.ROTATION_0, <span class="string">&quot;SMARNET&quot;</span>);</span><br><span class="line">        <span class="comment">// 打印标签</span></span><br><span class="line">        tsc.addPrint(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 打印标签后 蜂鸣器响</span></span><br><span class="line"></span><br><span class="line">        tsc.addSound(<span class="number">2</span>, <span class="number">100</span>);</span><br><span class="line">        tsc.addCashdrwer(LabelCommand.FOOT.F5, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">        Vector&lt;Byte&gt; datas = tsc.getCommand();</span><br><span class="line">        <span class="comment">// 发送数据</span></span><br><span class="line">        <span class="type">byte</span>[] byteData = BaseUtil.convertVectorByteTobytes(datas);</span><br><span class="line">        <span class="keyword">return</span> byteData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试发送ESC数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] sendESCData() &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> <span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAEECAIAAABBat1dAAAD+UlEQVR4nO3dwY7TMBRA0Rbx/788bK5GiAUOsmWc9Jw1omk6V948Pb+/vr5ewOv1438/AJxCDBAxQMQAEQNEDBAxQMQAEQNEDJCfw3/xfr83PMch9gynDF/pIY/xJFdeqZMBIgaIGCBigIgBIgaIGCBigIgBIgbIeBxj6Eb7Ne4ygHDIvMan/bJOBogYIGKAiAEiBogYIGKAiAEiBogYIAvGMYb2DEGcMzswP0wx/B+uvNInrdjY812cDBAxQMQAEQNEDBAxQMQAEQNEDBAxQMQA2TGb9GnmR4/4L5wMEDFAxAARA0QMEDFAxAARA0QMEDFAjGP8myU7Ws7ZasPvnAwQMUDEABEDRAwQMUDEABEDRAwQMUB2jGM8afrgkOtwznml5zzJPCcDRAwQMUDEABEDRAwQMUDEABEDRAwQMUAWzCZ91D00S1bFzI8eLXmMoY/6ZV9OBvgmBogYIGKAiAEiBogYIGKAiAEiBsh4HONJu0D2uMsUg1/2D04GiBggYoCIASIGiBggYoCIASIGiBggO27uWTKesGR24C6DEkNX3sb8l13yKTca+nAyQMQAEQNEDBAxQMQAEQNEDBAxQMQAEQPkveSSmL87Z6xow506VzxmROq16JKhDa78cE4GiBggYoCIASIGiBggYoCIASIGiBggC8YxDtkFcs5CmnmHfJdDHmMbJwNEDBAxQMQAEQNEDBAxQMQAEQNEDJDb3NyzxI1GA+bNz9HseV17/jxsx4B/IAaIGCBigIgBIgaIGCBigIgBIgbIeBxjz20Uez5lfkLh0xZGDB2yPGXJpzgZIGKAiAEiBogYIGKAiAEiBogYIGKAiAEyvrmH312ZTTrklc6PUS35Ijea5nIyQMQAEQNEDBAxQMQAEQNEDBAxQMQAGa+KOefenQ0OuavmRhtrDvnzWLKxxskAEQNEDBAxQMQAEQNEDBAxQMQAEQNkPI4xdMgyiCv2LIzYMG2xZ5Liyqcc8l2WcDJAxAARA0QMEDFAxAARA0QMEDFAxAARA2TBbNLQnm0i54y4HPIkexbSzH/ZQ5bNvJwM8E0MEDFAxAARA0QMEDFAxAARA0QMkB3jGE+yZEJhfgDhnBGGJ91C5GSAiAEiBogYIGKAiAEiBogYIGKAiAFiHONEe/ZrnDPTMbTnhTgZIGKAiAEiBogYIGKAiAEiBogYIGKAiAGyYzbpkJtslljyXQ7ZnrLnMfZMQM1vrHk5GeCbGCBigIgBIgaIGCBigIgBIgaIGCALxjFutHFkjyWjAXd5jPn/xM09cBwxQMQAEQNEDBAxQMQAEQNEDBAxQN5PWl0BM5wMEDFAxAARA0QMEDFAxAARA0QMEDFAxAD5BVn2+wfjFK/cAAAAAElFTkSuQmCC&quot;</span>;</span><br><span class="line">        <span class="type">EscCommand</span> <span class="variable">esc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EscCommand</span>();</span><br><span class="line">        esc.addInitializePrinter();</span><br><span class="line">        esc.addPrintAndFeedLines((<span class="type">byte</span>) <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 设置打印居中</span></span><br><span class="line">        esc.addSelectJustification(EscCommand.JUSTIFICATION.CENTER);</span><br><span class="line">        <span class="comment">// 设置为倍高倍宽</span></span><br><span class="line">        esc.addSelectPrintModes(EscCommand.FONT.FONTA, EscCommand.ENABLE.OFF, EscCommand.ENABLE.ON, EscCommand.ENABLE.ON, EscCommand.ENABLE.OFF);</span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Sample\n&quot;</span>);</span><br><span class="line">        esc.addPrintAndLineFeed();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 打印文字 */</span></span><br><span class="line">        <span class="comment">// 取消倍高倍宽</span></span><br><span class="line">        esc.addSelectPrintModes(EscCommand.FONT.FONTA, EscCommand.ENABLE.OFF, EscCommand.ENABLE.OFF, EscCommand.ENABLE.OFF, EscCommand.ENABLE.OFF);</span><br><span class="line">        <span class="comment">// 设置打印左对齐</span></span><br><span class="line">        esc.addSelectJustification(EscCommand.JUSTIFICATION.LEFT);</span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Print text\n&quot;</span>);</span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Welcome to use SMARNET printer!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 打印繁体中文 需要打印机支持繁体字库 */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;佳博智匯票據打印機\n&quot;</span>;</span><br><span class="line">        esc.addText(message, <span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">        esc.addPrintAndLineFeed();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 绝对位置 具体详细信息请查看GP58编程手册 */</span></span><br><span class="line">        esc.addText(<span class="string">&quot;智汇&quot;</span>);</span><br><span class="line">        esc.addSetHorAndVerMotionUnits((<span class="type">byte</span>) <span class="number">7</span>, (<span class="type">byte</span>) <span class="number">0</span>);</span><br><span class="line">        esc.addSetAbsolutePrintPosition((<span class="type">short</span>) <span class="number">6</span>);</span><br><span class="line">        esc.addText(<span class="string">&quot;网络&quot;</span>);</span><br><span class="line">        esc.addSetAbsolutePrintPosition((<span class="type">short</span>) <span class="number">10</span>);</span><br><span class="line">        esc.addText(<span class="string">&quot;设备&quot;</span>);</span><br><span class="line">        esc.addPrintAndLineFeed();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 打印图片 */</span></span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Print bitmap!\n&quot;</span>);</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">b</span> <span class="operator">=</span> PictureUtils.base64StringToBitmap(base64Str);</span><br><span class="line">        <span class="comment">//Bitmap b = BitmapFactory.decodeResource(MainActivity.getMainActivity().getResources(), R.mipmap.ic_launcher);</span></span><br><span class="line">        <span class="comment">// 打印图片</span></span><br><span class="line">        esc.addOriginRastBitImage(b, b.getWidth(), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 打印一维条码 */</span></span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Print code128\n&quot;</span>);</span><br><span class="line">        esc.addSelectPrintingPositionForHRICharacters(EscCommand.HRI_POSITION.BELOW);</span><br><span class="line">        <span class="comment">// 设置条码可识别字符位置在条码下方</span></span><br><span class="line">        <span class="comment">// 设置条码高度为60点</span></span><br><span class="line">        esc.addSetBarcodeHeight((<span class="type">byte</span>) <span class="number">60</span>);</span><br><span class="line">        <span class="comment">// 设置条码单元宽度为1</span></span><br><span class="line">        esc.addSetBarcodeWidth((<span class="type">byte</span>) <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 打印Code128码</span></span><br><span class="line">        esc.addCODE128(esc.genCodeB(<span class="string">&quot;SMARNET&quot;</span>));</span><br><span class="line">        esc.addPrintAndLineFeed();</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">         * QRCode命令打印 此命令只在支持QRCode命令打印的机型才能使用。 在不支持二维码指令打印的机型上，则需要发送二维条码图片</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">        <span class="comment">// 打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Print QRcode\n&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置纠错等级</span></span><br><span class="line">        esc.addSelectErrorCorrectionLevelForQRCode((<span class="type">byte</span>) <span class="number">0x31</span>);</span><br><span class="line">        <span class="comment">// 设置qrcode模块大小</span></span><br><span class="line">        esc.addSelectSizeOfModuleForQRCode((<span class="type">byte</span>) <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 设置qrcode内容</span></span><br><span class="line">        esc.addStoreQRCodeData(<span class="string">&quot;www.smarnet.cc&quot;</span>);</span><br><span class="line">        esc.addPrintQRCode();<span class="comment">// 打印QRCode</span></span><br><span class="line">        esc.addPrintAndLineFeed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置打印左对齐</span></span><br><span class="line">        esc.addSelectJustification(EscCommand.JUSTIFICATION.CENTER);</span><br><span class="line">        <span class="comment">//打印文字</span></span><br><span class="line">        esc.addText(<span class="string">&quot;Completed!\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开钱箱</span></span><br><span class="line">        esc.addGeneratePlus(LabelCommand.FOOT.F5, (<span class="type">byte</span>) <span class="number">255</span>, (<span class="type">byte</span>) <span class="number">255</span>);</span><br><span class="line">        esc.addPrintAndFeedLines((<span class="type">byte</span>) <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// 加入查询打印机状态，打印完成后，此时会接收到GpCom.ACTION_DEVICE_STATUS广播</span></span><br><span class="line">        esc.addQueryPrinterStatus();</span><br><span class="line">        Vector&lt;Byte&gt; datas = esc.getCommand();</span><br><span class="line">        <span class="comment">// 发送数据</span></span><br><span class="line">        <span class="type">byte</span>[] byteData = BaseUtil.convertVectorByteTobytes(datas);</span><br><span class="line">        <span class="keyword">return</span> byteData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] printLabel() &#123;</span><br><span class="line">        <span class="type">byte</span>[] byteData = &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> byteData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换图片TSC</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] convertTSCImgToBase64(String base64Str) &#123;</span><br><span class="line">        <span class="type">LabelCommand</span> <span class="variable">tsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LabelCommand</span>();</span><br><span class="line">        <span class="comment">// 设置原点坐标</span></span><br><span class="line"><span class="comment">//        tsc.addReference(0, 0);</span></span><br><span class="line">        <span class="comment">// 清除打印缓冲区</span></span><br><span class="line"><span class="comment">//        tsc.addCls();</span></span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">b</span> <span class="operator">=</span> PictureUtils.base64StringToBitmap(base64Str);</span><br><span class="line">        tsc.addBitmap(<span class="number">50</span>, <span class="number">55</span>, LabelCommand.BITMAP_MODE.OVERWRITE, b.getWidth(), b);</span><br><span class="line">        <span class="comment">// 打印标签</span></span><br><span class="line"><span class="comment">//        tsc.addPrint(1, 1);</span></span><br><span class="line">        Vector&lt;Byte&gt; datas = tsc.getCommand();</span><br><span class="line">        <span class="comment">// 发送数据</span></span><br><span class="line">        <span class="type">byte</span>[] byteData = BaseUtil.convertVectorByteTobytes(datas);</span><br><span class="line">        <span class="keyword">return</span> byteData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换图片ESC</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] convertESCImgToBase64(String base64Str) &#123;</span><br><span class="line">        <span class="type">EscCommand</span> <span class="variable">esc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EscCommand</span>();</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">b</span> <span class="operator">=</span> PictureUtils.base64StringToBitmap(base64Str);</span><br><span class="line">        <span class="comment">// 打印图片</span></span><br><span class="line">        esc.addOriginRastBitImage(b, b.getWidth(), <span class="number">0</span>);</span><br><span class="line">        Vector&lt;Byte&gt; datas = esc.getCommand();</span><br><span class="line">        <span class="comment">// 发送数据</span></span><br><span class="line">        <span class="type">byte</span>[] byteData = BaseUtil.convertVectorByteTobytes(datas);</span><br><span class="line">        <span class="keyword">return</span> byteData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ESC命令方法封装类"><a href="#ESC命令方法封装类" class="headerlink" title="ESC命令方法封装类"></a>ESC命令方法封装类</h2><p>关于<code>ESC</code>命令具体请参考<code>ESC命令文档</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.xx.yy.gpbt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.gpbt.LabelCommand.FOOT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EscCommand</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEBUG_TAG</span> <span class="operator">=</span> <span class="string">&quot;EscCommand&quot;</span>;</span><br><span class="line">    Vector&lt;Byte&gt; Command = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EscCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Command = <span class="keyword">new</span> <span class="title class_">Vector</span>(<span class="number">4096</span>, <span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addArrayToCommand</span><span class="params">(<span class="type">byte</span>[] array)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; ++i) &#123;</span><br><span class="line">            <span class="built_in">this</span>.Command.add(Byte.valueOf(array[i]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStrToCommand</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var4) &#123;</span><br><span class="line">                var4.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bs.length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStrToCommand</span><span class="params">(String str, String charset)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var5) &#123;</span><br><span class="line">                var5.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bs.length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStrToCommandUTF8Encoding</span><span class="params">(String str, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = str.getBytes(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var5) &#123;</span><br><span class="line">                var5.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;EscCommand&quot;</span>, <span class="string">&quot;bs.length&quot;</span> + bs.length);</span><br><span class="line">            <span class="keyword">if</span>(length &gt; bs.length) &#123;</span><br><span class="line">                length = bs.length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;EscCommand&quot;</span>, <span class="string">&quot;length&quot;</span> + length);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStrToCommand</span><span class="params">(String str, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var5) &#123;</span><br><span class="line">                var5.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;EscCommand&quot;</span>, <span class="string">&quot;bs.length&quot;</span> + bs.length);</span><br><span class="line">            <span class="keyword">if</span>(length &gt; bs.length) &#123;</span><br><span class="line">                length = bs.length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;EscCommand&quot;</span>, <span class="string">&quot;length&quot;</span> + length);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addHorTab</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">9</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addText</span><span class="params">(String text, String charsetName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(text, charsetName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addArabicText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        text = GpUtils.reverseLetterAndNumber(text);</span><br><span class="line">        text = GpUtils.splitArabic(text);</span><br><span class="line">        String[] fooInput = text.split(<span class="string">&quot;\\n&quot;</span>);</span><br><span class="line">        String[] var3 = fooInput;</span><br><span class="line">        <span class="type">int</span> <span class="variable">var4</span> <span class="operator">=</span> fooInput.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> <span class="number">0</span>; var5 &lt; var4; ++var5) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">in</span> <span class="operator">=</span> var3[var5];</span><br><span class="line">            <span class="type">byte</span>[] output = GpUtils.string2Cp864(in);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; output.length; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span>(output[i] == -<span class="number">16</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.addArrayToCommand(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">116</span>, <span class="number">29</span>, -<span class="number">124</span>, <span class="number">27</span>, <span class="number">116</span>, <span class="number">22</span>&#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(output[i] == <span class="number">127</span>) &#123;</span><br><span class="line">                    <span class="type">byte</span> <span class="variable">a</span> <span class="operator">=</span> -<span class="number">41</span>;</span><br><span class="line">                    <span class="built_in">this</span>.Command.add(Byte.valueOf(a));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.Command.add(Byte.valueOf(output[i]));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintAndLineFeed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">10</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">RealtimeStatusTransmission</span><span class="params">(EscCommand.STATUS status)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">16</span>, <span class="number">4</span>, status.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addGeneratePluseAtRealtime</span><span class="params">(FOOT foot, <span class="type">byte</span> t)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">16</span>, <span class="number">20</span>, <span class="number">1</span>, (<span class="type">byte</span>)foot.getValue(), <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(t &gt; <span class="number">8</span>) &#123;</span><br><span class="line">            t = <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        command[<span class="number">4</span>] = t;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSound</span><span class="params">(<span class="type">byte</span> n, <span class="type">byte</span> t)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">66</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            n = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(n &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            n = <span class="number">9</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(t &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            t = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(t &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            t = <span class="number">9</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        command[<span class="number">2</span>] = n;</span><br><span class="line">        command[<span class="number">3</span>] = t;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetRightSideCharacterSpacing</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">32</span>, n&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector&lt;Byte&gt; <span class="title function_">getCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.Command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectPrintModes</span><span class="params">(EscCommand.FONT font, EscCommand.ENABLE emphasized, EscCommand.ENABLE doubleheight, EscCommand.ENABLE doublewidth, EscCommand.ENABLE underline)</span> &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(font == EscCommand.FONT.FONTB) &#123;</span><br><span class="line">            temp = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(emphasized == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(doubleheight == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(doublewidth == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">32</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(underline == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">33</span>, temp&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetAbsolutePrintPosition</span><span class="params">(<span class="type">short</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">36</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nl</span> <span class="operator">=</span> (<span class="type">byte</span>)(n % <span class="number">256</span>);</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nh</span> <span class="operator">=</span> (<span class="type">byte</span>)(n / <span class="number">256</span>);</span><br><span class="line">        command[<span class="number">2</span>] = nl;</span><br><span class="line">        command[<span class="number">3</span>] = nh;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectOrCancelUserDefineCharacter</span><span class="params">(EscCommand.ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">37</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(enable == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurnUnderlineModeOnOrOff</span><span class="params">(EscCommand.UNDERLINE_MODE underline)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">45</span>, underline.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectDefualtLineSpacing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">50</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetLineSpacing</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">51</span>, n&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCancelUserDefinedCharacters</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">63</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(n &gt;= <span class="number">32</span> &amp;&amp; n &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">            command[<span class="number">2</span>] = n;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">32</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInitializePrinter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">64</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurnEmphasizedModeOnOrOff</span><span class="params">(EscCommand.ENABLE enabel)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">69</span>, enabel.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurnDoubleStrikeOnOrOff</span><span class="params">(EscCommand.ENABLE enabel)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">71</span>, enabel.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintAndFeedPaper</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">74</span>, n&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectCharacterFont</span><span class="params">(EscCommand.FONT font)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">77</span>, font.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectInternationalCharacterSet</span><span class="params">(EscCommand.CHARACTER_SET set)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">82</span>, set.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurn90ClockWiseRotatin</span><span class="params">(EscCommand.ENABLE enabel)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">86</span>, enabel.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetRelativePrintPositon</span><span class="params">(<span class="type">short</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">92</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nl</span> <span class="operator">=</span> (<span class="type">byte</span>)(n % <span class="number">256</span>);</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nh</span> <span class="operator">=</span> (<span class="type">byte</span>)(n / <span class="number">256</span>);</span><br><span class="line">        command[<span class="number">2</span>] = nl;</span><br><span class="line">        command[<span class="number">3</span>] = nh;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectJustification</span><span class="params">(EscCommand.JUSTIFICATION just)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">97</span>, just.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintAndFeedLines</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">100</span>, n&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addGeneratePlus</span><span class="params">(FOOT foot, <span class="type">byte</span> t1, <span class="type">byte</span> t2)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">112</span>, (<span class="type">byte</span>)foot.getValue(), t1, t2&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectCodePage</span><span class="params">(EscCommand.CODEPAGE page)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">116</span>, page.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurnUpsideDownModeOnOrOff</span><span class="params">(EscCommand.ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">27</span>, <span class="number">123</span>, enable.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetCharcterSize</span><span class="params">(EscCommand.WIDTH_ZOOM width, EscCommand.HEIGHT_ZOOM height)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">33</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">temp1</span> <span class="operator">=</span> (<span class="type">byte</span>)(temp | width.getValue());</span><br><span class="line">        temp1 |= height.getValue();</span><br><span class="line">        command[<span class="number">2</span>] = temp1;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTurnReverseModeOnOrOff</span><span class="params">(EscCommand.ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">66</span>, enable.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectPrintingPositionForHRICharacters</span><span class="params">(EscCommand.HRI_POSITION position)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">72</span>, position.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetLeftMargin</span><span class="params">(<span class="type">short</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">76</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nl</span> <span class="operator">=</span> (<span class="type">byte</span>)(n % <span class="number">256</span>);</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nh</span> <span class="operator">=</span> (<span class="type">byte</span>)(n / <span class="number">256</span>);</span><br><span class="line">        command[<span class="number">2</span>] = nl;</span><br><span class="line">        command[<span class="number">3</span>] = nh;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetHorAndVerMotionUnits</span><span class="params">(<span class="type">byte</span> x, <span class="type">byte</span> y)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">80</span>, x, y&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCutAndFeedPaper</span><span class="params">(<span class="type">byte</span> length)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">86</span>, <span class="number">66</span>, length&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCutPaper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">86</span>, <span class="number">1</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetPrintingAreaWidth</span><span class="params">(<span class="type">short</span> width)</span> &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nl</span> <span class="operator">=</span> (<span class="type">byte</span>)(width % <span class="number">256</span>);</span><br><span class="line">        <span class="type">byte</span> <span class="variable">nh</span> <span class="operator">=</span> (<span class="type">byte</span>)(width / <span class="number">256</span>);</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">87</span>, nl, nh&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetAutoSatusBack</span><span class="params">(EscCommand.ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">97</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(enable == EscCommand.ENABLE.OFF) &#123;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            command[<span class="number">2</span>] = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetFontForHRICharacter</span><span class="params">(EscCommand.FONT font)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">102</span>, font.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetBarcodeHeight</span><span class="params">(<span class="type">byte</span> height)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">104</span>, height&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetBarcodeWidth</span><span class="params">(<span class="type">byte</span> width)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">119</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(width &gt; <span class="number">6</span>) &#123;</span><br><span class="line">            width = <span class="number">6</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(width &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            width = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        command[<span class="number">2</span>] = width;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetKanjiFontMode</span><span class="params">(EscCommand.ENABLE DoubleWidth, EscCommand.ENABLE DoubleHeight, EscCommand.ENABLE Underline)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">33</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(DoubleWidth == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(DoubleHeight == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Underline == EscCommand.ENABLE.ON) &#123;</span><br><span class="line">            temp = (<span class="type">byte</span>)(temp | <span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        command[<span class="number">2</span>] = temp;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectKanjiMode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">38</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetKanjiUnderLine</span><span class="params">(EscCommand.UNDERLINE_MODE underline)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">45</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        command[<span class="number">3</span>] = underline.getValue();</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCancelKanjiMode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">46</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetKanjiLefttandRightSpace</span><span class="params">(<span class="type">byte</span> left, <span class="type">byte</span> right)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">83</span>, left, right&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSetQuadrupleModeForKanji</span><span class="params">(EscCommand.ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">87</span>, enable.getValue()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRastBitImage</span><span class="params">(Bitmap bitmap, <span class="type">int</span> nWidth, <span class="type">int</span> nMode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(bitmap != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight() * width / bitmap.getWidth();</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">grayBitmap</span> <span class="operator">=</span> GpUtils.toGrayscale(bitmap);</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(grayBitmap, width, height);</span><br><span class="line">            <span class="type">byte</span>[] src = GpUtils.bitmapToBWPix(rszBitmap);</span><br><span class="line">            <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">            height = src.length / width;</span><br><span class="line">            command[<span class="number">0</span>] = <span class="number">29</span>;</span><br><span class="line">            command[<span class="number">1</span>] = <span class="number">118</span>;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">48</span>;</span><br><span class="line">            command[<span class="number">3</span>] = (<span class="type">byte</span>)(nMode &amp; <span class="number">1</span>);</span><br><span class="line">            command[<span class="number">4</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> % <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">5</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> / <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">6</span>] = (<span class="type">byte</span>)(height % <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">7</span>] = (<span class="type">byte</span>)(height / <span class="number">256</span>);</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            <span class="type">byte</span>[] codecontent = GpUtils.pixToEscRastBitImageCmd(src);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; codecontent.length; ++k) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(codecontent[k]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.  null &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOriginRastBitImage</span><span class="params">(Bitmap bitmap, <span class="type">int</span> nWidth, <span class="type">int</span> nMode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(bitmap != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight() * width / bitmap.getWidth();</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(bitmap, width, height);</span><br><span class="line">            <span class="type">byte</span>[] data = GpUtils.printEscDraw(rszBitmap);</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.  null &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRastBitImageWithMethod</span><span class="params">(Bitmap bitmap, <span class="type">int</span> nWidth, <span class="type">int</span> nMode, <span class="type">int</span> method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(bitmap != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight() * width / bitmap.getWidth();</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">resizeImage</span> <span class="operator">=</span> GpUtils.resizeImage(bitmap, width, height);</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.filter(resizeImage, resizeImage.getWidth(), resizeImage.getHeight());</span><br><span class="line">            <span class="type">byte</span>[] src = GpUtils.bitmapToBWPix(rszBitmap);</span><br><span class="line">            <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span>];</span><br><span class="line">            height = src.length / width;</span><br><span class="line">            command[<span class="number">0</span>] = <span class="number">29</span>;</span><br><span class="line">            command[<span class="number">1</span>] = <span class="number">118</span>;</span><br><span class="line">            command[<span class="number">2</span>] = <span class="number">48</span>;</span><br><span class="line">            command[<span class="number">3</span>] = (<span class="type">byte</span>)(nMode &amp; <span class="number">1</span>);</span><br><span class="line">            command[<span class="number">4</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> % <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">5</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> / <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">6</span>] = (<span class="type">byte</span>)(height % <span class="number">256</span>);</span><br><span class="line">            command[<span class="number">7</span>] = (<span class="type">byte</span>)(height / <span class="number">256</span>);</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            <span class="type">byte</span>[] codecontent = GpUtils.pixToEscRastBitImageCmd(src);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; codecontent.length; ++k) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(codecontent[k]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.  null &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDownloadNvBitImage</span><span class="params">(Bitmap[] bitmap)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(bitmap == <span class="literal">null</span>) &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.  null &quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bitmap.length &quot;</span> + bitmap.length);</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> bitmap.length;</span><br><span class="line">            <span class="keyword">if</span>(n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">113</span>, (<span class="type">byte</span>)n&#125;;</span><br><span class="line">                <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> (bitmap[i].getHeight() + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bitmap[i].getWidth() * height / bitmap[i].getHeight();</span><br><span class="line">                    <span class="type">Bitmap</span> <span class="variable">grayBitmap</span> <span class="operator">=</span> GpUtils.toGrayscale(bitmap[i]);</span><br><span class="line">                    <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(grayBitmap, width, height);</span><br><span class="line">                    <span class="type">byte</span>[] src = GpUtils.bitmapToBWPix(rszBitmap);</span><br><span class="line">                    height = src.length / width;</span><br><span class="line">                    Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp  Width &quot;</span> + width);</span><br><span class="line">                    Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp  height &quot;</span> + height);</span><br><span class="line">                    <span class="type">byte</span>[] codecontent = GpUtils.pixToEscNvBitImageCmd(src, width, height);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; codecontent.length; ++k) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.Command.add(Byte.valueOf(codecontent[k]));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintNvBitmap</span><span class="params">(<span class="type">byte</span> n, <span class="type">byte</span> mode)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">28</span>, <span class="number">112</span>, n, mode&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUPCA</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">65</span>, <span class="number">11</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(content.length() &gt;= command[<span class="number">3</span>]) &#123;</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(content, <span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUPCE</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">66</span>, <span class="number">11</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(content.length() &gt;= command[<span class="number">3</span>]) &#123;</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEAN13</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">67</span>, <span class="number">12</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(content.length() &gt;= command[<span class="number">3</span>]) &#123;</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            Log.d(<span class="string">&quot;EscCommand&quot;</span>, <span class="string">&quot;content.length&quot;</span> + content.length());</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEAN8</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">68</span>, <span class="number">7</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(content.length() &gt;= command[<span class="number">3</span>]) &#123;</span><br><span class="line">            <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(&#123;&quot;DefaultLocale&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCODE39</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">69</span>, (<span class="type">byte</span>)content.length()&#125;;</span><br><span class="line">        content = content.toUpperCase();</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addITF</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">70</span>, (<span class="type">byte</span>)content.length()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCODABAR</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">71</span>, (<span class="type">byte</span>)content.length()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCODE93</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">72</span>, (<span class="type">byte</span>)content.length()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCODE128</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">107</span>, <span class="number">73</span>, (<span class="type">byte</span>)content.length()&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(content, command[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">genCodeC</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        List&lt;Byte&gt; bytes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">20</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> content.length();</span><br><span class="line">        <span class="type">byte</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">123</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">67</span>;</span><br><span class="line">        bytes.add(Byte.valueOf(a));</span><br><span class="line">        bytes.add(Byte.valueOf(b));</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">            i = (content.charAt(i) - <span class="number">48</span>) * <span class="number">10</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">bits</span> <span class="operator">=</span> content.charAt(i + <span class="number">1</span>) - <span class="number">48</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> i + bits;</span><br><span class="line">            bytes.add(Byte.valueOf((<span class="type">byte</span>)current));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bb = <span class="keyword">new</span> <span class="title class_">byte</span>[bytes.size()];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; bb.length; ++i) &#123;</span><br><span class="line">            bb[i] = ((Byte)bytes.get(i)).byteValue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(bb, <span class="number">0</span>, bb.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">genCodeB</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;&#123;B%s&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;content&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">genCode128</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;([^0-9])&quot;</span>;</span><br><span class="line">        String[] str = content.split(regex);</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(regex);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(content);</span><br><span class="line">        <span class="type">String</span> <span class="variable">splitString</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">strlen</span> <span class="operator">=</span> str.length;</span><br><span class="line">        <span class="keyword">if</span>(strlen &gt; <span class="number">0</span> &amp;&amp; matcher.find()) &#123;</span><br><span class="line">            splitString = matcher.group(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; strlen; ++i) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> str[i];</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> first.length();</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> len % <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(result == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">codeC</span> <span class="operator">=</span> <span class="built_in">this</span>.genCodeC(first);</span><br><span class="line">                sb.append(codeC);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sb.append(<span class="built_in">this</span>.genCodeB(String.valueOf(first.charAt(<span class="number">0</span>))));</span><br><span class="line">                sb.append(<span class="built_in">this</span>.genCodeC(first.substring(<span class="number">1</span>, first.length())));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(splitString != <span class="literal">null</span>) &#123;</span><br><span class="line">                sb.append(<span class="built_in">this</span>.genCodeB(splitString));</span><br><span class="line">                splitString = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectSizeOfModuleForQRCode</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">40</span>, <span class="number">107</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">67</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        command[<span class="number">7</span>] = n;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelectErrorCorrectionLevelForQRCode</span><span class="params">(<span class="type">byte</span> n)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">40</span>, <span class="number">107</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">69</span>, n&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStoreQRCodeData</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">40</span>, <span class="number">107</span>, (<span class="type">byte</span>)((content.getBytes().length + <span class="number">3</span>) % <span class="number">256</span>), (<span class="type">byte</span>)((content.getBytes().length + <span class="number">3</span>) / <span class="number">256</span>), <span class="number">49</span>, <span class="number">80</span>, <span class="number">48</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!content.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = content.getBytes(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var5) &#123;</span><br><span class="line">                var5.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bs.length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintQRCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">40</span>, <span class="number">107</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">81</span>, <span class="number">48</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] command = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">29</span>, <span class="number">114</span>, <span class="number">1</span>&#125;;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUserCommand</span><span class="params">(<span class="type">byte</span>[] command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addArrayToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">HRI_POSITION</span> &#123;</span><br><span class="line">        NO_PRINT(<span class="number">0</span>),</span><br><span class="line">        ABOVE(<span class="number">1</span>),</span><br><span class="line">        BELOW(<span class="number">2</span>),</span><br><span class="line">        ABOVE_AND_BELOW(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">HRI_POSITION</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">HEIGHT_ZOOM</span> &#123;</span><br><span class="line">        MUL_1(<span class="number">0</span>),</span><br><span class="line">        MUL_2(<span class="number">1</span>),</span><br><span class="line">        MUL_3(<span class="number">2</span>),</span><br><span class="line">        MUL_4(<span class="number">3</span>),</span><br><span class="line">        MUL_5(<span class="number">4</span>),</span><br><span class="line">        MUL_6(<span class="number">5</span>),</span><br><span class="line">        MUL_7(<span class="number">6</span>),</span><br><span class="line">        MUL_8(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">HEIGHT_ZOOM</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">WIDTH_ZOOM</span> &#123;</span><br><span class="line">        MUL_1(<span class="number">0</span>),</span><br><span class="line">        MUL_2(<span class="number">16</span>),</span><br><span class="line">        MUL_3(<span class="number">32</span>),</span><br><span class="line">        MUL_4(<span class="number">48</span>),</span><br><span class="line">        MUL_5(<span class="number">64</span>),</span><br><span class="line">        MUL_6(<span class="number">80</span>),</span><br><span class="line">        MUL_7(<span class="number">96</span>),</span><br><span class="line">        MUL_8(<span class="number">112</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">WIDTH_ZOOM</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">CODEPAGE</span> &#123;</span><br><span class="line">        PC437(<span class="number">0</span>),</span><br><span class="line">        KATAKANA(<span class="number">1</span>),</span><br><span class="line">        PC850(<span class="number">2</span>),</span><br><span class="line">        PC860(<span class="number">3</span>),</span><br><span class="line">        PC863(<span class="number">4</span>),</span><br><span class="line">        PC865(<span class="number">5</span>),</span><br><span class="line">        WEST_EUROPE(<span class="number">6</span>),</span><br><span class="line">        GREEK(<span class="number">7</span>),</span><br><span class="line">        HEBREW(<span class="number">8</span>),</span><br><span class="line">        EAST_EUROPE(<span class="number">9</span>),</span><br><span class="line">        IRAN(<span class="number">10</span>),</span><br><span class="line">        WPC1252(<span class="number">16</span>),</span><br><span class="line">        PC866(<span class="number">17</span>),</span><br><span class="line">        PC852(<span class="number">18</span>),</span><br><span class="line">        PC858(<span class="number">19</span>),</span><br><span class="line">        IRANII(<span class="number">20</span>),</span><br><span class="line">        LATVIAN(<span class="number">21</span>),</span><br><span class="line">        ARABIC(<span class="number">22</span>),</span><br><span class="line">        PT151(<span class="number">23</span>),</span><br><span class="line">        PC747(<span class="number">24</span>),</span><br><span class="line">        WPC1257(<span class="number">25</span>),</span><br><span class="line">        VIETNAM(<span class="number">27</span>),</span><br><span class="line">        PC864(<span class="number">28</span>),</span><br><span class="line">        PC1001(<span class="number">29</span>),</span><br><span class="line">        UYGUR(<span class="number">30</span>),</span><br><span class="line">        THAI(<span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">CODEPAGE</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">JUSTIFICATION</span> &#123;</span><br><span class="line">        LEFT(<span class="number">0</span>),</span><br><span class="line">        CENTER(<span class="number">1</span>),</span><br><span class="line">        RIGHT(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">JUSTIFICATION</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">CHARACTER_SET</span> &#123;</span><br><span class="line">        USA(<span class="number">0</span>),</span><br><span class="line">        FRANCE(<span class="number">1</span>),</span><br><span class="line">        GERMANY(<span class="number">2</span>),</span><br><span class="line">        UK(<span class="number">3</span>),</span><br><span class="line">        DENMARK_I(<span class="number">4</span>),</span><br><span class="line">        SWEDEN(<span class="number">5</span>),</span><br><span class="line">        ITALY(<span class="number">6</span>),</span><br><span class="line">        SPAIN_I(<span class="number">7</span>),</span><br><span class="line">        JAPAN(<span class="number">8</span>),</span><br><span class="line">        NORWAY(<span class="number">9</span>),</span><br><span class="line">        DENMARK_II(<span class="number">10</span>),</span><br><span class="line">        SPAIN_II(<span class="number">11</span>),</span><br><span class="line">        LATIN_AMERCIA(<span class="number">12</span>),</span><br><span class="line">        KOREAN(<span class="number">13</span>),</span><br><span class="line">        SLOVENIA(<span class="number">14</span>),</span><br><span class="line">        CHINA(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">CHARACTER_SET</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">FONT</span> &#123;</span><br><span class="line">        FONTA(<span class="number">0</span>),</span><br><span class="line">        FONTB(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">FONT</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">UNDERLINE_MODE</span> &#123;</span><br><span class="line">        OFF(<span class="number">0</span>),</span><br><span class="line">        UNDERLINE_1DOT(<span class="number">1</span>),</span><br><span class="line">        UNDERLINE_2DOT(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">UNDERLINE_MODE</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">ENABLE</span> &#123;</span><br><span class="line">        OFF(<span class="number">0</span>),</span><br><span class="line">        ON(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">ENABLE</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">STATUS</span> &#123;</span><br><span class="line">        PRINTER_STATUS(<span class="number">1</span>),</span><br><span class="line">        PRINTER_OFFLINE(<span class="number">2</span>),</span><br><span class="line">        PRINTER_ERROR(<span class="number">3</span>),</span><br><span class="line">        PRINTER_PAPER(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">STATUS</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">byte</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>)<span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="TSC命令封装类"><a href="#TSC命令封装类" class="headerlink" title="TSC命令封装类"></a>TSC命令封装类</h2><p>命令具体参考<code>TSC命令文档</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.xx.yy.gpbt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.gpbt.EscCommand.ENABLE;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.gpbt.LabelCommand;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.gpbt.GpUtils;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LabelCommand</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEBUG_TAG</span> <span class="operator">=</span> <span class="string">&quot;LabelCommand&quot;</span>;</span><br><span class="line">    Vector&lt;Byte&gt; Command = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LabelCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Command = <span class="keyword">new</span> <span class="title class_">Vector</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LabelCommand</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> gap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Command = <span class="keyword">new</span> <span class="title class_">Vector</span>(<span class="number">4096</span>, <span class="number">1024</span>);</span><br><span class="line">        <span class="built_in">this</span>.addSize(width, height);</span><br><span class="line">        <span class="built_in">this</span>.addGap(gap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clrCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.Command.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStrToCommand</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bs = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(!str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                bs = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var4) &#123;</span><br><span class="line">                var4.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bs.length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bs[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addGap</span><span class="params">(<span class="type">int</span> gap)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;GAP &quot;</span> + gap + <span class="string">&quot; mm,&quot;</span> + <span class="number">0</span> + <span class="string">&quot; mm&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSize</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SIZE &quot;</span> + width + <span class="string">&quot; mm,&quot;</span> + height + <span class="string">&quot; mm&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCashdrwer</span><span class="params">(LabelCommand.FOOT m, <span class="type">int</span> t1, <span class="type">int</span> t2)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;CASHDRAWER &quot;</span> + m.getValue() + <span class="string">&quot;,&quot;</span> + t1 + <span class="string">&quot;,&quot;</span> + t2 + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOffset</span><span class="params">(<span class="type">int</span> offset)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;OFFSET &quot;</span> + offset + <span class="string">&quot; mm&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSpeed</span><span class="params">(LabelCommand.SPEED speed)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SPEED &quot;</span> + speed.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDensity</span><span class="params">(LabelCommand.DENSITY density)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;DENSITY &quot;</span> + density.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addDirection</span><span class="params">(LabelCommand.DIRECTION direction, LabelCommand.MIRROR mirror)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;DIRECTION &quot;</span> + direction.getValue() + <span class="string">&#x27;,&#x27;</span> + mirror.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addReference</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;REFERENCE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShif</span><span class="params">(<span class="type">int</span> shift)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SHIFT &quot;</span> + shift + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCls</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;CLS\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFeed</span><span class="params">(<span class="type">int</span> dot)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;FEED &quot;</span> + dot + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBackFeed</span><span class="params">(<span class="type">int</span> dot)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BACKFEED &quot;</span> + dot + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormFeed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;FORMFEED\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addHome</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;HOME\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrint</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;PRINT &quot;</span> + m + <span class="string">&quot;,&quot;</span> + n + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrint</span><span class="params">(<span class="type">int</span> m)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;PRINT &quot;</span> + m + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCodePage</span><span class="params">(LabelCommand.CODEPAGE page)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;CODEPAGE &quot;</span> + page.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSound</span><span class="params">(<span class="type">int</span> level, <span class="type">int</span> interval)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SOUND &quot;</span> + level + <span class="string">&quot;,&quot;</span> + interval + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLimitFeed</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;LIMITFEED &quot;</span> + n + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSelfTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SELFTEST\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBar</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BAR &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addText</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.FONTTYPE font, LabelCommand.ROTATION rotation, LabelCommand.FONTMUL Xscal, LabelCommand.FONTMUL Yscal, String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;TEXT &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + font.getValue() + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;,&quot;</span> + rotation.getValue() + <span class="string">&quot;,&quot;</span> + Xscal.getValue() + <span class="string">&quot;,&quot;</span> + Yscal.getValue() + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + text + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add1DBarcode</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.BARCODETYPE type, <span class="type">int</span> height, LabelCommand.READABEL readable, LabelCommand.ROTATION rotation, String content)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">narrow</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BARCODE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + type.getValue() + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + readable.getValue() + <span class="string">&quot;,&quot;</span> + rotation.getValue() + <span class="string">&quot;,&quot;</span> + narrow + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + content + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add1DBarcode</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.BARCODETYPE type, <span class="type">int</span> height, LabelCommand.READABEL readable, LabelCommand.ROTATION rotation, <span class="type">int</span> narrow, <span class="type">int</span> width, String content)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BARCODE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + type.getValue() + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + readable.getValue() + <span class="string">&quot;,&quot;</span> + rotation.getValue() + <span class="string">&quot;,&quot;</span> + narrow + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + content + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBox</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xend, <span class="type">int</span> yend, <span class="type">int</span> thickness)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BOX &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + xend + <span class="string">&quot;,&quot;</span> + yend + <span class="string">&quot;,&quot;</span> + thickness + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBitmap</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.BITMAP_MODE mode, <span class="type">int</span> nWidth, Bitmap b)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(b != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> b.getHeight() * width / b.getWidth();</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.getWidth() &quot;</span> + b.getWidth());</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">grayBitmap</span> <span class="operator">=</span> GpUtils.toGrayscale(b);</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(grayBitmap, width, height);</span><br><span class="line">            <span class="type">byte</span>[] src = GpUtils.bitmapToBWPix(rszBitmap);</span><br><span class="line">            height = src.length / width;</span><br><span class="line">            width /= <span class="number">8</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BITMAP &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + mode.getValue() + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">            <span class="type">byte</span>[] codecontent = GpUtils.pixToLabelCmd(src);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; codecontent.length; ++k) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(codecontent[k]));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;LabelCommand&quot;</span>, <span class="string">&quot;codecontent&quot;</span> + codecontent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBitmapByMethod</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.BITMAP_MODE mode, <span class="type">int</span> nWidth, Bitmap b)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(b != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> b.getHeight() * width / b.getWidth();</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.getWidth() &quot;</span> + b.getWidth());</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(b, width, height);</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">grayBitmap</span> <span class="operator">=</span> GpUtils.filter(rszBitmap, width, height);</span><br><span class="line">            <span class="type">byte</span>[] src = GpUtils.bitmapToBWPix(grayBitmap);</span><br><span class="line">            height = src.length / width;</span><br><span class="line">            width /= <span class="number">8</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BITMAP &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + mode.getValue() + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">            <span class="type">byte</span>[] codecontent = GpUtils.pixToLabelCmd(src);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; codecontent.length; ++k) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(codecontent[k]));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;LabelCommand&quot;</span>, <span class="string">&quot;codecontent&quot;</span> + codecontent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBitmap</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> nWidth, Bitmap bmp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(bmp != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bmp.getHeight() * width / bmp.getWidth();</span><br><span class="line">            Log.d(<span class="string">&quot;BMP&quot;</span>, <span class="string">&quot;bmp.getWidth() &quot;</span> + bmp.getWidth());</span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> GpUtils.resizeImage(bmp, width, height);</span><br><span class="line">            <span class="type">byte</span>[] bytes = GpUtils.printTscDraw(x, y, LabelCommand.BITMAP_MODE.OVERWRITE, rszBitmap);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bytes.length; ++i) &#123;</span><br><span class="line">                <span class="built_in">this</span>.Command.add(Byte.valueOf(bytes[i]));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addErase</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xwidth, <span class="type">int</span> yheight)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;ERASE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + xwidth + <span class="string">&quot;,&quot;</span> + yheight + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addReverse</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xwidth, <span class="type">int</span> yheight)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;REVERSE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + xwidth + <span class="string">&quot;,&quot;</span> + yheight + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQRCode</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, LabelCommand.EEC level, <span class="type">int</span> cellwidth, LabelCommand.ROTATION rotation, String data)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;QRCODE &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + level.getValue() + <span class="string">&quot;,&quot;</span> + cellwidth + <span class="string">&quot;,&quot;</span> + <span class="string">&#x27;A&#x27;</span> + <span class="string">&quot;,&quot;</span> + rotation.getValue() + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;\&quot;&quot;</span> + data + <span class="string">&quot;\&quot;&quot;</span> + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector&lt;Byte&gt; <span class="title function_">getCommand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.Command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!T\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">27</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">63</span>;</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(a));</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(b));</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(c));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResetPrinter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">27</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line">        <span class="type">byte</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">82</span>;</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(a));</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(b));</span><br><span class="line">        <span class="built_in">this</span>.Command.add(Byte.valueOf(c));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterLife</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!@\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!A\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!F\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterCodePage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;~!I\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPeel</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(enable.getValue() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET PEEL &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">            <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTear</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET TEAR &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCutter</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET CUTTER &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCutterBatch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET CUTTER BATCH\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCutterPieces</span><span class="params">(<span class="type">short</span> number)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET CUTTER &quot;</span> + number + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addReprint</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET REPRINT &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintKey</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET PRINTKEY &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPrintKey</span><span class="params">(<span class="type">int</span> m)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET PRINTKEY &quot;</span> + m + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPartialCutter</span><span class="params">(ENABLE enable)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET PARTIAL_CUTTER &quot;</span> + enable.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueryPrinterStatus</span><span class="params">(LabelCommand.RESPONSE_MODE mode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;SET RESPONSE &quot;</span> + mode.getValue() + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUserCommand</span><span class="params">(String command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addStrToCommand(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">RESPONSE_MODE</span> &#123;</span><br><span class="line">        ON(<span class="string">&quot;ON&quot;</span>),</span><br><span class="line">        OFF(<span class="string">&quot;OFF&quot;</span>),</span><br><span class="line">        BATCH(<span class="string">&quot;BATCH&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">RESPONSE_MODE</span><span class="params">(String value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">BARCODETYPE</span> &#123;</span><br><span class="line">        CODE128(<span class="string">&quot;128&quot;</span>),</span><br><span class="line">        CODE128M(<span class="string">&quot;128M&quot;</span>),</span><br><span class="line">        EAN128(<span class="string">&quot;EAN128&quot;</span>),</span><br><span class="line">        ITF25(<span class="string">&quot;25&quot;</span>),</span><br><span class="line">        ITF25C(<span class="string">&quot;25C&quot;</span>),</span><br><span class="line">        CODE39(<span class="string">&quot;39&quot;</span>),</span><br><span class="line">        CODE39C(<span class="string">&quot;39C&quot;</span>),</span><br><span class="line">        CODE39S(<span class="string">&quot;39S&quot;</span>),</span><br><span class="line">        CODE93(<span class="string">&quot;93&quot;</span>),</span><br><span class="line">        EAN13(<span class="string">&quot;EAN13&quot;</span>),</span><br><span class="line">        EAN13_2(<span class="string">&quot;EAN13+2&quot;</span>),</span><br><span class="line">        EAN13_5(<span class="string">&quot;EAN13+5&quot;</span>),</span><br><span class="line">        EAN8(<span class="string">&quot;EAN8&quot;</span>),</span><br><span class="line">        EAN8_2(<span class="string">&quot;EAN8+2&quot;</span>),</span><br><span class="line">        EAN8_5(<span class="string">&quot;EAN8+5&quot;</span>),</span><br><span class="line">        CODABAR(<span class="string">&quot;CODA&quot;</span>),</span><br><span class="line">        POST(<span class="string">&quot;POST&quot;</span>),</span><br><span class="line">        UPCA(<span class="string">&quot;UPCA&quot;</span>),</span><br><span class="line">        UPCA_2(<span class="string">&quot;UPCA+2&quot;</span>),</span><br><span class="line">        UPCA_5(<span class="string">&quot;UPCA+5&quot;</span>),</span><br><span class="line">        UPCE(<span class="string">&quot;UPCE13&quot;</span>),</span><br><span class="line">        UPCE_2(<span class="string">&quot;UPCE13+2&quot;</span>),</span><br><span class="line">        UPCE_5(<span class="string">&quot;UPCE13+5&quot;</span>),</span><br><span class="line">        CPOST(<span class="string">&quot;CPOST&quot;</span>),</span><br><span class="line">        MSI(<span class="string">&quot;MSI&quot;</span>),</span><br><span class="line">        MSIC(<span class="string">&quot;MSIC&quot;</span>),</span><br><span class="line">        PLESSEY(<span class="string">&quot;PLESSEY&quot;</span>),</span><br><span class="line">        ITF14(<span class="string">&quot;ITF14&quot;</span>),</span><br><span class="line">        EAN14(<span class="string">&quot;EAN14&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">BARCODETYPE</span><span class="params">(String value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">EEC</span> &#123;</span><br><span class="line">        LEVEL_L(<span class="string">&quot;L&quot;</span>),</span><br><span class="line">        LEVEL_M(<span class="string">&quot;M&quot;</span>),</span><br><span class="line">        LEVEL_Q(<span class="string">&quot;Q&quot;</span>),</span><br><span class="line">        LEVEL_H(<span class="string">&quot;H&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">EEC</span><span class="params">(String value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">ROTATION</span> &#123;</span><br><span class="line">        ROTATION_0(<span class="number">0</span>),</span><br><span class="line">        ROTATION_90(<span class="number">90</span>),</span><br><span class="line">        ROTATION_180(<span class="number">180</span>),</span><br><span class="line">        ROTATION_270(<span class="number">270</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">ROTATION</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">FONTTYPE</span> &#123;</span><br><span class="line">        FONT_1(<span class="string">&quot;1&quot;</span>),</span><br><span class="line">        FONT_2(<span class="string">&quot;2&quot;</span>),</span><br><span class="line">        FONT_3(<span class="string">&quot;3&quot;</span>),</span><br><span class="line">        FONT_4(<span class="string">&quot;4&quot;</span>),</span><br><span class="line">        FONT_5(<span class="string">&quot;5&quot;</span>),</span><br><span class="line">        FONT_6(<span class="string">&quot;6&quot;</span>),</span><br><span class="line">        FONT_7(<span class="string">&quot;7&quot;</span>),</span><br><span class="line">        FONT_8(<span class="string">&quot;8&quot;</span>),</span><br><span class="line">        FONT_9(<span class="string">&quot;9&quot;</span>),</span><br><span class="line">        FONT_10(<span class="string">&quot;10&quot;</span>),</span><br><span class="line">        SIMPLIFIED_CHINESE(<span class="string">&quot;TSS24.BF2&quot;</span>),</span><br><span class="line">        TRADITIONAL_CHINESE(<span class="string">&quot;TST24.BF2&quot;</span>),</span><br><span class="line">        KOREAN(<span class="string">&quot;K&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">FONTTYPE</span><span class="params">(String value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">FONTMUL</span> &#123;</span><br><span class="line">        MUL_1(<span class="number">1</span>),</span><br><span class="line">        MUL_2(<span class="number">2</span>),</span><br><span class="line">        MUL_3(<span class="number">3</span>),</span><br><span class="line">        MUL_4(<span class="number">4</span>),</span><br><span class="line">        MUL_5(<span class="number">5</span>),</span><br><span class="line">        MUL_6(<span class="number">6</span>),</span><br><span class="line">        MUL_7(<span class="number">7</span>),</span><br><span class="line">        MUL_8(<span class="number">8</span>),</span><br><span class="line">        MUL_9(<span class="number">9</span>),</span><br><span class="line">        MUL_10(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">FONTMUL</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">CODEPAGE</span> &#123;</span><br><span class="line">        PC437(<span class="number">437</span>),</span><br><span class="line">        PC850(<span class="number">850</span>),</span><br><span class="line">        PC852(<span class="number">852</span>),</span><br><span class="line">        PC860(<span class="number">860</span>),</span><br><span class="line">        PC863(<span class="number">863</span>),</span><br><span class="line">        PC865(<span class="number">865</span>),</span><br><span class="line">        WPC1250(<span class="number">1250</span>),</span><br><span class="line">        WPC1252(<span class="number">1252</span>),</span><br><span class="line">        WPC1253(<span class="number">1253</span>),</span><br><span class="line">        WPC1254(<span class="number">1254</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">CODEPAGE</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">MIRROR</span> &#123;</span><br><span class="line">        NORMAL(<span class="number">0</span>),</span><br><span class="line">        MIRROR(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">MIRROR</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">DIRECTION</span> &#123;</span><br><span class="line">        FORWARD(<span class="number">0</span>),</span><br><span class="line">        BACKWARD(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">DIRECTION</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">DENSITY</span> &#123;</span><br><span class="line">        DNESITY0(<span class="number">0</span>),</span><br><span class="line">        DNESITY1(<span class="number">1</span>),</span><br><span class="line">        DNESITY2(<span class="number">2</span>),</span><br><span class="line">        DNESITY3(<span class="number">3</span>),</span><br><span class="line">        DNESITY4(<span class="number">4</span>),</span><br><span class="line">        DNESITY5(<span class="number">5</span>),</span><br><span class="line">        DNESITY6(<span class="number">6</span>),</span><br><span class="line">        DNESITY7(<span class="number">7</span>),</span><br><span class="line">        DNESITY8(<span class="number">8</span>),</span><br><span class="line">        DNESITY9(<span class="number">9</span>),</span><br><span class="line">        DNESITY10(<span class="number">10</span>),</span><br><span class="line">        DNESITY11(<span class="number">11</span>),</span><br><span class="line">        DNESITY12(<span class="number">12</span>),</span><br><span class="line">        DNESITY13(<span class="number">13</span>),</span><br><span class="line">        DNESITY14(<span class="number">14</span>),</span><br><span class="line">        DNESITY15(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">DENSITY</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">BITMAP_MODE</span> &#123;</span><br><span class="line">        OVERWRITE(<span class="number">0</span>),</span><br><span class="line">        OR(<span class="number">1</span>),</span><br><span class="line">        XOR(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">BITMAP_MODE</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">READABEL</span> &#123;</span><br><span class="line">        DISABLE(<span class="number">0</span>),</span><br><span class="line">        EANBEL(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">READABEL</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">SPEED</span> &#123;</span><br><span class="line">        SPEED1DIV5(<span class="number">1.5F</span>),</span><br><span class="line">        SPEED2(<span class="number">2.0F</span>),</span><br><span class="line">        SPEED3(<span class="number">3.0F</span>),</span><br><span class="line">        SPEED4(<span class="number">4.0F</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">SPEED</span><span class="params">(<span class="type">float</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">FOOT</span> &#123;</span><br><span class="line">        F2(<span class="number">0</span>),</span><br><span class="line">        F5(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">FOOT</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命令封装工具类"><a href="#命令封装工具类" class="headerlink" title="命令封装工具类"></a>命令封装工具类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.xx.yy.gpbt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap.CompressFormat;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap.Config;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.ColorMatrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.ColorMatrixColorFilter;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> com.masget.rcyltms.gpbt.LabelCommand.BITMAP_MODE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GpUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;([a-zA-Z0-9!@#$^&amp;*\\(\\)~\\&#123;\\&#125;:\&quot;,\\.&lt;&gt;/]+)&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p0 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">128</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p1 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">64</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p2 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">32</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p3 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">16</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p4 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">8</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p5 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] p6 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][] Floyd16x16 = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">128</span>, <span class="number">32</span>, <span class="number">160</span>, <span class="number">8</span>, <span class="number">136</span>, <span class="number">40</span>, <span class="number">168</span>, <span class="number">2</span>, <span class="number">130</span>, <span class="number">34</span>, <span class="number">162</span>, <span class="number">10</span>, <span class="number">138</span>, <span class="number">42</span>, <span class="number">170</span>&#125;, &#123;<span class="number">192</span>, <span class="number">64</span>, <span class="number">224</span>, <span class="number">96</span>, <span class="number">200</span>, <span class="number">72</span>, <span class="number">232</span>, <span class="number">104</span>, <span class="number">194</span>, <span class="number">66</span>, <span class="number">226</span>, <span class="number">98</span>, <span class="number">202</span>, <span class="number">74</span>, <span class="number">234</span>, <span class="number">106</span>&#125;, &#123;<span class="number">48</span>, <span class="number">176</span>, <span class="number">16</span>, <span class="number">144</span>, <span class="number">56</span>, <span class="number">184</span>, <span class="number">24</span>, <span class="number">152</span>, <span class="number">50</span>, <span class="number">178</span>, <span class="number">18</span>, <span class="number">146</span>, <span class="number">58</span>, <span class="number">186</span>, <span class="number">26</span>, <span class="number">154</span>&#125;, &#123;<span class="number">240</span>, <span class="number">112</span>, <span class="number">208</span>, <span class="number">80</span>, <span class="number">248</span>, <span class="number">120</span>, <span class="number">216</span>, <span class="number">88</span>, <span class="number">242</span>, <span class="number">114</span>, <span class="number">210</span>, <span class="number">82</span>, <span class="number">250</span>, <span class="number">122</span>, <span class="number">218</span>, <span class="number">90</span>&#125;, &#123;<span class="number">12</span>, <span class="number">140</span>, <span class="number">44</span>, <span class="number">172</span>, <span class="number">4</span>, <span class="number">132</span>, <span class="number">36</span>, <span class="number">164</span>, <span class="number">14</span>, <span class="number">142</span>, <span class="number">46</span>, <span class="number">174</span>, <span class="number">6</span>, <span class="number">134</span>, <span class="number">38</span>, <span class="number">166</span>&#125;, &#123;<span class="number">204</span>, <span class="number">76</span>, <span class="number">236</span>, <span class="number">108</span>, <span class="number">196</span>, <span class="number">68</span>, <span class="number">228</span>, <span class="number">100</span>, <span class="number">206</span>, <span class="number">78</span>, <span class="number">238</span>, <span class="number">110</span>, <span class="number">198</span>, <span class="number">70</span>, <span class="number">230</span>, <span class="number">102</span>&#125;, &#123;<span class="number">60</span>, <span class="number">188</span>, <span class="number">28</span>, <span class="number">156</span>, <span class="number">52</span>, <span class="number">180</span>, <span class="number">20</span>, <span class="number">148</span>, <span class="number">62</span>, <span class="number">190</span>, <span class="number">30</span>, <span class="number">158</span>, <span class="number">54</span>, <span class="number">182</span>, <span class="number">22</span>, <span class="number">150</span>&#125;, &#123;<span class="number">252</span>, <span class="number">124</span>, <span class="number">220</span>, <span class="number">92</span>, <span class="number">244</span>, <span class="number">116</span>, <span class="number">212</span>, <span class="number">84</span>, <span class="number">254</span>, <span class="number">126</span>, <span class="number">222</span>, <span class="number">94</span>, <span class="number">246</span>, <span class="number">118</span>, <span class="number">214</span>, <span class="number">86</span>&#125;, &#123;<span class="number">3</span>, <span class="number">131</span>, <span class="number">35</span>, <span class="number">163</span>, <span class="number">11</span>, <span class="number">139</span>, <span class="number">43</span>, <span class="number">171</span>, <span class="number">1</span>, <span class="number">129</span>, <span class="number">33</span>, <span class="number">161</span>, <span class="number">9</span>, <span class="number">137</span>, <span class="number">41</span>, <span class="number">169</span>&#125;, &#123;<span class="number">195</span>, <span class="number">67</span>, <span class="number">227</span>, <span class="number">99</span>, <span class="number">203</span>, <span class="number">75</span>, <span class="number">235</span>, <span class="number">107</span>, <span class="number">193</span>, <span class="number">65</span>, <span class="number">225</span>, <span class="number">97</span>, <span class="number">201</span>, <span class="number">73</span>, <span class="number">233</span>, <span class="number">105</span>&#125;, &#123;<span class="number">51</span>, <span class="number">179</span>, <span class="number">19</span>, <span class="number">147</span>, <span class="number">59</span>, <span class="number">187</span>, <span class="number">27</span>, <span class="number">155</span>, <span class="number">49</span>, <span class="number">177</span>, <span class="number">17</span>, <span class="number">145</span>, <span class="number">57</span>, <span class="number">185</span>, <span class="number">25</span>, <span class="number">153</span>&#125;, &#123;<span class="number">243</span>, <span class="number">115</span>, <span class="number">211</span>, <span class="number">83</span>, <span class="number">251</span>, <span class="number">123</span>, <span class="number">219</span>, <span class="number">91</span>, <span class="number">241</span>, <span class="number">113</span>, <span class="number">209</span>, <span class="number">81</span>, <span class="number">249</span>, <span class="number">121</span>, <span class="number">217</span>, <span class="number">89</span>&#125;, &#123;<span class="number">15</span>, <span class="number">143</span>, <span class="number">47</span>, <span class="number">175</span>, <span class="number">7</span>, <span class="number">135</span>, <span class="number">39</span>, <span class="number">167</span>, <span class="number">13</span>, <span class="number">141</span>, <span class="number">45</span>, <span class="number">173</span>, <span class="number">5</span>, <span class="number">133</span>, <span class="number">37</span>, <span class="number">165</span>&#125;, &#123;<span class="number">207</span>, <span class="number">79</span>, <span class="number">239</span>, <span class="number">111</span>, <span class="number">199</span>, <span class="number">71</span>, <span class="number">231</span>, <span class="number">103</span>, <span class="number">205</span>, <span class="number">77</span>, <span class="number">237</span>, <span class="number">109</span>, <span class="number">197</span>, <span class="number">69</span>, <span class="number">229</span>, <span class="number">101</span>&#125;, &#123;<span class="number">63</span>, <span class="number">191</span>, <span class="number">31</span>, <span class="number">159</span>, <span class="number">55</span>, <span class="number">183</span>, <span class="number">23</span>, <span class="number">151</span>, <span class="number">61</span>, <span class="number">189</span>, <span class="number">29</span>, <span class="number">157</span>, <span class="number">53</span>, <span class="number">181</span>, <span class="number">21</span>, <span class="number">149</span>&#125;, &#123;<span class="number">254</span>, <span class="number">127</span>, <span class="number">223</span>, <span class="number">95</span>, <span class="number">247</span>, <span class="number">119</span>, <span class="number">215</span>, <span class="number">87</span>, <span class="number">253</span>, <span class="number">125</span>, <span class="number">221</span>, <span class="number">93</span>, <span class="number">245</span>, <span class="number">117</span>, <span class="number">213</span>, <span class="number">85</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[][] Floyd8x8 = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">40</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">42</span>&#125;, &#123;<span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>&#125;, &#123;<span class="number">12</span>, <span class="number">44</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">46</span>, <span class="number">6</span>, <span class="number">38</span>&#125;, &#123;<span class="number">60</span>, <span class="number">28</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">54</span>, <span class="number">22</span>&#125;, &#123;<span class="number">3</span>, <span class="number">35</span>, <span class="number">11</span>, <span class="number">43</span>, <span class="number">1</span>, <span class="number">33</span>, <span class="number">9</span>, <span class="number">41</span>&#125;, &#123;<span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>&#125;, &#123;<span class="number">15</span>, <span class="number">47</span>, <span class="number">7</span>, <span class="number">39</span>, <span class="number">13</span>, <span class="number">45</span>, <span class="number">5</span>, <span class="number">37</span>&#125;, &#123;<span class="number">63</span>, <span class="number">31</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">53</span>, <span class="number">21</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAPER_58_WIDTH</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAPER_80_WIDTH</span> <span class="operator">=</span> <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sPaperWidth</span> <span class="operator">=</span> <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer[] theSet0 = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;Integer.valueOf(<span class="number">1569</span>), Integer.valueOf(<span class="number">1570</span>), Integer.valueOf(<span class="number">1571</span>), Integer.valueOf(<span class="number">1572</span>), Integer.valueOf(<span class="number">1573</span>), Integer.valueOf(<span class="number">1574</span>), Integer.valueOf(<span class="number">1575</span>), Integer.valueOf(<span class="number">1576</span>), Integer.valueOf(<span class="number">1577</span>), Integer.valueOf(<span class="number">1578</span>), Integer.valueOf(<span class="number">1579</span>), Integer.valueOf(<span class="number">1580</span>), Integer.valueOf(<span class="number">1581</span>), Integer.valueOf(<span class="number">1582</span>), Integer.valueOf(<span class="number">1583</span>), Integer.valueOf(<span class="number">1584</span>), Integer.valueOf(<span class="number">1585</span>), Integer.valueOf(<span class="number">1586</span>), Integer.valueOf(<span class="number">1587</span>), Integer.valueOf(<span class="number">1588</span>), Integer.valueOf(<span class="number">1589</span>), Integer.valueOf(<span class="number">1590</span>), Integer.valueOf(<span class="number">1591</span>), Integer.valueOf(<span class="number">1592</span>), Integer.valueOf(<span class="number">1593</span>), Integer.valueOf(<span class="number">1594</span>), Integer.valueOf(<span class="number">1601</span>), Integer.valueOf(<span class="number">1602</span>), Integer.valueOf(<span class="number">1603</span>), Integer.valueOf(<span class="number">1604</span>), Integer.valueOf(<span class="number">1605</span>), Integer.valueOf(<span class="number">1606</span>), Integer.valueOf(<span class="number">1607</span>), Integer.valueOf(<span class="number">1608</span>), Integer.valueOf(<span class="number">1609</span>), Integer.valueOf(<span class="number">1610</span>), Integer.valueOf(<span class="number">17442</span>), Integer.valueOf(<span class="number">17443</span>), Integer.valueOf(<span class="number">17445</span>), Integer.valueOf(<span class="number">17447</span>)&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer[][] FormatTable = <span class="keyword">new</span> <span class="title class_">Integer</span>[][]&#123;&#123;Integer.valueOf(<span class="string">&#x27;ﺀ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺀ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺀ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺀ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺁ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺂ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺁ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺂ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺃ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺄ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺃ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺄ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺅ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﹽ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﹽ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﹽ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﹽ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺋ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺋ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺋ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺋ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺍ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺎ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺍ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺎ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺏ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺏ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺑ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺑ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺓ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺓ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺓ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺓ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺕ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺕ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺗ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺗ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺙ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺙ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺛ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺛ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺝ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺝ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺟ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺟ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺡ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺡ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺣ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺣ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺥ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺥ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺧ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺧ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺩ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺩ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺩ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺩ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺫ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺫ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺫ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺫ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺭ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺯ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺯ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺯ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺯ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺱ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺱ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺳ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺳ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺵ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺵ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺷ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺷ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺹ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺹ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺻ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺻ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﺽ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺽ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺿ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﺿ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻁ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻁ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻁ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻁ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻅ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻅ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻉ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻊ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻋ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻌ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻍ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻎ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻏ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻐ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻑ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻑ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻓ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻓ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻕ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻕ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻗ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻗ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻙ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻙ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻛ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻛ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻝ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻝ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻟ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻟ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻡ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻡ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻣ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻣ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻥ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻥ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻧ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻧ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻩ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻩ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻫ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻫ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻭ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻭ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻯ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻰ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻯ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻰ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻱ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻲ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻳ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻳ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻵ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻶ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻵ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻶ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻷ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻸ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻷ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻸ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻹ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻺ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻹ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻺ&#x27;</span>)&#125;, &#123;Integer.valueOf(<span class="string">&#x27;ﻻ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻼ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻻ&#x27;</span>), Integer.valueOf(<span class="string">&#x27;ﻼ&#x27;</span>)&#125;&#125;;</span><br><span class="line">    <span class="keyword">static</span> Integer[] theSet1 = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;Integer.valueOf(<span class="number">1574</span>), Integer.valueOf(<span class="number">1576</span>), Integer.valueOf(<span class="number">1578</span>), Integer.valueOf(<span class="number">1579</span>), Integer.valueOf(<span class="number">1580</span>), Integer.valueOf(<span class="number">1581</span>), Integer.valueOf(<span class="number">1582</span>), Integer.valueOf(<span class="number">1587</span>), Integer.valueOf(<span class="number">1588</span>), Integer.valueOf(<span class="number">1589</span>), Integer.valueOf(<span class="number">1590</span>), Integer.valueOf(<span class="number">1591</span>), Integer.valueOf(<span class="number">1592</span>), Integer.valueOf(<span class="number">1593</span>), Integer.valueOf(<span class="number">1594</span>), Integer.valueOf(<span class="number">1600</span>), Integer.valueOf(<span class="number">1601</span>), Integer.valueOf(<span class="number">1602</span>), Integer.valueOf(<span class="number">1603</span>), Integer.valueOf(<span class="number">1604</span>), Integer.valueOf(<span class="number">1605</span>), Integer.valueOf(<span class="number">1606</span>), Integer.valueOf(<span class="number">1607</span>), Integer.valueOf(<span class="number">1610</span>)&#125;;</span><br><span class="line">    <span class="keyword">static</span> Integer[] theSet2 = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;Integer.valueOf(<span class="number">1570</span>), Integer.valueOf(<span class="number">1571</span>), Integer.valueOf(<span class="number">1572</span>), Integer.valueOf(<span class="number">1573</span>), Integer.valueOf(<span class="number">1574</span>), Integer.valueOf(<span class="number">1575</span>), Integer.valueOf(<span class="number">1576</span>), Integer.valueOf(<span class="number">1577</span>), Integer.valueOf(<span class="number">1578</span>), Integer.valueOf(<span class="number">1579</span>), Integer.valueOf(<span class="number">1580</span>), Integer.valueOf(<span class="number">1581</span>), Integer.valueOf(<span class="number">1582</span>), Integer.valueOf(<span class="number">1583</span>), Integer.valueOf(<span class="number">1584</span>), Integer.valueOf(<span class="number">1585</span>), Integer.valueOf(<span class="number">1586</span>), Integer.valueOf(<span class="number">1587</span>), Integer.valueOf(<span class="number">1588</span>), Integer.valueOf(<span class="number">1589</span>), Integer.valueOf(<span class="number">1590</span>), Integer.valueOf(<span class="number">1591</span>), Integer.valueOf(<span class="number">1592</span>), Integer.valueOf(<span class="number">1593</span>), Integer.valueOf(<span class="number">1594</span>), Integer.valueOf(<span class="number">1600</span>), Integer.valueOf(<span class="number">1601</span>), Integer.valueOf(<span class="number">1602</span>), Integer.valueOf(<span class="number">1603</span>), Integer.valueOf(<span class="number">1604</span>), Integer.valueOf(<span class="number">1605</span>), Integer.valueOf(<span class="number">1606</span>), Integer.valueOf(<span class="number">1607</span>), Integer.valueOf(<span class="number">1608</span>), Integer.valueOf(<span class="number">1609</span>), Integer.valueOf(<span class="number">1610</span>)&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ALGORITHM_DITHER_16x16</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ALGORITHM_DITHER_8x8</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ALGORITHM_TEXTMODE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ALGORITHM_GRAYTEXTMODE</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[][] COLOR_PALETTE = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">method</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FLOYD_STEINBERG_DITHER</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ATKINSON_DITHER</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GpUtils</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">resizeImage</span><span class="params">(Bitmap bitmap, <span class="type">int</span> w, <span class="type">int</span> h)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bitmap.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight();</span><br><span class="line">        <span class="type">float</span> <span class="variable">scaleWidth</span> <span class="operator">=</span> (<span class="type">float</span>)w / (<span class="type">float</span>)width;</span><br><span class="line">        <span class="type">float</span> <span class="variable">scaleHeight</span> <span class="operator">=</span> (<span class="type">float</span>)h / (<span class="type">float</span>)height;</span><br><span class="line">        <span class="type">Matrix</span> <span class="variable">matrix</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Matrix</span>();</span><br><span class="line">        matrix.postScale(scaleWidth, scaleHeight);</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">resizedBitmap</span> <span class="operator">=</span> Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, width, height, matrix, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> resizedBitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveMyBitmap</span><span class="params">(Bitmap mBitmap)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(Environment.getExternalStorageDirectory().getPath(), <span class="string">&quot;Btatotest.jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            f.createNewFile();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var6) &#123;</span><br><span class="line">            ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fOut</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fOut = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(f);</span><br><span class="line">            mBitmap.compress(CompressFormat.PNG, <span class="number">100</span>, fOut);</span><br><span class="line">            fOut.flush();</span><br><span class="line">            fOut.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException var4) &#123;</span><br><span class="line">            ;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var5) &#123;</span><br><span class="line">            ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">toGrayscale</span><span class="params">(Bitmap bmpOriginal)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bmpOriginal.getHeight();</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bmpOriginal.getWidth();</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bmpGrayscale</span> <span class="operator">=</span> Bitmap.createBitmap(width, height, Config.RGB_565);</span><br><span class="line">        <span class="type">Canvas</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Canvas</span>(bmpGrayscale);</span><br><span class="line">        <span class="type">Paint</span> <span class="variable">paint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paint</span>();</span><br><span class="line">        <span class="type">ColorMatrix</span> <span class="variable">cm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColorMatrix</span>();</span><br><span class="line">        cm.setSaturation(<span class="number">0.0F</span>);</span><br><span class="line">        <span class="type">ColorMatrixColorFilter</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColorMatrixColorFilter</span>(cm);</span><br><span class="line">        paint.setColorFilter(f);</span><br><span class="line">        c.drawBitmap(bmpOriginal, <span class="number">0.0F</span>, <span class="number">0.0F</span>, paint);</span><br><span class="line">        <span class="keyword">return</span> bmpGrayscale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] pixToEscRastBitImageCmd(<span class="type">byte</span>[] src, <span class="type">int</span> nWidth, <span class="type">int</span> nMode) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">nHeight</span> <span class="operator">=</span> src.length / nWidth;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">8</span> + src.length / <span class="number">8</span>];</span><br><span class="line">        data[<span class="number">0</span>] = <span class="number">29</span>;</span><br><span class="line">        data[<span class="number">1</span>] = <span class="number">118</span>;</span><br><span class="line">        data[<span class="number">2</span>] = <span class="number">48</span>;</span><br><span class="line">        data[<span class="number">3</span>] = (<span class="type">byte</span>)(nMode &amp; <span class="number">1</span>);</span><br><span class="line">        data[<span class="number">4</span>] = (<span class="type">byte</span>)(nWidth / <span class="number">8</span> % <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">5</span>] = (<span class="type">byte</span>)(nWidth / <span class="number">8</span> / <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">6</span>] = (<span class="type">byte</span>)(nHeight % <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">7</span>] = (<span class="type">byte</span>)(nHeight / <span class="number">256</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; ++i) &#123;</span><br><span class="line">            data[i] = (<span class="type">byte</span>)(p0[src[k]] + p1[src[k + <span class="number">1</span>]] + p2[src[k + <span class="number">2</span>]] + p3[src[k + <span class="number">3</span>]] + p4[src[k + <span class="number">4</span>]] + p5[src[k + <span class="number">5</span>]] + p6[src[k + <span class="number">6</span>]] + src[k + <span class="number">7</span>]);</span><br><span class="line">            k += <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] pixToEscRastBitImageCmd(<span class="type">byte</span>[] src) &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[src.length / <span class="number">8</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.length; ++i) &#123;</span><br><span class="line">            data[i] = (<span class="type">byte</span>)(p0[src[k]] + p1[src[k + <span class="number">1</span>]] + p2[src[k + <span class="number">2</span>]] + p3[src[k + <span class="number">3</span>]] + p4[src[k + <span class="number">4</span>]] + p5[src[k + <span class="number">5</span>]] + p6[src[k + <span class="number">6</span>]] + src[k + <span class="number">7</span>]);</span><br><span class="line">            k += <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] pixToEscNvBitImageCmd(<span class="type">byte</span>[] src, <span class="type">int</span> width, <span class="type">int</span> height) &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[src.length / <span class="number">8</span> + <span class="number">4</span>];</span><br><span class="line">        data[<span class="number">0</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> % <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">1</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span> / <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">2</span>] = (<span class="type">byte</span>)(height / <span class="number">8</span> % <span class="number">256</span>);</span><br><span class="line">        data[<span class="number">3</span>] = (<span class="type">byte</span>)(height / <span class="number">8</span> / <span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; width; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; height / <span class="number">8</span>; ++j) &#123;</span><br><span class="line">                data[<span class="number">4</span> + j + i * height / <span class="number">8</span>] = (<span class="type">byte</span>)(p0[src[i + k]] + p1[src[i + k + <span class="number">1</span> * width]] + p2[src[i + k + <span class="number">2</span> * width]] + p3[src[i + k + <span class="number">3</span> * width]] + p4[src[i + k + <span class="number">4</span> * width]] + p5[src[i + k + <span class="number">5</span> * width]] + p6[src[i + k + <span class="number">6</span> * width]] + src[i + k + <span class="number">7</span> * width]);</span><br><span class="line">                k += <span class="number">8</span> * width;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] pixToLabelCmd(<span class="type">byte</span>[] src) &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[src.length / <span class="number">8</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; data.length; ++k) &#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">temp</span> <span class="operator">=</span> (<span class="type">byte</span>)(p0[src[j]] + p1[src[j + <span class="number">1</span>]] + p2[src[j + <span class="number">2</span>]] + p3[src[j + <span class="number">3</span>]] + p4[src[j + <span class="number">4</span>]] + p5[src[j + <span class="number">5</span>]] + p6[src[j + <span class="number">6</span>]] + src[j + <span class="number">7</span>]);</span><br><span class="line">            data[k] = (<span class="type">byte</span>)(~temp);</span><br><span class="line">            j += <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] pixToTscCmd(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> mode, <span class="type">byte</span>[] src, <span class="type">int</span> nWidth) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> src.length / nWidth;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> nWidth / <span class="number">8</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BITMAP &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + width + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + mode + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] bitmap = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bitmap = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var13) &#123;</span><br><span class="line">            var13.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] arrayOfByte = <span class="keyword">new</span> <span class="title class_">byte</span>[src.length / <span class="number">8</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; arrayOfByte.length; ++k) &#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">temp</span> <span class="operator">=</span> (<span class="type">byte</span>)(p0[src[j]] + p1[src[j + <span class="number">1</span>]] + p2[src[j + <span class="number">2</span>]] + p3[src[j + <span class="number">3</span>]] + p4[src[j + <span class="number">4</span>]] + p5[src[j + <span class="number">5</span>]] + p6[src[j + <span class="number">6</span>]] + src[j + <span class="number">7</span>]);</span><br><span class="line">            arrayOfByte[k] = (<span class="type">byte</span>)(~temp);</span><br><span class="line">            j += <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[bitmap.length + arrayOfByte.length];</span><br><span class="line">        System.arraycopy(bitmap, <span class="number">0</span>, data, <span class="number">0</span>, bitmap.length);</span><br><span class="line">        System.arraycopy(arrayOfByte, <span class="number">0</span>, data, bitmap.length, arrayOfByte.length);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">format_K_dither16x16</span><span class="params">(<span class="type">int</span>[] orgpixels, <span class="type">int</span> xsize, <span class="type">int</span> ysize, <span class="type">byte</span>[] despixels)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; ysize; ++y) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; xsize; ++x) &#123;</span><br><span class="line">                <span class="keyword">if</span>((orgpixels[k] &amp; <span class="number">255</span>) &gt; Floyd16x16[x &amp; <span class="number">15</span>][y &amp; <span class="number">15</span>]) &#123;</span><br><span class="line">                    despixels[k] = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    despixels[k] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ++k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] bitmapToBWPix(Bitmap mBitmap) &#123;</span><br><span class="line">        <span class="type">int</span>[] pixels = <span class="keyword">new</span> <span class="title class_">int</span>[mBitmap.getWidth() * mBitmap.getHeight()];</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[mBitmap.getWidth() * mBitmap.getHeight()];</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">grayBitmap</span> <span class="operator">=</span> toGrayscale(mBitmap);</span><br><span class="line">        grayBitmap.getPixels(pixels, <span class="number">0</span>, mBitmap.getWidth(), <span class="number">0</span>, <span class="number">0</span>, mBitmap.getWidth(), mBitmap.getHeight());</span><br><span class="line">        format_K_dither16x16(pixels, grayBitmap.getWidth(), grayBitmap.getHeight(), data);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">format_K_dither16x16_int</span><span class="params">(<span class="type">int</span>[] orgpixels, <span class="type">int</span> xsize, <span class="type">int</span> ysize, <span class="type">int</span>[] despixels)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; ysize; ++y) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; xsize; ++x) &#123;</span><br><span class="line">                <span class="keyword">if</span>((orgpixels[k] &amp; <span class="number">255</span>) &gt; Floyd16x16[x &amp; <span class="number">15</span>][y &amp; <span class="number">15</span>]) &#123;</span><br><span class="line">                    despixels[k] = -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    despixels[k] = -<span class="number">16777216</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ++k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">format_K_dither8x8_int</span><span class="params">(<span class="type">int</span>[] orgpixels, <span class="type">int</span> xsize, <span class="type">int</span> ysize, <span class="type">int</span>[] despixels)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">0</span>; y &lt; ysize; ++y) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt; xsize; ++x) &#123;</span><br><span class="line">                <span class="keyword">if</span>((orgpixels[k] &amp; <span class="number">255</span>) &gt;&gt; <span class="number">2</span> &gt; Floyd8x8[x &amp; <span class="number">7</span>][y &amp; <span class="number">7</span>]) &#123;</span><br><span class="line">                    despixels[k] = -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    despixels[k] = -<span class="number">16777216</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ++k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] bitmapToBWPix_int(Bitmap mBitmap, <span class="type">int</span> algorithm) &#123;</span><br><span class="line">        <span class="type">int</span>[] pixels = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        Bitmap grayBitmap;</span><br><span class="line">        <span class="keyword">switch</span>(algorithm) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                grayBitmap = toGrayscale(mBitmap);</span><br><span class="line">                pixels = <span class="keyword">new</span> <span class="title class_">int</span>[grayBitmap.getWidth() * grayBitmap.getHeight()];</span><br><span class="line">                grayBitmap.getPixels(pixels, <span class="number">0</span>, grayBitmap.getWidth(), <span class="number">0</span>, <span class="number">0</span>, grayBitmap.getWidth(), grayBitmap.getHeight());</span><br><span class="line">                format_K_dither8x8_int(pixels, grayBitmap.getWidth(), grayBitmap.getHeight(), pixels);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                grayBitmap = toGrayscale(mBitmap);</span><br><span class="line">                pixels = <span class="keyword">new</span> <span class="title class_">int</span>[grayBitmap.getWidth() * grayBitmap.getHeight()];</span><br><span class="line">                grayBitmap.getPixels(pixels, <span class="number">0</span>, grayBitmap.getWidth(), <span class="number">0</span>, <span class="number">0</span>, grayBitmap.getWidth(), grayBitmap.getHeight());</span><br><span class="line">                format_K_dither16x16_int(pixels, grayBitmap.getWidth(), grayBitmap.getHeight(), pixels);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pixels;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">toBinaryImage</span><span class="params">(Bitmap mBitmap, <span class="type">int</span> nWidth, <span class="type">int</span> algorithm)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> (nWidth + <span class="number">7</span>) / <span class="number">8</span> * <span class="number">8</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> mBitmap.getHeight() * width / mBitmap.getWidth();</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">rszBitmap</span> <span class="operator">=</span> resizeImage(mBitmap, width, height);</span><br><span class="line">        <span class="type">int</span>[] pixels = bitmapToBWPix_int(rszBitmap, algorithm);</span><br><span class="line">        rszBitmap.setPixels(pixels, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="keyword">return</span> rszBitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getCloseColor</span><span class="params">(<span class="type">int</span> tr, <span class="type">int</span> tg, <span class="type">int</span> tb)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minDistanceSquared</span> <span class="operator">=</span> <span class="number">195076</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">bestIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; COLOR_PALETTE.length; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">rdiff</span> <span class="operator">=</span> tr - COLOR_PALETTE[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">gdiff</span> <span class="operator">=</span> tg - COLOR_PALETTE[i][<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">bdiff</span> <span class="operator">=</span> tb - COLOR_PALETTE[i][<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">distanceSquared</span> <span class="operator">=</span> rdiff * rdiff + gdiff * gdiff + bdiff * bdiff;</span><br><span class="line">            <span class="keyword">if</span>(distanceSquared &lt; minDistanceSquared) &#123;</span><br><span class="line">                minDistanceSquared = distanceSquared;</span><br><span class="line">                bestIndex = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bestIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setPixel</span><span class="params">(<span class="type">int</span>[] input, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> col, <span class="type">int</span> row, <span class="type">int</span>[] p)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(col &lt; <span class="number">0</span> || col &gt;= width) &#123;</span><br><span class="line">            col = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">0</span> || row &gt;= height) &#123;</span><br><span class="line">            row = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> row * width + col;</span><br><span class="line">        input[index] = -<span class="number">16777216</span> | clamp(p[<span class="number">0</span>]) &lt;&lt; <span class="number">16</span> | clamp(p[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span> | clamp(p[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] getPixel(<span class="type">int</span>[] input, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> col, <span class="type">int</span> row, <span class="type">float</span> error, <span class="type">int</span>[] ergb) &#123;</span><br><span class="line">        <span class="keyword">if</span>(col &lt; <span class="number">0</span> || col &gt;= width) &#123;</span><br><span class="line">            col = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(row &lt; <span class="number">0</span> || row &gt;= height) &#123;</span><br><span class="line">            row = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> row * width + col;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tr</span> <span class="operator">=</span> input[index] &gt;&gt; <span class="number">16</span> &amp; <span class="number">255</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tg</span> <span class="operator">=</span> input[index] &gt;&gt; <span class="number">8</span> &amp; <span class="number">255</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tb</span> <span class="operator">=</span> input[index] &amp; <span class="number">255</span>;</span><br><span class="line">        tr = (<span class="type">int</span>)((<span class="type">float</span>)tr + error * (<span class="type">float</span>)ergb[<span class="number">0</span>]);</span><br><span class="line">        tg = (<span class="type">int</span>)((<span class="type">float</span>)tg + error * (<span class="type">float</span>)ergb[<span class="number">1</span>]);</span><br><span class="line">        tb = (<span class="type">int</span>)((<span class="type">float</span>)tb + error * (<span class="type">float</span>)ergb[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;tr, tg, tb&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">clamp</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value &gt; <span class="number">255</span>?<span class="number">255</span>:(value &lt; <span class="number">0</span>?<span class="number">0</span>:value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">filter</span><span class="params">(Bitmap nbm, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] inPixels = <span class="keyword">new</span> <span class="title class_">int</span>[width * height];</span><br><span class="line">        nbm.getPixels(inPixels, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="type">int</span>[] outPixels = <span class="keyword">new</span> <span class="title class_">int</span>[inPixels.length];</span><br><span class="line"><span class="comment">//        int index = false;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> <span class="number">0</span>; row &lt; height; ++row) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">col</span> <span class="operator">=</span> <span class="number">0</span>; col &lt; width; ++col) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> row * width + col;</span><br><span class="line">                <span class="type">int</span> <span class="variable">r1</span> <span class="operator">=</span> inPixels[index] &gt;&gt; <span class="number">16</span> &amp; <span class="number">255</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">g1</span> <span class="operator">=</span> inPixels[index] &gt;&gt; <span class="number">8</span> &amp; <span class="number">255</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">b1</span> <span class="operator">=</span> inPixels[index] &amp; <span class="number">255</span>;</span><br><span class="line">                <span class="type">int</span> <span class="variable">cIndex</span> <span class="operator">=</span> getCloseColor(r1, g1, b1);</span><br><span class="line">                outPixels[index] = -<span class="number">16777216</span> | COLOR_PALETTE[cIndex][<span class="number">0</span>] &lt;&lt; <span class="number">16</span> | COLOR_PALETTE[cIndex][<span class="number">1</span>] &lt;&lt; <span class="number">8</span> | COLOR_PALETTE[cIndex][<span class="number">2</span>];</span><br><span class="line">                <span class="type">int</span>[] ergb = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;r1 - COLOR_PALETTE[cIndex][<span class="number">0</span>], g1 - COLOR_PALETTE[cIndex][<span class="number">1</span>], b1 - COLOR_PALETTE[cIndex][<span class="number">2</span>]&#125;;</span><br><span class="line">                <span class="type">float</span> e1;</span><br><span class="line">                <span class="type">int</span>[] rgb4;</span><br><span class="line">                <span class="type">int</span>[] rgb5;</span><br><span class="line">                <span class="type">int</span>[] rgb6;</span><br><span class="line">                <span class="keyword">if</span>(method == <span class="number">1</span>) &#123;</span><br><span class="line">                    e1 = <span class="number">0.4375F</span>;</span><br><span class="line">                    <span class="type">float</span> <span class="variable">e2</span> <span class="operator">=</span> <span class="number">0.3125F</span>;</span><br><span class="line">                    <span class="type">float</span> <span class="variable">e3</span> <span class="operator">=</span> <span class="number">0.1875F</span>;</span><br><span class="line">                    <span class="type">float</span> <span class="variable">e4</span> <span class="operator">=</span> <span class="number">0.0625F</span>;</span><br><span class="line">                    rgb4 = getPixel(inPixels, width, height, col + <span class="number">1</span>, row, e1, ergb);</span><br><span class="line">                    rgb5 = getPixel(inPixels, width, height, col, row + <span class="number">1</span>, e2, ergb);</span><br><span class="line">                    rgb6 = getPixel(inPixels, width, height, col - <span class="number">1</span>, row + <span class="number">1</span>, e3, ergb);</span><br><span class="line">                    <span class="comment">//int[] rgb4 = getPixel(inPixels, width, height, col + 1, row + 1, e4, ergb);</span></span><br><span class="line">                    rgb4 = getPixel(inPixels, width, height, col + <span class="number">1</span>, row + <span class="number">1</span>, e4, ergb);</span><br><span class="line">                    setPixel(inPixels, width, height, col + <span class="number">1</span>, row, rgb4);</span><br><span class="line">                    setPixel(inPixels, width, height, col, row + <span class="number">1</span>, rgb5);</span><br><span class="line">                    setPixel(inPixels, width, height, col - <span class="number">1</span>, row + <span class="number">1</span>, rgb6);</span><br><span class="line">                    setPixel(inPixels, width, height, col + <span class="number">1</span>, row + <span class="number">1</span>, rgb4);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(method != <span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Not Supported Dither Mothed!!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    e1 = <span class="number">0.125F</span>;</span><br><span class="line">                    <span class="type">int</span>[] rgb1 = getPixel(inPixels, width, height, col + <span class="number">1</span>, row, e1, ergb);</span><br><span class="line">                    <span class="type">int</span>[] rgb2 = getPixel(inPixels, width, height, col + <span class="number">2</span>, row, e1, ergb);</span><br><span class="line">                    <span class="type">int</span>[] rgb3 = getPixel(inPixels, width, height, col - <span class="number">1</span>, row + <span class="number">1</span>, e1, ergb);</span><br><span class="line">                    rgb4 = getPixel(inPixels, width, height, col, row + <span class="number">1</span>, e1, ergb);</span><br><span class="line">                    rgb5 = getPixel(inPixels, width, height, col + <span class="number">1</span>, row + <span class="number">1</span>, e1, ergb);</span><br><span class="line">                    rgb6 = getPixel(inPixels, width, height, col, row + <span class="number">2</span>, e1, ergb);</span><br><span class="line">                    setPixel(inPixels, width, height, col + <span class="number">1</span>, row, rgb1);</span><br><span class="line">                    setPixel(inPixels, width, height, col + <span class="number">2</span>, row, rgb2);</span><br><span class="line">                    setPixel(inPixels, width, height, col - <span class="number">1</span>, row + <span class="number">1</span>, rgb3);</span><br><span class="line">                    setPixel(inPixels, width, height, col, row + <span class="number">1</span>, rgb4);</span><br><span class="line">                    setPixel(inPixels, width, height, col + <span class="number">1</span>, row + <span class="number">1</span>, rgb5);</span><br><span class="line">                    setPixel(inPixels, width, height, col, row + <span class="number">2</span>, rgb6);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> Bitmap.createBitmap(outPixels, <span class="number">0</span>, width, width, height, Config.RGB_565);</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] printEscDraw(Bitmap bitmap) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bitmap.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight();</span><br><span class="line">        <span class="type">byte</span>[] bitbuf = <span class="keyword">new</span> <span class="title class_">byte</span>[width / <span class="number">8</span>];</span><br><span class="line">        <span class="type">byte</span>[] imgbuf = <span class="keyword">new</span> <span class="title class_">byte</span>[width / <span class="number">8</span> * height + <span class="number">8</span>];</span><br><span class="line">        imgbuf[<span class="number">0</span>] = <span class="number">29</span>;</span><br><span class="line">        imgbuf[<span class="number">1</span>] = <span class="number">118</span>;</span><br><span class="line">        imgbuf[<span class="number">2</span>] = <span class="number">48</span>;</span><br><span class="line">        imgbuf[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">        imgbuf[<span class="number">4</span>] = (<span class="type">byte</span>)(width / <span class="number">8</span>);</span><br><span class="line">        imgbuf[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">        imgbuf[<span class="number">6</span>] = (<span class="type">byte</span>)(height % <span class="number">256</span>);</span><br><span class="line">        imgbuf[<span class="number">7</span>] = (<span class="type">byte</span>)(height / <span class="number">256</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; height; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> k;</span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; width / <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">c0</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span>, i);</span><br><span class="line">                <span class="type">byte</span> p0;</span><br><span class="line">                <span class="keyword">if</span>(c0 != -<span class="number">1</span> &amp;&amp; c0 != <span class="number">0</span>) &#123;</span><br><span class="line">                    p0 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p0 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c1</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">1</span>, i);</span><br><span class="line">                <span class="type">byte</span> p1;</span><br><span class="line">                <span class="keyword">if</span>(c1 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p1 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p1 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c2</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">2</span>, i);</span><br><span class="line">                <span class="type">byte</span> p2;</span><br><span class="line">                <span class="keyword">if</span>(c2 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p2 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p2 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c3</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">3</span>, i);</span><br><span class="line">                <span class="type">byte</span> p3;</span><br><span class="line">                <span class="keyword">if</span>(c3 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p3 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p3 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c4</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">4</span>, i);</span><br><span class="line">                <span class="type">byte</span> p4;</span><br><span class="line">                <span class="keyword">if</span>(c4 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p4 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p4 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c5</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">5</span>, i);</span><br><span class="line">                <span class="type">byte</span> p5;</span><br><span class="line">                <span class="keyword">if</span>(c5 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p5 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p5 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c6</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">6</span>, i);</span><br><span class="line">                <span class="type">byte</span> p6;</span><br><span class="line">                <span class="keyword">if</span>(c6 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p6 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p6 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c7</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">7</span>, i);</span><br><span class="line">                <span class="type">byte</span> p7;</span><br><span class="line">                <span class="keyword">if</span>(c7 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p7 = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p7 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p0 * <span class="number">128</span> + p1 * <span class="number">64</span> + p2 * <span class="number">32</span> + p3 * <span class="number">16</span> + p4 * <span class="number">8</span> + p5 * <span class="number">4</span> + p6 * <span class="number">2</span> + p7;</span><br><span class="line">                bitbuf[k] = (<span class="type">byte</span>)value;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; width / <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                ++s;</span><br><span class="line">                imgbuf[s] = bitbuf[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> imgbuf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] printTscDraw(<span class="type">int</span> x, <span class="type">int</span> y, BITMAP_MODE mode, Bitmap bitmap) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> bitmap.getWidth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> bitmap.getHeight();</span><br><span class="line">        <span class="type">byte</span>[] bitbuf = <span class="keyword">new</span> <span class="title class_">byte</span>[width / <span class="number">8</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;BITMAP &quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;,&quot;</span> + width / <span class="number">8</span> + <span class="string">&quot;,&quot;</span> + height + <span class="string">&quot;,&quot;</span> + mode.getValue() + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] strPrint = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            strPrint = str.getBytes(<span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var30) &#123;</span><br><span class="line">            var30.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] imgbuf = <span class="keyword">new</span> <span class="title class_">byte</span>[width / <span class="number">8</span> * height + strPrint.length + <span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> s;</span><br><span class="line">        <span class="keyword">for</span>(s = <span class="number">0</span>; s &lt; strPrint.length; ++s) &#123;</span><br><span class="line">            imgbuf[s] = strPrint[s];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s = strPrint.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; height; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> k;</span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; width / <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">c0</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span>, i);</span><br><span class="line">                <span class="type">byte</span> p0;</span><br><span class="line">                <span class="keyword">if</span>(c0 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p0 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p0 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c1</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">1</span>, i);</span><br><span class="line">                <span class="type">byte</span> p1;</span><br><span class="line">                <span class="keyword">if</span>(c1 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p1 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p1 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c2</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">2</span>, i);</span><br><span class="line">                <span class="type">byte</span> p2;</span><br><span class="line">                <span class="keyword">if</span>(c2 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p2 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p2 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c3</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">3</span>, i);</span><br><span class="line">                <span class="type">byte</span> p3;</span><br><span class="line">                <span class="keyword">if</span>(c3 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p3 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p3 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c4</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">4</span>, i);</span><br><span class="line">                <span class="type">byte</span> p4;</span><br><span class="line">                <span class="keyword">if</span>(c4 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p4 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p4 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c5</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">5</span>, i);</span><br><span class="line">                <span class="type">byte</span> p5;</span><br><span class="line">                <span class="keyword">if</span>(c5 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p5 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p5 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c6</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">6</span>, i);</span><br><span class="line">                <span class="type">byte</span> p6;</span><br><span class="line">                <span class="keyword">if</span>(c6 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p6 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p6 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">c7</span> <span class="operator">=</span> bitmap.getPixel(k * <span class="number">8</span> + <span class="number">7</span>, i);</span><br><span class="line">                <span class="type">byte</span> p7;</span><br><span class="line">                <span class="keyword">if</span>(c7 == -<span class="number">1</span>) &#123;</span><br><span class="line">                    p7 = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p7 = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p0 * <span class="number">128</span> + p1 * <span class="number">64</span> + p2 * <span class="number">32</span> + p3 * <span class="number">16</span> + p4 * <span class="number">8</span> + p5 * <span class="number">4</span> + p6 * <span class="number">2</span> + p7;</span><br><span class="line">                bitbuf[k] = (<span class="type">byte</span>)value;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; width / <span class="number">8</span>; ++k) &#123;</span><br><span class="line">                ++s;</span><br><span class="line">                imgbuf[s] = bitbuf[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> imgbuf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">splitArabic</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">256</span>);</span><br><span class="line">        String[] arabics = input.split(<span class="string">&quot;\\n&quot;</span>);</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">int</span> lastArabic;</span><br><span class="line">        <span class="keyword">if</span>(arabics.length == <span class="number">1</span> &amp;&amp; arabics[<span class="number">0</span>].length() &gt; sPaperWidth) &#123;</span><br><span class="line">            i = arabics[<span class="number">0</span>].length() / sPaperWidth;</span><br><span class="line">            lastArabic = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; lastArabic &lt;= i; ++lastArabic) &#123;</span><br><span class="line">                sb.append(arabics[<span class="number">0</span>].substring(j, sPaperWidth * lastArabic));</span><br><span class="line">                j += sPaperWidth;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(sb.length() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            lastArabic = arabics[<span class="number">0</span>].length() % sPaperWidth;</span><br><span class="line">            sb.append(arabics[<span class="number">0</span>].substring(arabics[<span class="number">0</span>].length() - lastArabic, arabics[<span class="number">0</span>].length()));</span><br><span class="line">            <span class="keyword">return</span> splitArabic(sb.toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; arabics.length; ++i) &#123;</span><br><span class="line">                lastArabic = arabics[i].length();</span><br><span class="line">                <span class="keyword">if</span>(lastArabic &gt; sPaperWidth) &#123;</span><br><span class="line">                    sb.append(splitArabic(arabics[i]));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    sb.append(addSpaceAfterArabicString(arabics[i], sPaperWidth - lastArabic));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String <span class="title function_">addSpaceAfterArabicString</span><span class="params">(String arabic, <span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">65</span>);</span><br><span class="line">        sb.append(arabic);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; number; ++i) &#123;</span><br><span class="line">            sb.append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sb.append(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reverseLetterAndNumber</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(input);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(input);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(matcher.find()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">matcherString</span> <span class="operator">=</span> matcher.group();</span><br><span class="line">            <span class="type">int</span> <span class="variable">matcherStart</span> <span class="operator">=</span> matcher.start();</span><br><span class="line">            <span class="type">int</span> <span class="variable">matcherEnd</span> <span class="operator">=</span> matcher.end();</span><br><span class="line">            sb.replace(matcherStart, matcherEnd, (<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(matcherString)).reverse().toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] string2Cp864(String arabicString) &#123;</span><br><span class="line">        Integer[] originUnicode = <span class="keyword">new</span> <span class="title class_">Integer</span>[arabicString.length()];</span><br><span class="line">        Integer[] outputUnicode = <span class="keyword">new</span> <span class="title class_">Integer</span>[arabicString.length()];</span><br><span class="line">        Integer[] outputChars = <span class="keyword">new</span> <span class="title class_">Integer</span>[originUnicode.length];</span><br><span class="line">        copy(arabicString.toCharArray(), originUnicode, arabicString.length());</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(Arrays.asList(originUnicode));</span><br><span class="line">        List&lt;Integer&gt; list1 = Hyphen(list);</span><br><span class="line">        list = Deformation(list1);</span><br><span class="line">        Collections.reverse(list1);</span><br><span class="line">        list1.toArray(outputUnicode);</span><br><span class="line">        <span class="type">char</span>[] chs = integer2Character(outputUnicode);</span><br><span class="line">        <span class="type">byte</span>[] cp864bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cp864bytes = (<span class="keyword">new</span> <span class="title class_">String</span>(chs)).getBytes(<span class="string">&quot;cp864&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException var8) &#123;</span><br><span class="line">            var8.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cp864bytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span>[] integer2Character(Integer[] integers) &#123;</span><br><span class="line">        <span class="type">char</span>[] chs = <span class="keyword">new</span> <span class="title class_">char</span>[integers.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; integers.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(integers[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">                chs[i] = (<span class="type">char</span>)integers[i].intValue();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                chs[i] = <span class="number">32</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(<span class="type">char</span>[] array, Integer[] originUnicode, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">            originUnicode[i] = Integer.valueOf(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">Hyphen</span><span class="params">(List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(((Integer)list.get(i)).intValue() == <span class="number">1604</span>) &#123;</span><br><span class="line">                <span class="keyword">switch</span>(((Integer)list.get(i + <span class="number">1</span>)).intValue()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1570</span>:</span><br><span class="line">                        list.set(i, Integer.valueOf(<span class="number">17442</span>));</span><br><span class="line">                        list.remove(i + <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1571</span>:</span><br><span class="line">                        list.set(i, Integer.valueOf(<span class="number">17443</span>));</span><br><span class="line">                        list.remove(i + <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1572</span>:</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1574</span>:</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1573</span>:</span><br><span class="line">                        list.set(i, Integer.valueOf(<span class="number">17445</span>));</span><br><span class="line">                        list.remove(i + <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">1575</span>:</span><br><span class="line">                        list.set(i, Integer.valueOf(<span class="number">17447</span>));</span><br><span class="line">                        list.remove(i + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">Deformation</span><span class="params">(List&lt;Integer&gt; inputlist)</span> &#123;</span><br><span class="line"><span class="comment">//        int flag = false;</span></span><br><span class="line">        List&lt;Integer&gt; outputlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        Map&lt;Integer, Integer[]&gt; formHashTable = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">40</span>; ++i) &#123;</span><br><span class="line">            formHashTable.put(theSet0[i], FormatTable[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; inputlist.size(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(compare((Integer)inputlist.get(i), <span class="number">0</span>)) &#123;</span><br><span class="line">                <span class="type">boolean</span> inSet1;</span><br><span class="line">                <span class="type">boolean</span> inSet2;</span><br><span class="line">                <span class="type">int</span> flag;</span><br><span class="line">                <span class="keyword">if</span>(i == <span class="number">0</span>) &#123;</span><br><span class="line">                    inSet1 = <span class="literal">false</span>;</span><br><span class="line">                    inSet2 = compare((Integer)inputlist.get(i + <span class="number">1</span>), <span class="number">2</span>);</span><br><span class="line">                    flag = Flag(inSet1, inSet2);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(i == inputlist.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                    inSet1 = compare((Integer)inputlist.get(i - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">                    inSet2 = <span class="literal">false</span>;</span><br><span class="line">                    flag = Flag(inSet1, inSet2);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    inSet1 = compare((Integer)inputlist.get(i - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">                    inSet2 = compare((Integer)inputlist.get(i + <span class="number">1</span>), <span class="number">2</span>);</span><br><span class="line">                    flag = Flag(inSet1, inSet2);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Integer[] a = (Integer[])formHashTable.get(inputlist.get(i));</span><br><span class="line">                outputlist.add(a[flag]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                outputlist.add(inputlist.get(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> outputlist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">compare</span><span class="params">(Integer input, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        List&lt;Integer[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">3</span>);</span><br><span class="line">        list.add(theSet0);</span><br><span class="line">        list.add(theSet1);</span><br><span class="line">        list.add(theSet2);</span><br><span class="line">        <span class="keyword">return</span> findInArray((Integer[])list.get(i), input.intValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">findInArray</span><span class="params">(Integer[] integer, <span class="type">int</span> input)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; integer.length; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(integer[j].intValue() == input) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">Flag</span><span class="params">(<span class="type">boolean</span> set1, <span class="type">boolean</span> set2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> set1 &amp;&amp; set2?<span class="number">3</span>:(!set1 &amp;&amp; set2?<span class="number">2</span>:(set1 &amp;&amp; !set2?<span class="number">1</span>:<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setPaperWidth</span><span class="params">(<span class="type">int</span> paperWidth)</span> &#123;</span><br><span class="line">        sPaperWidth = paperWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] ByteTo_byte(Vector&lt;Byte&gt; vector) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> vector.size();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[len];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            data[i] = ((Byte)vector.get(i)).byteValue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> method;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setMethod</span><span class="params">(<span class="type">int</span> method)</span> &#123;</span><br><span class="line">        method = method;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他类的一些方法"><a href="#其他类的一些方法" class="headerlink" title="其他类的一些方法"></a>其他类的一些方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xx.yy.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2018/11/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PictureUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * base64字符串转位图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> base64String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title function_">base64StringToBitmap</span><span class="params">(String base64String)</span> &#123;</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Value</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] strArr =base64String.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(strArr.length==<span class="number">1</span>)&#123;</span><br><span class="line">                base64Value = strArr[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(strArr.length==<span class="number">2</span>)&#123;</span><br><span class="line">                base64Value = strArr[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] bitmapArray = Base64.decode(base64Value, Base64.DEFAULT);</span><br><span class="line">            bitmap = BitmapFactory.decodeByteArray(bitmapArray, <span class="number">0</span>, bitmapArray.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回base64字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bitmap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">bitmaptoBase64String</span><span class="params">(Bitmap bitmap)</span> &#123;</span><br><span class="line">        <span class="comment">//将Bitmap转换成字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        bitmap.compress(Bitmap.CompressFormat.PNG, <span class="number">100</span>, bStream);</span><br><span class="line">        <span class="type">byte</span>[] bytes = bStream.toByteArray();</span><br><span class="line">        string = Base64.encodeToString(bytes, Base64.DEFAULT);</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>以上就是使用<code>ESC</code>和<code>TSC</code>命令做打印的<code>Android</code>源码</p>
<p>有些打印机只支持<code>ESC</code>，有些只支持<code>TSC</code>,也有两种命令都支持的，两种都支持的可能要在打印机上做模式切换，不然有可能打印不执行，要么就是乱码</p>
]]></content>
      <categories>
        <category>react-native</category>
      </categories>
      <tags>
        <tag>react-native</tag>
      </tags>
  </entry>
  <entry>
    <title>Git与tortoisegit的使用</title>
    <url>/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="Git工具"><a href="#Git工具" class="headerlink" title="Git工具"></a>Git工具</h2><p>GIT （分布式版本控制系统）,下载地址： <a href="https://git-scm.com/downloads/">https://git-scm.com/downloads/</a><br>下载完成后，安装。</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/git_tool.png" class="" title="Git工具">

<span id="more"></span>

<p>在使用git前，需要告诉git自己是谁以及自己的邮箱是什么，所以我们需要对git进行一些基本设置。打开终端（Windows打开安装git时安装的git bash）执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;你的名字或昵称&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;你的邮箱&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置SSH公钥"><a href="#配置SSH公钥" class="headerlink" title="配置SSH公钥"></a>配置SSH公钥</h2><p>ssh是一种安全的传输协议,SSH 密钥总是成双出现的，一把公钥，一把私钥;</p>
<p>公钥登录：就是用户将自己的公钥储存在远程主机上，登录的时候，远程主机会向用户发送一段随机字符串，用户用自己的私钥加密后，再发回来，远程主机用事先储存的公钥进行解密，如果成功，就证明用户是可信的，直接允许登录 ，不再要求密码；</p>
<p>github支持使用 SSH 协议来访问 github仓库,用户可以在账户里面设置 SSH公钥,使用自己的私钥来获取github的相应全权限。</p>
<p><strong>注意：一个公钥只能认证一个用户，而一个用户却可以拥有多个公钥。</strong></p>
<h2 id="生成SSH-key"><a href="#生成SSH-key" class="headerlink" title="生成SSH key"></a>生成SSH key</h2><p>1、检查SSH keys是否存在，一般默认会在账户的主目录下的 ~&#x2F;.ssh 目录</p>
<p>关键是看有没有 xxx 和 xxx.pub 来命名的一对文件，这个 xxx 通常就是 id_dsa 或 id_rsa。有 .pub 后缀的文件就是公钥，另一个文件则是密钥。假如没有这些文件，或者干脆连 .ssh 目录都没有，可以用 ssh-keygen 来创建</p>
<p>2、生成ssh key</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;你的邮箱&quot;</span></span><br></pre></td></tr></table></figure>
<p>然后根据提示连续回车即可在~&#x2F;.ssh目录下得到id_rsa和id_rsa.pub两个文件，id_rsa.pub文件里存放的就是我们要使用的公钥key。</p>
<p>3、复制到github账户</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/ssh_key.png" class="" title="SSHKey">

<p>将id_rsa.pub文件的内容（公钥key），复制到上面的文本框（key），标题（title），自己命名，点击（Add SSH key）。</p>
<p>4、测试本地与github</p>
<p>执行下面命令:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
<p>成功后会提示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Hi XXXXXX! You<span class="string">&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure>

<p>这样，你和你的github通讯，再也不需要登陆验证了。</p>
<h2 id="配置中文"><a href="#配置中文" class="headerlink" title="配置中文"></a>配置中文</h2><p>项目目录，有中文目录，中文文件，提交日志，中文显示为八进制的字符编码</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/git_en.png" class="" title="八进制字符">

<p>设置相应参数其值为(false)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global core.quotepath <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/git_zh.png" class="" title="中文字符">

<p>到此，基本就可以正常显示中文了，git的主要配置基本上差不多了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##GBK字符集设置</span></span><br><span class="line">git config --global i18n.commitEncoding gbk</span><br></pre></td></tr></table></figure>
<h2 id="tortoisegit安装"><a href="#tortoisegit安装" class="headerlink" title="tortoisegit安装"></a>tortoisegit安装</h2><p>TortoiseGit是一个开放的git版本控制系统的源客户端，支持Winxp&#x2F;vista&#x2F;win7。</p>
<p>tortoisegit下载地址：<a href="https://download.tortoisegit.org/tgit/">https://download.tortoisegit.org/tgit/</a>,里面各个版本；</p>
<p>The current stable version of TortoiseGit is: 2.3.0（当前稳定的版本）<br>The latest preview releases can be found here.（最后发布的版本）</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/tortoisegit_home.png" class="" title="tortoisegit版本">

<p>点击一个版本进去下载，选择适合自己系统位数的版本下载，再下载简体中文语言包。</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/tortoisegit_dowload.png" class="" title="下载tortoisegit">

<ul>
<li>先安装tortoisegit，一路全部默认。</li>
<li>再安装语言包，等待安装完成。</li>
</ul>
<p>在空白处鼠标右键, 选择 TortoiseGit &#x3D;》 Settings, 然后选择，Genera，再选择相应的语言，应用就行了，就行了</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/tortoisegit_lang.png" class="" title="选择中文">

<h2 id="检查tortoisegit配置"><a href="#检查tortoisegit配置" class="headerlink" title="检查tortoisegit配置"></a>检查tortoisegit配置</h2><p>之前已经配置过了git，并且使用git与github进行通讯，读写github上的文件，并推送到github.</p>
<p>检查Tortoisegit 设置里面的 GIT选项，此时发现默认选中（实际生效），<br>读取到的用户名，和邮箱是你git配置的用户名和邮箱</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/tortoisegit_user.png" class="" title="设置用户">

<p>点击 “编辑全局 .git&#x2F;config(O)”按钮，设置记住密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[gui]</span><br><span class="line">[user]</span><br><span class="line">	email = xxx@163.com</span><br><span class="line">	name = xxx</span><br><span class="line">[credential]</span><br><span class="line">  helper = store</span><br><span class="line">[core]</span><br><span class="line">	quotepath = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>检查ssh客户端路径，默认类似如下</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/shh_client.png" class="" title="设置用户">

<p>如果你使用的是比较新,如现在的2.3.0.的版本的话，基本上已经可以从github上拉去项目，并推送项目了。</p>
<h2 id="用TortoiseGit为github账号添加SSH-keys"><a href="#用TortoiseGit为github账号添加SSH-keys" class="headerlink" title="用TortoiseGit为github账号添加SSH keys"></a>用TortoiseGit为github账号添加SSH keys</h2><p>设置SSH key后,与远程服务器同步代码时，就不必每次都要输入用户名和密码了；</p>
<p>用TortoiseGit作为本地管理工具，而TortoiseGit，使用扩展名为ppk的秘钥而不是ssh-keygen生成的rsa密钥。也就是说使用ssh-keygen -C “<a href="mailto:&#x75;&#x73;&#101;&#x72;&#110;&#97;&#109;&#101;&#64;&#x65;&#109;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;">&#x75;&#x73;&#101;&#x72;&#110;&#97;&#109;&#101;&#64;&#x65;&#109;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;</a>“ -t rsa产生的密钥TortoiseGit中不能用；</p>
<p>而基于github的开发必须要用到rsa密钥，因此需要用到TortoiseGit的putty key generator工具来生成既适用于github的rsa密钥也适用于TortoiseGit的ppk密钥；</p>
<ul>
<li>打开TortoiseGit下的PuttyGen;</li>
<li>在打开的窗口中点击Generate按钮，会出现绿色进度条，等下生成，生成过程中可以多晃晃鼠标增加随机性。</li>
<li>直到进度条完毕</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/puttygen.png" class="" title="puttygen">

<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/puttygen_generate.png" class="" title="puttygen_generate">

<ul>
<li>生成之后复制生成的全部内容（公钥），窗口先留着不关闭，同时下面有两个按钮（保存公钥和保存私钥）</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/puttygen_key.png" class="" title="puttygen_generate">

<ul>
<li><p>登录到github,找到的SSH key之后点击Add SSH key在出现的界面中填写SSH key的名称，再点击add key就可以了。</p>
</li>
<li><p>回到窗口，点击Save private key按钮保存为适用于TortoiseGit的私钥扩展名为.ppk的文件</p>
</li>
<li><p>运行TortoiseGit开始菜单中的Pageant，程序启动后将自动停靠在任务栏中，双击该图标，弹出key管理列表。</p>
</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/pageant.png" class="" title="pageant">

<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/pageant_key.png" class="" title="pageant_key">

<ul>
<li>点击add key,将保存的私钥.(.ppk）文件载进来。</li>
</ul>
<p>至此，，就可以使用TortoiseGit进行push、pull操作了</p>
<h2 id="OpenSSH-到-PuTTY-的转换"><a href="#OpenSSH-到-PuTTY-的转换" class="headerlink" title="OpenSSH 到 PuTTY 的转换"></a>OpenSSH 到 PuTTY 的转换</h2><p>转换需要用到 PuTTYgen应用程序，就是刚才生成TortoiseGit的SSH key的那个：</p>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/puttygen_doload.png" class="" title="puttygen转换界面">

<ul>
<li>单击 “Conversions” 后再单击 “Import key”</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/conver_1.png" class="" title="PuTTYgen转换界面">

<ul>
<li>选择你的OpenSSH private key (私钥)，如github生成的私钥.ssh目录的id_rsa文件，此时会生成SSH的公钥，也可保存适用于TortoiseGit的ppk私钥</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/conver_2.png" class="" title="PuTTYgen转换界面">

<ul>
<li>然后你想要的公钥和私钥就都有了，不用重新生成了</li>
</ul>
<h2 id="PuTTY-到-OpenSSH-的转换"><a href="#PuTTY-到-OpenSSH-的转换" class="headerlink" title="PuTTY 到 OpenSSH  的转换"></a>PuTTY 到 OpenSSH  的转换</h2><ul>
<li>单击 “Load”按钮，选择用于TortoiseGit的.ppk私钥文件，此时会生成相应的公钥私钥</li>
</ul>
<img src="/2016/10/19/tortoisegit%E7%9A%84%E4%BD%BF%E7%94%A8/conver_load.png" class="" title="单击load按钮">

<ul>
<li><p>单击 “Conversions” 然后单击 “Export OpenSSH key”，此时就得到github需要的SSH私钥</p>
</li>
<li><p>然后公钥私钥你都有了，不用重新再生成了</p>
</li>
</ul>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>unity操作xml文件</title>
    <url>/2016/05/06/unity%E6%93%8D%E4%BD%9Cxml%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="unity操作xml文件"><a href="#unity操作xml文件" class="headerlink" title="unity操作xml文件"></a>unity操作xml文件</h2><p>百度搜了一下，这里</p>
<p><a href="http://www.xuanyusong.com/archives/1901">MOMO传送地址</a></p>
<p>学习使用</p>
<span id="more"></span>

<h2 id="代码中学习"><a href="#代码中学习" class="headerlink" title="代码中学习"></a>代码中学习</h2><p><strong>注意</strong>：路径自己定义</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">using System.IO;</span><br><span class="line">using System.Xml;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class XmlFile : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">    private void <span class="function"><span class="title">Start</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        //print(Application.dataPath);</span><br><span class="line">        CreateXml();</span><br><span class="line">        //UpdateXml();</span><br><span class="line">        //RemoveXml();</span><br><span class="line">        //AddXml();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //创建xml</span><br><span class="line">    private void <span class="function"><span class="title">CreateXml</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        /**</span><br><span class="line">         * @避免字符串转义</span><br><span class="line">         * @允许字符串换行</span><br><span class="line">         * @可读性更高</span><br><span class="line">         */</span><br><span class="line">        string filePath = Application.dataPath + @<span class="string">&quot;/File/creat.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(filePath))</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument  xmlDoc = new XmlDocument();</span><br><span class="line"></span><br><span class="line">            //创建节点</span><br><span class="line">            XmlElement root = xmlDoc.CreateElement(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (int i = 0; i &lt; 5; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                XmlElement student = xmlDoc.CreateElement(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">                //设置属性</span><br><span class="line">                student.SetAttribute(<span class="string">&quot;id&quot;</span>, i+1+<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">                XmlElement name = xmlDoc.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                //设置内容</span><br><span class="line">                name.InnerText = <span class="string">&quot;小明&quot;</span>;</span><br><span class="line">                XmlElement sex = xmlDoc.CreateElement(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">                sex.InnerText = <span class="string">&quot;男&quot;</span>;</span><br><span class="line"></span><br><span class="line">                //添加节点</span><br><span class="line">                student.AppendChild(name);</span><br><span class="line">                student.AppendChild(sex);</span><br><span class="line">                root.AppendChild(student);</span><br><span class="line">            &#125;</span><br><span class="line">            xmlDoc.AppendChild(root);</span><br><span class="line"></span><br><span class="line">            //xml保存到本地</span><br><span class="line">            xmlDoc.Save(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //更新xml</span><br><span class="line">    private void <span class="function"><span class="title">UpdateXml</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        string filePath = Application.dataPath + @<span class="string">&quot;/File/creat.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (File.Exists(filePath))</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument xmlDoc = new XmlDocument();</span><br><span class="line"></span><br><span class="line">            //读取文件</span><br><span class="line">            xmlDoc.Load(filePath);</span><br><span class="line"></span><br><span class="line">            //得到所有节点</span><br><span class="line">            XmlNodeList nodeList = xmlDoc.SelectSingleNode(<span class="string">&quot;root&quot;</span>).ChildNodes;</span><br><span class="line"></span><br><span class="line">            //遍历节点</span><br><span class="line">            foreach (XmlElement ele <span class="keyword">in</span> nodeList)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ele.GetAttribute(<span class="string">&quot;id&quot;</span>) == <span class="string">&quot;3&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    foreach (XmlElement elea <span class="keyword">in</span> ele.ChildNodes)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (elea.Name == <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            elea.InnerText = <span class="string">&quot;女&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //跳出循环</span><br><span class="line">                    <span class="built_in">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Debug.Log(<span class="string">&quot;是否跳出循环&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //保存文件</span><br><span class="line">            xmlDoc.Save(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //删除节点</span><br><span class="line">    private void <span class="function"><span class="title">RemoveXml</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        string filePath = Application.dataPath + @<span class="string">&quot;/File/creat.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (File.Exists(filePath))</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument xmlDoc = new XmlDocument();</span><br><span class="line"></span><br><span class="line">            xmlDoc.Load(filePath);</span><br><span class="line"></span><br><span class="line">            XmlNodeList nodeList = xmlDoc.SelectSingleNode(<span class="string">&quot;root&quot;</span>).ChildNodes;</span><br><span class="line">            foreach (XmlElement ele <span class="keyword">in</span> nodeList)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (ele.GetAttribute(<span class="string">&quot;id&quot;</span>) == <span class="string">&quot;4&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    foreach (XmlElement elea <span class="keyword">in</span> ele.ChildNodes)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (elea.Name == <span class="string">&quot;name&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            elea.RemoveAttribute(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (elea.Name == <span class="string">&quot;sex&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            elea.RemoveAll();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //ele.RemoveChild(ele.LastChild);</span><br><span class="line">                    ele.RemoveChild(ele.SelectSingleNode(<span class="string">&quot;sex&quot;</span>));</span><br><span class="line">                    <span class="built_in">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            xmlDoc.Save(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //添加文件</span><br><span class="line">    private void <span class="function"><span class="title">AddXml</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        string filePath = Application.dataPath + @<span class="string">&quot;/File/creat.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (File.Exists(filePath))</span><br><span class="line">        &#123;</span><br><span class="line">            XmlDocument xmlDoc = new XmlDocument();</span><br><span class="line"></span><br><span class="line">            xmlDoc.Load(filePath);</span><br><span class="line"></span><br><span class="line">            XmlNode root = xmlDoc.SelectSingleNode(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">            int len = xmlDoc.SelectSingleNode(<span class="string">&quot;root&quot;</span>).ChildNodes.Count;</span><br><span class="line">            <span class="keyword">for</span> (int i = len; i &lt; len+2; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                XmlElement student = xmlDoc.CreateElement(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">                //设置属性</span><br><span class="line">                student.SetAttribute(<span class="string">&quot;id&quot;</span>, i + 1 + <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">                XmlElement name = xmlDoc.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                //设置内容</span><br><span class="line">                name.InnerText = <span class="string">&quot;小花&quot;</span>;</span><br><span class="line">                XmlElement sex = xmlDoc.CreateElement(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">                sex.InnerText = <span class="string">&quot;男&quot;</span>;</span><br><span class="line"></span><br><span class="line">                //添加节点</span><br><span class="line">                student.AppendChild(name);</span><br><span class="line">                student.AppendChild(sex);</span><br><span class="line">                root.AppendChild(student);</span><br><span class="line">            &#125;</span><br><span class="line">            xmlDoc.Save(filePath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考图片"><a href="#参考图片" class="headerlink" title="参考图片"></a>参考图片</h2><img src="/2016/05/06/unity%E6%93%8D%E4%BD%9Cxml%E6%96%87%E4%BB%B6/Exa_1.png" class="" title="xml文件">
]]></content>
      <categories>
        <category>unity</category>
      </categories>
      <tags>
        <tag>unity</tag>
      </tags>
  </entry>
  <entry>
    <title>vue2.0双向绑定</title>
    <url>/2018/03/13/vue2-0%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/</url>
    <content><![CDATA[<h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>MVVM是Model-View-ViewModel 的简写,是MVC的改进版.</p>
<p>在双向绑定中,Model和View之间没有耦合,通过操作Model，利用ViewModel提供的机制，自动实现ViewModel的更新。</p>
<span id="more"></span>

<h2 id="Object-defineProperty"><a href="#Object-defineProperty" class="headerlink" title="Object.defineProperty"></a>Object.defineProperty</h2><p>Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Object.defineProperty(obj, prop, descriptor)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>obj</code>:要在其上定义属性的对象</li>
<li><code>prop</code>:要定义或修改的属性的名称</li>
<li><code>descriptor</code>:将被定义或修改的属性描述符。</li>
</ul>
<ol>
<li><code>get</code>: 一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为 <code>undefined</code></li>
<li><code>set</code>: 一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为 <code>undefined</code>。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Log</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    <span class="keyword">var</span> id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">          arr.<span class="title function_">push</span>(&#123;<span class="attr">id</span>:id++,<span class="attr">oldVal</span>:val,<span class="attr">newVal</span>:newVal&#125;);</span><br><span class="line">          val = newVal;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getLog</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> arr; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lg = <span class="keyword">new</span> <span class="title class_">Log</span>();</span><br><span class="line">lg.<span class="property">name</span>=<span class="string">&quot;小明&quot;</span>;</span><br><span class="line">lg.<span class="property">name</span>=<span class="string">&quot;小华&quot;</span>;</span><br><span class="line">lg.<span class="property">name</span>=<span class="string">&quot;小刚&quot;</span>;</span><br><span class="line">lg.<span class="title function_">getLog</span>();</span><br></pre></td></tr></table></figure>


<h2 id="发布-x2F-订阅者模式"><a href="#发布-x2F-订阅者模式" class="headerlink" title="发布&#x2F;订阅者模式"></a>发布&#x2F;订阅者模式</h2><p>订阅者把自己想订阅的事件注册到调度中心，</p>
<p>当该事件触发时候，发布者发布该事件到调度中心（顺带上下文），由调度中心统一调度订阅者注册到调度中心的处理代码。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">            发布                  订阅</span><br><span class="line">发布者       -&gt;      调度中心       &lt;-      订阅者(多个)</span><br></pre></td></tr></table></figure>

<p>vue双向绑定的实现<code>Dep、Observer、Watcher:</code></p>
<ul>
<li><code>Dep</code>(调度中心):存放收集<code>Watcher</code>,Watcher的实例就是订阅者。</li>
<li><code>Observer</code>(发布者):是一个类(class),每个<code>Observer</code>都附有被观察的对象，观察的对象，一旦连接，观察者就转换目标对象的属性键成为<code>getter/setters</code>,收集依赖关系并发送更新</li>
<li><code>Watcher</code>(订阅者):观察者分析表达式，收集依赖关系，并在表达式值更改时触发回调。</li>
</ul>
<h3 id="Watcher-订阅者"><a href="#Watcher-订阅者" class="headerlink" title="Watcher(订阅者)"></a>Watcher(订阅者)</h3><p>解析对象路径函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [解析对象路径 obj = &#123;a:b:&#123;c:1&#125;&#125;]</span></span><br><span class="line"><span class="comment"> * a.b.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parsePath</span> (path) &#123;</span><br><span class="line">    <span class="keyword">var</span> bailRE = <span class="regexp">/[^\w.$]/</span>;</span><br><span class="line">    <span class="keyword">if</span> (bailRE.<span class="title function_">test</span>(path)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> segments = path.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; segments.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!obj) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            obj = obj[segments[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [订阅者]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Watcher</span> = <span class="keyword">function</span> <span class="title function_">Watcher</span>(<span class="params">vm,expOrFn,cb</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cb</span> = cb;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expression</span> = expOrFn;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getter</span> = <span class="title function_">parsePath</span>(expOrFn);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()<span class="comment">//更新前的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取表达式的值</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">get</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(data, data);</span><br><span class="line">    <span class="comment">//表明是watcher调用了getter</span></span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//订阅者的更新方法</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">update</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//获取更新后的值</span></span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    <span class="keyword">var</span> oldVal = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span>(value!==oldVal)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value <span class="comment">//更新新值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>,value,oldVal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加订阅者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addDep</span> = <span class="keyword">function</span> <span class="title function_">addDep</span> (dep) &#123;</span><br><span class="line">    dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Dep-调度中心"><a href="#Dep-调度中心" class="headerlink" title="Dep(调度中心)"></a>Dep(调度中心)</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [调度中心]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Dep</span> = <span class="keyword">function</span> <span class="title function_">Dep</span> () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = []<span class="comment">//订阅者队列</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个全局变量，用来判断是否是watcher调用了getter</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [添加订阅者]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addSub</span> = <span class="keyword">function</span> <span class="title function_">addSub</span> (sub) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [移除订阅者]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">removeSub</span> = <span class="keyword">function</span> <span class="title function_">removeSub</span> (sub) &#123;</span><br><span class="line">    <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">subs</span>, sub);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [订阅者，注册事件到事件中心]</span></span><br><span class="line"><span class="comment"> * set触发notify,并触发相应的update方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">notify</span> = <span class="keyword">function</span> <span class="title function_">notify</span> () &#123;</span><br><span class="line">    <span class="comment">// 复制一个新的订阅者数组</span></span><br><span class="line">    <span class="keyword">var</span> subs = <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">slice</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;notify&#x27;</span>,subs)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = subs.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="comment">//调度中心统一调度订阅者注册到调度中心的处理代码</span></span><br><span class="line">        subs[i].<span class="title function_">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [增加订阅者watcher到对象Dep]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Dep</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">depend</span> = <span class="keyword">function</span> <span class="title function_">depend</span> () &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">addDep</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Observer-发布者"><a href="#Observer-发布者" class="headerlink" title="Observer(发布者)"></a>Observer(发布者)</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [发布者 Observer 对data做监听]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Observer</span> = <span class="keyword">function</span> <span class="title function_">Observer</span> (data) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dep</span> = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(data);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 遍历对象所有属性，包括子属性,使其拥有getter/setter方法</span></span><br><span class="line"><span class="comment"> * 仅限值类型是对象，这个方法才能被调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Observer</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">walk</span> = <span class="keyword">function</span> <span class="title function_">walk</span> (obj) &#123;</span><br><span class="line">    <span class="keyword">var</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineReactive</span>(obj, keys[i], obj[keys[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [在对象上定义一个响应式属性]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125; [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Observer</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">defineReactive</span> = <span class="keyword">function</span>(<span class="params"> obj, key,val</span>)&#123;</span><br><span class="line">    <span class="comment">//实例化一个Dep</span></span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span><br><span class="line">    <span class="title function_">observe</span>(val);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">reactiveGetter</span> () &#123;</span><br><span class="line">            <span class="comment">//Dep.target指针指向watcher，增加订阅者watcher到对象Dep</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title class_">Dep</span>.<span class="property">target</span>)&#123;</span><br><span class="line">                <span class="comment">//console.log(&#x27;Dep.target&#x27;)</span></span><br><span class="line">                <span class="comment">// dep.depend();</span></span><br><span class="line">                dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span> <span class="title function_">reactiveSetter</span> (newVal) &#123;</span><br><span class="line">            <span class="comment">// 如果新设置的值和原来相等,则不重新赋值</span></span><br><span class="line">            <span class="comment">// console.log(&#x27;set之前&#x27;,val,newVal)</span></span><br><span class="line">            <span class="keyword">if</span> (newVal === val) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            val = newVal;</span><br><span class="line">            <span class="title function_">observe</span>(newVal);</span><br><span class="line">            <span class="comment">//调度中心发出通知</span></span><br><span class="line">            dep.<span class="title function_">notify</span>();</span><br><span class="line">            <span class="comment">// console.log(&#x27;set之后&#x27;,val,newVal)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Observer</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$watcher</span> = <span class="keyword">function</span>(<span class="params">expOrFn,cb</span>)&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="variable language_">this</span>,expOrFn,cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果是对象，则再实例化一个Observer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span> (val,vm)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(val) ===<span class="string">&quot;[object Object]&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Observer</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Observer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">&#x27;小明&#x27;</span>,<span class="attr">other</span>:<span class="number">20</span>,<span class="attr">power</span>:&#123;</span><br><span class="line">        <span class="attr">p1</span>:<span class="string">&#x27;有钱&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Observer</span>(obj);</span><br><span class="line">app.$watcher(<span class="string">&#x27;name&#x27;</span>, <span class="keyword">function</span>(<span class="params">newVal,oldVal</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印name&#x27;</span>,newVal,oldVal)</span><br><span class="line">&#125;);</span><br><span class="line">app.$watcher(<span class="string">&#x27;power.p1&#x27;</span>, <span class="keyword">function</span>(<span class="params">newVal,oldVal</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;power.p1&#x27;</span>,newVal,oldVal)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    obj.<span class="property">name</span> = <span class="string">&quot;小刚&quot;</span>;</span><br><span class="line">    obj.<span class="property">power</span>.<span class="property">p1</span> = <span class="string">&#x27;会打王者&#x27;</span>;</span><br><span class="line">&#125;,<span class="number">1500</span>);</span><br></pre></td></tr></table></figure>

<h2 id="抽象语法树AST-abstract-syntax-tree"><a href="#抽象语法树AST-abstract-syntax-tree" class="headerlink" title="抽象语法树AST(abstract syntax tree)"></a>抽象语法树AST(abstract syntax tree)</h2><p>AST是指抽象语法树（abstract syntax tree或者缩写为AST），或者语法树（syntax tree），是源代码的抽象语法结构的树状表现形式。</p>
<p><code>Vue.js v2.5.13</code></p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180313094253.png" alt="image"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * `createCompilerCreator`允许创建使用替代的编译器</span></span><br><span class="line"><span class="comment"> * 解析器/优化器/ codegen，例如SSR优化编译器。</span></span><br><span class="line"><span class="comment"> * 这里我们只使用默认的部分导出一个默认的编译器。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> createCompiler = <span class="title function_">createCompilerCreator</span>(<span class="keyword">function</span> <span class="title function_">baseCompile</span> (</span><br><span class="line">  template,</span><br><span class="line">  options</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> ast = <span class="title function_">parse</span>(template.<span class="title function_">trim</span>(), options);</span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">optimize</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_">optimize</span>(ast, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> code = <span class="title function_">generate</span>(ast, options);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">ast</span>: ast,</span><br><span class="line">    <span class="attr">render</span>: code.<span class="property">render</span>,</span><br><span class="line">    <span class="attr">staticRenderFns</span>: code.<span class="property">staticRenderFns</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将HTML字符串转换为AST</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parse</span> (</span><br><span class="line">  template,</span><br><span class="line">  options</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> root;</span><br><span class="line">    <span class="comment">/*todo....*/</span></span><br><span class="line">    <span class="title function_">parseHTML</span>(template, &#123;</span><br><span class="line">        <span class="attr">warn</span>: warn$2,</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">        <span class="attr">start</span>: <span class="keyword">function</span> <span class="title function_">start</span> (tag, attrs, unary) &#123;&#125;</span><br><span class="line">        <span class="attr">end</span>: <span class="keyword">function</span> <span class="title function_">end</span> () &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">        <span class="attr">chars</span>: <span class="keyword">function</span> <span class="title function_">chars</span> (text) &#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">        <span class="attr">comment</span>: <span class="keyword">function</span> <span class="title function_">comment</span> (text)&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>vue</code>将模板字符串给<code>parse</code>函数，最终返回一个抽象语法树(AST)</p>
<p><code>parse</code>函数内部会调用一个<code>parseHTML</code>,来完成对模板字符串解析，最终返回个js语法的树形结构。</p>
<p>执行<code>generate</code>函数返回<code>code</code>中有个<code>render</code>函数和<code>staticRenderFns</code>函数</p>
<h2 id="虚拟DOM-VNode"><a href="#虚拟DOM-VNode" class="headerlink" title="虚拟DOM(VNode)"></a>虚拟DOM(VNode)</h2><p>文档对象模型（Document Object Model，简称DOM）。用<code>jquery</code>在网页中直接操作dom结构,相对于原生API无疑方便了很多。</p>
<p>为了追求性能、和更方便的对DOM维护，于是就引入了虚拟DOM。</p>
<p>用JS表示DOM结构,操作DOM慢，而javascript很快，用javascript对象可以很容易地表示DOM节点。DOM节点包括标签、属性和子节点.</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180313142540.png" alt="image"></p>
<p><code>Vue.js v2.5.13</code>(VNode.js):</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/* @flow */</span><br><span class="line"><span class="built_in">export</span> default class VNode &#123;</span><br><span class="line">  tag: string | void;/* 标签类型 */</span><br><span class="line">  data: VNodeData | void; /* 节点上的class,attribute,style 事件 */</span><br><span class="line">  children: ?Array&lt;VNode&gt;;/* 存放的是子虚拟节点 */</span><br><span class="line">  text: string | void;/* 表明文本节点内容 */</span><br><span class="line">  elm: Node | void;/* 虚拟节点对应的真实DOM节点 */</span><br><span class="line">  ns: string | void;/* html命名空间 */</span><br><span class="line">  context: Component | void; /* 在此组件的作用域 */</span><br><span class="line">  key: string | number | void; /* 是vnode的标记 */</span><br><span class="line">  componentOptions: VNodeComponentOptions | void;/* 组件参数 */</span><br><span class="line">  componentInstance: Component | void; /* 组件实例 */</span><br><span class="line">  parent: VNode | void; /*  */</span><br><span class="line"></span><br><span class="line">  /*  严格内部 */</span><br><span class="line">  raw: boolean; /* 包含原始HTML？ （仅限服务器） */</span><br><span class="line">  isStatic: boolean; /* 悬挂静态节点 */</span><br><span class="line">  isRootInsert: boolean; /* 进入转换检查所必需的 */</span><br><span class="line">  isComment: boolean; /* 空注释占位符? */</span><br><span class="line">  isCloned: boolean; /*是否是一个克隆节点?  */</span><br><span class="line">  isOnce: boolean; /* 是否是一次性节点? */</span><br><span class="line">  asyncFactory: Function | void; /* 异步组件 factory <span class="keyword">function</span> */</span><br><span class="line">  asyncMeta: Object | void;</span><br><span class="line">  isAsyncPlaceholder: boolean;</span><br><span class="line">  ssrContext: Object | void;</span><br><span class="line">  fnContext: Component | void; /* 真实的上下文虚拟功能节点 */</span><br><span class="line">  fnOptions: ?ComponentOptions; /* 用于SSR缓存 */</span><br><span class="line">  fnScopeId: ?string; /*  功能范围<span class="built_in">id</span>支持 */</span><br><span class="line"></span><br><span class="line">  constructor (</span><br><span class="line">    tag?: string,</span><br><span class="line">    data?: VNodeData,</span><br><span class="line">    children?: ?Array&lt;VNode&gt;,</span><br><span class="line">    text?: string,</span><br><span class="line">    elm?: Node,</span><br><span class="line">    context?: Component,</span><br><span class="line">    componentOptions?: VNodeComponentOptions,</span><br><span class="line">    asyncFactory?: Function</span><br><span class="line">  ) &#123;</span><br><span class="line">    this.tag = tag</span><br><span class="line">    this.data = data</span><br><span class="line">    this.children = children</span><br><span class="line">    this.text = text</span><br><span class="line">    this.elm = elm</span><br><span class="line">    this.ns = undefined</span><br><span class="line">    this.context = context</span><br><span class="line">    this.fnContext = undefined</span><br><span class="line">    this.fnOptions = undefined</span><br><span class="line">    this.fnScopeId = undefined</span><br><span class="line">    this.key = data &amp;&amp; data.key</span><br><span class="line">    this.componentOptions = componentOptions</span><br><span class="line">    this.componentInstance = undefined</span><br><span class="line">    this.parent = undefined</span><br><span class="line">    this.raw = <span class="literal">false</span></span><br><span class="line">    this.isStatic = <span class="literal">false</span></span><br><span class="line">    this.isRootInsert = <span class="literal">true</span></span><br><span class="line">    this.isComment = <span class="literal">false</span></span><br><span class="line">    this.isCloned = <span class="literal">false</span></span><br><span class="line">    this.isOnce = <span class="literal">false</span></span><br><span class="line">    this.asyncFactory = asyncFactory</span><br><span class="line">    this.asyncMeta = undefined</span><br><span class="line">    this.isAsyncPlaceholder = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * 弃用: 别名 为组件实例 向后兼容.</span><br><span class="line">   * istanbul ignore next</span><br><span class="line">   */</span><br><span class="line">  get child (): Component | void &#123;</span><br><span class="line">    <span class="built_in">return</span> this.componentInstance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 创建一个空的vnode实例 */</span><br><span class="line"><span class="built_in">export</span> const createEmptyVNode = (text: string = <span class="string">&#x27;&#x27;</span>) =&gt; &#123;</span><br><span class="line">  const node = new VNode()</span><br><span class="line">  node.text = text</span><br><span class="line">  node.isComment = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 创建一个文本vnode */</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> createTextVNode (val: string | number) &#123;</span><br><span class="line">  <span class="built_in">return</span> new VNode(undefined, undefined, undefined, String(val))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 优化的浅层克隆</span><br><span class="line"> * 用于静态节点和插槽节点，因为它们可能会被重复使用</span><br><span class="line"> * 多重渲染，克隆它们可以避免DOM操作依赖时的错误</span><br><span class="line"> * 克隆一个vnode</span><br><span class="line"> */</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> cloneVNode (vnode: VNode): VNode &#123;</span><br><span class="line">  const cloned = new VNode(</span><br><span class="line">    vnode.tag,</span><br><span class="line">    vnode.data,</span><br><span class="line">    vnode.children,</span><br><span class="line">    vnode.text,</span><br><span class="line">    vnode.elm,</span><br><span class="line">    vnode.context,</span><br><span class="line">    vnode.componentOptions,</span><br><span class="line">    vnode.asyncFactory</span><br><span class="line">  )</span><br><span class="line">  cloned.ns = vnode.ns</span><br><span class="line">  cloned.isStatic = vnode.isStatic</span><br><span class="line">  cloned.key = vnode.key</span><br><span class="line">  cloned.isComment = vnode.isComment</span><br><span class="line">  cloned.fnContext = vnode.fnContext</span><br><span class="line">  cloned.fnOptions = vnode.fnOptions</span><br><span class="line">  cloned.fnScopeId = vnode.fnScopeId</span><br><span class="line">  cloned.isCloned = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">return</span> cloned</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span> ( vm, el, hydrating) &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el;</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="property">$options</span>.<span class="property">render</span>) &#123;</span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">render</span> = createEmptyVNode;</span><br><span class="line">    <span class="comment">/* .... */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeMount&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> updateComponent;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;development&quot;</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vnode, hydrating);</span><br><span class="line">      <span class="comment">/* .... */</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//我们在观察者的构造函数中将其设置为vm._watcher</span></span><br><span class="line">  <span class="comment">//因为观察者的初始补丁可能会调用$ forceUpdate（例如在子内部）</span></span><br><span class="line">  <span class="comment">//组件的挂载钩子），这依赖于已经定义的vm._watcher</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, updateComponent, noop, <span class="literal">null</span>, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>);</span><br><span class="line">  hydrating = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">/* .... */</span></span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在初始化的时候执行<code>mountComponent</code>函数方法，其中的<code>vm._render()</code>函数返回虚拟Dom(在模板编译后生成的render方法挂载了实例上)</p>
<p>其中的<code>updateComponent</code>传给了<code>Watcher</code>,而<code>updateComponent</code>中有<code>vm._update(vnode, hydrating)</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_update</span> = <span class="keyword">function</span> (<span class="params">vnode, hydrating</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_isMounted</span>) &#123;</span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> prevEl = vm.<span class="property">$el</span>;</span><br><span class="line">  <span class="keyword">var</span> prevVnode = vm.<span class="property">_vnode</span>;</span><br><span class="line">  <span class="keyword">var</span> prevActiveInstance = activeInstance;</span><br><span class="line">  activeInstance = vm;</span><br><span class="line">  vm.<span class="property">_vnode</span> = vnode;</span><br><span class="line">  <span class="comment">// Vue.prototype.__patch__方法已经在入口点注入</span></span><br><span class="line">  <span class="comment">// based on the rendering backend used.</span></span><br><span class="line">  <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">    <span class="comment">// 初始渲染</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(</span><br><span class="line">      vm.<span class="property">$el</span>, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>,</span><br><span class="line">      vm.<span class="property">$options</span>.<span class="property">_parentElm</span>,</span><br><span class="line">      vm.<span class="property">$options</span>.<span class="property">_refElm</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//在初始补丁之后不需要ref节点</span></span><br><span class="line">    <span class="comment">// 这可以防止在内存中保留分离的DOM树（＃5851）</span></span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">_parentElm</span> = vm.<span class="property">$options</span>.<span class="property">_refElm</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 更新</span></span><br><span class="line">    vm.<span class="property">$el</span> = vm.<span class="title function_">__patch__</span>(prevVnode, vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>传入新的<code>vnode</code>与老的<code>vnode</code>进行diff,来进行dom更新操作,其中的<code>vm.__patch__</code>方法在入口处已经注入</p>
<p>定义<code>patch</code>补丁函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> patch = <span class="title function_">createPatchFunction</span>(&#123; <span class="attr">nodeOps</span>: nodeOps, <span class="attr">modules</span>: modules &#125;);</span><br></pre></td></tr></table></figure>

<p><code>注入</code>patch<code>方法</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装平台补丁功能</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__patch__</span> = inBrowser ? patch : noop;</span><br></pre></td></tr></table></figure>

<p>函数<code>createPatchFunction</code>返回patch方法，其中的patch方法之后来完成<code>vnode</code>的diff过程和打补丁<code>pacth</code>过程,</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* sameVnode会对传入的2个vnode进行基本属性的比较 */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sameVnode</span> (a, b) &#123;</span><br><span class="line">    <span class="comment">/* .... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createPatchFunction</span> (backend) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">emptyNodeAt</span> (elm) &#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VNode</span>(nodeOps.<span class="title function_">tagName</span>(elm).<span class="title function_">toLowerCase</span>(), &#123;&#125;, [], <span class="literal">undefined</span>, elm)&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createRmCb</span> (childElm, listeners)&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">removeNode</span> (el) &#123;&#125;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">patchVnode</span> (oldVnode, vnode, insertedVnodeQueue, removeOnly)&#123;&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">updateChildren</span> (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) &#123;&#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">invokeInsertHook</span> (vnode, queue, initial) &#123;&#125;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">patch</span> (oldVnode, vnode, hydrating, removeOnly, parentElm, refElm) &#123;</span><br><span class="line">        <span class="comment">//销毁钩子</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isUndef</span>(vnode)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode)) &#123; <span class="title function_">invokeDestroyHook</span>(oldVnode); &#125;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* ...  */</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldVnode)) &#123;</span><br><span class="line">            <span class="comment">// oldVnode不存在,创建一个root节点</span></span><br><span class="line">            isInitialPatch = <span class="literal">true</span>;</span><br><span class="line">            <span class="title function_">createElm</span>(vnode, insertedVnodeQueue, parentElm, refElm);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> isRealElement = <span class="title function_">isDef</span>(oldVnode.<span class="property">nodeType</span>);</span><br><span class="line">            <span class="keyword">if</span> (!isRealElement &amp;&amp; <span class="title function_">sameVnode</span>(oldVnode, vnode)) &#123;</span><br><span class="line">                <span class="comment">// 是同一个节点的时候直接修改现有的节点</span></span><br><span class="line">                <span class="title function_">patchVnode</span>(oldVnode, vnode, insertedVnodeQueue, removeOnly);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/* .... */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*调用insert钩子*/</span></span><br><span class="line">        <span class="title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch);</span><br><span class="line">        <span class="keyword">return</span> vnode.<span class="property">elm</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="vue生命周期"><a href="#vue生命周期" class="headerlink" title="vue生命周期"></a>vue生命周期</h2><p>生命周期钩子(<code>Vue.js v2.5.13</code>)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">LIFECYCLE_HOOKS</span> = [</span><br><span class="line">  <span class="string">&#x27;beforeCreate&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;created&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeMount&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;mounted&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeUpdate&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;updated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeDestroy&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;destroyed&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;activated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;deactivated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;errorCaptured&#x27;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201803121750.png" alt="image"></p>
<p>版本：Vue.js v2.5.13</p>
<ol>
<li><code>beforeCreate</code>:在实例初始化之后，数据观测 (data observer) 和 event&#x2F;watcher 事件配置之前被调用。</li>
<li><code>created</code>:在实例创建完成后被立即调用。在这一步，实例已完成以下的配置：数据观测 (<code>data observer</code>)，属性和方法的运算，<code>watch/event</code> 事件回调。然而，挂载阶段还没开始，<code>$el</code> 属性目前不可见。</li>
<li><code>beforeMount</code>：在挂载开始之前被调用：相关的 render 函数首次被调用。(该钩子在服务器端渲染期间不被调用)</li>
<li><code>mounted</code>:<code>el</code> 被新创建的 <code>vm.$el</code> 替换，并挂载到实例上去之后调用该钩子。如果 <code>root</code> 实例挂载了一个文档内元素，当 <code>mounted</code> 被调用时 <code>vm.$el</code> 也在文档内。(该钩子在服务器端渲染期间不被调用。)<ul>
<li>注意 <code>mounted</code> 不会承诺所有的子组件也都一起被挂载。如果你希望等到整个视图都渲染完毕，可以用 <code>vm.$nextTick</code> 替换掉 <code>mounted</code></li>
</ul>
</li>
<li><code>beforeUpdate</code>:数据更新时调用，发生在虚拟 DOM 打补丁之前。这里适合在更新之前访问现有的 DOM，比如手动移除已添加的事件监听器。(该钩子在服务器端渲染期间不被调用，因为只有初次渲染会在服务端进行。)</li>
<li><code>updated</code>:由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子(该钩子在服务器端渲染期间不被调用)</li>
<li><code>activated</code>:<code>keep-alive</code> 组件激活时调用(该钩子在服务器端渲染期间不被调用)</li>
<li><code>deactivated</code>:<code>keep-alive</code> 组件停用时调用(该钩子在服务器端渲染期间不被调用)</li>
<li><code>beforeDestroy</code>:实例销毁之前调用。在这一步，实例仍然完全可用。</li>
<li><code>destroyed</code>:Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁(该钩子在服务器端渲染期间不被调用)</li>
<li><code>errorCaptured</code>:当捕获一个来自子孙组件的错误时被调用。此钩子会收到三个参数：错误对象、发生错误的组件实例以及一个包含错误来源信息的字符串。此钩子可以返回 false 以阻止该错误继续向上传播。</li>
</ol>
<p><code>new Vue()</code>调用构造函数,执行<code>this._init(options)</code></p>
<p>构造函数<code>Vue$3</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Vue$3</span> (options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;development&quot;</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    !(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Vue</span>$3)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(<span class="string">`Vue是一个构造函数，应该用new关键字`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_init</span>(options);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Vue</span>$3;</span><br></pre></td></tr></table></figure>

<p>原型对象上的<code>_init</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">/* todo... */</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title function_">initProxy</span>(vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*初始化生命周期*/</span></span><br><span class="line">  <span class="title function_">initLifecycle</span>(vm);</span><br><span class="line">  <span class="comment">/* 初始化事件 */</span></span><br><span class="line">  <span class="title function_">initEvents</span>(vm);</span><br><span class="line">  <span class="title function_">initRender</span>(vm);</span><br><span class="line">  <span class="comment">/*调用beforeCreate钩子函数并且触发beforeCreate钩子事件*/</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>);</span><br><span class="line">  <span class="title function_">initInjections</span>(vm); <span class="comment">// 在data/props之前初始化注入</span></span><br><span class="line">  <span class="comment">/*初始化props、methods、data、computed、watch */</span></span><br><span class="line">  <span class="title function_">initState</span>(vm);</span><br><span class="line">  <span class="title function_">initProvide</span>(vm); <span class="comment">// resolve provide after data/props</span></span><br><span class="line">  <span class="comment">/*调用created钩子函数并且触发created钩子事件*/</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>);</span><br><span class="line">  <span class="comment">/* todo... */</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">    <span class="comment">/*挂载组件*/</span></span><br><span class="line">    vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化<code>props、methods、data、computed、watch</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initState</span> (vm) &#123;</span><br><span class="line">  vm.<span class="property">_watchers</span> = [];</span><br><span class="line">  <span class="keyword">var</span> opts = vm.<span class="property">$options</span>;</span><br><span class="line">  <span class="comment">/*初始化props*/</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">props</span>) &#123; <span class="title function_">initProps</span>(vm, opts.<span class="property">props</span>); &#125;</span><br><span class="line">  <span class="comment">/*初始化方法*/</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">methods</span>) &#123; <span class="title function_">initMethods</span>(vm, opts.<span class="property">methods</span>); &#125;</span><br><span class="line">  <span class="comment">/*初始化data*/</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">data</span>) &#123;</span><br><span class="line">    <span class="title function_">initData</span>(vm);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/*该组件没有data的时候绑定一个空对象*/</span></span><br><span class="line">    <span class="title function_">observe</span>(vm.<span class="property">_data</span> = &#123;&#125;, <span class="literal">true</span> <span class="comment">/* asRootData */</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*初始化computed*/</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">computed</span>) &#123; <span class="title function_">initComputed</span>(vm, opts.<span class="property">computed</span>); &#125;</span><br><span class="line">  <span class="comment">/*初始化watchers*/</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">watch</span> &amp;&amp; opts.<span class="property">watch</span> !== nativeWatch) &#123;</span><br><span class="line">    <span class="title function_">initWatch</span>(vm, opts.<span class="property">watch</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initData</span> (vm) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = vm.<span class="property">$options</span>.<span class="property">data</span>;</span><br><span class="line">  data = vm.<span class="property">_data</span> = <span class="keyword">typeof</span> data === <span class="string">&#x27;function&#x27;</span>? <span class="title function_">getData</span>(data, vm): data || &#123;&#125;;</span><br><span class="line">  <span class="comment">/* todo.... */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);</span><br><span class="line">  <span class="keyword">var</span> i = keys.<span class="property">length</span>;</span><br><span class="line">  <span class="comment">/* todo... */</span></span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = keys[i];</span><br><span class="line">    <span class="comment">/* todo... */</span></span><br><span class="line">    <span class="comment">//代理数据到实例上</span></span><br><span class="line">    <span class="title function_">proxy</span>(vm, <span class="string">&quot;_data&quot;</span>, key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 开始观察数据，递归进行数据绑定</span></span><br><span class="line">  <span class="title function_">observe</span>(data, <span class="literal">true</span> <span class="comment">/* 作为根数据 */</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理数据到实例上:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">proxy</span> (target, sourceKey, key) &#123;</span><br><span class="line">  sharedPropertyDefinition.<span class="property">get</span> = <span class="keyword">function</span> <span class="title function_">proxyGetter</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[sourceKey][key]</span><br><span class="line">  &#125;;</span><br><span class="line">  sharedPropertyDefinition.<span class="property">set</span> = <span class="keyword">function</span> <span class="title function_">proxySetter</span> (val) &#123;</span><br><span class="line">    <span class="variable language_">this</span>[sourceKey][key] = val;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, sharedPropertyDefinition);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尝试创建一个<code>Observer</code>实例，如果成功创建<code>Observer</code>实例则返回新的<code>Observer</code>实例，如果已有<code>Observer</code>实例则返回现有的<code>Observer</code>实例。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span> (value, asRootData) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isObject</span>(value) || value <span class="keyword">instanceof</span> <span class="title class_">VNode</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> ob;</span><br><span class="line">  <span class="comment">/* todo... */</span></span><br><span class="line">  ob = <span class="keyword">new</span> <span class="title class_">Observer</span>(value);</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>挂载组件，并编译模板：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> createCompiler = <span class="title function_">createCompilerCreator</span>(<span class="keyword">function</span> <span class="title function_">baseCompile</span> (</span><br><span class="line">  template,</span><br><span class="line">  options</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> ast = <span class="title function_">parse</span>(template.<span class="title function_">trim</span>(), options);</span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">optimize</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_">optimize</span>(ast, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> code = <span class="title function_">generate</span>(ast, options);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">ast</span>: ast,</span><br><span class="line">    <span class="attr">render</span>: code.<span class="property">render</span>,</span><br><span class="line">    <span class="attr">staticRenderFns</span>: code.<span class="property">staticRenderFns</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> ref$1 = <span class="title function_">createCompiler</span>(baseOptions);</span><br><span class="line"><span class="keyword">var</span> compileToFunctions = ref$1.<span class="property">compileToFunctions</span>;</span><br><span class="line"><span class="comment">/*将$mount方法保存下来,此时没编译模板，在最后边调用。*/</span></span><br><span class="line"><span class="keyword">var</span> mount = <span class="title class_">Vue</span>$3.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>$3.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el,</span></span><br><span class="line"><span class="params">  hydrating</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  el = el &amp;&amp; <span class="title function_">query</span>(el);</span><br><span class="line">  <span class="comment">/* todo... */</span></span><br><span class="line">  <span class="keyword">var</span> options = <span class="variable language_">this</span>.<span class="property">$options</span>;</span><br><span class="line">  <span class="comment">// resolve template/el and convert to render function</span></span><br><span class="line">  <span class="comment">// 处理模板templete，编译成render函数，render不存在的时候编译template,否则使用render</span></span><br><span class="line">  <span class="keyword">if</span> (!options.<span class="property">render</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> template = options.<span class="property">template</span>;</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="comment">/* todo... */</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el) &#123;</span><br><span class="line">      <span class="comment">/*获取el的outerHTML*/</span></span><br><span class="line">      template = <span class="title function_">getOuterHTML</span>(el);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="comment">/* todo... */</span></span><br><span class="line">      <span class="comment">/* 编译模板，最后返回两个函数render和staticRenderFns */</span></span><br><span class="line">      <span class="keyword">var</span> ref = <span class="title function_">compileToFunctions</span>(template, &#123;</span><br><span class="line">        <span class="attr">shouldDecodeNewlines</span>: shouldDecodeNewlines,</span><br><span class="line">        <span class="attr">shouldDecodeNewlinesForHref</span>: shouldDecodeNewlinesForHref,</span><br><span class="line">        <span class="attr">delimiters</span>: options.<span class="property">delimiters</span>,</span><br><span class="line">        <span class="attr">comments</span>: options.<span class="property">comments</span></span><br><span class="line">      &#125;, <span class="variable language_">this</span>);</span><br><span class="line">      <span class="keyword">var</span> render = ref.<span class="property">render</span>;</span><br><span class="line">      <span class="keyword">var</span> staticRenderFns = ref.<span class="property">staticRenderFns</span>;</span><br><span class="line">      options.<span class="property">render</span> = render;</span><br><span class="line">      options.<span class="property">staticRenderFns</span> = staticRenderFns;</span><br><span class="line">      <span class="comment">/* todo... */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//调用保存下来的mount方法</span></span><br><span class="line">  <span class="keyword">return</span> mount.<span class="title function_">call</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当模板编译了之后调用公共挂载方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 公共挂载方法</span></span><br><span class="line"><span class="title class_">Vue</span>$3.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el,</span></span><br><span class="line"><span class="params">  hydrating</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? <span class="title function_">query</span>(el) : <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mountComponent</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>挂载组件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span> (</span><br><span class="line">  vm,</span><br><span class="line">  el,</span><br><span class="line">  hydrating</span><br><span class="line">) &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el;</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="property">$options</span>.<span class="property">render</span>) &#123;</span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">render</span> = createEmptyVNode;</span><br><span class="line">    <span class="comment">/* todo */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeMount&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> updateComponent;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;development&quot;</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">/* todo... */</span></span><br><span class="line">      vm.<span class="title function_">_update</span>(vnode, hydrating);</span><br><span class="line">      <span class="comment">/* todo... */</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 我们在观察者的构造函数中将其设置为vm._watcher</span></span><br><span class="line"><span class="comment">   * 因为观察者的初始补丁可能会调用$forceUpdate（例如在子内部组件的挂载钩子），</span></span><br><span class="line"><span class="comment">   * 这依赖于已经定义的vm._watcher</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, updateComponent, noop, <span class="literal">null</span>, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>);</span><br><span class="line">  hydrating = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 手动挂载实例，调用自己挂载</span></span><br><span class="line"><span class="comment">   * 在其插入的钩子中调用渲染创建的子组件</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$vnode</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">    vm.<span class="property">_isMounted</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;mounted&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>强制更新：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$forceUpdate</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_watcher</span>) &#123;</span><br><span class="line">    vm.<span class="property">_watcher</span>.<span class="title function_">update</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue之keepAlive</title>
    <url>/2019/12/19/vue%E4%B9%8BkeepAlive/</url>
    <content><![CDATA[<h2 id="keep-alive语法"><a href="#keep-alive语法" class="headerlink" title="keep-alive语法"></a><code>keep-alive</code>语法</h2><h6 id="props"><a href="#props" class="headerlink" title="props"></a><code>props</code></h6><ul>
<li><code>include</code> - 字符串或正则表达式。只有名称匹配的组件会被缓存。</li>
<li><code>exclude</code> - 字符串或正则表达式。任何名称匹配的组件都不会被缓存。</li>
<li><code>max</code> - 数字。最多可以缓存多少组件实例。</li>
</ul>
<p><code>include</code> 和 <code>exclude prop</code> 允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示：</p>
<span id="more"></span>

<h6 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h6><ul>
<li><code>&lt;keep-alive&gt;</code> 包裹动态组件时，会缓存不活动的组件实例，而不是销毁它们。和 <code>&lt;transition&gt;</code> 相似</li>
<li><code>&lt;keep-alive&gt;</code> 是一个抽象组件：它自身不会渲染一个 <code>DOM</code> 元素，也不会出现在组件的父组件链中。</li>
<li>当组件在 <code>&lt;keep-alive&gt;</code> 内被切换，它的 <code>activated</code> 和 <code>deactivated</code> 这两个生命周期钩子函数将会被对应执行。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- 基本 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 多个条件判断的子组件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">comp-a</span> <span class="attr">v-if</span>=<span class="string">&quot;a &gt; 1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">comp-a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">comp-b</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">comp-b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 和 <span class="string">`&lt;transition&gt;`</span> 一起使用 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">transition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>匹配首先检查组件自身的 <code>name</code> 选项，如果 <code>name</code> 选项不可用，则匹配它的局部注册名称 (父组件 <code>components</code> 选项的键值)。匿名组件不能被匹配。</p>
<p><strong><keep-alive> 不会在函数式组件中正常工作，因为它们没有缓存实例。</strong></p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><h6 id="get-first-component-child-js"><a href="#get-first-component-child-js" class="headerlink" title="get-first-component-child.js "></a><code>get-first-component-child.js </code></h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isDef &#125; <span class="keyword">from</span> <span class="string">&#x27;shared/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; isAsyncPlaceholder &#125; <span class="keyword">from</span> <span class="string">&#x27;./is-async-placeholder&#x27;</span></span><br><span class="line"><span class="comment">// 获取第一个子组件(d带componentOptions)</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getFirstComponentChild</span> (<span class="attr">children</span>: ?<span class="title class_">Array</span>&lt;<span class="title class_">VNode</span>&gt;): ?<span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> c = children[i]</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isDef</span>(c) &amp;&amp; (<span class="title function_">isDef</span>(c.<span class="property">componentOptions</span>) || <span class="title function_">isAsyncPlaceholder</span>(c))) &#123;</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="v2-6-12-src-core-components-keep-alive-js"><a href="#v2-6-12-src-core-components-keep-alive-js" class="headerlink" title="v2.6.12/src/core/components/keep-alive.js"></a><code>v2.6.12/src/core/components/keep-alive.js</code></h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一般都在代码档案的最上面一行加入类型检查的注释，没加Flow工具是不会进行检查的</span></span><br><span class="line"><span class="comment">/* @flow */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; isRegExp, remove &#125; <span class="keyword">from</span> <span class="string">&#x27;shared/util&#x27;</span></span><br><span class="line"><span class="comment">// 获取第一个子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; getFirstComponentChild &#125; <span class="keyword">from</span> <span class="string">&#x27;core/vdom/helpers/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ?VNode代表的是类型可自定义，也就是值的部份除了定义的类型，也可以是null或undefined，不过这属性是需要的</span></span><br><span class="line">type <span class="title class_">VNodeCache</span> = &#123; [<span class="attr">key</span>: string]: ?<span class="title class_">VNode</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取组件名/标签名</span></span><br><span class="line"><span class="comment">// 匹配首先检查组件自身的 name 选项，如果 name 选项不可用，则匹配它的局部注册名称 (父组件 components 选项的键值)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getComponentName</span> (<span class="attr">opts</span>: ?<span class="title class_">VNodeComponentOptions</span>): ?string &#123;</span><br><span class="line">  <span class="keyword">return</span> opts &amp;&amp; (opts.<span class="property">Ctor</span>.<span class="property">options</span>.<span class="property">name</span> || opts.<span class="property">tag</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否匹配</span></span><br><span class="line"><span class="comment">// pattern可以用逗号分隔字符串、正则表达式或一个数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">matches</span> (<span class="attr">pattern</span>: string | <span class="title class_">RegExp</span> | <span class="title class_">Array</span>&lt;string&gt;, <span class="attr">name</span>: string): boolean &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.<span class="title function_">indexOf</span>(name) &gt; -<span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> pattern === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>).<span class="title function_">indexOf</span>(name) &gt; -<span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isRegExp</span>(pattern)) &#123;</span><br><span class="line">    <span class="keyword">return</span> pattern.<span class="title function_">test</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 不计入覆盖率</span></span><br><span class="line">  <span class="comment">/* istanbul ignore next */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新（删除）缓存</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pruneCache</span> (<span class="attr">keepAliveInstance</span>: any, <span class="attr">filter</span>: <span class="title class_">Function</span>) &#123;</span><br><span class="line">  <span class="comment">// 当前keepAlive示例 _vnode 已渲染的虚拟dom</span></span><br><span class="line">  <span class="keyword">const</span> &#123; cache, keys, _vnode &#125; = keepAliveInstance</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> cache) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">cachedNode</span>: ?<span class="title class_">VNode</span> = cache[key]</span><br><span class="line">    <span class="comment">// 已缓存</span></span><br><span class="line">    <span class="keyword">if</span> (cachedNode) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">name</span>: ?string = <span class="title function_">getComponentName</span>(cachedNode.<span class="property">componentOptions</span>)</span><br><span class="line">      <span class="comment">// 排除已缓存的组件</span></span><br><span class="line">      <span class="keyword">if</span> (name &amp;&amp; !<span class="title function_">filter</span>(name)) &#123;</span><br><span class="line">        <span class="title function_">pruneCacheEntry</span>(cache, key, keys, _vnode)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除或销毁缓存的组件</span></span><br><span class="line"><span class="comment">// current属性是可选的</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pruneCacheEntry</span> (</span><br><span class="line">  <span class="attr">cache</span>: <span class="title class_">VNodeCache</span>,</span><br><span class="line">  <span class="attr">key</span>: string,</span><br><span class="line">  <span class="attr">keys</span>: <span class="title class_">Array</span>&lt;string&gt;,</span><br><span class="line">  current?: <span class="title class_">VNode</span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">const</span> cached = cache[key]</span><br><span class="line">  <span class="keyword">if</span> (cached &amp;&amp; (!current || cached.<span class="property">tag</span> !== current.<span class="property">tag</span>)) &#123;</span><br><span class="line">    <span class="comment">// 执行组件的destory钩子函数 销毁组件</span></span><br><span class="line">    cached.<span class="property">componentInstance</span>.$destroy()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 清空缓存的虚拟dom</span></span><br><span class="line">  cache[key] = <span class="literal">null</span></span><br><span class="line">  <span class="comment">// 从数组中移除该项key</span></span><br><span class="line">  <span class="title function_">remove</span>(keys, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// patternTypes 数组</span></span><br><span class="line"><span class="comment">// 类型 可以用逗号分隔字符串、正则表达式或一个数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">patternTypes</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt; = [<span class="title class_">String</span>, <span class="title class_">RegExp</span>, <span class="title class_">Array</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">  <span class="comment">//抽象组件：它自身不会渲染一个 DOM 元素，也不会出现在组件的父组件链中。</span></span><br><span class="line">  <span class="attr">abstract</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// 字符串或正则表达式。只有名称匹配的组件会被缓存。</span></span><br><span class="line">    <span class="attr">include</span>: patternTypes,</span><br><span class="line">    <span class="comment">// 字符串或正则表达式。任何名称匹配的组件都不会被缓存。</span></span><br><span class="line">    <span class="attr">exclude</span>: patternTypes,</span><br><span class="line">    <span class="comment">// 最多可以缓存多少组件实例。</span></span><br><span class="line">    <span class="attr">max</span>: [<span class="title class_">String</span>, <span class="title class_">Number</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="comment">// 缓存虚拟dom</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cache</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// 缓存的虚拟dom的健集合</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">keys</span> = []</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  destroyed () &#123;</span><br><span class="line">    <span class="comment">// 删除所有的缓存组件</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">cache</span>) &#123;</span><br><span class="line">      <span class="title function_">pruneCacheEntry</span>(<span class="variable language_">this</span>.<span class="property">cache</span>, key, <span class="variable language_">this</span>.<span class="property">keys</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="comment">// 对include和exclude参数进行监听，然后实时地更新（删除）</span></span><br><span class="line">    <span class="variable language_">this</span>.$watch(<span class="string">&#x27;include&#x27;</span>, <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">pruneCache</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">name</span> =&gt;</span> <span class="title function_">matches</span>(val, name))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(<span class="string">&#x27;exclude&#x27;</span>, <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">pruneCache</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">name</span> =&gt;</span> !<span class="title function_">matches</span>(val, name))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="comment">// 获取默认分发的虚拟dom(可能多个)</span></span><br><span class="line">    <span class="keyword">const</span> slot = <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span></span><br><span class="line">    <span class="comment">//获取第一个子组件的虚拟dom</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">vnode</span>: <span class="title class_">VNode</span> = <span class="title function_">getFirstComponentChild</span>(slot)</span><br><span class="line">    <span class="comment">// 获取虚拟dom组件参数</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">componentOptions</span>: ?<span class="title class_">VNodeComponentOptions</span> = vnode &amp;&amp; vnode.<span class="property">componentOptions</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (componentOptions) &#123;</span><br><span class="line">      <span class="comment">// ?string代表的是类型可自定义string，也就是值的部份除了定义的类型，</span></span><br><span class="line">      <span class="comment">// 也可以是null或undefined，不过这属性是需要的</span></span><br><span class="line">      <span class="comment">//获取到组件的name，存在组件名则直接使用组件名，否则会使用标签(tag)</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">name</span>: ?string = <span class="title function_">getComponentName</span>(componentOptions)</span><br><span class="line">      <span class="keyword">const</span> &#123; include, exclude &#125; = <span class="variable language_">this</span></span><br><span class="line">      <span class="comment">// include 只有名称匹配的组件会被缓存</span></span><br><span class="line">      <span class="comment">// exclude 匹配的组件都不会被缓存</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="comment">// 不包含</span></span><br><span class="line">        (include &amp;&amp; (!name || !<span class="title function_">matches</span>(include, name))) ||</span><br><span class="line">        <span class="comment">// 排除在外</span></span><br><span class="line">        (exclude &amp;&amp; name &amp;&amp; <span class="title function_">matches</span>(exclude, name))</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">return</span> vnode</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; cache, keys &#125; = <span class="variable language_">this</span></span><br><span class="line">      <span class="comment">// 获取/生成代表组件的唯一标识key</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">key</span>: ?string = vnode.<span class="property">key</span> == <span class="literal">null</span></span><br><span class="line">        <span class="comment">// 同一构造函数可能会注册为不同的本地组件</span></span><br><span class="line">        <span class="comment">// 因此仅凭cid是不够的（＃3269）</span></span><br><span class="line">        ? componentOptions.<span class="property">Ctor</span>.<span class="property">cid</span> + (componentOptions.<span class="property">tag</span> ? <span class="string">`::<span class="subst">$&#123;componentOptions.tag&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        : vnode.<span class="property">key</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (cache[key]) &#123;</span><br><span class="line">        <span class="comment">// 已缓存虚拟dom</span></span><br><span class="line">        <span class="comment">// 将缓存的vnode的componentInstance（组件实例）赋值到目前的vnode上面</span></span><br><span class="line">        vnode.<span class="property">componentInstance</span> = cache[key].<span class="property">componentInstance</span></span><br><span class="line">        <span class="comment">// 移除缓存的key</span></span><br><span class="line">        <span class="title function_">remove</span>(keys, key)</span><br><span class="line">        <span class="comment">// 重新插入新的key，相当于修改了key的顺序</span></span><br><span class="line">        keys.<span class="title function_">push</span>(key)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 未缓存虚拟dom,则进行缓存虚拟dom</span></span><br><span class="line">        cache[key] = vnode</span><br><span class="line">        <span class="comment">//缓存key</span></span><br><span class="line">        keys.<span class="title function_">push</span>(key)</span><br><span class="line">        <span class="comment">// 如果缓存的组件数量大于max时，销毁最早缓存的那个组件</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">max</span> &amp;&amp; keys.<span class="property">length</span> &gt; <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">max</span>)) &#123;</span><br><span class="line">          <span class="comment">//_vnode 是经过 render处理过的</span></span><br><span class="line">          <span class="title function_">pruneCacheEntry</span>(cache, keys[<span class="number">0</span>], keys, <span class="variable language_">this</span>.<span class="property">_vnode</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//标记已缓存</span></span><br><span class="line">      vnode.<span class="property">data</span>.<span class="property">keepAlive</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// keepalive组件只能渲染一个子元素</span></span><br><span class="line">    <span class="keyword">return</span> vnode || (slot &amp;&amp; slot[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>yarn</title>
    <url>/2017/04/08/yarn/</url>
    <content><![CDATA[<h2 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h2><p>yarn 是由Facebook、Google、Exponent 和 Tilde 联合推出的 JS 包管理工具</p>
<h2 id="弥补-npm-的一些缺陷"><a href="#弥补-npm-的一些缺陷" class="headerlink" title="弥补 npm 的一些缺陷"></a>弥补 npm 的一些缺陷</h2><ul>
<li>npm 安装包（packages）的速度不够快，拉取的 packages 可能版本不同</li>
<li>npm 允许在安装 packages 时执行代码，这就埋下了安全隐患</li>
</ul>
<span id="more"></span>

<h2 id="yarn特点"><a href="#yarn特点" class="headerlink" title="yarn特点"></a>yarn特点</h2><ul>
<li><strong>极速</strong> Yarn 缓存它下载的每个包，所以无需重复下载。它还并行化操作以最大化资源利用，所以安装时间比以往快。</li>
<li><strong>超级安全</strong> Yarn 在每个安装包的代码执行前使用校验码验证包的完整性。</li>
<li><strong>超级可靠</strong> Yarn 使用一个格式详尽但简洁的 lockfile 和一个精确的算法来安装，能够保证在一个系统上的运行的安装过程也会以同样的方式运行在其他系统上。</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>以下是windows方式安装，前提安装了nodejs</p>
<h3 id="安装方式一"><a href="#安装方式一" class="headerlink" title="安装方式一"></a>安装方式一</h3><p>下载安装程序.msi 文件，运行之后将引导你完成 Yarn 的安装</p>
<h3 id="安装方式二"><a href="#安装方式二" class="headerlink" title="安装方式二"></a>安装方式二</h3><p>通过Chocolatey安装 Chocolatey是Windows平台下的包管理器。 安装好后打开命令行，执行下面的命令： choco install yarn</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">choco install yarn</span><br></pre></td></tr></table></figure>
<h3 id="安装方式三"><a href="#安装方式三" class="headerlink" title="安装方式三"></a>安装方式三</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install yarn -g</span><br><span class="line"></span><br><span class="line">yarn -v</span><br><span class="line"><span class="comment">#查看安装版本</span></span><br></pre></td></tr></table></figure>

<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn init <span class="comment">#初始化</span></span><br><span class="line">yarn add jquery <span class="comment">#添加jquery依赖</span></span><br><span class="line">yarn add jquery@1.9.1 <span class="comment">#添加jquery指定版本</span></span><br><span class="line">yarn upgrade jquery <span class="comment">#更新依赖</span></span><br><span class="line">yarn remove jquery <span class="comment">#删除依赖</span></span><br><span class="line">yarn <span class="comment"># 安装所有依赖</span></span><br><span class="line">yarn install <span class="comment">#安装所有依赖</span></span><br></pre></td></tr></table></figure>
<h2 id="Yarn命令"><a href="#Yarn命令" class="headerlink" title="Yarn命令"></a>Yarn命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add jquery <span class="comment">#添加依赖包</span></span><br><span class="line">yarn bin <span class="comment">#显示yarn安装目录</span></span><br><span class="line">yarn cache <span class="built_in">ls</span> <span class="comment">#列出缓存包</span></span><br><span class="line">yarn cache <span class="built_in">dir</span> <span class="comment">#打出缓存目录路径</span></span><br><span class="line">yarn cache clean <span class="comment">#清除缓存</span></span><br><span class="line">yarn check <span class="comment">#检查包</span></span><br><span class="line">yarn clean <span class="comment">#清理不需要的依赖文件</span></span><br><span class="line">yarn config list <span class="comment">#显示当前配置。</span></span><br><span class="line">yarn config <span class="built_in">set</span> registry <span class="string">&quot;https://registry.npm.taobao.org&quot;</span> <span class="comment">#设置淘宝源</span></span><br><span class="line">yarn config delete <span class="comment">#删除设置</span></span><br><span class="line">yarn generate-lock-entry <span class="comment">#生成锁定文件</span></span><br><span class="line">yarn global [--prefix] <span class="comment">#全局安装依赖包</span></span><br><span class="line">yarn info <span class="comment">#显示依赖包的信息</span></span><br><span class="line">yarn init <span class="comment">#--yes/-y：以默认值生成package.json文件</span></span><br><span class="line">yarn install <span class="comment">#安装所有依赖包</span></span><br><span class="line">yarn licenses <span class="built_in">ls</span> <span class="comment">#列出已安装依赖包的证书</span></span><br><span class="line">yarn licenses generate-disclaimer <span class="comment">#生成免责声明</span></span><br><span class="line">yarn <span class="built_in">link</span> <span class="comment">#开发时链接依赖包，以便在其他项目中使用</span></span><br><span class="line">yarn login <span class="comment">#保存你的用户名、邮箱</span></span><br><span class="line">yarn <span class="built_in">logout</span> <span class="comment">#删除你的用户名、邮箱</span></span><br><span class="line">yarn list <span class="comment">#列出已安装依赖包</span></span><br><span class="line">yarn outdated <span class="comment">#检查过时的依赖包</span></span><br><span class="line">yarn owner [<span class="built_in">ls</span>/add/remove] <span class="comment">#管理拥有者</span></span><br><span class="line">yarn pack <span class="comment">#创建一个压缩的包依赖 gzip 档案。</span></span><br><span class="line">yarn publish <span class="comment">#将包发布到npm</span></span><br><span class="line">yarn remove jquery	<span class="comment">#卸载包，更新package.json和yarn.lock</span></span><br><span class="line">yarn run <span class="comment">#运行package.json中预定义的脚本</span></span><br><span class="line">yarn tag [add/rm/ls] <span class="comment">#显示包的标签</span></span><br><span class="line">yarn team [create/destroy/add/rm/ls] <span class="comment">#管理团队</span></span><br><span class="line">yarn <span class="built_in">test</span>  <span class="comment">#测试</span></span><br><span class="line">yarn <span class="built_in">unlink</span> <span class="comment">#取消链接依赖包</span></span><br><span class="line">yarn upgrade <span class="comment">#升级依赖包</span></span><br><span class="line">yarn version <span class="comment">#管理当前项目的版本号</span></span><br><span class="line">yarn why jquery <span class="comment">#分析为什么需要安装依赖包</span></span><br><span class="line">yarn install --force <span class="comment">#强制所有包都预下载</span></span><br><span class="line">yarn install --flat <span class="comment">#安装依赖包的单版本</span></span><br><span class="line">yarn install --production <span class="comment">#仅安装生产环境依赖包</span></span><br><span class="line">npm install [package] <span class="comment">#安装依赖</span></span><br><span class="line">npm install --save [package] <span class="comment">#添加生产模式依赖到项目</span></span><br><span class="line">npm install --save-dev [package] <span class="comment">#添加开发模式的依赖</span></span><br></pre></td></tr></table></figure>

<h2 id="yarn其他"><a href="#yarn其他" class="headerlink" title="yarn其他"></a>yarn其他</h2><p>yarn add 命令允许你添加并安装依赖，和我们在 npm 命令中使用 –save 参数一样<br>Yarn 的-dev 则等同于 npm 的 –save-dev</p>
<p>yarn.lock 文件通过保存哪些依赖版本和你的包一起安装来确保你的包跨平台安装时是一致的</p>
<p>从npm客户端迁移至Yarn客户端，要在已有目录执行相应的yarn命令</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="http://qianduan.guru/2016/11/09/yarn-vs-npm/">Yarn vs npm：你需要知道的一切</a></li>
<li><a href="https://yarn.bootcss.com/">yarn 中文网(一)</a></li>
<li><a href="https://yarnpkg.com/zh-Hans/">yarn 中文网(二)</a></li>
<li><a href="https://yarnpkg.com/en/">yarn 英文网</a></li>
<li><a href="http://docs.shellway.cn/learning-yarn/">Yarn学习笔记</a></li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>vue之NextTick实现</title>
    <url>/2019/10/19/vue%E4%B9%8BNextTick%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><code>Vue.nextTick( [callback, context] )</code></p>
<ul>
<li><strong>参数：</strong><ul>
<li><code>&#123;Function&#125; [callback]</code></li>
<li><code>&#123;Object&#125; [context]</code></li>
</ul>
</li>
<li>用法：<ul>
<li>在下次 <code>DOM</code> 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 <code>DOM</code></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// 修改数据</span><br><span class="line">vm.msg = <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">// DOM 还没有更新</span><br><span class="line">Vue.nextTick(<span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">  // DOM 更新了</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>2.1.0起新增</strong>：如果没有提供回调且在支持 <code>Promise</code> 的环境中，则返回一个 <code>Promise</code>。请注意 <code>Vue</code> 不自带 <code>Promise</code> 的 <code>polyfill</code>，所以如果你的目标浏览器不原生支持 <code>Promise</code> (<code>IE</code>：你们都看我干嘛)，你得自己提供 <code>polyfill</code>。</p>
<span id="more"></span>

<h2 id="异步更新队列"><a href="#异步更新队列" class="headerlink" title="异步更新队列"></a>异步更新队列</h2><ol>
<li><code>Vue</code> 在更新 <code>DOM</code> 时是异步执行的</li>
<li>只要侦听到数据变化，<code>Vue</code> 将开启一个队列，并缓冲在同一事件循环中发生的所有数据变更</li>
<li>在缓冲时去除重复数据对于避免不必要的计算和 <code>DOM</code> 操作是非常重要的。然后，在下一个的事件循环<code>tick</code>中更新</li>
<li>如果同一个 <code>watcher</code> 被多次触发，只会被推入到队列中一次</li>
<li><code>Vue</code> 在内部对异步队列尝试使用原生的 <code>Promise.then</code>、<code>MutationObserver</code> 和  <code>setImmediate</code>，如果执行环境不支持，则会采用 <code>setTimeout(fn, 0)</code> 代替</li>
</ol>
<h2 id="v2-6-12之next-tick源码"><a href="#v2-6-12之next-tick源码" class="headerlink" title="v2.6.12之next-tick源码"></a><code>v2.6.12</code>之<code>next-tick</code>源码</h2><h6 id="辅助方法"><a href="#辅助方法" class="headerlink" title="辅助方法"></a>辅助方法</h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//是否IE</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isIE = <span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/msie|trident/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>)</span><br><span class="line"><span class="comment">//空函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">noop</span> (a?: any, b?: any, c?: any) &#123;&#125;</span><br><span class="line"><span class="comment">/* istanbul ignore next */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isNative</span> (<span class="title class_">Ctor</span>: any): boolean &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> <span class="title class_">Ctor</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="regexp">/native code/</span>.<span class="title function_">test</span>(<span class="title class_">Ctor</span>.<span class="title function_">toString</span>())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//是否ios</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isIOS = (<span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/iphone|ipad|ipod|ios/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>)) || (weexPlatform === <span class="string">&#x27;ios&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h6 id="next-tick-js"><a href="#next-tick-js" class="headerlink" title="next-tick.js"></a><code>next-tick.js</code></h6><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* @flow */</span></span><br><span class="line"><span class="comment">/* globals MutationObserver */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; noop &#125; <span class="keyword">from</span> <span class="string">&#x27;shared/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleError &#125; <span class="keyword">from</span> <span class="string">&#x27;./error&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; isIE, isIOS, isNative &#125; <span class="keyword">from</span> <span class="string">&#x27;./env&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否正在使用微任务</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> isUsingMicroTask = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用来存储所有需要执行的回调函数</span></span><br><span class="line"><span class="keyword">const</span> callbacks = []</span><br><span class="line"><span class="comment">// 该变量的作用是表示状态，判断是否有正在执行的回调函数。</span></span><br><span class="line"><span class="keyword">let</span> pending = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行缓冲回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">flushCallbacks</span> () &#123;</span><br><span class="line">  pending = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> copies = callbacks.<span class="title function_">slice</span>(<span class="number">0</span>)</span><br><span class="line">  callbacks.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; copies.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    copies[i]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里，我们使用微任务异步延迟包装器。</span></span><br><span class="line"><span class="comment">// 在2.5中，我们使用了（宏）任务（与微任务结合使用）。</span></span><br><span class="line"><span class="comment">// 但是，当在重新绘制之前更改状态时，它存在一些细微的问题</span></span><br><span class="line"><span class="comment">// （例如＃6813，由外向内的过渡）。</span></span><br><span class="line"><span class="comment">// 此外，在事件处理程序中使用（宏）任务会导致一些奇怪的行为</span></span><br><span class="line"><span class="comment">// 无法规避的代码（例如＃7109，＃7153，＃7546，＃7834，＃8109）。</span></span><br><span class="line"><span class="comment">// 因此，我们现在再次在各处使用微任务。</span></span><br><span class="line"><span class="comment">// 这种折衷的主要缺点是存在一些场景</span></span><br><span class="line"><span class="comment">// 微任务的优先级过高，并且在两者之间触发</span></span><br><span class="line"><span class="comment">// 顺序事件（例如，具有解决方法的＃4521，＃6690）</span></span><br><span class="line"><span class="comment">// 甚至在同一事件冒泡之间（＃6566）。</span></span><br><span class="line"><span class="keyword">let</span> timerFunc</span><br><span class="line"></span><br><span class="line"><span class="comment">// nextTick行为利用了微任务队列，可以访问它</span></span><br><span class="line"><span class="comment">// 通过本地Promise.then或MutationObserver。</span></span><br><span class="line"><span class="comment">// MutationObserver拥有更广泛的支持，但是在此方面存在严重错误</span></span><br><span class="line"><span class="comment">// 在触摸事件处理程序中触发时，iOS&gt; = 9.3.3中的UIWebView。 它</span></span><br><span class="line"><span class="comment">// 触发几次后完全停止工作...因此，如果是原生的</span></span><br><span class="line"><span class="comment">// Promise可用，我们将使用它：</span></span><br><span class="line"><span class="comment">/* istanbul 忽略下一个, $flow-disable-line */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Promise</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title function_">isNative</span>(<span class="title class_">Promise</span>)) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    p.<span class="title function_">then</span>(flushCallbacks)</span><br><span class="line">    <span class="comment">// 在有问题的UIWebViews中，Promise.then不会完全中断，但是</span></span><br><span class="line">    <span class="comment">// 它可能会陷入怪异的状态，在这种状态下，回调被推入微任务队列，</span></span><br><span class="line">    <span class="comment">// 但是直到浏览器才刷新队列，需要做其他一些工作</span></span><br><span class="line">    <span class="comment">// 例如 处理一个计时器。 因此，我们可以</span></span><br><span class="line">    <span class="comment">// 通过添加空计时器来“强制”刷新微任务队列。</span></span><br><span class="line">    <span class="keyword">if</span> (isIOS) <span class="built_in">setTimeout</span>(noop)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isIE &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">MutationObserver</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; (</span><br><span class="line">  <span class="title function_">isNative</span>(<span class="title class_">MutationObserver</span>) ||</span><br><span class="line">  <span class="comment">// PhantomJS and iOS 7.x</span></span><br><span class="line">  <span class="title class_">MutationObserver</span>.<span class="title function_">toString</span>() === <span class="string">&#x27;[object MutationObserverConstructor]&#x27;</span></span><br><span class="line">)) &#123;</span><br><span class="line">  <span class="comment">// timerFunc函数执行时会导致文本节点textNode的数据发生改变，因为MutationObserver对象在监听文本节点，</span></span><br><span class="line">  <span class="comment">// 所以进而也就会触发flushCallbacks回调函数</span></span><br><span class="line">  <span class="comment">// 如果本地Promise不可用，请使用MutationObserver，</span></span><br><span class="line">  <span class="comment">// 例如 PhantomJS，iOS7，Android 4.4</span></span><br><span class="line">  <span class="comment">//（＃6466 MutationObserver在IE11中不可靠）</span></span><br><span class="line">  <span class="keyword">let</span> counter = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(flushCallbacks)</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">String</span>(counter))</span><br><span class="line">  observer.<span class="title function_">observe</span>(textNode, &#123;</span><br><span class="line">    <span class="attr">characterData</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    counter = (counter + <span class="number">1</span>) % <span class="number">2</span></span><br><span class="line">    textNode.<span class="property">data</span> = <span class="title class_">String</span>(counter)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> setImmediate !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title function_">isNative</span>(setImmediate)) &#123;</span><br><span class="line">  <span class="comment">// 回退到setImmediate。</span></span><br><span class="line">  <span class="comment">// 从技术上讲，它利用了（宏）任务队列，</span></span><br><span class="line">  <span class="comment">// 但它仍然是比setTimeout更好的选择。</span></span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setImmediate</span>(flushCallbacks)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 回退到setTimeout。</span></span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(flushCallbacks, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">nextTick</span> (cb?: <span class="title class_">Function</span>, ctx?: <span class="title class_">Object</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _resolve</span><br><span class="line">  callbacks.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.<span class="title function_">call</span>(ctx)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, ctx, <span class="string">&#x27;nextTick&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_resolve) &#123;</span><br><span class="line">      <span class="title function_">_resolve</span>(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">    pending = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">timerFunc</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果没有提供回调且在支持 `Promise` 的环境中，则返回一个 `Promise`</span></span><br><span class="line">  <span class="comment">// $flow-disable-line</span></span><br><span class="line">  <span class="keyword">if</span> (!cb &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Promise</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      _resolve = resolve</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MutationObserver"><a href="#MutationObserver" class="headerlink" title="MutationObserver"></a><code>MutationObserver</code></h2><ul>
<li><code>MutationObserver</code>接口提供了监视对<code>DOM</code>树所做更改的能力。</li>
<li>它被设计为旧的<code>Mutation Events</code>功能的替代品，该功能是<code>DOM3 Events</code>规范的一部分。</li>
</ul>
<ol>
<li><code>childList：</code>子节点的变动（指新增，删除或者更改）。</li>
<li><code>attributes：</code>属性的变动。</li>
<li><code>characterData：</code>节点内容或节点文本的变动。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flushCallbacks</span> (mutationsList, observer) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;flushCallbacks&quot;</span>,&#123;</span><br><span class="line">        mutationsList,</span><br><span class="line">        observer</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(flushCallbacks)</span><br><span class="line"><span class="keyword">const</span> textNode = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">String</span>(counter))</span><br><span class="line">observer.<span class="title function_">observe</span>(textNode, &#123;</span><br><span class="line">    <span class="comment">//节点内容或节点文本的变动。</span></span><br><span class="line">    <span class="attr">characterData</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">textNode.<span class="property">data</span> = <span class="title class_">String</span>(counter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止监控</span></span><br><span class="line">observer.<span class="title function_">disconnect</span>();</span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://cn.vuejs.org/v2/api/#Vue-nextTick">Vue-nextTick</a></li>
<li><a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E9%98%9F%E5%88%97">异步更新队列</a></li>
<li><a href="https://github.com/vuejs/vue/blob/v2.6.12/src/core/util/next-tick.js">v2.6.12&#x2F;src&#x2F;core&#x2F;util&#x2F;next-tick</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>事件循环</title>
    <url>/2018/10/07/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
    <content><![CDATA[<h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><p><code>Event Loop</code> 是一种运行机制。</p>
<p>宏任务<code>macrotask</code>和微任务<code>microtask</code>两个概念，这表示任务的两种分类。</p>
<p>在挂起任务时，<code>JS</code> 引擎会将所有任务按照类别分到这两个队列中，首先在 <code>macrotask</code> 的队列（这个队列也被叫做 <code>task queue</code>）中取出第一个任务，执行完毕后取出 <code>microtask</code> 队列中的所有任务顺序执行；</p>
<p>之后再取 <code>macrotask</code> 任务，周而复始，直至两个队列的任务都取完。</p>
<span id="more"></span>

<h3 id="V8引擎"><a href="#V8引擎" class="headerlink" title="V8引擎"></a><code>V8</code>引擎</h3><p><code>V8</code>引擎基本概念关系图 (根据 <code>Google V8</code> 官方文档)</p>
<p><a href="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201809281123.jpg">http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201809281123.jpg</a></p>
<h4 id="handle"><a href="#handle" class="headerlink" title="handle"></a><code>handle</code></h4><p><code>handle </code>是指向对象的指针，在 <code>V8</code> 中，所有的对象都通过 <code>handle</code> 来引用，<code>handle</code> 主要用于 <code>V8</code>的垃圾回收机制。</p>
<h4 id="上下文-context"><a href="#上下文-context" class="headerlink" title="上下文(context)"></a>上下文(<code>context</code>)</h4><p><code>context</code> 是一个执行器环境，使用 <code>context</code> 可以将相互分离的 <code>JavaScript</code> 脚本在同一个 <code>V8</code> 实例中运行，而互不干涉。在运行 <code>JavaScript</code> 脚本是，需要显式的指定 <code>context</code> 对象。</p>
<h3 id="运行时概念"><a href="#运行时概念" class="headerlink" title="运行时概念"></a>运行时概念</h3><h4 id="可视化描述"><a href="#可视化描述" class="headerlink" title="可视化描述"></a>可视化描述</h4><p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201809281133.png" alt="image"></p>
<h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><p>函数调用形成了一个栈帧。</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201809281418.gif" alt="image"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> a + b + <span class="number">11</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">x</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">foo</span>(x * y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bar</span>(<span class="number">7</span>));</span><br></pre></td></tr></table></figure>

<p>当调用<code>bar</code>时，创建了第一个帧 ，帧中包含了<code>bar</code>的参数和局部变量。</p>
<p>当<code>bar</code>调用<code>foo</code>时，第二个帧就被创建，并被压到第一个帧之上，帧中包含了<code>foo</code>的参数和局部变量。当<code>foo</code>返回时，最上层的帧就被弹出栈（剩下<code>bar</code>函数的调用帧 ）。</p>
<p>当<code>bar</code>返回的时候，栈就空了。</p>
<h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><p>对象被分配在一个堆中，即用以表示一个大部分非结构化的内存区域。</p>
<h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><p>一个 <code>JavaScript</code> 运行时包含了一个待处理的消息队列。每一个消息都有一个为了处理这个消息相关联的函数。</p>
<p>在事件循环期间的某个时刻，运行时总是从最先进入队列的一个消息开始处理队列中的消息。正因如此，这个消息就会被移出队列，并将其作为输入参数调用与之关联的函数。为了使用这个函数，调用一个函数总是会为其创造一个新的栈帧，一如既往。</p>
<p>函数的处理会一直进行直到执行栈再次为空；然后事件循环将会处理队列中的下一个消息（如果还有的话）。</p>
<h2 id="浏览器事件循环"><a href="#浏览器事件循环" class="headerlink" title="浏览器事件循环"></a>浏览器事件循环</h2><h3 id="事件循环-WHATWG规范"><a href="#事件循环-WHATWG规范" class="headerlink" title="事件循环(WHATWG规范)"></a>事件循环(WHATWG规范)</h3><p>要协调事件<code>(event)</code>，用户交互<code>(user interaction)</code>，脚本<code>(script)</code>，渲染<code>(rendering)</code>，网络<code>(networking)</code>等，用户代理<code>(user agent)</code>就需要使用事件循环<code>(event loops)</code>。</p>
<p>有两种事件循环：</p>
<ol>
<li>用于浏览器上下(<code>browsing context</code>)文的事件循环</li>
<li>用于<code>workers</code>的事件循环</li>
</ol>
<h3 id="事件循环机制"><a href="#事件循环机制" class="headerlink" title="事件循环机制"></a>事件循环机制</h3><ul>
<li><p>一个事件循环有一个或多个任务队列(<code>task queues</code>),一个任务队列是有序列表的任务,这些算法负责以下工作：<br>事件(<code>Events</code>)，解析(<code>Parsing</code>) ，回调(<code>Callbacks</code>)，使用资源(<code>Using a resource</code>)，对DOM操作做出反应(<code>Reacting to DOM manipulation</code>)</p>
</li>
<li><p>每个任务都定义为来自特定任务源<code>task source</code>。必须始终添加来自一个特定任务源并发往特定事件循环的所有任务(例如，由<code>Document</code>的计时器生成的回调，针对该<code>Document</code>的鼠标移动而触发的事件，排队等待该<code>Document</code>的解析器的任务)到同一任务队列，但来自不同任务源的任务可以放在不同的任务队列中。</p>
</li>
<li><p>例如，用户代理可以为鼠标和键事件(用户交互任务源)创建一个任务队列，为其他所有事件设置另一个任务队列。然后，用户代理可以在四分之三的时间内为其他任务提供键盘和鼠标事件首选项，保持界面响应但不会使其他任务队列处于饥饿状态，并且永远不会无序地处理来自任何一个任务源的事件。</p>
</li>
<li><p>每个事件循环都有一个当前运行的任务。最初，这是null。它用于处理重入。每个事件循环还具有执行微任务检查点标志(<code>microtask checkpoint flag</code>)，该标志最初必须为假(<code>false</code>)。它用于防止执行微任务检查点算法的重入调用。</p>
</li>
</ul>
<h3 id="事件循环处理模型"><a href="#事件循环处理模型" class="headerlink" title="事件循环处理模型"></a>事件循环处理模型</h3><p>一个事件循环存在，将连续执行以下步骤：</p>
<ol>
<li>选择最先进入事件循环任务队列的一个任务(<code>oldestTask</code>)， 如果队列中没有任务，则直接跳到第6步的<code>microtask</code></li>
<li>将事件循环的当前运行任务设置为上一步所选择的任务(<code>oldestTask</code>)</li>
<li>运行所选任务(<code>oldestTask</code>)</li>
<li>将事件循环的当前运行任务设置为<code>null</code> 。</li>
<li>从其任务队列中移除<code>oldestTask</code>。</li>
<li>微任务(<code>microtask</code>):执行微任务检查点</li>
<li>更新渲染(<code>update the rendering</code>)</li>
<li>如果这是一个<code>worker</code>事件循环（即一个为<code>WorkerGlobalScope</code>运行的循环）</li>
<li>跳到第一步</li>
</ol>
<h3 id="微任务-microtask"><a href="#微任务-microtask" class="headerlink" title="微任务(microtask)"></a>微任务(<code>microtask</code>)</h3><p>每个事件循环都有一个微任务队列。微任务是最初要在微任务队列上排队的任务，而不是任务队列上排队的任务</p>
<p>当算法需要对微任务进行排队时，必须将其附加到相关事件循环的微任务队列中;这种微任务的任务源是微任务任务源</p>
<p>当用户代理要 <strong>执行微任务检查点</strong> 时，如果执行微任务检查点标志为<code>false</code>，则用户代理必须运行以下步骤：</p>
<ol>
<li>将执行微任务检查点标志(<code>flag</code>)设置为<code>true</code>。</li>
<li>而事件循环的微任务队列不为空:<ol>
<li>让<code>oldestMicrotask</code>成为事件循环的微任务队列中最老的微任务(<code>oldest microtask </code>)</li>
<li>将事件循环的当前运行任务设置为<code>oldestMicrotask</code></li>
<li>运行<code>oldestMicrotask</code></li>
<li>将事件循环的当前运行任务设置为<code>null</code>。</li>
<li>从微任务队列中删除<code>oldestMicrotask</code>。</li>
</ol>
</li>
<li>对于其负责事件循环是此事件循环的每个环境设置对象，请通知该环境设置对象上被拒绝的承诺。</li>
<li>清理索引数据库事务。</li>
<li>将执行微任务检查点标志设置为<code>false</code>。</li>
</ol>
<p>微任务的实现：</p>
<ul>
<li><code>process.nextTick</code>:事件循环的下一次循环中调用 <code>callback</code> 回调函数</li>
<li><code>Promises</code>:<code>Promise</code> 对象用于表示一个异步操作的最终状态（完成或失败），以及其返回的值。</li>
<li><code>Object.observe</code>:<code>Object.observe()</code> 方法用于异步地监视一个对象的修改</li>
<li><code>MutationObserver</code>:(<code>Mutation Observer API</code> 用来监视 <code>DOM</code> 变动)</li>
</ul>
<h3 id="宏任务-macrotask"><a href="#宏任务-macrotask" class="headerlink" title="宏任务(macrotask)"></a>宏任务(<code>macrotask</code>)</h3><p>宏任务的实现：</p>
<ol>
<li><code>script</code>（整体代码）</li>
<li><code>setTimeout</code></li>
<li><code>setInterval</code></li>
<li><code>setImmediate</code>:该方法用来把一些需要长时间运行的操作放在一个回调函数里,在浏览器完成后面的其他语句后,就立刻执行这个回调函数,</li>
<li><code>I/O</code></li>
<li><code>UI rendering</code></li>
</ol>
<h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>chrome</code>执行顺序：</p>
<p><code>script start</code>、<code>script end</code>、<code>promise1</code>、<code>promise2</code>、<code>setTimeout</code></p>
<h2 id="nodejs事件循环"><a href="#nodejs事件循环" class="headerlink" title="nodejs事件循环"></a>nodejs事件循环</h2><p><code>nodejs</code>的<code>event</code>是基于<code>libuv</code></p>
<p>事件循环允许<code>Node.js</code>执行非阻塞<code>I/O</code>操作</p>
<p>尽管<code>JavaScript</code>是单线程的,通过尽可能将操作卸载到系统内核。</p>
<p>由于大多数现代内核都是多线程的，因此它们可以处理在后台执行的多个操作。 当其中一个操作完成时，内核会告诉<code>Node.js</code>，以便可以将相应的回调添加到轮询队列中以最终执行。</p>
<h3 id="事件循环-1"><a href="#事件循环-1" class="headerlink" title="事件循环"></a>事件循环</h3><p>当<code>Node.js</code>启动时，它初始化事件循环，处理提供的输入脚本（或放入交互式解释器(<code>REPL</code>)），这可能会进行异步<code>API</code>调用，调度计时器或调用<code>process.nextTick</code>， 然后开始处理事件循环。</p>
<h3 id="事件循环操作顺序"><a href="#事件循环操作顺序" class="headerlink" title="事件循环操作顺序:"></a>事件循环操作顺序:</h3><p><strong>注意：</strong> 以下每个框都将被称为事件循环的“阶段”</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">   ┌───────────────────────────┐</span><br><span class="line">┌─&gt;│           timers          │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">│  │     pending callbacks     │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">│  │       idle, prepare       │</span><br><span class="line">│  └─────────────┬─────────────┘      ┌───────────────┐</span><br><span class="line">│  ┌─────────────┴─────────────┐      │   incoming:   │</span><br><span class="line">│  │           poll            │&lt;─────┤  connections, │</span><br><span class="line">│  └─────────────┬─────────────┘      │   data, etc.  │</span><br><span class="line">│  ┌─────────────┴─────────────┐      └───────────────┘</span><br><span class="line">│  │           check           │</span><br><span class="line">│  └─────────────┬─────────────┘</span><br><span class="line">│  ┌─────────────┴─────────────┐</span><br><span class="line">└──┤      close callbacks      │</span><br><span class="line">   └───────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>每个阶段都有一个要执行的回调先入先出(<code>First Input First Output</code>)队列。虽然每个阶段都有自己的特殊之处，但通常，当事件循环进入给定阶段时，它将执行特定于该阶段的任何操作，然后在该阶段的队列中执行回调，直到队列耗尽或执行的回调的最大数量为止。当队列耗尽或达到回调限制时，事件循环将移至下一阶段，依此类推。</p>
<p>由于这些操作中的任何一个可以调度更多操作,并且在轮询阶段中处理的新事件由内核排队，因此轮询事件可以在处理轮询事件时排队。因此，长时间运行的回调可以允许轮询阶段运行的时间比计时器的阈值长得多</p>
<p><strong>注意</strong>：<code>Windows</code>和<code>Unix/Linux</code>实现之间存在轻微差异，但这对于此演示并不重要。最重要的部分在这里。实际上有七到八个步骤，而我们关心的是 - <code>Node.js</code>实际使用的那些 - 是上面那些。</p>
<h3 id="阶段概述"><a href="#阶段概述" class="headerlink" title="阶段概述"></a>阶段概述</h3><p><code>nodejs</code>的事件循环分为6个阶段</p>
<ol>
<li>计时器(<code>timers</code>):此阶段执行<code>setTimeout()</code>和<code>setInterval()</code>调度的回调。</li>
<li>等待回调(<code>pending callbacks</code>):执行延迟到下一个循环迭代的<code>I/O</code>回调</li>
<li>空闲,准备(<code>idle, prepare</code>):仅在内部使用</li>
<li>轮询(<code>poll</code>):检索新的<code>I/O</code>事件;执行与<code>I/O</code>相关的回调（几乎所有回调都是关闭回调，定时器和<code>setImmediate()</code>调度的回调）;<code>node</code>将在适当的时候阻止</li>
<li><code>check</code>:<code>setImmediate()</code>在这里调用回调</li>
<li>关闭回调(<code>close callbacks</code>):一些关闭回调,例如<code>socket.on</code>（’close’，…）</li>
</ol>
<p>在事件循环的每次运行之间，<code>Node.js</code>检查它是否在等待任何异步的<code>I/O</code>或定时器，如果没有，则关闭。</p>
<p>代码片段：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeout&quot;</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setImmediate&quot;</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;process.nextTick&quot;</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise&quot;</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">;(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>))()</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行结果</span></span><br><span class="line">$ node index.<span class="property">js</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">process.<span class="property">nextTick</span> <span class="number">3</span></span><br><span class="line"><span class="title class_">Promise</span> <span class="number">4</span></span><br><span class="line"><span class="built_in">setTimeout</span> <span class="number">1</span></span><br><span class="line">setImmediate <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="循环阶段详情"><a href="#循环阶段详情" class="headerlink" title="循环阶段详情"></a>循环阶段详情</h3><h4 id="计时器-timers"><a href="#计时器-timers" class="headerlink" title="计时器(timers)"></a>计时器(<code>timers</code>)</h4><p>计时器指定阈值，在该阈值之后可以执行提供的回调而不是人们希望它执行的确切时间。 定时器回调将在指定的时间过去后尽早安排; 但是，操作系统调度或其他回调的运行可能会延迟它们。</p>
<p>注意：从技术上讲，轮询阶段控制何时执行定时器。</p>
<p>例如，假设您计划在<code>100</code>毫秒阈值后执行超时，那么您的脚本将异步读取一个耗时<code>95</code>毫秒的文件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//一些异步操作</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">someAsyncOperation</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">//假设这需要95ms才能完成</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;d:/all.txt&#x27;</span>, callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeoutScheduled = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> delay = <span class="title class_">Date</span>.<span class="title function_">now</span>() - timeoutScheduled;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`已经过去了<span class="subst">$&#123;delay&#125;</span>ms`</span>);</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 做一些需要95毫秒完成的异步操作</span></span><br><span class="line"><span class="title function_">someAsyncOperation</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">throw</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> startCallback = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;while开始&quot;</span>);</span><br><span class="line">    <span class="comment">//做一些需要10ms的事情....</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - startCallback &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="comment">//todo</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;while结束&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当事件循环进入轮询阶段时，它有一个空队列（<code>fs.readFile（）</code>尚未完成），因此它将等待<code>剩余的ms</code>数，直到达到最快的计时器阈值。 当它等待<code>95</code>毫秒传递时，<code>fs.readFile（）</code>完成读取文件，并且其完成需要<code>10</code>毫秒的回调被添加到轮询队列并执行。 当回调结束时，队列中不再有回调，因此事件循环将看到已达到最快定时器的阈值，然后回绕到定时器阶段以执行定时器的回调。 在此示例中，您将看到正在调度的计时器与正在执行的回调之间的总延迟将为<code>105</code>毫秒。</p>
<p>注意：为了防止轮询阶段使事件循环挨饿，<code>libuv</code>(实现<code>Node.js</code>事件循环的<code>C</code>库和平台的所有异步行为）在停止轮询更多的事件之前具有硬性最大值（取决于系统）。</p>
<h4 id="等待回调-pending-callbacks"><a href="#等待回调-pending-callbacks" class="headerlink" title="等待回调(pending callbacks)"></a>等待回调(<code>pending callbacks</code>)</h4><p>此阶段执行某些系统操作（例如<code>TCP</code>错误类型）的回调。 例如，如果<code>TCP</code>套接字在尝试连接时收到拒绝<code>ECONNREFUSED</code>，则某些<code>*nix</code>系统希望等待报告错误。 这将排队等待在挂起的回调阶段执行。</p>
<h4 id="轮询-poll"><a href="#轮询-poll" class="headerlink" title="轮询(poll)"></a>轮询(<code>poll</code>)</h4><p>轮询阶段有两个主要功能:</p>
<ol>
<li>计算它应该阻止和轮询<code>I/O</code>的时间,然后</li>
<li>处理轮询队列中的事件。</li>
</ol>
<p>当事件循环进入轮询阶段并且没有计划定时器时，将发生以下两种情况之一:</p>
<ol>
<li>如果轮询队列不为空，则事件循环将遍历其同步执行它们的回调队列，直到队列已用尽或者达到系统相关的硬性限制。</li>
<li>如果轮询队列为空，则会发生以下两种情况之一：<ul>
<li>如果<code>setImmediate()</code>已调度脚本，则事件循环将结束轮询阶段并继续执行检查阶段以执行这些调度脚本。</li>
<li>如果<code>setImmediate()</code>尚未调度脚本，则事件循环将等待将回调添加到队列，然后立即执行它们。</li>
</ul>
</li>
</ol>
<p>轮询队列为空后，事件循环将检查已达到时间阈值的计时器。 如果一个或多个计时器准备就绪，事件循环将回绕到计时器阶段以执行那些计时器的回调。</p>
<h4 id="check"><a href="#check" class="headerlink" title="check"></a><code>check</code></h4><p>此阶段允许人员在轮询阶段完成后立即执行回调。 如果轮询阶段变为空闲并且脚本已使用<code>setImmediate()</code>排队，则事件循环可以继续到检查阶段而不是等待。</p>
<p><code>setImmediate()</code>实际上是一个特殊的计时器，它在事件循环的一个单独阶段运行。 它使用<code>libuv API</code>来调度,在轮询阶段完成后执行的回调。</p>
<p>通常，在执行代码时，事件循环最终会到达轮询阶段，它将等待传入连接，请求等。但是，如果已使用<code>setImmediate()</code>调度回调并且轮询阶段变为空闲，则将结束并继续检查阶段，而不是等待轮询事件。</p>
<h4 id="关闭回调close-callbacks"><a href="#关闭回调close-callbacks" class="headerlink" title="关闭回调close callbacks"></a>关闭回调<code>close callbacks</code></h4><p>如果套接字或句柄突然关闭（例如<code>socket.destroy()</code>），则在此阶段将发出<code>close</code>事件。 否则它将通过<code>process.nextTick()</code>发出。</p>
<h3 id="setImmediate-与-setTimeout"><a href="#setImmediate-与-setTimeout" class="headerlink" title="setImmediate() 与 setTimeout()"></a><code>setImmediate()</code> 与 <code>setTimeout()</code></h3><p><code>setImmediate</code>和<code>setTimeout()</code>类似，但根据它们的调用时间以不同的方式运行。</p>
<ol>
<li><code>setImmediate()</code>用于在当前轮询阶段完成后执行脚本,即check阶段。</li>
<li><code>setTimeout()</code>计划在经过最小阈值（以<code>ms</code>为单位）后运行的脚本。</li>
</ol>
<p>执行定时器的顺序将根据调用它们的上下文而有所不同。 如果从主模块中调用两者，则时间将受到进程性能的限制（可能受到计算机上运行的其他应用程序的影响）。</p>
<p>例如，如果我们运行不在<code>I/O</code>周期内的以下脚本（即主模块），则执行两个定时器的顺序是不确定的，因为它受进程性能的约束：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// timeout_vs_immediate.js</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="keyword">function</span> <span class="title function_">immediate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;immediate&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>输出的顺序不确定：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line"><span class="built_in">timeout</span></span><br><span class="line">immediate</span><br><span class="line"></span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line"><span class="built_in">timeout</span></span><br></pre></td></tr></table></figure>

<p>但是，如果在<code>I/O</code>周期内移动两个调用，则始终首先执行立即回调：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;d:/all.txt&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;immediate&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>始终首先执行立即回调<code>immediate</code>,再执行<code>setTimeout</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line"><span class="built_in">timeout</span></span><br><span class="line"></span><br><span class="line">$ node timeout_vs_immediate.js</span><br><span class="line">immediate</span><br><span class="line"><span class="built_in">timeout</span></span><br></pre></td></tr></table></figure>

<p>使用<code>setImmediate()</code>而不是<code>setTimeout()</code>的主要优点是<code>setImmediate()</code>将始终在任何定时器之前执行（如果在<code>I/O</code>周期内调度），与存在多少定时器无关。</p>
<h3 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick()"></a><code>process.nextTick()</code></h3><h4 id="了解process-nextTick"><a href="#了解process-nextTick" class="headerlink" title="了解process.nextTick()"></a>了解<code>process.nextTick()</code></h4><p>您可能已经注意到<code>process.nextTick()</code>没有显示在图中，即使它是异步API的一部分。 这是因为<code>process.nextTick</code>在技术上不是事件循环的一部分。 相反，<code>nextTickQueue</code>将在当前操作完成后处理，而不管事件循环的当前阶段如何。</p>
<p>回顾一下上面的图表，无论何时在给定阶段调用<code>process.nextTick()</code>，传递给<code>process.nextTick()</code>的所有回调都将在事件循环继续之前得到解决。 这可能会产生一些不好的情况，因为它允许您通过进行递归的<code>process.nextTick()</code>调用来饿死(<code>starve</code>)您的<code>I/O</code>，这会阻止事件循环到达轮询阶段。</p>
<h4 id="为什么会被允许"><a href="#为什么会被允许" class="headerlink" title="为什么会被允许"></a>为什么会被允许</h4><p>为什么这样的东西会被包含在<code>Node.js</code>中? 其中一部分是一种设计理念，其中<code>API</code>应该始终是异步的，即使它不是必须的。 以下面代码段为例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">apiCall</span>(<span class="params">arg, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> arg !== <span class="string">&#x27;string&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> process.<span class="title function_">nextTick</span>(callback,<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;参数应该是字符串&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码片段进行参数检查，如果不正确，它会将错误传递给回调。这个API最近更新了，允许将参数传递给<code>process.nextTick()</code>，允许它将回调后传递的任何参数作为参数传播到回调，因此您不必嵌套函数。</p>
<p>我们正在做的是将错误传回给用户，但只有在我们允许其余的用户代码执行之后。 通过使用<code>process.nextTick</code>，我们保证<code>apiCall()</code>始终在用户代码的其余部分之后和允许事件循环继续之前运行其回调。 为了实现这一点，允许<code>JS</code>调用堆栈展开然后立即执行提供的回调，这允许一个人对<code>process.nextTick()</code>进行递归调用而不会达到<code>RangeError</code>：超出<code>v8</code>的最大调用堆栈大小。</p>
<p>这种理念可能会导致一些潜在的问题,以以下片段为例:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> bar;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这有一个异步签名，但同步调用回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">someAsyncApiCall</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在`someAsyncApiCall`完成之前调用回调。</span></span><br><span class="line"><span class="title function_">someAsyncApiCall</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 由于someAsyncApiCall已完成，因此bar未分配任何值</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bar&#x27;</span>, bar); <span class="comment">// undefined</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">bar = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>用户将<code>someAsyncApiCall()</code>定义为具有异步签名，但它实际上是同步操作的。 调用它时，在事件循环的同一阶段调用提供给<code>someAsyncApiCall()</code>的回调，因为<code>someAsyncApiCall()</code>实际上不会异步执行任何操作。 因此,回调尝试引用<code>bar</code>，即使它在范围内可能没有该变量，因为该脚本无法运行完成。</p>
<p>通过将回调放在<code>process.nextTick()</code>中，脚本仍然能够运行完成，允许在调用回调之前初始化所有变量，函数等。 它还具有不允许事件循环继续的优点。 在允许事件循环继续之前，向用户警告错误可能是有用的。</p>
<p>以下是使用<code>process.nextTick()</code>的前一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> bar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">someAsyncApiCall</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    process.<span class="title function_">nextTick</span>(callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">someAsyncApiCall</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bar&#x27;</span>, bar); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">bar = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>这是另一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(server.<span class="title function_">address</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>仅传递端口时，端口立即绑定。 因此可以立即调用<code>listen</code>回调。 问题是那时候不会设置<code>.on（&#39;listen&#39;）</code>。</p>
<p>为了解决这个问题，<code>listening</code>事件在<code>nextTick</code>中排队，以允许脚本运行完成。 这允许用户设置他们想要的任何事件处理程序。</p>
<h3 id="process-nextTick-vs-setImmediate"><a href="#process-nextTick-vs-setImmediate" class="headerlink" title="process.nextTick() vs setImmediate()"></a><code>process.nextTick()</code> vs <code>setImmediate()</code></h3><p>就用户而言，我们有两个类似的调用，但它们的名称令人困惑。</p>
<ul>
<li><code>process.nextTick()</code>在同一阶段立即触发</li>
<li><code>setImmediate()</code>触发事件循环的后续迭代或<code>tick</code></li>
</ul>
<p>本质上，这些名字应该被交换。与<code>setimmediation()</code>相比，<code>process.nextTick()</code>更快速地触发，但这是过去的产物，不太可能改变。这样做会破坏npm上的大部分包。每天都有更多的新模块被添加，这意味着我们每天都在等待，更多的潜在故障发生。虽然它们令人困惑，但名称本身不会改变。</p>
<p>建议开发人员在所有情况下都使用<code>setimmediation()</code>，因为这样做更容易理解(而且会导致代码与更广泛的环境兼容，比如浏览器<code>JS</code>)。</p>
<h3 id="为什么使用process-nextTick"><a href="#为什么使用process-nextTick" class="headerlink" title="为什么使用process.nextTick()"></a>为什么使用<code>process.nextTick()</code></h3><p>主要有两个原因：</p>
<ol>
<li>允许用户处理错误，清除任何不需要的资源，或者在事件循环继续之前再次尝试请求。</li>
<li>有时需要允许回调在调用堆栈展开之后但在事件循环继续之前运行。</li>
</ol>
<p>一个例子简单的例子:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="keyword">function</span>(<span class="params">conn</span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;listening&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(server.<span class="title function_">address</span>());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>假设<code>listen()</code>在事件循环的开头运行，但是侦听回调被放置在<code>setimmediation()</code>中。现在，除非将主机名传递给端口，否则绑定将立即发生。现在，为了让事件循环继续进行，它必须到达轮询阶段，这意味着有一个非零的机会，连接可能已经收到，允许连接事件在侦听事件之前被触发。</p>
<p>另一个例子是运行一个函数构造函数，比如继承自<code>EventEmitter</code>，它想在构造函数中调用一个事件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EventEmitter</span> = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyEmitter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">EventEmitter</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;event&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">util.<span class="title function_">inherits</span>(<span class="title class_">MyEmitter</span>, <span class="title class_">EventEmitter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> <span class="title class_">MyEmitter</span>();</span><br><span class="line">myEmitter.<span class="title function_">on</span>(<span class="string">&#x27;event&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发生了一件事！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>您无法立即从构造函数中发出事件，因为脚本将不会处理到用户为该事件分配回调的位置。 因此，在构造函数本身中，您可以使用<code>process.nextTick()</code>来设置回调以在构造函数完成后发出事件，从而提供预期的结果：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EventEmitter</span> = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyEmitter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">EventEmitter</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分配处理程序后，使用nextTick发出事件</span></span><br><span class="line">    process.<span class="title function_">nextTick</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="string">&#x27;event&#x27;</span>);</span><br><span class="line">    &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">&#125;</span><br><span class="line">util.<span class="title function_">inherits</span>(<span class="title class_">MyEmitter</span>, <span class="title class_">EventEmitter</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> <span class="title class_">MyEmitter</span>();</span><br><span class="line">myEmitter.<span class="title function_">on</span>(<span class="string">&#x27;event&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发生了一件事！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="libuv"><a href="#libuv" class="headerlink" title="libuv"></a>libuv</h2><p><code>libuv</code>是最初为<code>NodeJS</code>编写的跨平台支持库。 它是围绕事件驱动的异步<code>I/O</code>模型设计的。</p>
<h3 id="I-x2F-O-或事件-循环"><a href="#I-x2F-O-或事件-循环" class="headerlink" title="I&#x2F;O(或事件)循环"></a>I&#x2F;O(或事件)循环</h3><p><code>I/O</code>(或事件)循环是<code>libuv</code>的中心部分。它为所有<code>I/O</code>操作建立内容，并且它被绑定到一个线程。只要在不同的线程中运行，就可以运行多个事件循环。<code>libuv</code>事件循环(或任何其他涉及循环或句柄的<code>API</code>)不是线程安全的，除非另有说明。</p>
<p>为了更好地理解事件循环的运行方式，下图说明了循环迭代的所有阶段：</p>
<p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/201809281054.png" alt="image"></p>
<p><strong>重要：</strong> 虽然 <code>libuv</code> 的异步文件 <code>I/O</code>操作是通过线程池实现的，但是网络 <code>I/O</code> 总是在单线程中执行的。</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://en.wikipedia.org/wiki/Event_loop">事件循环Event loop</a></li>
<li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">WHATWG规范对Event loop</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop">并发模型与事件循环</a></li>
<li><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">任务，微任务，队列和日程安排</a></li>
<li><a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/"><code>The Node.js Event Loop, Timers, and process.nextTick()</code></a></li>
<li><a href="https://cnodejs.org/topic/5a9108d78d6e16e56bb80882">不要混淆nodejs和浏览器中的event loop</a></li>
<li><a href="https://github.com/libuv/libuv">跨平台异步I&#x2F;O. libuv</a></li>
<li><a href="http://acemood.github.io/2016/02/01/event-loop-in-javascript/">Event loop in JavaScript</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-v8engine/">使用 Google V8 引擎开发可定制的应用程序</a></li>
<li><a href="https://github.com/yjhjstz/deep-into-node">深入理解Nodejs核心思想与源码分析基于node v6.0.0</a></li>
<li><a href="https://github.com/xtx1130/blog">node源码粗读系列文章</a></li>
<li><a href="http://nodejs.cn/api/process.html#process_process_nexttick_callback_args">process.nextTick(callback[, …args])</a></li>
<li><a href="http://docs.libuv.org/en/v1.x/design.html">libuv 设计概述</a></li>
<li><a href="https://github.com/latentflip/loupe">在运行时可视化<code>javascript</code>运行时</a></li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>冒泡与快速排序</title>
    <url>/2016/05/05/%E5%86%92%E6%B3%A1%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 冒泡排序：比较相邻的前后二个数据，如果前面数据大于（小于）后面的数据，就将二个数据交换，循环n-1次</span><br><span class="line"> */</span><br><span class="line">private void <span class="function"><span class="title">BubbleSort</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //定义数组</span><br><span class="line">    int[] arr = &#123;80,10,5,40,60,1,20,10&#125;;</span><br><span class="line"></span><br><span class="line">    //临时存储</span><br><span class="line">    int temp;</span><br><span class="line"></span><br><span class="line">    //外循环：从数组第一个值循环到倒数第二个值</span><br><span class="line">    <span class="keyword">for</span> (int i = 0; i &lt; arr.Length-1; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        //内循环：把最大数字的排在后面</span><br><span class="line">        //比较的总是比i大的值，前面的值已经冒泡完成了</span><br><span class="line">        <span class="keyword">for</span> (int j = i+1; j &lt; arr.Length; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            //前边的大于后边的则交换</span><br><span class="line">            <span class="keyword">if</span> (arr[i].CompareTo(arr[j])&gt;0)</span><br><span class="line">            &#123;</span><br><span class="line">                temp = arr[i];</span><br><span class="line">                arr[i] = arr[j];</span><br><span class="line">                arr[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //转为字符串数组</span><br><span class="line">    string[] strArr = arr.Select(s =&gt; s.ToString()).ToArray();</span><br><span class="line"></span><br><span class="line">    //拼接字符串</span><br><span class="line">    string str = string.Join(<span class="string">&quot;,&quot;</span>, strArr);</span><br><span class="line"></span><br><span class="line">    //打印字符串</span><br><span class="line">    Debug.Log(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//快速排序单元</span><br><span class="line">private int sortUnit(int[] arr, int left, int right)</span><br><span class="line">&#123;</span><br><span class="line">    //此处选择第一个数作为基准值</span><br><span class="line">    int pivot = arr[left];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left&lt;right)</span><br><span class="line">    &#123;</span><br><span class="line">        //从后向前搜索比基准值小的元素</span><br><span class="line">        <span class="keyword">while</span> (right &gt; left &amp;&amp; arr[right] &gt; pivot)</span><br><span class="line">        &#123;</span><br><span class="line">            //右边下标左移</span><br><span class="line">            --right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //比基准值小的(等于的)元素放在左边</span><br><span class="line">        arr[left] = arr[right];</span><br><span class="line"></span><br><span class="line">        //从前向后搜索比基准值大（等于）的元素</span><br><span class="line">        <span class="keyword">while</span> (right &gt; left &amp;&amp; arr[left] &lt;= pivot)</span><br><span class="line">        &#123;</span><br><span class="line">            //左边下标右移</span><br><span class="line">            ++left;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //比基准值大的的元素放在左边</span><br><span class="line">        arr[right] = arr[left];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //左边的元素小于或等于基准值，右边的则大于基准值，此时左右下标相等，将基准值放在下标当前位置</span><br><span class="line">    arr[left] = pivot;</span><br><span class="line"></span><br><span class="line">    //返回此时的下标</span><br><span class="line">    <span class="built_in">return</span> right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//递归调用</span><br><span class="line">private void QuickMain(int[] arr,int left,int right)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //如果起点下标和终点下标一样直接返回空</span><br><span class="line">    <span class="keyword">if</span> (left &gt;= right)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //完成一次单元排序</span><br><span class="line">    int index = sortUnit(arr, left, right);</span><br><span class="line"></span><br><span class="line">    //对左边单元进行排序</span><br><span class="line">    QuickMain(arr, left, index - 1);</span><br><span class="line">    //对右边边单元进行排序</span><br><span class="line">    QuickMain(arr, index+1, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* 快速排序:</span><br><span class="line">* 1.在数组里面找出一个基准值，通常选取第一个数作为基准值</span><br><span class="line">* 2.依据基准值，对数组进行分区操作，使左边的元素小于或等于基准值，右边的元素大于基准值</span><br><span class="line">*</span><br><span class="line">*/</span><br><span class="line">private void <span class="function"><span class="title">QuickSort</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    //定义数组</span><br><span class="line">    int[] arr = &#123; 80, 10, 5, 40, 60, 1, 20, 10 &#125;;</span><br><span class="line"></span><br><span class="line">    //开始快速排序</span><br><span class="line">    QuickMain(arr, 0, arr.Length - 1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //转为字符串数组</span><br><span class="line">    string[] strArr = arr.Select(s =&gt; s.ToString()).ToArray();</span><br><span class="line"></span><br><span class="line">    //拼接字符串</span><br><span class="line">    string str = string.Join(<span class="string">&quot;,&quot;</span>, strArr);</span><br><span class="line"></span><br><span class="line">    //打印字符串</span><br><span class="line">    Debug.Log(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title>函数apply-call-bind</title>
    <url>/2017/06/18/%E5%87%BD%E6%95%B0apply-call-bind/</url>
    <content><![CDATA[<h2 id="Function-prototype-apply"><a href="#Function-prototype-apply" class="headerlink" title="Function.prototype.apply()"></a>Function.prototype.apply()</h2><p><code>apply()</code> 方法调用一个函数, 其具有一个指定的this值，以及作为一个数组（或类似数组的对象）提供的参数。</p>
<h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fun.<span class="title function_">apply</span>(thisArg, [argsArray])</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<ul>
<li><p><code>thisArg</code>: 在 <code>fun</code> 函数运行时指定的 <code>this</code> 值。需要注意的是，指定的 <code>this</code> 值并不一定是该函数执行时真正的 <code>this</code> 值，如果这个函数处于非严格模式下，则指定为 <code>null</code> 或 <code>undefined</code> 时会自动指向全局对象（浏览器中就是<code>window</code>对象）,同时值为原始值（数字，字符串，布尔值）的 <code>this</code> 会指向该原始值的自动包装对象。</p>
</li>
<li><p><code>argsArray</code>: 一个数组或者类数组对象，其中的数组元素将作为单独的参数传给 fun 函数。如果该参数的值为null 或 undefined，则表示不需要传入任何参数。从ECMAScript 5 开始可以使用类数组对象。</p>
</li>
</ul>
<p>从 <code>ECMAScript</code> 第5版开始，可以使用任何种类的类数组对象，就是说只要有一个 <code>length</code> 属性和<code>[0...length)</code> 范围的整数属性。例如现在可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList"><code>NodeList</code></a> 或一个自己定义的类似 <code>&#123;&#39;length&#39;: 2, &#39;0&#39;: &#39;eat&#39;, &#39;1&#39;: &#39;bananas&#39;&#125;</code> 形式的对象。</p>
<p><strong>注意：Chrome 14 以及 <code>Internet Explorer 9</code> 仍然不接受类数组对象。如果传入类数组对象，它们会抛出异常。</strong></p>
<h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><h4 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>,+<span class="title class_">Infinity</span>,-<span class="title class_">Infinity</span>];</span><br><span class="line">max = <span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, numbers); <span class="comment">//Infinity</span></span><br><span class="line">min = <span class="title class_">Math</span>.<span class="property">min</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, numbers); <span class="comment">//-Infinity</span></span><br></pre></td></tr></table></figure>
<h4 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> cbj = &#123;</span><br><span class="line">    <span class="attr">lang</span>:<span class="string">&quot;汉语&quot;</span>,</span><br><span class="line">    <span class="attr">speak</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">lang</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ebj = &#123;</span><br><span class="line">    <span class="attr">lang</span>:<span class="string">&quot;英语&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">cbj.<span class="property">speak</span>.<span class="title function_">apply</span>(ebj)<span class="comment">//英语</span></span><br></pre></td></tr></table></figure>
<h4 id="例3"><a href="#例3" class="headerlink" title="例3"></a>例3</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lang</span> = <span class="string">&quot;谁知道你讲什么&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span>  = <span class="keyword">function</span>(<span class="params">args1,args2</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;speak &quot;</span> + <span class="variable language_">this</span>.<span class="property">lang</span>,args1,args2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> pe = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">pe.<span class="title function_">speak</span>();<span class="comment">//speak 谁知道你讲什么 undefined undefined</span></span><br><span class="line">pe.<span class="property">speak</span>.<span class="title function_">apply</span>(&#123;<span class="attr">lang</span>:<span class="string">&#x27;汉语&#x27;</span>&#125;,[<span class="number">1</span>,<span class="number">2</span>]);<span class="comment">//speak 汉语 1 2</span></span><br></pre></td></tr></table></figure>

<p><strong>当心</strong>：如果用上面的方式调用 <code>apply</code>, 你很可能会遇到方法参数个数越界的问题. 当你对一个方法传入非常多的参数 (比如超过1W多个参数) 时, 就非常有可能会导致越界问题, 这个临界值是根据不同的 <code>JavaScript</code> 引擎而定的.</p>
<h2 id="Function-prototype-call"><a href="#Function-prototype-call" class="headerlink" title="Function.prototype.call()"></a>Function.prototype.call()</h2><p><code>call()</code> 方法调用一个函数, 其具有一个指定的this值和分别地提供的参数(参数的列表)。</p>
<h3 id="语法：-1"><a href="#语法：-1" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fun.<span class="title function_">call</span>(thisArg[, arg1[, arg2[, ...]]])</span><br></pre></td></tr></table></figure>

<ul>
<li><code>thisArg</code>:在<code>fun</code>函数运行时指定的<code>this</code>值。需要注意的是，指定的<code>this</code>值并不一定是该函数执行时真正的<code>this</code>值，如果这个函数处于非严格模式下，则指定为<code>null</code>和<code>undefined</code>的<code>this</code>值会自动指向全局对象(浏览器中就是<code>window</code>对象)，同时值为原始值(数字，字符串，布尔值)的<code>this</code>会指向该原始值的自动包装对象。</li>
<li><code>arg1, arg2, ...</code>:指定的参数列表。</li>
</ul>
<p>可以让<code>call()</code>中的对象调用当前对象所拥有的<code>function</code>。你可以使用<code>call()</code>来实现继承：写一个方法，然后让另外一个新的对象来继承它（而不是在新对象中再写一次这个方法）</p>
<h3 id="例子：-1"><a href="#例子：-1" class="headerlink" title="例子："></a>例子：</h3><h4 id="使用-call-方法调用函数并且指定上下文的this"><a href="#使用-call-方法调用函数并且指定上下文的this" class="headerlink" title="使用 call 方法调用函数并且指定上下文的this"></a>使用 <code>call</code> 方法调用函数并且指定上下文的<code>this</code></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> cbj = &#123;</span><br><span class="line">    <span class="attr">lang</span>:<span class="string">&quot;汉语&quot;</span>,</span><br><span class="line">    <span class="attr">speak</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">lang</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ebj = &#123;</span><br><span class="line">    <span class="attr">lang</span>:<span class="string">&quot;英语&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">cbj.<span class="property">speak</span>.<span class="title function_">call</span>(ebj)<span class="comment">//英语</span></span><br></pre></td></tr></table></figure>

<h4 id="使用call方法调用父构造函数"><a href="#使用call方法调用父构造函数" class="headerlink" title="使用call方法调用父构造函数"></a>使用call方法调用父构造函数</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Product</span>(<span class="params">name, price</span>) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">price</span> = price;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">getInfo</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>+<span class="variable language_">this</span>.<span class="property">price</span>+<span class="string">&quot;块&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Fruits</span>(<span class="params">name, price</span>) &#123;</span><br><span class="line">	<span class="title class_">Product</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, price);</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">category</span> = <span class="string">&#x27;水果&#x27;</span>;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">getFruitsInfo</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">category</span>+<span class="string">&quot;:&quot;</span>+<span class="variable language_">this</span>.<span class="property">name</span>+<span class="variable language_">this</span>.<span class="property">price</span>+<span class="string">&quot;块&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vegetables</span>(<span class="params">name, price</span>) &#123;</span><br><span class="line">	<span class="title class_">Product</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name, price);</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">category</span> = <span class="string">&#x27;蔬菜&#x27;</span>;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">getVegetablesInfo</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">category</span>+<span class="string">&quot;:&quot;</span>+<span class="variable language_">this</span>.<span class="property">name</span>+<span class="variable language_">this</span>.<span class="property">price</span>+<span class="string">&quot;块&quot;</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = <span class="keyword">new</span> <span class="title class_">Product</span>(<span class="string">&#x27;红烧西瓜茄子&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">var</span> fru = <span class="keyword">new</span> <span class="title class_">Fruits</span>(<span class="string">&#x27;西瓜&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> veg = <span class="keyword">new</span> <span class="title class_">Vegetables</span>(<span class="string">&#x27;茄子&#x27;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">pro.<span class="title function_">getInfo</span>();<span class="comment">//红烧西瓜茄子10块</span></span><br><span class="line"></span><br><span class="line">fru.<span class="title function_">getInfo</span>();<span class="comment">//西瓜20块</span></span><br><span class="line">fru.<span class="title function_">getFruitsInfo</span>();<span class="comment">//水果:西瓜20块</span></span><br><span class="line"></span><br><span class="line">veg.<span class="title function_">getInfo</span>();<span class="comment">//茄子30块</span></span><br><span class="line">veg.<span class="title function_">getVegetablesInfo</span>();<span class="comment">//蔬菜:茄子30块</span></span><br></pre></td></tr></table></figure>

<h4 id="使用call方法调用匿名函数"><a href="#使用call方法调用匿名函数" class="headerlink" title="使用call方法调用匿名函数"></a>使用<code>call</code>方法调用匿名函数</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> animals = [</span><br><span class="line">	&#123;<span class="attr">color</span>: <span class="string">&#x27;白色&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;猴子&#x27;</span>&#125;,</span><br><span class="line">	&#123;<span class="attr">color</span>: <span class="string">&#x27;黑色&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;老虎&#x27;</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; animals.<span class="property">length</span>; i++) &#123;</span><br><span class="line">	(<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">print</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">		  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;#&#x27;</span> + i  + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">color</span> + <span class="string">&#x27;: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="title function_">print</span>();</span><br><span class="line">	&#125;).<span class="title function_">call</span>(animals[i], i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//#0 白色: 猴子</span></span><br><span class="line"><span class="comment">//#1 黑色: 老虎</span></span><br></pre></td></tr></table></figure>

<h2 id="Function-prototype-bind"><a href="#Function-prototype-bind" class="headerlink" title="Function.prototype.bind()"></a>Function.prototype.bind()</h2><p><code>bind()</code>方法创建一个新的函数, 当被调用时，将其<code>this</code>关键字设置为提供的值，在调用新函数时，在任何提供之前提供一个给定的参数序列。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fun.<span class="title function_">bind</span>(thisArg[, arg1[, arg2[, ...]]])</span><br></pre></td></tr></table></figure>

<ul>
<li><code>thisArg</code>:当绑定函数被调用时，该参数会作为原函数运行时的 <code>this</code> 指向。当使用<code>new</code> 操作符调用绑定函数时，该参数无效。</li>
<li><code>arg1, arg2, ...</code>:当绑定函数被调用时，这些参数将置于实参之前传递给被绑定的方法。</li>
</ul>
<p><code>bind()</code> 函数会创建一个新函数（称为绑定函数），新函数与被调函数（绑定函数的目标函数）具有相同的函数体（在 <code>ECMAScript 5</code> 规范中内置的<code>call</code>属性）。当新函数被调用时 <code>this</code> 值绑定到 <code>bind() </code>的第一个参数，该参数不能被重写。绑定函数被调用时，bind() 也接受预设的参数提供给原函数。一个绑定函数也能使用<code>new</code>操作符创建对象：这种行为就像把原函数当成构造器。提供的 <code>this</code> 值被忽略，同时调用时的参数被提供给模拟函数。</p>
<h3 id="例子：-2"><a href="#例子：-2" class="headerlink" title="例子："></a>例子：</h3><h4 id="创建绑定函数"><a href="#创建绑定函数" class="headerlink" title="创建绑定函数"></a>创建绑定函数</h4><p><code>bind()</code> 最简单的用法是创建一个函数，使这个函数不论怎么调用都有同样的 <code>this</code> 值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">9</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">81</span>,</span><br><span class="line">  <span class="attr">getX</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">x</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">getX</span>(); <span class="comment">// 返回 81</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> retrieveX = obj.<span class="property">getX</span>;</span><br><span class="line"><span class="title function_">retrieveX</span>(); <span class="comment">// 返回 9, 在这种情况下，&quot;this&quot;指向全局作用域</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个新函数，将&quot;this&quot;绑定到obj对象</span></span><br><span class="line"><span class="keyword">var</span> boundGetX = retrieveX.<span class="title function_">bind</span>(obj);</span><br><span class="line"><span class="title function_">boundGetX</span>(); <span class="comment">// 返回 81</span></span><br></pre></td></tr></table></figure>

<h4 id="用预设的初始参数创建函数"><a href="#用预设的初始参数创建函数" class="headerlink" title="用预设的初始参数创建函数"></a>用预设的初始参数创建函数</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用预设的初始参数创建函数</span></span><br><span class="line"><span class="keyword">var</span> clist = <span class="title class_">List</span>.<span class="title function_">bind</span>(<span class="literal">undefined</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">clist</span>(); <span class="comment">//[100]</span></span><br><span class="line"><span class="title function_">clist</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);<span class="comment">//[100,1,2,3]</span></span><br></pre></td></tr></table></figure>
<h4 id="作为构造函数使用的绑定函数"><a href="#作为构造函数使用的绑定函数" class="headerlink" title="作为构造函数使用的绑定函数"></a>作为构造函数使用的绑定函数</h4><p>绑定函数适用于用<code>new</code>操作符 <code>new</code> 去构造一个由目标函数创建的新的实例。</p>
<p>当一个绑定函数是用来构建一个值的，原来提供的 <code>this</code> 就会被忽略。</p>
<p>然而, 原先提供的那些参数仍然会被前置到构造函数调用的前面。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Point</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Point</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">print</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span> + <span class="string">&#x27;,&#x27;</span> + <span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">PointA</span>= <span class="title class_">Point</span>.<span class="title function_">bind</span>(obj, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> pa = <span class="keyword">new</span> <span class="title class_">PointA</span>(<span class="number">5</span>);</span><br><span class="line"><span class="title class_">PointA</span>(<span class="number">5</span>);<span class="comment">//undefined</span></span><br><span class="line">pa.<span class="title function_">print</span>();<span class="comment">//0,5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj);<span class="comment">//Object &#123;x: 0, y: 5&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="创建捷径"><a href="#创建捷径" class="headerlink" title="创建捷径"></a>创建捷径</h4><p>将一个类似于数组的对象<code>（array-like object）</code>转换成一个真正的数组</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;小明&#x27;</span>,<span class="string">&#x27;2&#x27;</span>:<span class="string">&#x27;小黑&#x27;</span>,<span class="string">&#x27;4&#x27;</span>:<span class="string">&#x27;小刚&#x27;</span>,<span class="attr">length</span>:<span class="number">6</span>&#125;;</span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">apply</span>(a);</span><br><span class="line"><span class="comment">//[undefined × 1, &quot;小明&quot;, &quot;小黑&quot;, undefined × 1, &quot;小刚&quot;, undefined × 1]</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(a);</span><br><span class="line"><span class="comment">// [undefined × 1, &quot;小明&quot;, &quot;小黑&quot;, undefined × 1, &quot;小刚&quot;, undefined × 1]</span></span><br></pre></td></tr></table></figure>

<p>用 <code>bind() </code>可以使这个过程变得简单</p>
<p><code>slice</code> 是 <code>Function.prototype</code> 的 <code>call()</code> 方法的绑定函数.</p>
<p>并且将 <code>Array.prototype</code> 的 <code>slice()</code> 方法作为 <code>this</code> 的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;小明&#x27;</span>,<span class="string">&#x27;2&#x27;</span>:<span class="string">&#x27;小黑&#x27;</span>,<span class="string">&#x27;4&#x27;</span>:<span class="string">&#x27;小刚&#x27;</span>,<span class="attr">length</span>:<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> slice = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span>.<span class="title function_">bind</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>);</span><br><span class="line"><span class="title function_">slice</span>(a);</span><br><span class="line"><span class="comment">// [undefined × 1, &quot;小明&quot;, &quot;小黑&quot;, undefined × 1, &quot;小刚&quot;, undefined × 1]</span></span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ul>
<li><code>call()</code>方法第二个参数是若干个参数的列表；而<code>apply()</code>方法的第二个参数是一个包含多个参数的数组；<code>bind()</code>方法第二个参数是若干个参数的列表，是创建函数的预设的初始参数 。</li>
<li><code>apply 、 call 、bind</code>三个方法的第一个参数都是this要指向的对象，可以改变函数的this对象的指向。</li>
<li><code>bind</code>方法 返回对应的创建函数，便于后续调用；<code>apply 、call</code> 则是立即执行 。</li>
</ul>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://bugs.webkit.org/show_bug.cgi?id=80797">apply参数个数限制在65536)</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>单例模式</title>
    <url>/2016/04/21/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="先看文字"><a href="#先看文字" class="headerlink" title="先看文字"></a>先看文字</h2><p>单例模式(Singleton Pattern)<br>保证一个类仅有一个实例，并提供一个访问它的全局访问点</p>
<ol>
<li>单例类只能有一个实例；</li>
<li>单例类必须自己创建自己的唯一实例；</li>
<li>单例类必须给其所有对象提供这一实例；</li>
</ol>
<h3 id="主要解决"><a href="#主要解决" class="headerlink" title="主要解决"></a>主要解决</h3><p>一个全局使用的类 &lt;&#x3D;&gt;  频繁的创建于销毁</p>
<span id="more"></span>

<h3 id="何时使用"><a href="#何时使用" class="headerlink" title="何时使用"></a>何时使用</h3><p>控制实例数目，节省系统资源</p>
<h3 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h3><p>构造函数是私有的</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>在内存里只有有一个实例，减少了内存的开销</li>
<li>避免资源被多重占用（如写文件操作）</li>
</ol>
<h3 id="现实场景"><a href="#现实场景" class="headerlink" title="现实场景"></a>现实场景</h3><ol>
<li>生产一个唯一的产品序列号</li>
<li>数据库的连接</li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p><strong>获取实例中需要使用同步锁，防止多线程同时进入，造成被多次实例化</strong></p>
<h2 id="unity中"><a href="#unity中" class="headerlink" title="unity中"></a>unity中</h2><p>有时会看到类似下面的代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class TestMange : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public static TestMange _instance;</span><br><span class="line"></span><br><span class="line">    public static TestMange Instance</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_instance == null)</span><br><span class="line">            &#123;</span><br><span class="line">                GameObject _obj = new GameObject();</span><br><span class="line">                _obj.name = <span class="string">&quot;TestMangeObject&quot;</span>;</span><br><span class="line"></span><br><span class="line">                 //对象添加脚本</span><br><span class="line">                _instance = _obj.AddComponent&lt;TestMange&gt;();</span><br><span class="line">                <span class="built_in">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void <span class="function"><span class="title">Awake</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        _instance = this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void <span class="function"><span class="title">TestToDo</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如访问</span><br><span class="line">TestMange.Instance.TestToDo();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据结构</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>php图片上传type错误</title>
    <url>/2015/09/16/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0type%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天在用php做图片上传时，发现在ie上传失败，chrom和火狐正常，而ie报文件类型错误，于是就针对这个问题，就有了发现…</p>
<h2 id="上传的MIME类型-Uploaded-MIME-Types"><a href="#上传的MIME类型-Uploaded-MIME-Types" class="headerlink" title="上传的MIME类型[Uploaded MIME Types]"></a>上传的MIME类型[Uploaded MIME Types]</h2><p>当上传文件从客户端到Web服务器，Windows Internet Explorer使用findmimefromdata确定MIME类型。在可能的情况下，findmimefromdata返回硬编码的值从已知的MIME类型，而不是依靠在系统注册表的文件扩展名关联的MIME类型值的列表。在某些情况下，检测到的MIME类型可以不同于一般公认为向后兼容的值，如下表所示：</p>
<img src="/2015/09/16/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0type%E9%94%99%E8%AF%AF/mime_type.png" class="" title="mine类型">

<p>从上图可以看出前者才是标准的，符合常规的文件类型。</p>
<span id="more"></span>
<h2 id="ie-678-浏览器页面效果"><a href="#ie-678-浏览器页面效果" class="headerlink" title="ie[678]浏览器页面效果"></a>ie[678]浏览器页面效果</h2><p>下面是我在ie浏览器中测试的四种类型图片</p>
<img src="/2015/09/16/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0type%E9%94%99%E8%AF%AF/ie_type.png" class="" title="ie测试">

<p>从图中不难看出，jpg和png的类型是有点问题的。而gif和bmp是比较正常的。</p>
<h2 id="image-x2F-x-png"><a href="#image-x2F-x-png" class="headerlink" title="[image&#x2F;x-png]"></a>[image&#x2F;x-png]</h2><p>x前缀是给非标准MIME类型（即不在IANA注册），所以图像&#x2F;x-png在MIME类型标准化是PNG。</p>
<blockquote>
<p>新的内容传输编码<br>如果有必要，定义私有的内容传输编码值，但必须使用x-token，这是出了名的前缀“X”，表明其不规范的情况，例如，“内容传输编码：x-my-new-encoding”。附加的标准内容传输编码值必须用标准跟踪RFC指定。这样的规格必须符合要求，在RFC 2048。因此，所有的内容传输编码命名空间外，“X”是明确保留供将来使用的IETF开始。</p>
</blockquote>
<h2 id="image-x2F-pjpeg"><a href="#image-x2F-pjpeg" class="headerlink" title="[image&#x2F;pjpeg]"></a>[image&#x2F;pjpeg]</h2><blockquote>
<p>pjpeg MIME类型指的是一种渐进式JPEG图像，这意味着它可以被传输和显示，而它正在加载。目标系统将提前知道它是显示一个渐进式JPEG而不是一个由MIME类型标准JPEG文件之前，甚至开始加载。它不是一个错误。只是一个功能不支持的浏览器。</p>
</blockquote>
<h2 id="Jpg-x2F-Jpeg-的区别"><a href="#Jpg-x2F-Jpeg-的区别" class="headerlink" title="[Jpg&#x2F;Jpeg]的区别"></a>[Jpg&#x2F;Jpeg]的区别</h2><blockquote>
<p>JPEG的文件格式一般有两种文件扩展名：.jpg和.jpeg，这两种扩展名的实质是相同的，我们可以把*.jpg的文件改名为*.jpeg，而对文件本身不会有任何影响。严格来讲，JPEG的文件扩展名应该为.jpeg，但由于DOS时代的8.3文件名命名原则，PC机使用了.jpg的扩展名，而由于Mac并不限制扩展名的长度，因此当时苹果机上都使用了.jpeg的后缀名。虽然现在windows也可以支持任意长度的扩展名了，但大家已经习惯了.jpg的叫法，因此也就没有强制修正。这种情况类似于.htm和.html的区别。</p>
</blockquote>
<h2 id="数据结果图"><a href="#数据结果图" class="headerlink" title="数据结果图"></a>数据结果图</h2><img src="/2015/09/16/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0type%E9%94%99%E8%AF%AF/date_type.png" class="" title="结果">

<p>以上是ie678和其他浏览器的比较结果，通过以上从和结果图可以看出来chrom和火狐是符合我们的常规标准的。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>为了ie多增加两种文件类型image&#x2F;pjpeg 和 image&#x2F;x-png</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$allowMime</span>=array(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>,<span class="string">&#x27;image/pjpeg&#x27;</span>,<span class="string">&#x27;image/x-png&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://svn.apache.org/viewvc/httpd/httpd/trunk/docs/conf/mime.types?view=markup">mine类型查询</a></li>
<li><a href="http://stackoverflow.com/questions/2086374/what-is-the-difference-between-image-png-and-image-x-png">What is the difference between “image&#x2F;png” and “image&#x2F;x-png”?</a></li>
<li><a href="http://seewhatever.de/blog/?p=50">see whatever</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/ms775147%28v=VS.85%29.aspx">MIME Type Detection in Windows Internet Explorer (Windows)</a></li>
</ol>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>地理定位H5</title>
    <url>/2015/10/10/%E5%9C%B0%E7%90%86%E5%AE%9A%E4%BD%8DH5/</url>
    <content><![CDATA[<h2 id="html5-Geolocation-基本介绍"><a href="#html5-Geolocation-基本介绍" class="headerlink" title="html5 Geolocation 基本介绍"></a>html5 Geolocation 基本介绍</h2><p>HTML5有一个新功能：Geolocation，它允许用户在 Web 应用程序中共享他们的位置，使其能够享受位置感知服务。<br>Geolocation API的使用很简单，请求一个位置信息，如果用户同意，就返回位置信息。</p>
<p><strong>注：此处所提到的定位都是javascript地图API，适合Web 应用程序</strong></p>
<h2 id="获取地理位置的方式"><a href="#获取地理位置的方式" class="headerlink" title="获取地理位置的方式"></a>获取地理位置的方式</h2><h3 id="设备可以使用的数据源："><a href="#设备可以使用的数据源：" class="headerlink" title="设备可以使用的数据源："></a>设备可以使用的数据源：</h3><ul>
<li>IP 地址</li>
<li>GPS（Global Positioning System，全球定位系统）</li>
<li>WiFi基站的mac地址</li>
<li>手机信号（GSM或CDMA基站）</li>
<li>用户自定义数据</li>
</ul>
<h3 id="数据源对比："><a href="#数据源对比：" class="headerlink" title="数据源对比："></a>数据源对比：</h3><p>|数据源|优点|缺点|<br>|—|:—|:—:|—:|<br>|IP 地址|任何地方都可用、在服务器端处理|不精确（经常出错，一般精确到城市级）、运算代价大|<br>|GPS|很精确|定位时间长，耗电量大 、室内效果差 、需要额外硬件设备支持|<br>|Wi-Fi|精确、可在室内使用、简单，快捷|在乡村这些 Wi-Fi 接入点少的地区无法使用|<br>|手机信号|精确、可在室内使用、简单，快捷|需要能够访问手机或其 modem 设备|<br>|用户自定义|可获得比程序定位服务更准确的位置数据，用户自行输入可能比自动检测更快|可能很不准确，特别是当用户位置变更后|</p>
<span id="more"></span>
<h3 id="推荐："><a href="#推荐：" class="headerlink" title="推荐："></a>推荐：</h3><p>可见它们各有优缺点，为了保证更高的精确度，许多设备使用多个数据源组合的方式。</p>
<h2 id="地理位置获取流程"><a href="#地理位置获取流程" class="headerlink" title="地理位置获取流程"></a>地理位置获取流程</h2><ol>
<li>用户打开需要获取地理位置的web应用</li>
<li>应用通过Geolocation API 向浏览器请求地理位置，浏览器拦截请求，向用户请求授权。</li>
<li>假设用户允许，浏览器从设备查询相关信息，如IP地址、WIFI地址或GPS坐标。</li>
<li>浏览器将相关信息发送给信任的外部定位服务器，服务器返回具体的地理位置。</li>
</ol>
<h2 id="隐私"><a href="#隐私" class="headerlink" title="隐私"></a>隐私</h2><p>HTML5 Geolocation API提供了一套保护用户隐私的机制，必须先得到用户明确许可，才能获取用户的位置信息。访问使用Geolocation API的页面应用时，会触发隐私保护机制，浏览器会询问用户是否共享位置信息。</p>
<p>因为位置数据属于敏感信息，所以应用程序的开发人员应考虑关于隐私的以下准则:</p>
<ul>
<li>仅在必要时请求位置信息，并且仅将位置信息用于其原计划用于的任务。</li>
<li>如果用户没有授权存储这些数据，那么应用程序应该在相应任务完成后立即删除。</li>
<li>如果要在服务器上存储位置数据，请务必确保位置数据不受到未经授权的访问，并允许用户更新和删除此信息。</li>
</ul>
<h2 id="检测浏览器是否支持Geolocation"><a href="#检测浏览器是否支持Geolocation" class="headerlink" title="检测浏览器是否支持Geolocation"></a>检测浏览器是否支持Geolocation</h2><p>在html5使用Geolocation API时，应确保浏览器支持Geolocation API，如果geolocation对象存在，那么地理位置服务可用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;geolocation&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    console.log(<span class="string">&quot;地理位置服务可用&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    console.log(<span class="string">&quot;地理位置服务不可用&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意: 在 Firefox 24 和之前的浏览器中，即使 API 被禁止，代码 “geolocation” in navigator 也总是会得到 true。这在 Firefox 25 中已经被修复<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=884921">bug 884921</a></strong></p>
<p>##getCurrentPosition获取当前定位<br>###getCurrentPosition函数介绍<br>使用 getCurrentPosition 方法获取当前的地理位置。<br><strong>语法</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">navigator.geolocation.getCurrentPosition(successCallback, errorCallback, options);</span><br></pre></td></tr></table></figure>
<p>getCurrentPosition包含三个参数，前两个为函数名，第三个为一个对象。其中只有第一个是必须的。当你执行上面的JavaScript语句后，浏览器通常会弹出一个提示，询问用户是否允许网站跟踪位置信息；同时getCurrentPosition函数会立即返回。如果用户选择了允许，则会执行上述successCallback函数，</p>
<p>这个方法使用的是异步回调的方式。它的3个参数分别是：</p>
<ol>
<li>successCallback – 为浏览器成功获得位置信息后的回调函数。</li>
<li>errorCallback – 用于位置信息获取失败时的回调函数。</li>
<li>options – 配置参数，可以调整geolocation的数据收集方式</li>
</ol>
<blockquote>
<p><strong>注意: 默认情况下，getCurrentPosition() 会尽快返回一个低精度结果，这在您不关心准确度只关心快速获取结果的情况下很有用。有 GPS 的设备可能需要一分钟或更久来获取 GPS 定位，在这种情况下 getCurrentPosition() 会返回低精度数据（基于 IP 的定位或 Wi-Fi 定位）。</strong></p>
</blockquote>
<h3 id="成功获得地理位置信息"><a href="#成功获得地理位置信息" class="headerlink" title="成功获得地理位置信息"></a>成功获得地理位置信息</h3><p>下面是函数successCallback的写法示例。它有一个参数，你将最终通过这个函数获取到用户的位置。经纬度分别存在longitude和latitude变量中，同时还有精度、时间戳，以及一些其他额外信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> successCallback(pos) &#123;</span><br><span class="line">    // 将会获得以下信息</span><br><span class="line">    var latitude = pos.coords.latitude;</span><br><span class="line">    var longitude = pos.coords.longitude;</span><br><span class="line">    var accuracy = pos.coords.accuracy;</span><br><span class="line">    var timestamp = pos.timestamp;</span><br><span class="line"></span><br><span class="line">    // 以下信息不一定提供，和具体设备有关</span><br><span class="line">    var altitude = pos.coords.altitude;</span><br><span class="line">    var altitudeAccuracy = pos.coords.altitudeAccuracy;</span><br><span class="line">    var heading = pos.coords.heading;</span><br><span class="line">    var speed = pos.coords.speed;</span><br><span class="line"></span><br><span class="line">    console.log(pos.coords.latitude); // 纬度</span><br><span class="line">    console.log(pos.coords.longitude); // 经度</span><br><span class="line">    console.log(pos.coords.accuracy); // 准确度，由于geolocation的实现方式，呈现返回值时一定要检查返回值的准确度</span><br><span class="line">    console.log(pos.coords.altitude); // 海拔，以米为单位，如不支持altitude特性，返回null</span><br><span class="line">    console.log(pos.coords.altitudeAccuracy); // 海拔经度，以米为单位，如不支持altitude特性，返回null</span><br><span class="line">    console.log(pos.coords.heading); // 行进方向，相对正北</span><br><span class="line">    console.log(pos.coords.speed); // 行进速度，单位m/s</span><br><span class="line">    console.log(pos.timestamp); // 获取位置的时间</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<strong>altitude</strong>、<strong>altitudeAccuracy</strong>、<strong>heading</strong>和<strong>speed</strong>则根据用户的终端不同，可能提供，可能为null<br><strong>参考图片</strong>：</p>
<img src="/2015/10/10/%E5%9C%B0%E7%90%86%E5%AE%9A%E4%BD%8DH5/position.png" class="" title="位置信息">

<h3 id="错误信息处理"><a href="#错误信息处理" class="headerlink" title="错误信息处理"></a>错误信息处理</h3><p>上面我们还有一个errorCallback。显然，如果用户不同意，那我们无法获得任何信息，这时候系统会自动调用这个函数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> errorCallback(error) &#123;</span><br><span class="line">    console.log(error.message);</span><br><span class="line">    switch (error.code) &#123;</span><br><span class="line">        <span class="keyword">case</span> error.PERMISSION_DENIED:</span><br><span class="line">            console.log(<span class="string">&quot;用户不允许地理定位&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.POSITION_UNAVAILABLE:</span><br><span class="line">            console.log(<span class="string">&quot;无法获取当前位置&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.TIMEOUT:</span><br><span class="line">            console.log(<span class="string">&quot;操作超时&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.UNKNOWN_ERROR:</span><br><span class="line">            console.log(<span class="string">&quot;发生未知错误&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中error.code为一个枚举类型，可能的取值如下：</p>
<ul>
<li>PERMISSION_DENIED：用户拒绝</li>
<li>POSITION_UNAVAILABLE：地理位置获取失败（可能是用户没网或卫星搜不到等原因）</li>
<li>TIMEOUT：地理位置获取超时</li>
<li>UNKNOWN_ERROR:发生未知错误</li>
</ul>
<p><strong>而error.message则为一个可以帮助开发者调试的错误信息（此信息一般不适合直接显示在网页中给用户查看）。</strong></p>
<h3 id="可选项"><a href="#可选项" class="headerlink" title="可选项"></a>可选项</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var options = &#123;</span><br><span class="line">  enableHighAccuracy: <span class="literal">true</span>, //如果启动该参数，浏览器会启动 HTML5 Geolocation 服务的高精确度模式，这将导致机器花费更多的时间和资源来确定位置，应谨慎使用。默认值为 <span class="literal">false</span>;</span><br><span class="line">  maximumAge        : 30000, //以 ms 为单位，表示浏览器重新获取位置信息的时间间隔。默认值为 0，这意味着浏览器每次请求时必须立即重新计算位置。</span><br><span class="line">  <span class="built_in">timeout</span>           : 27000 //单位为 ms，告诉浏览器获取当前位置信息所允许的最长时间。如果在这个时间段内未完成，就会调用错误处理程序。默认值为 Infinity，即无穷大（无限制）；</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其中timeout是设定地理位置获取的超时时间（单位为毫秒，用户选择允许的时间不计算在内）；而maximumAge表示允许设备从缓存中读取位置，缓存的过期时间，单位是毫秒，设为0来禁用缓存读取。如果返回的是缓存中的时间，会在timestamp中反映出来。</p>
<h2 id="watchPosition函数"><a href="#watchPosition函数" class="headerlink" title="watchPosition函数"></a>watchPosition函数</h2><p>您可以设定一个回调函数来响应定位数据发生的变更（设备发生了移动，或获取到了更高精度的地理位置信息）。您可以通过 watchPosition() 函数实现该功能。它与 getCurrentPosition() 接受相同的参数，但回调函数会被调用多次。错误回调函数与 getCurrentPosition() 中一样是可选的，也会被多次调用。</p>
<p><strong>语法</strong>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var watchID = navigator.geolocation.watchPosition(successCallback, errorCallback, options);</span><br></pre></td></tr></table></figure>
<p>watchPosition方法与getCurrentPosition方法类似，都有同样的三个参数，都立即返回。下面是watchPosition的特殊之处：</p>
<ul>
<li>该函数会返回一个整数，表示这个监视任务的 ID。</li>
<li>将持续追踪用户的位置；相应，on_success函数会被多次地调用来更新信息。</li>
<li>通过clearWatch(id)函数调用来停止监视。</li>
</ul>
<h2 id="clearWatch函数"><a href="#clearWatch函数" class="headerlink" title="clearWatch函数"></a>clearWatch函数</h2><p>这个方法接受一个参数，需要清理监视位置变化的方法的id：watchID（这个参数由watchPosition方法返回）。</p>
<p><strong>参考代码</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">navigator.geolocation.clearWatch(watchID);</span><br></pre></td></tr></table></figure>
<h2 id="DEMO源码"><a href="#DEMO源码" class="headerlink" title="DEMO源码"></a>DEMO源码</h2><h3 id="百度地图源码"><a href="#百度地图源码" class="headerlink" title="百度地图源码:"></a>百度地图源码:</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Cache-Control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;telephone=no&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;email=no&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-touch-fullscreen&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> content=<span class="string">&quot;black&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;百度地图&lt;/title&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;百度地图&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;百度地图&quot;</span>&gt;</span><br><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">html,body&#123;height:100%;&#125;</span><br><span class="line">.map&#123;display:block;width:calc(100% - 20px);margin:10px auto;height:calc(100% - 20px);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;map&quot;</span> class=<span class="string">&quot;map&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://api.map.baidu.com/api?v=2.0&amp;ak=OuwScGRpy5UlO2jfRrDe7KKq&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    //此处使用百度地图2.0API</span><br><span class="line">    var map = new BMap.Map(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">    var point = new BMap.Point(116.331398, 39.897445);//默认北京</span><br><span class="line">    map.centerAndZoom(point, 12);</span><br><span class="line"></span><br><span class="line">    var geolocation = new BMap.Geolocation();</span><br><span class="line">    geolocation.getCurrentPosition(<span class="keyword">function</span>(r) &#123;</span><br><span class="line">        <span class="keyword">if</span> (this.getStatus() == BMAP_STATUS_SUCCESS) &#123;</span><br><span class="line">            var mk = new BMap.Marker(r.point);</span><br><span class="line">            map.addOverlay(mk);// 将标注添加到地图中</span><br><span class="line">            map.panTo(r.point);</span><br><span class="line">            map.addControl(new BMap.GeolocationControl());  //定位控件，针对移动端开发，默认位于地图左下方。</span><br><span class="line">            <span class="keyword">if</span>(r.address)&#123;</span><br><span class="line">            	alert(<span class="string">&quot;地址：&quot;</span>+r.address.province+r.address.city+r.address.district+r.address.street+r.address.street_number)</span><br><span class="line">            &#125;</span><br><span class="line">            //console.log(<span class="string">&#x27;您的位置：&#x27;</span> + r.point.lng + <span class="string">&#x27;,&#x27;</span> + r.point.lat);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            console.log(<span class="string">&#x27;failed&#x27;</span> + this.getStatus());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        enableHighAccuracy: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    //关于状态码</span><br><span class="line">    //BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。</span><br><span class="line">    //BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。</span><br><span class="line">    //BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。</span><br><span class="line">    //BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。</span><br><span class="line">    //BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。</span><br><span class="line">    //BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。</span><br><span class="line">    //BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)</span><br><span class="line">    //BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)</span><br><span class="line">    //BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="腾讯地图源码："><a href="#腾讯地图源码：" class="headerlink" title="腾讯地图源码："></a>腾讯地图源码：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Cache-Control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;telephone=no&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;email=no&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-touch-fullscreen&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> content=<span class="string">&quot;black&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;腾讯地图&lt;/title&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;腾讯地图&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;腾讯地图&quot;</span>&gt;</span><br><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">html,body&#123;height:100%;&#125;</span><br><span class="line">.map&#123;display:block;width:calc(100% - 20px);margin:10px auto;height:calc(100% - 20px);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;map&quot;</span> class=<span class="string">&quot;map&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script charset=<span class="string">&quot;utf-8&quot;</span> src=<span class="string">&quot;http://map.qq.com/api/js?v=2.exp&amp;key=QFUBZ-BFPAR-RYOWE-WGKR7-TUEOK-CWF3N&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">if</span>(window.navigator.geolocation)&#123;</span><br><span class="line">    browserPostion();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(<span class="string">&quot;您的浏览器不支持定位&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">browserPostion</span></span>()&#123;</span><br><span class="line">    var options = &#123;</span><br><span class="line">        enableHighAccuracy:<span class="literal">true</span>, //它将告诉浏览器是否启用高精度设备。</span><br><span class="line">        maximumAge:600000,  //超时，获取位置信息时超出设定的这个时长，将会触发错误，捕获错误的函数将被调用，并且错误码指向TIMEOUT。</span><br><span class="line">        <span class="built_in">timeout</span>:60000   //缓存时间 缓存时间过后浏览器会再次调用getCurrentPosition方法。</span><br><span class="line">    &#125;;</span><br><span class="line">    //谷歌地图调用</span><br><span class="line">    window.navigator.geolocation.getCurrentPosition(getPositionSuccess, getPositionError, options);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getPositionSuccess(position)&#123;</span><br><span class="line">    var lat = position.coords.latitude;  //获取用户位置的纬度</span><br><span class="line">    var lng = position.coords.longitude; //获取用户位置的经度</span><br><span class="line">    var map = new qq.maps.Map(document.getElementById(<span class="string">&quot;map&quot;</span>),&#123;</span><br><span class="line">        center: new qq.maps.LatLng(39.914850, 116.403765),//默认坐标</span><br><span class="line">        zoom: 13,//设置地图的缩放级别</span><br><span class="line">        draggable: <span class="literal">true</span>,</span><br><span class="line">        scrollwheel: <span class="literal">true</span>,</span><br><span class="line">        disableDoubleClickZoom: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    var info = new qq.maps.InfoWindow(&#123;map: map&#125;);</span><br><span class="line">    var geocoder = new qq.maps.Geocoder(&#123;</span><br><span class="line">        complete : <span class="keyword">function</span>(result)&#123;</span><br><span class="line">            map.setCenter(result.detail.location);</span><br><span class="line">            var marker = new qq.maps.Marker(&#123;</span><br><span class="line">                map:map,</span><br><span class="line">                position: result.detail.location</span><br><span class="line">            &#125;);</span><br><span class="line">            //添加监听事件 当标记被点击了  设置图层</span><br><span class="line">            qq.maps.event.addListener(marker, <span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">                info.open();</span><br><span class="line">                info.setContent(<span class="string">&#x27;&lt;div style=&quot;width:200px;height:40px;&quot;&gt;&#x27;</span>+</span><br><span class="line">                    result.detail.address+<span class="string">&#x27;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">                info.setPosition(result.detail.location);</span><br><span class="line">            &#125;);</span><br><span class="line">            alert(<span class="string">&#x27;地址为：&#x27;</span>+result.detail.address);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">	var center = new qq.maps.LatLng(lat,lng);</span><br><span class="line">    geocoder.getAddress(center);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getPositionError(error) &#123;</span><br><span class="line">    switch (error.code) &#123;</span><br><span class="line">        <span class="keyword">case</span> error.PERMISSION_DENIED:</span><br><span class="line">            console.log(<span class="string">&quot;用户不允许地理定位&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.POSITION_UNAVAILABLE:</span><br><span class="line">            console.log(<span class="string">&quot;无法获取当前位置&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.TIMEOUT:</span><br><span class="line">            console.log(<span class="string">&quot;操作超时&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.UNKNOWN_ERROR:</span><br><span class="line">            console.log(<span class="string">&quot;发生未知错误&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="谷歌地图源码"><a href="#谷歌地图源码" class="headerlink" title="谷歌地图源码:"></a>谷歌地图源码:</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Cache-Control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;telephone=no&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;email=no&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-touch-fullscreen&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> content=<span class="string">&quot;black&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;谷歌地图&lt;/title&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;谷歌地图&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;谷歌地图&quot;</span>&gt;</span><br><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">html,body&#123;height:100%;&#125;</span><br><span class="line">.map&#123;display:block;width:calc(100% - 20px);margin:10px auto;height:calc(100% - 20px);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="built_in">id</span>=<span class="string">&quot;map&quot;</span> class=<span class="string">&quot;map&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://maps.google.com/maps/api/js?sensor=false&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">if</span>(window.navigator.geolocation)&#123;</span><br><span class="line">    browserPostion();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    alert(<span class="string">&quot;您的浏览器不支持定位&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">browserPostion</span></span>()&#123;</span><br><span class="line">    var options = &#123;</span><br><span class="line">        enableHighAccuracy:<span class="literal">true</span>, //它将告诉浏览器是否启用高精度设备。</span><br><span class="line">        maximumAge:600000,  //超时，获取位置信息时超出设定的这个时长，将会触发错误，捕获错误的函数将被调用，并且错误码指向TIMEOUT。</span><br><span class="line">        <span class="built_in">timeout</span>:60000   //缓存时间 缓存时间过后浏览器会再次调用getCurrentPosition方法。</span><br><span class="line">    &#125;;</span><br><span class="line">    //谷歌地图调用</span><br><span class="line">    window.navigator.geolocation.getCurrentPosition(getPositionSuccess, getPositionError, options);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getPositionSuccess(position)&#123;</span><br><span class="line">    var lat = position.coords.latitude;</span><br><span class="line">    var lon = position.coords.longitude;</span><br><span class="line">    var latlon = new google.maps.LatLng(lat, lon)</span><br><span class="line">    var mapholder = document.getElementById(<span class="string">&#x27;map&#x27;</span>);</span><br><span class="line">    var myOptions = &#123;</span><br><span class="line">        center: latlon,</span><br><span class="line">        zoom: 14,</span><br><span class="line">        mapTypeId: google.maps.MapTypeId.ROADMAP,</span><br><span class="line">        mapTypeControl: <span class="literal">false</span>,</span><br><span class="line">        navigationControlOptions: &#123;</span><br><span class="line">            style: google.maps.NavigationControlStyle.SMALL</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    var map = new google.maps.Map(mapholder, myOptions);</span><br><span class="line">    var marker = new google.maps.Marker(&#123;</span><br><span class="line">        position: latlon,</span><br><span class="line">        map: map,</span><br><span class="line">        title: <span class="string">&quot;你在这里&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getPositionError(error) &#123;</span><br><span class="line">    switch (error.code) &#123;</span><br><span class="line">        <span class="keyword">case</span> error.PERMISSION_DENIED:</span><br><span class="line">            console.log(<span class="string">&quot;用户不允许地理定位&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.POSITION_UNAVAILABLE:</span><br><span class="line">            console.log(<span class="string">&quot;无法获取当前位置&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.TIMEOUT:</span><br><span class="line">            console.log(<span class="string">&quot;操作超时&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        <span class="keyword">case</span> error.UNKNOWN_ERROR:</span><br><span class="line">            console.log(<span class="string">&quot;发生未知错误&quot;</span>);</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="高德地图源码："><a href="#高德地图源码：" class="headerlink" title="高德地图源码："></a>高德地图源码：</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Cache-Control&quot;</span> content=<span class="string">&quot;no-cache&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;telephone=no&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;format-detection&quot;</span> content=<span class="string">&quot;email=no&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-touch-fullscreen&quot;</span> content=<span class="string">&quot;yes&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> content=<span class="string">&quot;black&quot;</span> /&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1, user-scalable=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;高德地图&lt;/title&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;高德地图&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;高德地图&quot;</span>&gt;</span><br><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">html,body&#123;height:100%;&#125;</span><br><span class="line">.map&#123;display:block;width:calc(100% - 20px);margin:10px auto;height:calc(100% - 20px);&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">	&lt;div <span class="built_in">id</span>=<span class="string">&quot;map&quot;</span> class=<span class="string">&quot;map&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> src=<span class="string">&quot;http://webapi.amap.com/maps?v=1.3&amp;key=e8496e8ac4b0f01100b98da5bde96597&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">var map = new AMap.Map(<span class="string">&quot;map&quot;</span>, &#123;</span><br><span class="line">	view: new AMap.View2D(&#123;</span><br><span class="line">		center: new AMap.LngLat(116.397428, 39.90923),</span><br><span class="line">		zoom: 13</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">map.plugin([<span class="string">&quot;AMap.MapType&quot;</span>], <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	var <span class="built_in">type</span> = new AMap.MapType(&#123;</span><br><span class="line">		defaultType: 0</span><br><span class="line">	&#125;);</span><br><span class="line">	map.addControl(<span class="built_in">type</span>);</span><br><span class="line">&#125;);</span><br><span class="line">map.plugin([<span class="string">&quot;AMap.ToolBar&quot;</span>], <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	toolBar = new AMap.ToolBar();</span><br><span class="line">	map.addControl(toolBar);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var geolocation = null;</span><br><span class="line">map.plugin(<span class="string">&#x27;AMap.Geolocation&#x27;</span>, <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">	geolocation = new AMap.Geolocation(&#123;</span><br><span class="line">		enableHighAccuracy: <span class="literal">true</span>, //是否使用高精度定位，默认:<span class="literal">true</span></span><br><span class="line">		<span class="built_in">timeout</span>: 10000, //超过10秒后停止定位，默认：无穷大</span><br><span class="line">		maximumAge: 0, //定位结果缓存0毫秒，默认：0</span><br><span class="line">		convert: <span class="literal">true</span>, //自动偏移坐标，偏移后的坐标为高德坐标，默认：<span class="literal">true</span></span><br><span class="line">		showButton: <span class="literal">true</span>, //显示定位按钮，默认：<span class="literal">true</span></span><br><span class="line">		buttonPosition: <span class="string">&#x27;LB&#x27;</span>, //定位按钮停靠位置，默认：<span class="string">&#x27;LB&#x27;</span>，左下角</span><br><span class="line">		buttonOffset: new AMap.Pixel(10, 20), //定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)</span><br><span class="line">		showMarker: <span class="literal">true</span>, //定位成功后在定位到的位置显示点标记，默认：<span class="literal">true</span></span><br><span class="line">		showCircle: <span class="literal">true</span>, //定位成功后用圆圈表示定位精度范围，默认：<span class="literal">true</span></span><br><span class="line">		panToLocation: <span class="literal">true</span>, //定位成功后将定位到的位置作为地图中心点，默认：<span class="literal">true</span></span><br><span class="line">		zoomToAccuracy: <span class="literal">true</span>, //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：<span class="literal">false</span></span><br><span class="line">	&#125;);</span><br><span class="line">	map.addControl(geolocation);</span><br><span class="line">	AMap.event.addListener(geolocation, <span class="string">&#x27;complete&#x27;</span>, onComplete); //返回定位信息</span><br><span class="line">	AMap.event.addListener(geolocation, <span class="string">&#x27;error&#x27;</span>, onError); //返回定位出错信息</span><br><span class="line">	var marker = new AMap.Marker(&#123;</span><br><span class="line">		map: map,</span><br><span class="line">		bubble: <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br><span class="line">getCurrentPosition();</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> *获取当前位置信息</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getCurrentPosition</span></span>() &#123;</span><br><span class="line">	geolocation.getCurrentPosition();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> *监控当前位置并获取当前位置信息</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">watchPosition</span></span>() &#123;</span><br><span class="line">	geolocation.watchPosition();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> onComplete(data) &#123;</span><br><span class="line">	var str = <span class="string">&#x27;&lt;p&gt;定位成功&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	str += <span class="string">&#x27;&lt;p&gt;经度：&#x27;</span> + data.position.getLng() + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	str += <span class="string">&#x27;&lt;p&gt;纬度：&#x27;</span> + data.position.getLat() + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	str += <span class="string">&#x27;&lt;p&gt;精度：&#x27;</span> + data.accuracy + <span class="string">&#x27; 米&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	str += <span class="string">&#x27;&lt;p&gt;是否经过偏移：&#x27;</span> + (data.isConverted ? <span class="string">&#x27;是&#x27;</span> : <span class="string">&#x27;否&#x27;</span>) + <span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	//console.log(str);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> *解析定位错误信息</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">function</span> onError(data) &#123;</span><br><span class="line">	var str = <span class="string">&#x27;&lt;p&gt;定位失败&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	str += <span class="string">&#x27;&lt;p&gt;错误信息：&#x27;</span></span><br><span class="line">	switch (data.info) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;PERMISSION_DENIED&#x27;</span>:</span><br><span class="line">			str += <span class="string">&#x27;浏览器阻止了定位操作&#x27;</span>;</span><br><span class="line">			<span class="built_in">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;POSITION_UNAVAILBLE&#x27;</span>:</span><br><span class="line">			str += <span class="string">&#x27;无法获得当前位置&#x27;</span>;</span><br><span class="line">			<span class="built_in">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">&#x27;TIMEOUT&#x27;</span>:</span><br><span class="line">			str += <span class="string">&#x27;定位超时&#x27;</span>;</span><br><span class="line">			<span class="built_in">break</span>;</span><br><span class="line">		default:</span><br><span class="line">			str += <span class="string">&#x27;未知错误&#x27;</span>;</span><br><span class="line">			<span class="built_in">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	str += <span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	console.log(str);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注：以上地图文件引入可能需要一个开发者key，具体参考官网的API</strong></p>
<h2 id="浏览器支持情况"><a href="#浏览器支持情况" class="headerlink" title="浏览器支持情况"></a><a href="http://caniuse.com/#feat=geolocation">浏览器支持情况</a></h2><img src="/2015/10/10/%E5%9C%B0%E7%90%86%E5%AE%9A%E4%BD%8DH5/browser.png" class="" title="GeolocationAPI支持情况">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.w3school.com.cn/html5/html_5_geolocation.asp">w3schoolHTML5 地理定位</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/web/1208_wangjian_html5geo/">HTML5 Geolocation 构建基于地理位置的 Web 应用</a></li>
<li><a href="http://wlog.cn/html/geolocation.html">冰点-html5 Geolocation 地理定位</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/Using_geolocation">MDN-使用地理位置定位</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/gg589513%28v=vs.85%29.aspx">Introduction to the Geolocation API</a></li>
<li><a href="http://www.w3.org/TR/geolocation-API/">地理定位API规范-en-us</a></li>
<li><a href="http://developer.baidu.com/map/index.php?title=jspopular">百度地图JavaScript API大众版</a></li>
<li><a href="http://lbs.qq.com/javascript_v2/guide.html">腾讯地图JavaScript API V2</a></li>
<li><a href="https://developers.google.com/maps/documentation/geolocation/intro">geolocation the Google地图API</a></li>
<li><a href="http://lbs.amap.com/api/javascript-api/jsapi-markdown/%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8/">高德地图 JavaScript API</a></li>
</ol>
]]></content>
      <categories>
        <category>H5</category>
      </categories>
      <tags>
        <tag>H5</tag>
      </tags>
  </entry>
  <entry>
    <title>块级元素与行内元素</title>
    <url>/2015/10/16/%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E8%A1%8C%E5%86%85%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h2 id="了解html"><a href="#了解html" class="headerlink" title="了解html"></a>了解html</h2><ul>
<li><strong>W3C</strong>：万维网联盟-World Wide Web Consortium,创建于1994年</li>
<li><strong>HTML</strong>：超级文本标记语言-HyperText Markup Language</li>
<li><strong>XHTML</strong>：可扩展超文本标记语言-Extensible HyperText Markup Language，XHTML 的目标是为取代 HTML</li>
<li><strong>DHTML</strong>：是动态HTML - Dynamic HTML，它不是 W3C 标准</li>
<li><strong>HTML5</strong>：万维网的核心语言，是超文本标记语言-html的第五次重大修改,是一项推荐标准</li>
</ul>
<h2 id="元素的基本定义"><a href="#元素的基本定义" class="headerlink" title="元素的基本定义"></a>元素的基本定义</h2><h3 id="块级元素与块元素"><a href="#块级元素与块元素" class="headerlink" title="块级元素与块元素"></a>块级元素与块元素</h3><ul>
<li>**块级元素(block-level elements)**：那些视觉上会被格式化成块状的元素，通俗一点来说就是那些会换新行的元素。display 属性值为：block, list-item, table 值都可以将一个元素设置成块级元素。<span id="more"></span></li>
<li><strong>块元素</strong>：display属性值为block的元素，是块级元素的一个子集。</li>
</ul>
<h3 id="行内级元素与行内元素"><a href="#行内级元素与行内元素" class="headerlink" title="行内级元素与行内元素"></a>行内级元素与行内元素</h3><ul>
<li><p>**行内级元素(inline-level elements)**：行内级元素是那些不会为自身内容形成新的块，而让内容分布在同一行中的元素。display 属性的：inline, inline-table, inline-block 值都可以将一个元素设置成行内级元素。</p>
</li>
<li><p><strong>行内元素</strong>：display属性为inline的元素，是行内级元素的一个子集</p>
</li>
</ul>
<h3 id="置换元素与非置换元素"><a href="#置换元素与非置换元素" class="headerlink" title="置换元素与非置换元素"></a>置换元素与非置换元素</h3><ul>
<li><p>**置换元素(replaced element)**：一个内容 不受CSS视觉格式化模型控制，CSS渲染模型并不考虑对此内容的渲染，且元素本身一般拥有固有尺寸（宽度，高度，宽高比）的元素，被称之为置换元素。这类元素，浏览器根据元素的标签和属性，来决定元素的具体显示内容。常见的置换元素有这些：img,input,textarea,select,button等，而某些元素像是audio或canvas只有在特殊情況下才是置換元素。</p>
</li>
<li><p>**非置换元素(non-replaced element)**：w3c并没有给出明确的非置换元素的解释，但能确定的是除置换元素之外，所有的元素都是非置换元素。</p>
</li>
</ul>
<h3 id="行内级非置换元素和行内级置换元素"><a href="#行内级非置换元素和行内级置换元素" class="headerlink" title="行内级非置换元素和行内级置换元素"></a>行内级非置换元素和行内级置换元素</h3><ul>
<li><strong>行内级非置换元素</strong>：宽度与高度的设置对于行内级非置换元素时不适用的，例如span,a</li>
<li><strong>行内级置换元素</strong>：置换元素一般都是一般拥有固有尺寸（宽度，高度，宽高比）的元素，因此对于置换元素在不设宽度和高度的情况下，元素宽高度等于元素自身固有尺寸。而且其遵循的特点如下：</li>
</ul>
<hr>
<ol>
<li>若宽高的计算值都为 auto 且元素有固有高度，则 height 的使用值为该固有高度<blockquote>
<p>如表单元素input</p>
</blockquote>
</li>
<li>若宽度的计算值为 auto 且元素有固有宽度，则 width 的使用值为该固有宽度<blockquote>
<p>如表单元素input</p>
</blockquote>
</li>
<li>若宽度的计算值为 auto 且高度有 非auto 的计算值，并且元素有固有宽高比，则 width 的使用值为 高度使用值 * 固有宽高比；<blockquote>
<p>如img元素</p>
</blockquote>
</li>
<li>若高度的计算值为 auto 且上述条件完全不符，则 height 的使用值不能大于150px，且宽度不能大于长方形高度的2倍。<blockquote>
<p>如iframe元素</p>
</blockquote>
</li>
</ol>
<hr>
<h2 id="元素列表"><a href="#元素列表" class="headerlink" title="元素列表"></a>元素列表</h2><h3 id="块元素-block-element"><a href="#块元素-block-element" class="headerlink" title="块元素(block element)"></a>块元素(block element)</h3><table>
<thead>
<tr>
<th align="center">标签</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;#60;address&amp;#62;</td>
<td align="center">定义文档作者或拥有者的联系信息</td>
</tr>
<tr>
<td align="center">&amp;#60;caption&amp;#62;</td>
<td align="center">定义表格标题</td>
</tr>
<tr>
<td align="center">&amp;#60;blockquote&amp;#62;</td>
<td align="center">块引用</td>
</tr>
<tr>
<td align="center">&amp;#60;dd&amp;#62;</td>
<td align="center">定义列表中定义条目</td>
</tr>
<tr>
<td align="center">&amp;#60;div&amp;#62;</td>
<td align="center">定义文档中的分区或节</td>
</tr>
<tr>
<td align="center">&amp;#60;dl&amp;#62;</td>
<td align="center">定义列表</td>
</tr>
<tr>
<td align="center">&amp;#60;dt&amp;#62;</td>
<td align="center">定义列表中的项目</td>
</tr>
<tr>
<td align="center">&amp;#60;fieldset&amp;#62;</td>
<td align="center">定义一个框架集</td>
</tr>
<tr>
<td align="center">&amp;#60;form&amp;#62;</td>
<td align="center">创建 HTML 表单</td>
</tr>
<tr>
<td align="center">&amp;#60;h1&amp;#62;</td>
<td align="center">定义最大的标题</td>
</tr>
<tr>
<td align="center">&amp;#60;h2&amp;#62;</td>
<td align="center">定义副标题</td>
</tr>
<tr>
<td align="center">&amp;#60;h3&amp;#62;</td>
<td align="center">定义标题</td>
</tr>
<tr>
<td align="center">&amp;#60;h4&amp;#62;</td>
<td align="center">定义标题</td>
</tr>
<tr>
<td align="center">&amp;#60;h5&amp;#62;</td>
<td align="center">定义标题</td>
</tr>
<tr>
<td align="center">&amp;#60;h6&amp;#62;</td>
<td align="center">定义最小的标题</td>
</tr>
<tr>
<td align="center">&amp;#60;hr&amp;#62;</td>
<td align="center">创建一条水平线</td>
</tr>
<tr>
<td align="center">&amp;#60;legend&amp;#62;</td>
<td align="center">元素为 fieldset 元素定义标题</td>
</tr>
<tr>
<td align="center">&amp;#60;li&amp;#62;</td>
<td align="center">标签定义列表项目</td>
</tr>
<tr>
<td align="center">&amp;#60;noframes&amp;#62;</td>
<td align="center">为那些不支持框架的浏览器显示文本，于 frameset 元素内部</td>
</tr>
<tr>
<td align="center">&amp;#60;noscript&amp;#62;</td>
<td align="center">为定义在脚本未被执行时的替代内容</td>
</tr>
<tr>
<td align="center">&amp;#60;ol&amp;#62;</td>
<td align="center">定义有序列表</td>
</tr>
<tr>
<td align="center">&amp;#60;ul&amp;#62;</td>
<td align="center">定义无序列表</td>
</tr>
<tr>
<td align="center">&amp;#60;p&amp;#62;</td>
<td align="center">标签定义段落</td>
</tr>
<tr>
<td align="center">&amp;#60;pre&amp;#62;</td>
<td align="center">定义预格式化的文本</td>
</tr>
<tr>
<td align="center">&amp;#60;table&amp;#62;</td>
<td align="center">标签定义 HTML 表格</td>
</tr>
<tr>
<td align="center">&amp;#60;tbody&amp;#62;</td>
<td align="center">标签表格主体（正文）</td>
</tr>
<tr>
<td align="center">&amp;#60;td&amp;#62;</td>
<td align="center">表格中的标准单元格</td>
</tr>
<tr>
<td align="center">&amp;#60;tfoot&amp;#62;</td>
<td align="center">定义表格的页脚（脚注或表注）</td>
</tr>
<tr>
<td align="center">&amp;#60;th&amp;#62;</td>
<td align="center">定义表头单元格</td>
</tr>
<tr>
<td align="center">&amp;#60;thead&amp;#62;</td>
<td align="center">标签定义表格的表头</td>
</tr>
<tr>
<td align="center">&amp;#60;tr&amp;#62;</td>
<td align="center">定义表格中的行</td>
</tr>
<tr>
<td align="center">&amp;#60;header&amp;#62;</td>
<td align="center">区段头或页头</td>
</tr>
<tr>
<td align="center">&amp;#60;footer&amp;#62;</td>
<td align="center">区段尾或页尾。</td>
</tr>
<tr>
<td align="center">&amp;#60;section&amp;#62;</td>
<td align="center">一个页面区段。</td>
</tr>
<tr>
<td align="center">&amp;#60;article&amp;#62;</td>
<td align="center">定义文章。</td>
</tr>
</tbody></table>
<h3 id="内联元素-inline-element"><a href="#内联元素-inline-element" class="headerlink" title="内联元素(inline element)"></a>内联元素(inline element)</h3><table>
<thead>
<tr>
<th align="center">标签</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;#60;a&amp;#62;</td>
<td align="center">超链接&#x2F;锚点</td>
</tr>
<tr>
<td align="center">&amp;#60;acronym &amp;#62;</td>
<td align="center">定义只取首字母缩写</td>
</tr>
<tr>
<td align="center">&amp;#60;b&amp;#62;</td>
<td align="center">字体加粗</td>
</tr>
<tr>
<td align="center">&amp;#60;bdo&amp;#62;</td>
<td align="center">可覆盖默认的文本方向</td>
</tr>
<tr>
<td align="center">&amp;#60;big &amp;#62;</td>
<td align="center">大字体</td>
</tr>
<tr>
<td align="center">&amp;#60;br&amp;#62;</td>
<td align="center">换行</td>
</tr>
<tr>
<td align="center">&amp;#60;cite&amp;#62;</td>
<td align="center">引用进行定义</td>
</tr>
<tr>
<td align="center">&amp;#60;code&amp;#62;</td>
<td align="center">计定义计算机代码文本</td>
</tr>
<tr>
<td align="center">&amp;#60;dfn&amp;#62;</td>
<td align="center">定义一个定义项目</td>
</tr>
<tr>
<td align="center">&amp;#60;em &amp;#62;</td>
<td align="center">强调</td>
</tr>
<tr>
<td align="center">&amp;#60;font&amp;#62;</td>
<td align="center">字体设定(不推荐)</td>
</tr>
<tr>
<td align="center">&amp;#60; i &amp;#62;</td>
<td align="center">斜体文本效果</td>
</tr>
<tr>
<td align="center">&amp;#60;img &amp;#62;</td>
<td align="center">向网页中嵌入一幅图像</td>
</tr>
<tr>
<td align="center">&amp;#60;input &amp;#62;</td>
<td align="center">输入框</td>
</tr>
<tr>
<td align="center">&amp;#60;kbd &amp;#62;</td>
<td align="center">定义键盘文</td>
</tr>
<tr>
<td align="center">&amp;#60; label &amp;#62;</td>
<td align="center">标签为 input 元素定义标注（标记）</td>
</tr>
<tr>
<td align="center">&amp;#60; q&amp;#62;</td>
<td align="center">短引用</td>
</tr>
<tr>
<td align="center">&amp;#60; s&amp;#62;</td>
<td align="center">中划线(不推荐)</td>
</tr>
<tr>
<td align="center">&amp;#60; samp&amp;#62;</td>
<td align="center">定义范例计算机代码</td>
</tr>
<tr>
<td align="center">&amp;#60;select &amp;#62;</td>
<td align="center">创建单选或多选菜单</td>
</tr>
<tr>
<td align="center">&amp;#60;small &amp;#62;</td>
<td align="center">小字体文本</td>
</tr>
<tr>
<td align="center">&amp;#60;span &amp;#62;</td>
<td align="center">组合文档中的行内元素</td>
</tr>
<tr>
<td align="center">&amp;#60;strike &amp;#62;</td>
<td align="center">中划线</td>
</tr>
<tr>
<td align="center">&amp;#60;strong &amp;#62;</td>
<td align="center">语气更强的强调的内容</td>
</tr>
<tr>
<td align="center">&amp;#60;sub&amp;#62;</td>
<td align="center">下标</td>
</tr>
<tr>
<td align="center">&amp;#60;sup&amp;#62;</td>
<td align="center">上标</td>
</tr>
<tr>
<td align="center">&amp;#60;textarea &amp;#62;</td>
<td align="center">多行文本输入框</td>
</tr>
<tr>
<td align="center">&amp;#60; tt&amp;#62;</td>
<td align="center">打字机或者等宽的文本效果</td>
</tr>
<tr>
<td align="center">&amp;#60;u &amp;#62;</td>
<td align="center">下划线</td>
</tr>
<tr>
<td align="center">&amp;#60;var&amp;#62;</td>
<td align="center">定义变量</td>
</tr>
</tbody></table>
<h3 id="可变元素"><a href="#可变元素" class="headerlink" title="可变元素"></a>可变元素</h3><p><strong>可变元素 为根据上下文语境决定该元素为块元素或者内联元素。</strong></p>
<table>
<thead>
<tr>
<th align="center">标签</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;#60;applet &amp;#62;</td>
<td align="center">java applet</td>
</tr>
<tr>
<td align="center">&amp;#60;button &amp;#62;</td>
<td align="center">按钮</td>
</tr>
<tr>
<td align="center">&amp;#60;del &amp;#62;</td>
<td align="center">删除文本</td>
</tr>
<tr>
<td align="center">&amp;#60;iframe  &amp;#62;</td>
<td align="center">创建包含另外一个文档的内联框架（即行内框架）</td>
</tr>
<tr>
<td align="center">&amp;#60;ins &amp;#62;</td>
<td align="center">标签定义已经被插入文档中的文本</td>
</tr>
<tr>
<td align="center">&amp;#60;map &amp;#62;</td>
<td align="center">客户端图像映射（即热区）</td>
</tr>
<tr>
<td align="center">&amp;#60;object &amp;#62;</td>
<td align="center">object对象</td>
</tr>
<tr>
<td align="center">&amp;#60;script &amp;#62;</td>
<td align="center">客户端脚本</td>
</tr>
</tbody></table>
<p><strong>注：此处只包含部分标签分类，而”块级“在新的 HTML5 元素中暂时无明确定义</strong></p>
<h2 id="块元素与内联元素的基本特点"><a href="#块元素与内联元素的基本特点" class="headerlink" title="块元素与内联元素的基本特点"></a>块元素与内联元素的基本特点</h2><h3 id="块元素特点："><a href="#块元素特点：" class="headerlink" title="块元素特点："></a>块元素特点：</h3><ol>
<li>每个块级元素都从新的一行开始，并且其后的元素也另起一行。</li>
<li>元素的高度、宽度、行高以及顶和底边距都可设置。</li>
<li>元素宽度在不设置的情况下，是它本身父容器的100%（和父元素的宽度一致），除非设定一个宽度。</li>
<li>它可以容纳内联元素和其他块元素</li>
</ol>
<h3 id="内联元素特点："><a href="#内联元素特点：" class="headerlink" title="内联元素特点："></a>内联元素特点：</h3><ol>
<li>和其他元素都在一行上；</li>
<li>高，行高及外边距和内边距不可改变；</li>
<li>宽度就是它的文字或图片的宽度，不可改变</li>
<li>内联元素只能容纳文本或者其他内联元素</li>
</ol>
<h3 id="对行内元素，需要注意如下"><a href="#对行内元素，需要注意如下" class="headerlink" title="对行内元素，需要注意如下:"></a>对行内元素，需要注意如下:</h3><ol>
<li>设置宽度width 无效。</li>
<li>设置高度height 无效，可以通过line-height来设置。</li>
<li>设置margin 只有左右margin有效，上下无效。</li>
<li>设置padding 只有左右padding有效，上下则无效。注意元素范围是增大了，但是对元素周围的内容是没影响的。</li>
</ol>
<p><strong>注：行内各别元素除外如类似img元素</strong></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://www.w3cwhy.com/css-html/html-hkmarka.html">w3c常见的块状元素与内联元素</a></li>
<li><a href="http://segmentfault.com/a/1190000003409574">关于元素高度与宽度的讨论</a></li>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/Replaced_element">MDN-置換元素</a></li>
<li><a href="http://www.w3.org/html/ig/zh/wiki/CSS2/visuren">w3c视觉格式化模型</a></li>
<li><a href="http://www.w3.org/html/ig/zh/wiki/CSS2/visudet/zh-hans">w3c视觉布局模型细节</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Block-level_elements#%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E8%A1%8C%E5%86%85%E5%85%83%E7%B4%A0">MDN-块级元素</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Visual_formatting_model">MDN-视觉格式化模型</a></li>
</ol>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>承诺Promises</title>
    <url>/2018/08/17/%E6%89%BF%E8%AF%BAPromises/</url>
    <content><![CDATA[<h2 id="Promises"><a href="#Promises" class="headerlink" title="Promises"></a>Promises</h2><p><code>Promise </code>表示一个异步操作的最终结果，与之进行交互的方式主要是 then 方法，该方法注册了两个回调函数，用于接收 promise 的终值或本 promise 不能执行的原因。</p>
<p>一个 Promise有以下几种状态:</p>
<ul>
<li><code>pending:</code> 初始状态，既不是成功，也不是失败状态。</li>
<li><code>fulfilled:</code> 意味着操作成功完成。</li>
<li><code>rejected:</code> 意味着操作失败。</li>
</ul>
<ol>
<li><code>Promise</code> 本质是一个状态机。每个 <code>promise</code> 只能是 3 种状态中的一种：<code>pending、fulfilled</code> 或 <code>rejected</code>。状态转变只能是 <code>pending -&gt; fulfilled</code> 或者 <code>pending -&gt; rejected</code>。状态转变不可逆。</li>
<li><code>then</code> 方法可以被同一个 <code>promise</code> 调用多次。</li>
<li><code>then</code> 方法必须返回一个 <code>promise</code> 。规范里没有明确说明返回一个新的 promise 还是复用老的 <code>promise</code>（即 return this），大多数实现都是返回一个新的 <code>promise</code> ，而且复用老的 <code>promise</code> 可能改变内部状态，这与规范也是相违背的。</li>
<li>值穿透(上一个<code>promise</code>传递过来的值，经由这个<code>then</code>方法的时候不做任何处理，而是交给再下个<code>then</code>方法去处理)。</li>
</ol>
<span id="more"></span>

<p><strong>注意：</strong> 如果一个<code>promise</code>对象处在<code>fulfilled</code>或<code>rejected</code>状态而不是<code>pending</code>状态，那么它也可以被称为<code>settled</code>状态。你可能也会听到一个术语<code>resolved </code>，它表示<code>promise</code>对象处于<code>fulfilled</code>状态。</p>
<h3 id="术语集"><a href="#术语集" class="headerlink" title="术语集"></a>术语集</h3><ol>
<li><code>Promises</code>:<code>Promise</code>规范自身</li>
<li><code>promise</code>对象:<code>promise</code>对象指的是 <code>Promise</code> 实例对象</li>
<li><code>ES6 Promises</code>:如果想明确表示使用 <code>ECMAScript 6th Edition</code> 的话，可以使用<code>ES6</code>作为前缀（<code>prefix</code>）</li>
<li><code>Promises/A+</code>:这是<code>ES6 Promises</code>的前身，是一个社区规范，它和 <code>ES6 Promises</code> 有很多共通的内容。</li>
<li><code>Thenable</code>:类<code>Promise</code>对象。 拥有名为<code>.then</code>方法的对象。</li>
<li><code>promise chain</code>:指使用 <code>then</code> 或者 <code>catch</code> 方法将<code>promise</code>对象连接起来的行为。 此用语只是在本书中的说法，而不是在 <code>ES6 Promises</code> 中定义的官方用语。</li>
</ol>
<h3 id="Promise的实现类库"><a href="#Promise的实现类库" class="headerlink" title="Promise的实现类库"></a><code>Promise</code>的实现类库</h3><p>如果说一个类库兼容 <code>Promises/A+</code> 的话，那么就是说它除了具有标准的 <code>then</code> 方法之外，很多情况下也说明此类库还支持 <code>Promise.all</code> 和 <code>catch</code> 等功能。</p>
<p>但是 <code>Promises/A+</code> 实际上只是定义了关于 <code>Promise#then</code> 的规范，所以有些类库可能实现了其它诸如 <code>all</code> 或 <code>catch</code> 等功能，但是可能名字却不一样。</p>
<p>如果我们说一个类库具有 <code>then</code> 兼容性的话，实际上指的是 <code>Thenable</code> ，它通过使用 <code>Promise.resolve</code> 基于<code>ES6 Promise</code>的规定，进行<code>promise</code>对象的变换。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">new Promise( <span class="keyword">function</span>(resolve, reject) &#123;...&#125; /* executor */  );</span><br></pre></td></tr></table></figure>

<p><code>Promise</code> 带有 <code>resolve</code> 和 <code>reject</code> 两个参数的函数;</p>
<p><code>resolve</code> 和 <code>reject</code> 函数被调用时，分别将 <code>promise</code> 的状态改为<code>fulfilled</code>（完成）或 <code>rejected</code>（失败）</p>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><ul>
<li><code>Promise.length</code>:<code>length</code>属性，其值总是为 1 (构造器参数的数目).</li>
<li><code>Promise.prototype</code>:表示 <code>Promise</code> 构造器的原型.</li>
</ul>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ul>
<li><p><code>Promise.all(iterable)</code>:这个方法返回一个新的<code>promise</code>对象，该<code>promise</code>对象在<code>iterable</code>参数对象里所有的<code>promise</code>对象都成功的时候才会触发成功，一旦有任何一个<code>iterable</code>里面的<code>promise</code>对象失败则立即触发该<code>promise</code>对象的失败。</p>
<p>  这个新的<code>promise</code>对象在触发成功状态以后，会把一个包含<code>iterable</code>里所有<code>promise</code>返回值的数组作为成功回调的返回值，顺序跟<code>iterable</code>的顺序保持一致；</p>
<p>  如果这个新的<code>promise</code>对象触发了失败状态，它会把<code>iterable</code>里第一个触发失败的<code>promise</code>对象的错误信息作为它的失败错误信息</p>
<p>  <code>Promise.all</code>方法常被用于处理多个<code>promise</code>对象的状态集合</p>
</li>
<li><p><code>Promise.race(iterable)</code>:当<code>iterable</code>参数里的任意一个子<code>promise</code>被成功或失败后，父<code>promise</code>马上也会用子<code>promise</code>的成功返回值或失败详情作为参数调用父<code>promise</code>绑定的相应句柄，并返回该<code>promise</code>对象</p>
</li>
<li><p><code>Promise.reject(reason)</code>:返回一个状态为失败的<code>Promise</code>对象，并将给定的失败信息传递给对应的处理方法</p>
</li>
<li><p><code>Promise.resolve(value)</code>:返回一个状态由给定<code>value</code>决定的<code>Promise</code>对象</p>
<p>  如果该值是一个<code>Promise</code>对象，则直接返回该对象；</p>
<p>  如果该值是<code>thenable</code>(即，带有<code>then</code>方法的对象)，返回的<code>Promise</code>对象的最终状态由<code>then</code>方法执行决定；</p>
<p>  否则的话(该<code>value</code>为空，基本类型或者不带<code>then</code>方法的对象),返回的<code>Promise</code>对象状态为<code>fulfilled</code>，并且将该<code>value</code>传递给对应的<code>then</code>方法</p>
<p>  如果你不知道一个值是否是<code>Promise</code>对象，使用<code>Promise.resolve(value)</code> 来返回一个<code>Promise</code>对象,这样就能将该<code>value</code>以<code>Promise</code>对象形式使用。</p>
</li>
</ul>
<h3 id="Promise-原型"><a href="#Promise-原型" class="headerlink" title="Promise 原型"></a><code>Promise</code> 原型</h3><h4 id="Promise-prototype-constructor"><a href="#Promise-prototype-constructor" class="headerlink" title="Promise.prototype.constructor"></a><code>Promise.prototype.constructor</code></h4><p>返回被创建的实例函数.  默认为 <code>Promise</code> 函数.</p>
<h4 id="Promise-prototype-catch-onRejected"><a href="#Promise-prototype-catch-onRejected" class="headerlink" title="Promise.prototype.catch(onRejected)"></a><code>Promise.prototype.catch(onRejected)</code></h4><p>添加一个拒绝(<code>rejection</code>) 回调到当前 <code>promise</code>, 返回一个新的 <code>promise</code></p>
<p>当这个回调函数被调用，新<code> promise</code> 将以它的返回值来<code>resolve</code>;</p>
<p>否则如果当前<code>promise</code> 进入<code>fulfilled</code>状态，则以当前<code>promise</code>的完成结果作为新<code>promise</code>的完成结果.</p>
<h4 id="Promise-prototype-then-onFulfilled-onRejected"><a href="#Promise-prototype-then-onFulfilled-onRejected" class="headerlink" title="Promise.prototype.then(onFulfilled, onRejected)"></a><code>Promise.prototype.then(onFulfilled, onRejected)</code></h4><p>添加解决(<code>fulfillment</code>)和拒绝(<code>rejection</code>)回调到当前 <code>promise</code>, 返回一个新的 <code>promise</code>, 将以回调的返回值来 <code>resolve</code>.</p>
<h4 id="Promise-prototype-finally-onFinally"><a href="#Promise-prototype-finally-onFinally" class="headerlink" title="Promise.prototype.finally(onFinally)"></a><code>Promise.prototype.finally(onFinally)</code></h4><p>添加一个事件处理回调于当前<code>promise</code>对象，并且在原<code>promise</code>对象解析完毕后，返回一个新的<code>promise</code>对象</p>
<p>回调会在当前<code>promise</code>运行完毕后被调用，无论当前<code>promise</code>的状态是完成(<code>fulfilled</code>)还是失败(<code>rejected</code>)</p>
<h3 id="承诺源码"><a href="#承诺源码" class="headerlink" title="承诺源码"></a>承诺源码</h3><ol>
<li><a href="https://github.com/calvinmetcalf/lie">一个基础并高性能的承诺实现。</a></li>
<li><a href="https://github.com/calvinmetcalf/immediate#readme">immediate.js</a></li>
</ol>
<h3 id="代码片段1"><a href="#代码片段1" class="headerlink" title="代码片段1"></a>代码片段1</h3><p>此处的<code>PromiseA</code>等同于<code>Promise</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">PromiseA</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开始测试&quot;</span>)</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;1.小明&quot;</span>)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(promise, &#123; <span class="attr">depth</span>: <span class="number">10</span> &#125;)</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">(<span class="params">aVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> aVal+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;2.小刚&quot;</span>;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">bVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bVal+<span class="string">&quot;,&quot;</span>+<span class="string">&quot;3.小吃&quot;</span>;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">cVal</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cVal)</span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;结束测试&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180817190156.png" alt="image"></p>
<p><code>then</code> 方法可以被同一个 <code>promise</code> 调用多次</p>
<h3 id="代码片段-all与-race"><a href="#代码片段-all与-race" class="headerlink" title="代码片段 all与 race"></a>代码片段 <code>all</code>与 <code>race</code></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">PromiseA</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">500</span>, <span class="string">&#x27;大哥&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> p2= <span class="keyword">new</span> <span class="title class_">PromiseA</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="string">&#x27;小弟&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> p3= <span class="title class_">PromiseA</span>.<span class="title function_">resolve</span>(<span class="string">&quot;大爷&quot;</span>);</span><br><span class="line"><span class="title class_">PromiseA</span>.<span class="title function_">all</span>([p1,p2,p3]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">pArr</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;all&quot;</span>,pArr)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">PromiseA</span>.<span class="title function_">race</span>([p1,p2,p3]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">p</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;race&quot;</span>,p)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">race 大爷</span><br><span class="line">all [<span class="string">&quot;大哥&quot;</span>, <span class="string">&quot;小弟&quot;</span>, <span class="string">&quot;大爷&quot;</span>]0: <span class="string">&quot;大哥&quot;</span>1: <span class="string">&quot;小弟&quot;</span>2: <span class="string">&quot;大爷&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="源码代码"><a href="#源码代码" class="headerlink" title="源码代码"></a><a href="https://github.com/calvinmetcalf/lie">源码代码</a></h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * immediate是一个微任务库，来自NobleJS的 setImmediate，延迟执行</span></span><br><span class="line"><span class="comment"> * 把一些需要长时间运行的操作放在一个回调函数里、延迟执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> immediate = <span class="built_in">require</span>(<span class="string">&#x27;immediate&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代码覆盖率工具 Istanbul,</span></span><br><span class="line"><span class="comment"> * istanbul 提供注释语法，允许某些代码不计入覆盖率。</span></span><br><span class="line"><span class="comment"> * 忽略覆盖 、空函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* istanbul ignore next */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">INTERNAL</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 空对象 */</span></span><br><span class="line"><span class="keyword">var</span> handlers = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义 3 种状态</span></span><br><span class="line"><span class="comment"> * [REJECTED 操作失败]</span></span><br><span class="line"><span class="comment"> * [FULFILLED 操作成功]</span></span><br><span class="line"><span class="comment"> * [PENDING 初始状态，既不是成功，也不是失败状态]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">REJECTED</span> = [<span class="string">&#x27;REJECTED&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">FULFILLED</span> = [<span class="string">&#x27;FULFILLED&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">PENDING</span> = [<span class="string">&#x27;PENDING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 忽略else路径 */</span></span><br><span class="line"><span class="comment">/* istanbul ignore else */</span></span><br><span class="line"><span class="keyword">if</span> (!process.<span class="property">browser</span>) &#123;</span><br><span class="line">    <span class="comment">// in which we actually take advantage of JS scoping</span></span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">UNHANDLED</span> = [<span class="string">&#x27;UNHANDLED&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Promise</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [Promise构造函数]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">[Function]</span>&#125; resolver [函数]</span></span><br><span class="line"><span class="comment"> * new Promise(function resolver(resolve, reject) &#123;</span></span><br><span class="line"><span class="comment"> *      setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment"> *          resolve(&#x27;haha&#x27;)</span></span><br><span class="line"><span class="comment"> *      &#125;, 1000)</span></span><br><span class="line"><span class="comment"> * &#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">resolver</span>) &#123;</span><br><span class="line">    <span class="comment">/* resolver必须是一个函数 */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> resolver !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;resolver must be a function&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">PENDING</span>;<span class="comment">//初始状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">queue</span> = [];<span class="comment">// promise 内部的回调队列</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">outcome</span> = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/* 忽略if路径 */</span></span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (!process.<span class="property">browser</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">handled</span> = <span class="variable constant_">UNHANDLED</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Promise 构造函数传入了一个 INTERNAL 即空函数，因为这个新产生的 promise可以认为是内部的 promise；</span></span><br><span class="line"><span class="comment">     * 需要根据外部的 promise 的状态和值产生自身的状态和值，不需要传入回调函数，</span></span><br><span class="line"><span class="comment">     * 而外部Promise 需要传入回调函数决定它的状态和值。所以之前 Promise 的构造函数里做了判断区分外部</span></span><br><span class="line"><span class="comment">     * 调用还是内部调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (resolver !== <span class="variable constant_">INTERNAL</span>) &#123;</span><br><span class="line">        <span class="comment">/* 安全的执行 then 函数 */</span></span><br><span class="line">        <span class="title function_">safelyResolveThenable</span>(<span class="variable language_">this</span>, resolver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * finally() 方法返回一个Promise，在执行then()和catch()后，都会执行finally指定的回调函数。避免同样的语句需要在then()和catch()中各写一次的情况。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">Function</span>&#125; callback [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;            [返回一个Promise]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="variable language_">this</span>.<span class="property">constructor</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">yes</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(yes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">no</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> reason;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p.<span class="title function_">resolve</span>(<span class="title function_">callback</span>()).<span class="title function_">then</span>(no);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * catch() 方法返回一个Promise，并且处理拒绝的情况</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; onRejected [失败操作]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;            [返回一个Promise]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span>(<span class="params">onRejected</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [then 原型方法]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; onFulfilled [then的 成功回调]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; onRejected  [then的 失败回调]</span></span><br><span class="line"><span class="comment"> * 生成了一个新的 promise 然后返回，符合规范要求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">state</span> === <span class="variable constant_">FULFILLED</span> ||</span><br><span class="line">        <span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">state</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>;<span class="comment">//实现了值穿透</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Promise 构造函数传入了一个 INTERNAL 即空函数，因为这个新产生的 promise 可以认为是内部的</span></span><br><span class="line"><span class="comment">     * promise;需要根据外部的 promise 的状态和值产生自身的状态和值，不需要传入回调函数，</span></span><br><span class="line"><span class="comment">     * 而外部Promise 需要传入回调函数决定它的状态和值;所以之前 Promise 的构造函数里做了判断区分外部</span></span><br><span class="line"><span class="comment">     * 调用还是内部调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="variable language_">this</span>.<span class="title function_">constructor</span>(<span class="params">INTERNAL</span>);</span><br><span class="line">    <span class="comment">/* 覆盖测试忽略else路径 */</span></span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (!process.<span class="property">browser</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">handled</span> === <span class="variable constant_">UNHANDLED</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">handled</span> = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">        <span class="comment">//state状态改变、根据状态返回成功或失败回调、则调用 unwrap</span></span><br><span class="line">        <span class="keyword">var</span> resolver = <span class="variable language_">this</span>.<span class="property">state</span> === <span class="variable constant_">FULFILLED</span> ? onFulfilled : onRejected;</span><br><span class="line">        <span class="comment">//传入内部承诺、</span></span><br><span class="line">        <span class="title function_">unwrap</span>(promise, resolver, <span class="variable language_">this</span>.<span class="property">outcome</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//将生成的 promise 加入到当前 promise 的队列 queue 里</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">QueueItem</span>(promise, onFulfilled, onRejected));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [QueueItem 承诺队列]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">[type]</span>&#125; promise     [promise 为 then 生成的新 promise/子承诺]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">[type]</span>&#125; onFulfilled [then 参数中的 onFulfilled]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">[type]</span>&#125; onRejected  [then 参数中的 onRejected]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">QueueItem</span>(<span class="params">promise, onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">promise</span> = promise;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilled</span> = onFulfilled;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callFulfilled</span> = <span class="variable language_">this</span>.<span class="property">otherCallFulfilled</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejected</span> = onRejected;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callRejected</span> = <span class="variable language_">this</span>.<span class="property">otherCallRejected</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//承诺成功调用</span></span><br><span class="line"><span class="title class_">QueueItem</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">callFulfilled</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    handlers.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">promise</span>, value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//用 otherCallFulfilled 调用 unwrap 进行解包最终得出子 promise 的状态和值</span></span><br><span class="line"><span class="title class_">QueueItem</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">otherCallFulfilled</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="title function_">unwrap</span>(<span class="variable language_">this</span>.<span class="property">promise</span>, <span class="variable language_">this</span>.<span class="property">onFulfilled</span>, value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//承诺失败调用</span></span><br><span class="line"><span class="title class_">QueueItem</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">callRejected</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    handlers.<span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">promise</span>, value);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//用 otherCallRejected 调用 unwrap 进行解包最终得出子 promise 的状态和值</span></span><br><span class="line"><span class="title class_">QueueItem</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">otherCallRejected</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="title function_">unwrap</span>(<span class="variable language_">this</span>.<span class="property">promise</span>, <span class="variable language_">this</span>.<span class="property">onRejected</span>, value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [unwrap 解包函数(即执行函数)、]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; promise [子 promise/内部承诺]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; func    [父 promise 的 then 的回调（onFulfilled/onRejected）]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; value   [父 promise 的值（正常值/错误）]</span></span><br><span class="line"><span class="comment"> * immediate 是 立即激活回调，然后等待后续事件在一定时间内触发。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unwrap</span>(<span class="params">promise, func, value</span>) &#123;</span><br><span class="line">    <span class="comment">//把一些需要长时间运行的操作放在一个回调函数里、延迟执行、将代码装换成异步代码</span></span><br><span class="line">    <span class="title function_">immediate</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> returnValue;</span><br><span class="line">        <span class="comment">//捕获 then/catch 内抛出的异常，并调用 handlers.reject</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//执行父 promise 的 then 的回调（onFulfilled/onRejected），并传入父 promise 的值（正常值/错误）</span></span><br><span class="line">            returnValue = <span class="title function_">func</span>(value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">return</span> handlers.<span class="title function_">reject</span>(promise, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回的值不能是 内部promise 本身，否则会造成死循环</span></span><br><span class="line">        <span class="keyword">if</span> (returnValue === promise) &#123;</span><br><span class="line">            <span class="comment">//调用拒绝</span></span><br><span class="line">            handlers.<span class="title function_">reject</span>(promise, <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Cannot resolve promise with itself&#x27;</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//调用拒成功</span></span><br><span class="line">            handlers.<span class="title function_">resolve</span>(promise, returnValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [resolve description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; self  [promise]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; value [父承诺的值]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;       [返回自身]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">handlers.<span class="property">resolve</span> = <span class="keyword">function</span>(<span class="params">self, value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="title function_">tryCatch</span>(getThen, value);</span><br><span class="line">    <span class="comment">//有错误则执行 handlers.reject</span></span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> handlers.<span class="title function_">reject</span>(self, result.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> thenable = result.<span class="property">value</span>;</span><br><span class="line">    <span class="comment">//如果返回值存在</span></span><br><span class="line">    <span class="keyword">if</span> (thenable) &#123;</span><br><span class="line">        <span class="comment">/* 安全的执行 then 函数 */</span></span><br><span class="line">        <span class="title function_">safelyResolveThenable</span>(self, thenable);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        self.<span class="property">state</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">        self.<span class="property">outcome</span> = value;</span><br><span class="line">        <span class="keyword">var</span> i = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> len = self.<span class="property">queue</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">            self.<span class="property">queue</span>[i].<span class="title function_">callFulfilled</span>(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//操作失败</span></span><br><span class="line">handlers.<span class="property">reject</span> = <span class="keyword">function</span>(<span class="params">self, error</span>) &#123;</span><br><span class="line">    self.<span class="property">state</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">    self.<span class="property">outcome</span> = error;</span><br><span class="line">    <span class="comment">/* 覆盖测试忽略else路径 */</span></span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (!process.<span class="property">browser</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (self.<span class="property">handled</span> === <span class="variable constant_">UNHANDLED</span>) &#123;</span><br><span class="line">            <span class="title function_">immediate</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (self.<span class="property">handled</span> === <span class="variable constant_">UNHANDLED</span>) &#123;</span><br><span class="line">                    process.<span class="title function_">emit</span>(<span class="string">&#x27;unhandledRejection&#x27;</span>, error, self);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> i = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> len = self.<span class="property">queue</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">        self.<span class="property">queue</span>[i].<span class="title function_">callRejected</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [getThen 辅助函数 getThen]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; obj [值或承诺]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;     [description]</span></span><br><span class="line"><span class="comment"> * 规范中规定：如果 then 是函数，这里是 obj作为函数的 this 调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getThen</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">// Make sure we only access the accessor once as required by the spec</span></span><br><span class="line">    <span class="keyword">var</span> then = obj &amp;&amp; obj.<span class="property">then</span>;</span><br><span class="line">    <span class="comment">//只有obj是一个对象或函数并且含有的属性then是函数，如obj是一个承诺</span></span><br><span class="line">    <span class="keyword">if</span> (obj &amp;&amp; (<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span>) &amp;&amp; <span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">//返回解包函数类似tryToUnwrap</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">appyThen</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">//执行then方法，这里 obj 作为函数的 this 调用。</span></span><br><span class="line">            then.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [safelyResolveThenable 安全的执行 then 函数]</span></span><br><span class="line"><span class="comment"> * 构造函数的参数resolver，即这里的 thenable</span></span><br><span class="line"><span class="comment"> * new Promise(function resolver(resolve, reject) &#123;</span></span><br><span class="line"><span class="comment"> *      setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment"> *          resolve(&#x27;haha&#x27;)</span></span><br><span class="line"><span class="comment"> *      &#125;, 1000)</span></span><br><span class="line"><span class="comment"> * &#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safelyResolveThenable</span>(<span class="params">self, thenable</span>) &#123;</span><br><span class="line">    <span class="comment">// Either fulfill, reject or reject with error</span></span><br><span class="line">    <span class="keyword">var</span> called = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 失败调用 */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onError</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (called) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        called = <span class="literal">true</span>;</span><br><span class="line">        handlers.<span class="title function_">reject</span>(self, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 成功调用 */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onSuccess</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (called) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        called = <span class="literal">true</span>;</span><br><span class="line">        handlers.<span class="title function_">resolve</span>(self, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//捕获并解包函数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">tryToUnwrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//执行传进来的函数</span></span><br><span class="line">        <span class="title function_">thenable</span>(onSuccess, onError);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行并返回结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="title function_">tryCatch</span>(tryToUnwrap);</span><br><span class="line">    <span class="comment">//如果抛出异常、则调用onError里的handlers.reject</span></span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">onError</span>(result.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [tryCatch 捕获抛出的异常]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[Function]</span>&#125; func  [then函数]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[type]</span>&#125; value [父函数then返回的值]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[Object]</span>&#125;       [返回执行结果]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tryCatch</span>(<span class="params">func, value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> out = &#123;&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//执行then函数,传入父then返回的值</span></span><br><span class="line">        out.<span class="property">value</span> = <span class="title function_">func</span>(value);</span><br><span class="line">        out.<span class="property">status</span> = <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        out.<span class="property">status</span> = <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">        out.<span class="property">value</span> = e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态方法成功</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = resolve;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="comment">//Promise.resolve 参数是一个 promise 时，直接返回该值</span></span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="variable language_">this</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//传入新的承诺</span></span><br><span class="line">    <span class="keyword">return</span> handlers.<span class="title function_">resolve</span>(<span class="keyword">new</span> <span class="title function_">this</span>(<span class="variable constant_">INTERNAL</span>), value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态方法失败</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = reject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="comment">//传入新的承诺</span></span><br><span class="line">    <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title function_">this</span>(<span class="variable constant_">INTERNAL</span>);</span><br><span class="line">    <span class="keyword">return</span> handlers.<span class="title function_">reject</span>(promise, reason);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = all;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [此实例在 iterable 参数内所有的 promise 都“完成（resolved）”或参数中不包含 promise 时回调完成（resolve）；如果参数中  promise 有一个失败（rejected），此实例回调失败（reject），失败原因的是第一个失败 promise 的结果。]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[Array]</span>&#125; iterable [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;          [返回一个 Promise 实例]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">all</span>(<span class="params">iterable</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(iterable) !== <span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;must be an array&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> len = iterable.<span class="property">length</span>;</span><br><span class="line">    <span class="comment">//called 用来控制即使有多个 promise reject 也只有第一个生效</span></span><br><span class="line">    <span class="keyword">var</span> called = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!len) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">resolve</span>([]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//values 用来存储结果</span></span><br><span class="line">    <span class="keyword">var</span> values = <span class="keyword">new</span> <span class="title class_">Array</span>(len);</span><br><span class="line">    <span class="keyword">var</span> resolved = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> i = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//生成新承诺</span></span><br><span class="line">    <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title function_">this</span>(<span class="variable constant_">INTERNAL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//循环处理所有的</span></span><br><span class="line">    <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">        <span class="title function_">allResolver</span>(iterable[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">allResolver</span>(<span class="params">value, i</span>) &#123;</span><br><span class="line">        self.<span class="title function_">resolve</span>(value).<span class="title function_">then</span>(resolveFromAll, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!called) &#123;</span><br><span class="line">                called = <span class="literal">true</span>;</span><br><span class="line">                handlers.<span class="title function_">reject</span>(promise, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">resolveFromAll</span>(<span class="params">outValue</span>) &#123;</span><br><span class="line">            values[i] = outValue;</span><br><span class="line">            <span class="keyword">if</span> (++resolved === len &amp;&amp; !called) &#123;</span><br><span class="line">                called = <span class="literal">true</span>;</span><br><span class="line">                handlers.<span class="title function_">resolve</span>(promise, values);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = race;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Promise.race(iterable) 方法返回一个 promise，一旦迭代器中的某个promise解决或拒绝，返回的 promise就会解决或拒绝。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">[Array]</span>&#125; iterable [description]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">[type]</span>&#125;          [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">race</span>(<span class="params">iterable</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(iterable) !== <span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;must be an array&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> len = iterable.<span class="property">length</span>;</span><br><span class="line">    <span class="comment">/* called 控制只要有任何一个 promise onFulfilled/onRejected 立即去设置 promise 的状态和值。*/</span></span><br><span class="line">    <span class="keyword">var</span> called = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!len) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">resolve</span>([]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//生成一个新的承诺</span></span><br><span class="line">    <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title function_">this</span>(<span class="variable constant_">INTERNAL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">        <span class="title function_">resolver</span>(iterable[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolver</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        self.<span class="title function_">resolve</span>(value).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!called) &#123;</span><br><span class="line">                called = <span class="literal">true</span>;</span><br><span class="line">                handlers.<span class="title function_">resolve</span>(promise, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!called) &#123;</span><br><span class="line">                called = <span class="literal">true</span>;</span><br><span class="line">                handlers.<span class="title function_">reject</span>(promise, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考注释"><a href="#参考注释" class="headerlink" title="参考注释"></a>参考注释</h2><ul>
<li>平台代码指的是引擎、环境以及 <code>promise</code> 的实施代码。实践中要确保 <code>onFulfilled</code> 和 <code>onRejected</code> 方法异步执行，且应该在 <code>then</code> 方法被调用的那一轮事件循环之后的新执行栈中执行。这个事件队列可以采用“宏任务（<code>macro-task</code>）”机制或者“微任务（<code>micro-task</code>）”机制来实现。由于 <code>promise</code> 的实施代码本身就是平台代码（译者注：即都是 <code>JavaScript</code>），故代码自身在处理在处理程序时可能已经包含一个任务调度队列。</li>
</ul>
<p><code>macrotask</code> 和 <code>microtask</code> 两个概念，这表示异步任务的两种分类。在挂起任务时，<code>JS</code> 引擎会将所有任务按照类别分到这两个队列中，首先在 macrotask 的队列（这个队列也被叫做 <code>task queue</code>）中取出第一个任务，执行完毕后取出 <code>microtask</code> 队列中的所有任务顺序执行；之后再取 <code>macrotask</code> 任务，周而复始，直至两个队列的任务都取完。</p>
<p>两个类别的具体分类如下:</p>
<ol>
<li><code>macro-task:</code> script（整体代码）,<code>setTimeout</code>, <code>setInterval</code>, <code>setImmediate</code>,<code>I/O</code>, <code>UI rendering</code></li>
<li><code>micro-task:</code> <code>process.nextTick</code>, <code>Promises</code>（这里指浏览器实现的原生 <code>Promise</code>）, <code>Object.observe</code>, <code>MutationObserver</code></li>
</ol>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="http://wiki.commonjs.org/wiki/Promises/A"> Promise&#x2F;A 规范 </a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25178630">深入 Promise(一)——Promise 实现详解</a></li>
<li><a href="https://github.com/azu/promises-book">Promises Book</a></li>
<li><a href="http://www.ituring.com.cn/article/66566">翻译Promises&#x2F;A+规范</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>水平垂直居中</title>
    <url>/2018/01/10/%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD/</url>
    <content><![CDATA[<h2 id="方案一"><a href="#方案一" class="headerlink" title="方案一:"></a>方案一:</h2><p>使用<code>inline-block</code>与伪类</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">display</span>:block;<span class="attribute">position</span>:fixed;<span class="attribute">top</span>:<span class="number">0</span>;<span class="attribute">left</span>:<span class="number">0</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">z-index</span>:<span class="number">1501</span>;<span class="attribute">text-align</span>: center;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-box</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ddd</span>;<span class="attribute">background-color</span>:<span class="number">#fff</span>;<span class="attribute">display</span>:inline-block;<span class="attribute">vertical-align</span>:middle;<span class="attribute">text-align</span><span class="selector-pseudo">:left</span>;<span class="attribute">color</span>:<span class="number">#333</span>;<span class="attribute">position</span>:relative;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span><span class="selector-pseudo">:after</span>&#123;<span class="attribute">content</span>: <span class="string">&quot; &quot;</span>;<span class="attribute">width</span>: <span class="number">0</span>;<span class="attribute">height</span>: <span class="number">100%</span>;<span class="attribute">display</span>: inline-block;<span class="attribute">vertical-align</span>: middle;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-box&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;padding:30px 100px;&quot;</span>&gt;</span>测试数据<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="方案二"><a href="#方案二" class="headerlink" title="方案二:"></a>方案二:</h2><p>使用table-cell与vertical-align</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">display</span>: table;<span class="attribute">position</span>:fixed;<span class="attribute">top</span>:<span class="number">0</span>;<span class="attribute">left</span>:<span class="number">0</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span>&#123;<span class="attribute">display</span>: table-cell;<span class="attribute">vertical-align</span>: middle;<span class="attribute">text-align</span>: center;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid blue;display:inline-block;&quot;</span>&gt;</span>行内块元素不定宽高<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid red; width:300px;margin:auto;&quot;</span>&gt;</span>块元素定宽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid #ff00ff;&quot;</span>&gt;</span>行内素元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案三"><a href="#方案三" class="headerlink" title="方案三:"></a>方案三:</h2><p>fixed&#x2F;absolute定位定宽定高</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">position</span>:absolute;<span class="attribute">top</span>:<span class="number">0</span>;<span class="attribute">right</span>:<span class="number">0</span>;<span class="attribute">bottom</span>:<span class="number">0</span>;<span class="attribute">left</span>:<span class="number">0</span>;<span class="attribute">margin</span>:auto;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">height</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ddd</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    fixed/absolute定位定宽定高</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案四"><a href="#方案四" class="headerlink" title="方案四"></a>方案四</h2><p>定位于<code>transform</code>不定宽不定高</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">position</span>: fixed;<span class="attribute">top</span>:<span class="number">50%</span>;<span class="attribute">left</span>:<span class="number">50%</span>;<span class="attribute">transform</span>:<span class="built_in">translate</span>(-<span class="number">50%</span>,-<span class="number">50%</span>);<span class="attribute">text-align</span>: center;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    (fixed/absolute)与transform不定宽不定高</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案五"><a href="#方案五" class="headerlink" title="方案五"></a>方案五</h2><p>使用<code>flex</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">display</span>:flex;<span class="attribute">align-items</span>: center;<span class="attribute">justify-content</span>: center;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">position</span>:fixed;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>不定宽不定高<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案六"><a href="#方案六" class="headerlink" title="方案六"></a>方案六</h2><p>宽高取一半负值</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">position</span>:fixed;<span class="attribute">top</span>:<span class="number">50%</span>;<span class="attribute">left</span>:<span class="number">50%</span>;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">height</span>:<span class="number">100px</span>;<span class="attribute">margin-left</span>:-<span class="number">50px</span>;<span class="attribute">margin-top</span>:-<span class="number">50px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>定宽定高<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案七"><a href="#方案七" class="headerlink" title="方案七"></a>方案七</h2><p>使用grid</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    可以使用grid-column-start:1;和grid-column-end:-1;（或者简写grid-column: 1 / -1;）；</span></span><br><span class="line"><span class="comment">    从第一列网格线到第二列网格线创建一个网格标签（创建一个跨列网格）。使用比-1更小的值也是可以的</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.g-popup-wrap</span>&#123;<span class="attribute">display</span>: grid;<span class="attribute">position</span>:fixed;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);<span class="attribute">grid-template-rows</span>: <span class="built_in">repeat</span>(<span class="number">3</span>, <span class="number">1</span>fr);&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span>&#123;<span class="attribute">grid-column</span>: <span class="number">2</span> / <span class="number">2</span>;<span class="attribute">grid-row</span>: <span class="number">2</span> / <span class="number">2</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;g-popup-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>宽高依赖父级grid<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>注册苹果开发者</title>
    <url>/2025/09/19/%E6%B3%A8%E5%86%8C%E8%8B%B9%E6%9E%9C%E5%BC%80%E5%8F%91%E8%80%85/</url>
    <content><![CDATA[<h2 id="Apple-Developer-Program"><a href="#Apple-Developer-Program" class="headerlink" title="Apple Developer Program"></a><code>Apple Developer Program</code></h2><h3 id="个人"><a href="#个人" class="headerlink" title="个人"></a>个人</h3><p>如果你是个人或独资企业&#x2F;一人公司，那么你个人的法定姓名将作为供应商列示在 <code>App Store</code> 上。请勿输入别名、昵称或公司名称作为你的姓氏或名字，因为错误地输入你的法定姓名将导致注册审批延误。</p>
<h3 id="组织"><a href="#组织" class="headerlink" title="组织"></a>组织</h3><p>如果你是公司、非营利组织、合资企业、合伙企业或政府组织的员工，那么法人实体名称将作为供应商列示在 <code>App Store</code> 上。在验证过程中，我们会要求你提供法人实体名称和 <code>D‑U‑N‑S®</code> 编号。成为会员后，你可以选择将更多成员添加到自己的团队中。</p>
<span id="more"></span>

<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol>
<li>注册一个邮箱账号（推荐<code>163</code>邮箱，注册过程中基本都是英文，163邮箱自带翻译会节省很多时间）</li>
<li>再准备一个企业邮箱带域名的，后边会用到</li>
<li>一部苹果手机以及一个手机号（用于绑定<code>AppleID</code>和填写注册信息）</li>
<li>注册地址：<a href="https://account.apple.com/account">https://account.apple.com/account</a></li>
<li>填写信息<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/202509181134.png" alt="注册"></li>
<li>登录注册账号<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918142754.png" alt="加入苹果开发者"><br>6.手机下载<code>Apple Developer App</code>进行注册<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918143135.png" alt="手机下载Apple Developer App进行注册"></li>
</ol>
<h2 id="申请公司邓白氏码-D-U-N-S"><a href="#申请公司邓白氏码-D-U-N-S" class="headerlink" title="申请公司邓白氏码(D-U-N-S)"></a>申请公司邓白氏码(D-U-N-S)</h2><ol>
<li><a href="https://developer.apple.com/cn/help/account/membership/D-U-N-S/">查看文档DUNS</a></li>
<li>查找你的 D-U-N-S 编号，填写组织信息，注意需使用英文（工作电子邮件填写以域名为后缀的邮箱）<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918183254_32_148.png" alt="image"></li>
<li>如果组织有编号则可以查询到，没有的话会提示未找到你的组织，按提示填写信息正常提交申请流程即可，注册时平台如果报错，提示如下，和支持团队反馈了情况以后他们给我发送了一封邮件，让我提交材料，他们帮我提交给邓白氏。<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918183837_33_148.png" alt="image"></li>
<li>需要提供以下信息，通过邮件发送给苹果技术支持（有问题就联系技术平台，不要乱填）<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918184059_34_148.png" alt="image"></li>
<li>提交信息以后，邓白氏会给你的邮箱发送一封邮件，按照提示操作，时间比较短，最好提前准备好相关材料<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918184322_35_148.png" alt="image"></li>
<li>登录邓白氏网<a href="https://sso.dnbportal.cn/">https://sso.dnbportal.cn/</a><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918184522_36_148.png" alt="image"></li>
<li>登录后完成实名认证和企业核验，按照指引填就好了，需要什么材料会给你发邮件，多看自己邮箱，官网核验不通过，去微信小程序上操作。<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918184925_37_148.png" alt="image"></li>
<li>待企业核验通过后点击首页-申请邓白氏编码-选择苹果开发者-下一步-填写订单号和验证码，提交申请。</li>
<li>提交申请以后等待邓白氏官方给你发邮件就可以。<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918185543_38_148.png" alt="image"></li>
</ol>
<h2 id="申请加入开发者"><a href="#申请加入开发者" class="headerlink" title="申请加入开发者"></a>申请加入开发者</h2><blockquote>
<p>以下过程需要<code>DUNS</code>编码</p>
</blockquote>
<ol>
<li><p>在苹果商店下载 <code>Apple Developer</code><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/202509181436409148.jpg" alt="image"></p>
</li>
<li><p>登录<code>Apple ID</code>账号, 点击立即注册，我同意<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918144943492.png" alt="image"></p>
</li>
<li><p>点击同意，按照要求填写身份证信息<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091814454711148.jpg" alt="同意"><br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091814454712148.jpg" alt="填写"></p>
</li>
<li><p>进行人脸核验</p>
</li>
<li><p>选择对应的实体类型<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20250918150411931.jpg" alt="image"></p>
</li>
<li><p>填写<code>DUNS</code>编号，法人实体名称 （如果没有的话需要去申请）<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091815012415148.png" alt="image"></p>
</li>
<li><p>按照提示填写企业信息</p>
</li>
</ol>
<blockquote>
<p>电子邮件必须填企业邮箱，邮箱必须是以域名为后缀的；否则会提示：无效的电子邮箱；<br>填写的网站必须能打开，且域名必须与组织相关联，否则会审核不通过</p>
</blockquote>
<p><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091814595514148.png" alt="image"><br>8. 提交信息以后会收到一个注册ID，等待审核，审核通过后就会收到申请成功的邮件<br><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/2025091814584413148.png" alt="image"></p>
<ol start="9">
<li>登录<code>Apple Developer</code>，成功付款以后账号就申请成功啦。</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/4591209458">2024年注册苹果开发者（公司）账号流程 图文教程</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/4617165705">公司邓白氏码（D-U-N-S 编号）申请流程</a></li>
</ol>
]]></content>
      <categories>
        <category>ios</category>
      </categories>
      <tags>
        <tag>ios</tag>
      </tags>
  </entry>
  <entry>
    <title>浏览器滚动条样式</title>
    <url>/2019/03/02/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%BB%9A%E5%8A%A8%E6%9D%A1%E6%A0%B7%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="Chrome滚动条样式"><a href="#Chrome滚动条样式" class="headerlink" title="Chrome滚动条样式"></a><code>Chrome</code>滚动条样式</h2><h5 id="CSS滚动条选择器"><a href="#CSS滚动条选择器" class="headerlink" title="CSS滚动条选择器"></a><code>CSS</code>滚动条选择器</h5><ul>
<li><code>::-webkit-scrollbar</code> — 整个滚动条.</li>
<li><code>::-webkit-scrollbar-button</code> — 滚动条上的按钮 (上下箭头).</li>
<li><code>::-webkit-scrollbar-thumb</code> — 滚动条上的滚动滑块.</li>
<li><code>::-webkit-scrollbar-track</code> — 滚动条轨道.</li>
<li><code>::-webkit-scrollbar-track-piece</code> — 滚动条没有滑块的轨道部分.</li>
<li><code>::-webkit-scrollbar-corner</code> — 当同时有垂直滚动条和水平滚动条时交汇的部分.</li>
<li><code>::-webkit-resizer</code> — 某些元素的<code>corner</code>部分的部分样式(例:<code>textarea</code>的可拖动按钮).</li>
</ul>
<span id="more"></span>

<h6 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h6><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 整个滚动条 */</span></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条上的按钮 (上下箭头) */</span></span><br><span class="line">::-webkit-scrollbar-button    &#123;</span><br><span class="line">    <span class="attribute">background-color</span>:blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条轨道 */</span></span><br><span class="line">::-webkit-scrollbar-track     &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条没有滑块的轨道部分 */</span></span><br><span class="line">::-webkit-scrollbar-track-piece &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#ff0000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条上的滚动滑块 */</span></span><br><span class="line">::-webkit-scrollbar-thumb&#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#FFA711</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 当同时有垂直滚动条和水平滚动条时交汇的部分 */</span></span><br><span class="line">::-webkit-scrollbar-corner &#123;</span><br><span class="line">    <span class="attribute">background</span>:green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 某些元素的`corner`部分的部分样式(例:`textarea`的可拖动按钮). */</span></span><br><span class="line">::-webkit-scrollbar-resizer  &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#bf7326</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="demo"><a href="#demo" class="headerlink" title="demo"></a><code>demo</code></h6><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 整个滚动条 */</span></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条上的按钮 (上下箭头) */</span></span><br><span class="line">::-webkit-scrollbar-button    &#123;</span><br><span class="line">    <span class="comment">/* background-color:blue; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条轨道 */</span></span><br><span class="line">::-webkit-scrollbar-track     &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条没有滑块的轨道部分 */</span></span><br><span class="line">::-webkit-scrollbar-track-piece &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 滚动条上的滚动滑块 */</span></span><br><span class="line">::-webkit-scrollbar-thumb&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#999</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 当同时有垂直滚动条和水平滚动条时交汇的部分 */</span></span><br><span class="line">::-webkit-scrollbar-corner &#123;</span><br><span class="line">    <span class="attribute">background</span>:<span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">border-bottom-right-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 某些元素的`corner`部分的部分样式(例:`textarea`的可拖动按钮). */</span></span><br><span class="line">::-webkit-scrollbar-resizer  &#123;</span><br><span class="line">    <span class="comment">/* background:#bf7326; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FireFox滚动条样式"><a href="#FireFox滚动条样式" class="headerlink" title="FireFox滚动条样式"></a><code>FireFox</code>滚动条样式</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Only FireFox */</span></span><br><span class="line">* &#123;   </span><br><span class="line">    <span class="attribute">scrollbar-color</span>: transparent  transparent <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">scrollbar-width</span>: thin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IE滚动条样式"><a href="#IE滚动条样式" class="headerlink" title="IE滚动条样式"></a><code>IE</code>滚动条样式</h2><table>
<thead>
<tr>
<th>Scrollbar Properties 属性</th>
<th>CSS Version 版本</th>
<th>Compatibility 兼容性</th>
<th>Inherit From Parent 继承性</th>
<th>Description 简介</th>
</tr>
</thead>
<tbody><tr>
<td>scrollbar-3d-light-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条亮边框颜色</td>
</tr>
<tr>
<td>scrollbar-highlight-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条3D界面的亮边（ThreedHighlight）颜色</td>
</tr>
<tr>
<td>scrollbar-face-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条3D表面（ThreedFace）的颜色</td>
</tr>
<tr>
<td>scrollbar-arrow-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条方向箭头的颜色</td>
</tr>
<tr>
<td>scrollbar-shadow-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条3D界面的暗边（ThreedShadow）颜色</td>
</tr>
<tr>
<td>scrollbar-dark-shadow-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条暗边框（ThreedDarkShadow）颜色</td>
</tr>
<tr>
<td>scrollbar-base-color</td>
<td>IE专有属性</td>
<td>IE5.5+</td>
<td>有</td>
<td>设置或检索滚动条基准颜色。其它界面颜色将据此自动调整</td>
</tr>
</tbody></table>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">scrollbar-arrow-<span class="attribute">color</span>: color; <span class="comment">/*三角箭头的颜色*/</span></span><br><span class="line">scrollbar-face-<span class="attribute">color</span>: color; <span class="comment">/*立体滚动条的颜色（包括箭头部分的背景色）*/</span></span><br><span class="line">scrollbar-<span class="number">3</span>dlight-<span class="attribute">color</span>: color; <span class="comment">/*立体滚动条亮边的颜色*/</span></span><br><span class="line">scrollbar-highlight-<span class="attribute">color</span>: color; <span class="comment">/*滚动条的高亮颜色（左阴影？）*/</span></span><br><span class="line">scrollbar-shadow-<span class="attribute">color</span>: color; <span class="comment">/*立体滚动条阴影的颜色*/</span></span><br><span class="line">scrollbar-darkshadow-<span class="attribute">color</span>: color; <span class="comment">/*立体滚动条外阴影的颜色*/</span></span><br><span class="line">scrollbar-track-<span class="attribute">color</span>: color; <span class="comment">/*立体滚动条背景颜色*/</span></span><br><span class="line">scrollbar-base-<span class="attribute">color</span>:color; <span class="comment">/*滚动条的基色*/</span></span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/::-webkit-scrollbar"><code>::-webkit-scrollbar</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/scrollbar-width"><code>scrollbar-width firefox</code></a></li>
<li><a href="https://github.com/Aris-t2/CustomCSSforFx/blob/master/classic/config/custom_scrollbar_appearance.css"><code>CustomCSSforFx</code></a></li>
<li><a href="https://www.php.cn/manual/view/14677.html"><code>CSS Scrollbar Properties</code>滚动条属性IE</a></li>
</ol>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>认识gulp</title>
    <url>/2015/12/16/%E8%AE%A4%E8%AF%86gulp/</url>
    <content><![CDATA[<h2 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h2><p>Gulp是基于node.js流的前端自动化构建工具，类似与grunt工具<br>官方网站地址：<a href="http://www.gulpjs.com.cn/">中文</a> 、<a href="http://gulpjs.com/">英文</a>、<a href="https://github.com/gulpjs/gulp">github地址</a></p>
<h3 id="官方指出"><a href="#官方指出" class="headerlink" title="官方指出"></a>官方指出</h3><ul>
<li>易于使用：通过代码优于配置的策略，Gulp 让简单的任务简单，复杂的任务可管理。</li>
<li>构建快速：利用 Node.js 流的威力，你可以快速构建项目并减少频繁的 IO 操作。</li>
<li>插件高质：Gulp 严格的插件指南确保插件如你期望的那样简洁高质得工作。</li>
<li>易于学习：通过最少的 API，掌握 Gulp 毫不费力，构建工作尽在掌握：如同一系列流管道。</li>
</ul>
<span id="more"></span>

<h2 id="Gulp的使用"><a href="#Gulp的使用" class="headerlink" title="Gulp的使用"></a>Gulp的使用</h2><p>目标：编译less文件到css并压缩<br>确保已经安装了node.js</p>
<p>1、全局安装gulp</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --global gulp</span><br></pre></td></tr></table></figure>

<p>2、新建package.json文件,根据命令引导执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<p>3、作为项目的开发依赖（devDependencies）安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install gulp --save-dev</span><br></pre></td></tr></table></figure>

<p>4、项目引用模块安装,执行下面命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//方式一</span><br><span class="line">npm install gulp-less gulp-minify-css gulp-rename  --save-dev</span><br><span class="line"></span><br><span class="line">//方式二</span><br><span class="line">npm install gulp-less --save-dev       //安装gulp-less</span><br><span class="line">npm install gulp-minify-css --save-dev //安装gulp-minify-css</span><br><span class="line">npm install gulp-rename --save-dev     //安装gulp-minify-css</span><br></pre></td></tr></table></figure>

<p>5、在项目根目录下创建一个名为 gulpfile.js 的文件,写入代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//引入模块</span><br><span class="line">var gulp = require(<span class="string">&#x27;gulp&#x27;</span>),</span><br><span class="line">    less = require(<span class="string">&#x27;gulp-less&#x27;</span>),</span><br><span class="line">    minifycss = require(<span class="string">&#x27;gulp-minify-css&#x27;</span>),</span><br><span class="line">    rename = require(<span class="string">&#x27;gulp-rename&#x27;</span>);</span><br><span class="line"></span><br><span class="line">//建立任务</span><br><span class="line">gulp.task(<span class="string">&#x27;testcStyle&#x27;</span>,<span class="function"><span class="title">function</span></span> () &#123; //任务名</span><br><span class="line">    gulp.src(<span class="string">&#x27;src/less/*.less&#x27;</span>) //匹配 任务文件</span><br><span class="line">        .pipe(less()) //编译less</span><br><span class="line">        .pipe(rename(&#123; suffix: <span class="string">&#x27;.min&#x27;</span> &#125;)) //重命名</span><br><span class="line">        .pipe(minifycss())// 压缩</span><br><span class="line">        .pipe(gulp.dest(<span class="string">&#x27;dist/css&#x27;</span>)); //将会在src/css下生成index.min.css</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//监控任务</span><br><span class="line">gulp.task(<span class="string">&#x27;autoWatchTask&#x27;</span>,<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    var watcher = gulp.watch(<span class="string">&#x27;src/less/index.less&#x27;</span>, [<span class="string">&#x27;testStyle&#x27;</span>]);</span><br><span class="line">    watcher.on(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span> (event) &#123;</span><br><span class="line">       console.log(<span class="string">&#x27;event type: &#x27;</span> + event.type); // added, changed, or deleted</span><br><span class="line">       console.log(<span class="string">&#x27;event path: &#x27;</span> + event.path); // The path of the modified file</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">&#x27;default&#x27;</span>,[<span class="string">&#x27;autoWatchTask&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6、执行命令gulp,完了</p>
<h2 id="Gulp-API了解"><a href="#Gulp-API了解" class="headerlink" title="Gulp API了解"></a>Gulp API了解</h2><p>gulp拥有的方法有gulp.task()、gulp.src()、gulp.dest()、gulp.watch()，除gulp.run()现在已被淘汰</p>
<h3 id="gulp-src-globs-options"><a href="#gulp-src-globs-options" class="headerlink" title="gulp.src(globs[, options])"></a>gulp.src(globs[, options])</h3><p>获取匹配的虚拟文件对象流(Vinyl files stream)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">globs：类型(String或Array)</span><br><span class="line">匹配模式，可以匹配文件路径或文件名，多个匹配可为数组</span><br><span class="line"></span><br><span class="line">options: 类型(Object),可选</span><br><span class="line">options.buffer:类型(Boolean 默认值为<span class="literal">true</span>),</span><br><span class="line">options.read:类型(Boolean 默认值<span class="literal">true</span>)</span><br><span class="line">options.base:类型(String)</span><br><span class="line"></span><br><span class="line">example:gulp.src([<span class="string">&#x27;js/*.js&#x27;</span>,<span class="string">&#x27;css/*.css&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="gulp-dest-path-options"><a href="#gulp-dest-path-options" class="headerlink" title="gulp.dest(path[, options])"></a>gulp.dest(path[, options])</h3><p>文件被写入的路径,文件夹不存在，将会自动创建它</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">path: 类型(String或Function)</span><br><span class="line">设置写入文件的路径</span><br><span class="line"></span><br><span class="line">options：类型(Object),可选</span><br><span class="line">options.cwd：类型(String)、默认值(process.cwd())</span><br><span class="line">options.mode：类型(String)、默认值 (0777), 八进制权限字符</span><br></pre></td></tr></table></figure>

<h3 id="gulp-task-name-deps-fn"><a href="#gulp-task-name-deps-fn" class="headerlink" title="gulp.task(name[, deps], fn)"></a>gulp.task(name[, deps], fn)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">定义任务</span><br><span class="line">name: 类型(String),任务名称</span><br><span class="line">deps：类型(Array),任务列表的数组,在当前任务运行之前完成，可选</span><br><span class="line">fn：任务所要执行的一些操作，可选</span><br><span class="line"></span><br><span class="line">example：</span><br><span class="line">gulp.task(<span class="string">&#x27;testTask&#x27;</span>, [<span class="string">&#x27;less&#x27;</span>, <span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;html&#x27;</span>],<span class="keyword">function</span>(callback) &#123;</span><br><span class="line">    //接受一个 callback</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="gulp-watch-glob-opts-tasks-或-gulp-watch-glob-opts-cb"><a href="#gulp-watch-glob-opts-tasks-或-gulp-watch-glob-opts-cb" class="headerlink" title="gulp.watch(glob [, opts], tasks) 或 gulp.watch(glob [, opts, cb])"></a>gulp.watch(glob [, opts], tasks) 或 gulp.watch(glob [, opts, cb])</h3><p>监控文件的变化，当文件一发生变化，就立即执行指定的任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">glob：类型(String或Array)</span><br><span class="line">匹配模式，可以匹配文件路径或文件名，多个匹配可为数组</span><br><span class="line"></span><br><span class="line">opts：类型 (Object),可选</span><br><span class="line">tasks：类型 (Array),文件变化后，要执行的任务</span><br><span class="line">cb(event)：类型(Function),每次变化后需要执行的 callback, event.type-类型(String)、event.path-类型(String)</span><br><span class="line"></span><br><span class="line">example:</span><br><span class="line">gulp.watch(<span class="string">&#x27;js/*.js&#x27;</span>, <span class="keyword">function</span>(event)&#123;</span><br><span class="line">    console.log(event.type); //变化类型 added为新增,deleted为删除，changed为改变</span><br><span class="line">    console.log(event.path); //变化的文件的路径</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><ul>
<li><strong>*</strong>  匹配0或多个字符在一个单一的路径部分</li>
<li>** 匹配路径中的0个或多个目录及其子目录,需要单独出现</li>
<li>{} 匹配多个属性</li>
<li>! 排除文件</li>
<li>?  匹配1个字符</li>
<li>[…] 匹配方括号中出现的任意字符中的一个，当方括号中第一个字符为^或!时，则表示不匹配方括号中出现的其他字符中的任意一个</li>
<li>!(pattern|pattern|pattern)  匹配任何与括号中给定的任一模式都不匹配</li>
<li>?(pattern|pattern|pattern)  匹配括号中给定的任一模式0次或1次</li>
<li>+(pattern|pattern|pattern)  匹配括号中给定的任一模式至少1次</li>
<li><strong>*</strong>(pattern|pattern|pattern)  匹配括号中给定的任一模式0次或多次</li>
</ul>
<h2 id="gulp插件"><a href="#gulp插件" class="headerlink" title="gulp插件"></a>gulp插件</h2><p><strong><a href="https://github.com/gulpjs/plugins/blob/master/src/blackList.json">gulp插件黑名单</a></strong></p>
<ol>
<li>less编译(gulp-less)</li>
<li>css压缩(gulp-minify-css)</li>
<li>js压缩、美化(gulp-uglify)</li>
<li>js错误和潜在问题检查(gulp-jshint)</li>
<li>图片压缩(gulp-imagemin)</li>
<li>合并js(gulp-concat)</li>
<li>压缩html(gulp-htmlmin),可压页面js、css、去除页面空格、注释</li>
<li>css增加前缀(gulp-autoprefixer), 根据设置浏览器版本自动处理浏览器前缀</li>
<li>重命名(gulp-rename)</li>
<li>sass编译(gulp-sass)</li>
<li>自动刷新(gulp-livereload)</li>
<li>清理路径下文件(del)</li>
<li>优化html内的script和stylesheets(gulp-useref)</li>
<li>除错工具将直接显示原始代码(gulp-sourcemaps)</li>
<li>对文件名加MD5后缀(gulp-rev)</li>
<li>路径替换(gulp-rev-collector)</li>
<li>更改提醒(gulp-notify)</li>
<li>只有改变了的图片才会压缩((gulp-cache)</li>
<li>js格式化(gulp-jsfmt)</li>
<li>生成雪碧图(gulp-sprite-generator)</li>
<li>js质量检查(gulp-jslint)</li>
<li>handlebars模版(gulp-handlebars)</li>
<li>字符串替换(gulp-replace)</li>
<li>任务执行顺序(gulp-run-sequence)</li>
<li>途中添加文件夹(gulp-add-src)</li>
<li>动态html&#x2F;替换变量(gulp-template)</li>
<li>include文件(gulp-file-include)</li>
<li>条件切换(gulp-if)</li>
<li>自定义辅助工具(gulp-util)</li>
<li>恢复路径(gulp-revert-path)</li>
<li>有变化的才操作，没变化的就跳过，可进一步优化效率(gulp-changed)</li>
<li>任务发生错误不中断继续执行(gulp-plumber)</li>
<li>打包压缩(gulp-zip)</li>
<li>requirejs合并(gulp-requirejs-optimize)</li>
</ol>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>语义化版本2.0.0</title>
    <url>/2016/11/06/%E8%AF%AD%E4%B9%89%E5%8C%96%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>本文以下所有内容来源：</strong><a href="http://semver.org/lang/zh-CN/spec/v2.0.0.html">http://semver.org/lang/zh-CN/spec/v2.0.0.html</a></p>
<p>官网地址：<a href="http://semver.org/">http://semver.org/</a><br>github地址：<a href="https://github.com/mojombo/semver">https://github.com/mojombo/semver</a></p>
<p>语义化版本控制规范是由 Gravatars 创办者兼 GitHub 共同创办者 Tom Preston-Werner 所建立。</p>
<span id="more"></span>

<h3 id="语义化版本-2-0-0"><a href="#语义化版本-2-0-0" class="headerlink" title="语义化版本 2.0.0"></a>语义化版本 2.0.0</h3><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>版本格式：主版本号.次版本号.修订号，版本号递增规则如下：</p>
<ol>
<li>主版本号：当你做了不兼容的 API 修改，</li>
<li>次版本号：当你做了向下兼容的功能性新增，</li>
<li>修订号：当你做了向下兼容的问题修正。</li>
</ol>
<p>先行版本号及版本编译信息可以加到“主版本号.次版本号.修订号”的后面，作为延伸。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在软件管理的领域里存在着被称作“依赖地狱”的死亡之谷，系统规模越大，加入的套件越多，你就越有可能在未来的某一天发现自己已深陷绝望之中。</p>
<p>在依赖高的系统中发布新版本套件可能很快会成为恶梦。如果依赖关系过高，可能面临版本控制被锁死的风险（必须对每一个相依套件改版才能完成某次升级）。而如果依赖关系过于松散，又将无法避免版本的混乱（假设兼容于未来的多个版本已超出了合理数量）。当你专案的进展因为版本相依被锁死或版本混乱变得不够简便和可靠，就意味着你正处于依赖地狱之中。</p>
<p>作为这个问题的解决方案之一，我提议用一组简单的规则及条件来约束版本号的配置和增长。这些规则是根据（但不局限于）已经被各种封闭、开放源码软件所广泛使用的惯例所设计。为了让这套理论运作，你必须先有定义好的公共 API。这可以透过文件定义或代码强制要求来实现。无论如何，这套 API 的清楚明了是十分重要的。一旦你定义了公共 API，你就可以透过修改相应的版本号来向大家说明你的修改。考虑使用这样的版本号格式：X.Y.Z（主版本号.次版本号.修订号）修复问题但不影响 API 时，递增修订号；API 保持向下兼容的新增及修改时，递增次版本号；进行不向下兼容的修改时，递增主版本号。</p>
<p>我称这套系统为“语义化的版本控制”，在这套约定下，版本号及其更新方式包含了相邻版本间的底层代码和修改内容的信息。</p>
<h3 id="语义化版本控制规范（SemVer）"><a href="#语义化版本控制规范（SemVer）" class="headerlink" title="语义化版本控制规范（SemVer）"></a>语义化版本控制规范（SemVer）</h3><p>以下关键词 MUST、MUST NOT、REQUIRED、SHALL、SHALL NOT、SHOULD、SHOULD NOT、 RECOMMENDED、MAY、OPTIONAL 依照 RFC 2119 的叙述解读。（译注：为了保持语句顺畅， 以下文件遇到的关键词将依照整句语义进行翻译，在此先不进行个别翻译。）</p>
<ol>
<li><p>使用语义化版本控制的软件“必须 MUST ”定义公共 API。该 API 可以在代码中被定义或出现于严谨的文件内。无论何种形式都应该力求精确且完整。</p>
</li>
<li><p>标准的版本号“必须 MUST ”采用 XYZ 的格式，其中 X、Y 和 Z 为非负的整数，且“禁止 MUST NOT”在数字前方补零。X 是主版本号、Y 是次版本号、而 Z 为修订号。每个元素“必须 MUST ”以数值来递增。例如：1.9.1 -&gt; 1.10.0 -&gt; 1.11.0。</p>
</li>
<li><p>标记版本号的软件发行后，“禁止 MUST NOT ”改变该版本软件的内容。任何修改都“必须 MUST ”以新版本发行。</p>
</li>
<li><p>主版本号为零（0.y.z）的软件处于开发初始阶段，一切都可能随时被改变。这样的公共 API 不应该被视为稳定版。</p>
</li>
<li><p>1.0.0 的版本号用于界定公共 API 的形成。这一版本之后所有的版本号更新都基于公共 API 及其修改内容。</p>
</li>
<li><p>修订号 Z（x.y.Z <code>|</code> x &gt; 0）“必须 MUST ”在只做了向下兼容的修正时才递增。这里的修正指的是针对不正确结果而进行的内部修改。</p>
</li>
<li><p>次版本号 Y（x.Y.z <code>|</code> x &gt; 0）“必须 MUST ”在有向下兼容的新功能出现时递增。在任何公共 API 的功能被标记为弃用时也“必须 MUST ”递增。也“可以 MAY ”在内部程序有大量新功能或改进被加入时递增，其中“可以 MAY ”包括修订级别的改变。每当次版本号递增时，修订号“必须 MUST ”归零。</p>
</li>
<li><p>主版本号 X（X.y.z <code>|</code> X &gt; 0）“必须 MUST ”在有任何不兼容的修改被加入公共 API 时递增。其中“可以 MAY ”包括次版本号及修订级别的改变。每当主版本号递增时，次版本号和修订号“必须 MUST ”归零。</p>
</li>
<li><p>先行版本号“可以 MAY ”被标注在修订版之后，先加上一个连接号再加上一连串以句点分隔的标识符号来修饰。标识符号“必须 MUST ”由 ASCII 码的英数字和连接号 [0-9A-Za-z-] 组成，且“禁止 MUST NOT ”留白。数字型的标识符号“禁止 MUST NOT ”在前方补零。先行版的优先级低于相关联的标准版本。被标上先行版本号则表示这个版本并非稳定而且可能无法达到兼容的需求。范例：1.0.0-alpha、1.0.0-alpha.1、1.0.0-0.3.7、1.0.0-x.7.z.92。</p>
</li>
<li><p>版本编译信息“可以 MAY ”被标注在修订版或先行版本号之后，先加上一个加号再加上一连串以句点分隔的标识符号来修饰。标识符号“必须 MUST ”由 ASCII 的英数字和连接号 [0-9A-Za-z-] 组成，且“禁止 MUST NOT ”留白。当判断版本的优先层级时，版本编译信息“可 SHOULD ”被忽略。因此当两个版本只有在版本编译信息有差别时，属于相同的优先层级。范例：1.0.0-alpha+001、1.0.0+20130313144700、1.0.0-beta+exp.sha.5114f85。</p>
</li>
<li><p>版本的优先层级指的是不同版本在排序时如何比较。判断优先层级时，“必须 MUST ”把版本依序拆分为主版本号、次版本号、修订号及先行版本号后进行比较（版本编译信息不在这份比较的列表中）。由左到右依序比较每个标识符号，第一个差异值用来决定优先层级：主版本号、次版本号及修订号以数值比较，例如：1.0.0 &lt; 2.0.0 &lt; 2.1.0 &lt; 2.1.1。当主版本号、次版本号及修订号都相同时，改以优先层级比较低的先行版本号决定。例如：1.0.0-alpha &lt; 1.0.0。有相同主版本号、次版本号及修订号的两个先行版本号，其优先层级“必须 MUST ”透过由左到右的每个被句点分隔的标识符号来比较，直到找到一个差异值后决定：只有数字的标识符号以数值高低比较，有字母或连接号时则逐字以 ASCII 的排序来比较。数字的标识符号比非数字的标识符号优先层级低。若开头的标识符号都相同时，栏位比较多的先行版本号优先层级比较高。范例：1.0.0-alpha &lt; 1.0.0-alpha.1 &lt; 1.0.0-alpha.beta &lt; 1.0.0-beta &lt; 1.0.0-beta.2 &lt; 1.0.0-beta.11 &lt; 1.0.0- rc.1 &lt; 1.0.0。</p>
</li>
</ol>
<h3 id="为什么要使用语义化的版本控制？"><a href="#为什么要使用语义化的版本控制？" class="headerlink" title="为什么要使用语义化的版本控制？"></a>为什么要使用语义化的版本控制？</h3><p>这并不是一个新的或者革命性的想法。实际上，你可能已经在做一些近似的事情了。问题在于只是“近似”还不够。如果没有某个正式的规范可循，版本号对于依赖的管理并无实质意义。将上述的想法命名并给予清楚的定义，让你对软件使用者传达意向变得容易。一旦这些意向变得清楚，弹性（但又不会太弹性）的依赖规范就能达成。</p>
<p>举个简单的例子就可以展示语义化的版本控制如何让依赖地狱成为过去。假设有个名为“救火车”的函式库，它需要另一个名为“梯子”并已经有使用语义化版本控制的套件。当救火车创建时，梯子的版本号为 3.1.0。因为救火车使用了一些版本 3.1.0 所新增的功能， 你可以放心地指定相依于梯子的版本号大等于 3.1.0 但小于 4.0.0。这样，当梯子版本 3.1.1 和 3.2.0 发布时，你可以将直接它们纳入你的套件管理系统，因为它们能与原有相依的软件兼容。</p>
<p>作为一位负责任的开发者，你理当确保每次套件升级的运作与版本号的表述一致。现实世界是复杂的，我们除了提高警觉外能做的不多。你所能做的就是让语义化的版本控制为你提供一个健全的方式来发行以及升级套件，而无需推出新的相依套件，节省你的时间及烦恼。</p>
<p>如果你对此认同，希望立即开始使用语义化版本控制，你只需声明你的函式库正在使用它并遵循这些规则就可以了。请在你的 README 文件中保留此页连结，让别人也知道这些规则并从中受益。</p>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><h4 id="在-0-y-z-初始开发阶段，我该如何进行版本控制？"><a href="#在-0-y-z-初始开发阶段，我该如何进行版本控制？" class="headerlink" title="在 0.y.z 初始开发阶段，我该如何进行版本控制？"></a>在 0.y.z 初始开发阶段，我该如何进行版本控制？</h4><p>最简单的做法是以 0.1.0 作为你的初始化开发版本，并在后续的每次发行时递增次版本号。</p>
<h4 id="如何判断发布-1-0-0-版本的时机？"><a href="#如何判断发布-1-0-0-版本的时机？" class="headerlink" title="如何判断发布 1.0.0 版本的时机？"></a>如何判断发布 1.0.0 版本的时机？</h4><p>当你的软件被用于正式环境，它应该已经达到了 1.0.0 版。如果你已经有个稳定的 API 被使用者依赖，也会是 1.0.0 版。如果你很担心向下兼容的问题，也应该算是 1.0.0 版了。</p>
<h4 id="这不会阻碍快速开发和迭代吗？"><a href="#这不会阻碍快速开发和迭代吗？" class="headerlink" title="这不会阻碍快速开发和迭代吗？"></a>这不会阻碍快速开发和迭代吗？</h4><p>主版本号为零的时候就是为了做快速开发。如果你每天都在改变 API，那么你应该仍在主版本号为零的阶段（0.y.z），或是正在下个主版本的独立开发分支中。</p>
<h4 id="对于公共-API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到-42-0-0-版？"><a href="#对于公共-API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到-42-0-0-版？" class="headerlink" title="对于公共 API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到 42.0.0 版？"></a>对于公共 API，若即使是最小但不向下兼容的改变都需要产生新的主版本号，岂不是很快就达到 42.0.0 版？</h4><p>这是开发的责任感和前瞻性的问题。不兼容的改变不应该轻易被加入到有许多依赖代码的软件中。升级所付出的代价可能是巨大的。要递增主版本号来发行不兼容的改版，意味着你必须为这些改变所带来的影响深思熟虑，并且评估所涉及的成本及效益比。</p>
<h4 id="为整个公共-API-写文件太费事了！"><a href="#为整个公共-API-写文件太费事了！" class="headerlink" title="为整个公共 API 写文件太费事了！"></a>为整个公共 API 写文件太费事了！</h4><p>为供他人使用的软件编写适当的文件，是你作为一名专业开发者应尽的职责。保持专案高效一个非常重要的部份是掌控软件的复杂度，如果没有人知道如何使用你的软件或不知道哪些函数的调用是可靠的，要掌控复杂度会是困难的。长远来看，使用语义化版本控制以及对于公共 API 有良好规范的坚持，可以让每个人及每件事都运行顺畅。</p>
<h4 id="万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？"><a href="#万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？" class="headerlink" title="万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？"></a>万一不小心把一个不兼容的改版当成了次版本号发行了该怎么办？</h4><p>一旦发现自己破坏了语义化版本控制的规范，就要修正这个问题，并发行一个新的次版本号来更正这个问题并且恢复向下兼容。即使是这种情况，也不能去修改已发行的版本。可以的话，将有问题的版本号记录到文件中，告诉使用者问题所在，让他们能够意识到这是有问题的版本。</p>
<h4 id="如果我更新了自己的依赖但没有改变公共-API-该怎么办？"><a href="#如果我更新了自己的依赖但没有改变公共-API-该怎么办？" class="headerlink" title="如果我更新了自己的依赖但没有改变公共 API 该怎么办？"></a>如果我更新了自己的依赖但没有改变公共 API 该怎么办？</h4><p>由于没有影响到公共 API，这可以被认定是兼容的。若某个软件和你的套件有共同依赖，则它会有自己的依赖规范，作者也会告知可能的冲突。要判断改版是属于修订等级或是次版等级，是依据你更新的依赖关系是为了修复问题或是加入新功能。对于后者，我经常会预期伴随着更多的代码，这显然会是一个次版本号级别的递增。</p>
<h4 id="如果我变更了公共-API-但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）"><a href="#如果我变更了公共-API-但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）" class="headerlink" title="如果我变更了公共 API 但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）"></a>如果我变更了公共 API 但无意中未遵循版本号的改动怎么办呢？（意即在修订等级的发布中，误将重大且不兼容的改变加到代码之中）</h4><p>自行做最佳的判断。如果你有庞大的使用者群在依照公共 API 的意图而变更行为后会大受影响，那么最好做一次主版本的发布，即使严格来说这个修复仅是修订等级的发布。记住， 语义化的版本控制就是透过版本号的改变来传达意义。若这些改变对你的使用者是重要的，那就透过版本号来向他们说明。</p>
<h4 id="我该如何处理即将弃用的功能？"><a href="#我该如何处理即将弃用的功能？" class="headerlink" title="我该如何处理即将弃用的功能？"></a>我该如何处理即将弃用的功能？</h4><p>弃用现存的功能是软件开发中的家常便饭，也通常是向前发展所必须的。当你弃用部份公共 API 时，你应该做两件事：（1）更新你的文件让使用者知道这个改变，（2）在适当的时机将弃用的功能透过新的次版本号发布。在新的主版本完全移除弃用功能前，至少要有一个次版本包含这个弃用信息，这样使用者才能平顺地转移到新版 API。</p>
<h4 id="语义化版本对于版本的字串长度是否有限制呢？"><a href="#语义化版本对于版本的字串长度是否有限制呢？" class="headerlink" title="语义化版本对于版本的字串长度是否有限制呢？"></a>语义化版本对于版本的字串长度是否有限制呢？</h4><p>没有，请自行做适当的判断。举例来说，长到 255 个字元的版本已过度夸张。再者，特定的系统对于字串长度可能会有他们自己的限制。</p>
<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><p>语义化版本控制的规范是由 Gravatars 创办者兼 GitHub 共同创办者 <a href="http://tom.preston-werner.com/">Tom Preston-Werner</a> 所建立。</p>
<p>如果您有任何建议，请到 <a href="https://github.com/mojombo/semver/issues">GitHub 上提出您的问题</a>。</p>
<h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><p>创用 CC 姓名标示 3.0 Unported 授权条款 <a href="http://creativecommons.org/licenses/by/3.0/">http://creativecommons.org/licenses/by/3.0/</a></p>
]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>常识</tag>
      </tags>
  </entry>
  <entry>
    <title>重绘[repaints]/回流[reflows]</title>
    <url>/2015/08/31/%E9%87%8D%E7%BB%98(repaints)%E5%9B%9E%E6%B5%81(reflows)/</url>
    <content><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>为了提高页面性能,因为重排的消耗较大而且直接影响用户界面，它们将会给响应式网站以及 web APP 造成较大的影响。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><h3 id="重绘-repaints"><a href="#重绘-repaints" class="headerlink" title="重绘[repaints]"></a>重绘[repaints]</h3><p>重绘是指元素外观的改变所触发的浏览器行为,例如，color&#x2F;visibility&#x2F;outline&#x2F;background-color。等属性引起的元素外观的改变。</p>
<h3 id="回流-reflows"><a href="#回流-reflows" class="headerlink" title="回流[reflows]"></a>回流[reflows]</h3><p>回流又叫重排,是指浏览器计算页面的全部或部分布局所做的处理。调整浏览器窗口大小，使用伪类（比如 :hover），以及使用JavaScript 操作DOM，影响到页面布局事件的发生，就会导致重排。</p>
<h3 id="同步重排-synchronous-reflows"><a href="#同步重排-synchronous-reflows" class="headerlink" title="同步重排[synchronous reflows]"></a>同步重排[synchronous reflows]</h3><p>Web 控制台可以通过记录重排事件来显示出这个重排消耗的时间，如果是由 JavaScript 触发的重排，这个时间是指同步重排（synchronous reflows）时消耗的时间。</p>
<span id="more"></span>

<h2 id="重排的原因"><a href="#重排的原因" class="headerlink" title="重排的原因"></a>重排的原因</h2><ul>
<li>调整窗口大小</li>
<li>字体的大小</li>
<li>触发元素的伪类(:hover)</li>
<li>dom元素的增加、删除，大小改变</li>
<li>其他的改动scrollTop、scrollLeft、offsetWidth等的值</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>避免使用css的JavaScript表达式(仅IE浏览器)</li>
<li>应用元素的动画，使用 position 属性的 fixed 值或 absolute 值。<br>因为它们已经脱离了正常文档流，动画效果应用到它们的元素上，不影响其他元素的布局，所它他们只会导致重新绘制，而不是一个完整回流。消耗会低一些。</li>
<li>避免使用table布局，<br>表格中某一个单元格内容过宽，而引起其他列大小的改变，就会使布局发生改变，而引起其他节点的重排</li>
<li>牺牲平滑度<br>Opera建议牺牲平滑度换取速度，每次1像素移动一个动画，但此动画及随后的回流使用了100%的CPU，动画就会看上去是跳动的，因为浏览器正在与更新回流做斗争，动画元素每次移动3像素可能在非常快的机器上看起来平滑度低了，但它不会导致CPU在较慢的机器和移动设备中抖动。</li>
<li>改变元素的class名，修改元素样式，如下<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">.normal&#123;width:300px;height:200px;font-size:14px;&#125;</span><br><span class="line">.change&#123;background:red;border:5px solid grey;height:300px;font-size:20px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;box&quot;</span> class=<span class="string">&quot;normal&quot;</span>&gt;盒子&lt;/div&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	document.getElementById(<span class="string">&#x27;box&#x27;</span>).className = <span class="string">&#x27;normal change&#x27;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li>避免设置多项内联样式,DOM交互是很慢,交替的修改和读取一个正在被操作元素的样式，每当你在读取前一次修改的样式时都会强制执行了同步重排.尽量不要出现类似如下的写法(推荐5):<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="built_in">id</span>=<span class="string">&quot;box&quot;</span> class=<span class="string">&quot;normal&quot;</span>&gt;盒子&lt;/div&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	var box = document.getElementById(<span class="string">&#x27;box&#x27;</span>);</span><br><span class="line">	box.style.background = <span class="string">&#x27;red&#x27;</span>;</span><br><span class="line">	box.style.border = <span class="string">&#x27;5px solid grey&#x27;</span>;</span><br><span class="line">	box.style.height = <span class="string">&#x27;300px&#x27;</span>;</span><br><span class="line">	box.style.fontSize = <span class="string">&#x27;20px&#x27;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li>尽可能在DOM树的里面改变class，可限制回流的范围，使其影响尽可能少的节点。</li>
</ol>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><p>重绘可能引发回流,回流必定引发重绘</p>
<h2 id="FireFox-火狐浏览器"><a href="#FireFox-火狐浏览器" class="headerlink" title="FireFox(火狐浏览器)"></a>FireFox(火狐浏览器)</h2><img src="/2015/08/31/%E9%87%8D%E7%BB%98(repaints)%E5%9B%9E%E6%B5%81(reflows)/reflow.png" class="" title="火狐浏览器">

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://www.zhangxinxu.com/wordpress/2010/01/%E5%9B%9E%E6%B5%81%E4%B8%8E%E9%87%8D%E7%BB%98%EF%BC%9Acss%E6%80%A7%E8%83%BD%E8%AE%A9javascript%E5%8F%98%E6%85%A2%EF%BC%9F/">回流与重绘-张鑫旭</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>闪过的ajax</title>
    <url>/2016/04/10/%E9%97%AA%E8%BF%87%E7%9A%84ajax/</url>
    <content><![CDATA[<h2 id="引出"><a href="#引出" class="headerlink" title="引出"></a>引出</h2><p>今天在看帖子的时候闪过，就想到了ajax，这个用原生js怎么写呢？<br>以前也不会写，当时就学习，最后还查资料。反复练习了的，再之后就用了jQuery,<br>然后就没用原生js写过了。</p>
<h2 id="开始简单回忆"><a href="#开始简单回忆" class="headerlink" title="开始简单回忆"></a>开始简单回忆</h2><p>AJAX &#x3D; Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）—w3school</p>
<p><strong>百度一下，真多…</strong></p>
<span id="more"></span>

<h2 id="创建XMLHttpRequest对象"><a href="#创建XMLHttpRequest对象" class="headerlink" title="创建XMLHttpRequest对象"></a>创建XMLHttpRequest对象</h2><p>所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">createXHR</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(window.XMLHttpRequest)&#123;</span><br><span class="line">        <span class="built_in">return</span> new XMLHttpRequest();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(window.ActiveXObject)&#123;</span><br><span class="line">        //以前写还真没注意有这么多版本</span><br><span class="line">        var version = [</span><br><span class="line">            <span class="string">&quot;MSXML2.XMLHttp.6.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MSXML2.XMLHttp.3.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MSXML2.XMLHttp&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span>(var i=1;i&lt;version.length;i++)&#123;</span><br><span class="line">            try&#123;</span><br><span class="line">                <span class="built_in">return</span> new ActiveXObject(version[i]);</span><br><span class="line">            &#125;catch(e)&#123;</span><br><span class="line">                console.log(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        throw new Error(<span class="string">&quot;浏览器不支持XHR对象！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//有抄码嫌疑，重点是-理解与会，这是第一步，最后返回XHR</span><br></pre></td></tr></table></figure>

<h2 id="注册回调函数"><a href="#注册回调函数" class="headerlink" title="注册回调函数"></a>注册回调函数</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var xhr = createXHR();</span><br><span class="line">xhr.onreadystatechange = callback;</span><br></pre></td></tr></table></figure>

<h2 id="设置和服务器交互的信息"><a href="#设置和服务器交互的信息" class="headerlink" title="设置和服务器交互的信息"></a>设置和服务器交互的信息</h2><p>先来看下边一张图</p>
<img src="/2016/04/10/%E9%97%AA%E8%BF%87%E7%9A%84ajax/way.png" class="" title="xhr方法">

<p>默认是同步(false)；<br>jQuery中的默认异步(true)；</p>
<h3 id="GET交互"><a href="#GET交互" class="headerlink" title="GET交互"></a>GET交互</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var username = document.getElementById(<span class="string">&quot;userName&quot;</span>).value;</span><br><span class="line">xhr.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;XMLHttpRequest.php?username=&quot;</span> + username, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="POST交互"><a href="#POST交互" class="headerlink" title="POST交互"></a>POST交互</h3><p>encodeURIComponent() 函数将转义用于分隔 URI 各个部分的标点符号</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var username = document.getElementById(<span class="string">&quot;userName&quot;</span>).value;</span><br><span class="line">var args = <span class="string">&quot;username=&quot;</span> + encodeURIComponent(username);</span><br><span class="line">xhr.open(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;XMLHttpRequest.php&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h2 id="发送数据，开始和服务器端进行交互"><a href="#发送数据，开始和服务器端进行交互" class="headerlink" title="发送数据，开始和服务器端进行交互"></a>发送数据，开始和服务器端进行交互</h2><img src="/2016/04/10/%E9%97%AA%E8%BF%87%E7%9A%84ajax/set_header.png" class="" title="设置请求头">

<h3 id="GET方式"><a href="#GET方式" class="headerlink" title="GET方式"></a>GET方式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xhr.send(null);</span><br></pre></td></tr></table></figure>

<h3 id="post方式"><a href="#post方式" class="headerlink" title="post方式"></a>post方式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xhr.setRequestHeader(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">xhr.send(args);</span><br></pre></td></tr></table></figure>

<h2 id="判断和服务器交互是否完成，是否正确返回数据"><a href="#判断和服务器交互是否完成，是否正确返回数据" class="headerlink" title="判断和服务器交互是否完成，是否正确返回数据"></a>判断和服务器交互是否完成，是否正确返回数据</h2><p>readyState属性：</p>
<p>0：请求未初始化，open还没有调用<br>1：请求连接已建立，open已经调用<br>2：请求已接收，也就是接收到头信息了<br>3：请求处理中，也就是接收到响应主体了<br>4：请求已完成，且响应已就绪。</p>
<p>xhr.statusText：服务器返回的状态文本。<br>xhr.responseText：返回纯文本<br>xhr.responseXML： 返回XML</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">callback</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === 4 &amp;&amp; xhr.status === 200) &#123;  </span><br><span class="line">        console.log(xhr.responseText);    </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>写到这里了，清楚多了，再来一段POST代码,或许更清晰，共5个步骤。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var xhr = createXHR();//调用上边的方法</span><br><span class="line">xhr.open(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;/XMLHttpRequest.php&quot;</span>);</span><br><span class="line">var data = <span class="string">&quot;username=&quot;</span> + document.getElementById(<span class="string">&quot;username&quot;</span>).value</span><br><span class="line">            + <span class="string">&quot;&amp;code=&quot;</span> + document.getElementById(<span class="string">&quot;code&quot;</span>).value;</span><br><span class="line">xhr.setRequestHeader(<span class="string">&quot;Content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">xhr.send(data);</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === 4 &amp;&amp; xhr.status === 200) &#123;  </span><br><span class="line">        console.log(xhr.responseText);    </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>面向对象-继承</title>
    <url>/2018/04/07/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E7%BB%A7%E6%89%BF/</url>
    <content><![CDATA[<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p><code>JavaScript</code>主要通过原型链实现继承。原型链的构建是通过将一个类型的实例赋值给另一个构造函数的原型实现的</p>
<h3 id="内部指针-proto"><a href="#内部指针-proto" class="headerlink" title="内部指针__proto__"></a>内部指针<code>__proto__</code></h3><ol>
<li>遵循ECMAScript标准，<code>someObject.[[Prototype]]</code> 符号是用于指向 <code>someObject</code>的原型;</li>
<li>这个等同于 <code>JavaScript</code> 的非标准但许多浏览器实现的属性 <code>__proto__</code>;</li>
<li>从 ECMAScript 6 开始，<code>[[Prototype]]</code> 可以通过<code>Object.getPrototypeOf()</code>和<code>Object.setPrototypeOf()</code>访问器来访问;</li>
<li>但它不应该与构造函数 <code>func</code> 的 <code>prototype</code> 属性相混淆</li>
<li>被构造函数创建的实例对象的 <code>[[prototype]]</code> 指向 <code>func</code> 的 <code>prototype</code> 属性。</li>
<li><code>Object.prototype</code> 属性表示<code>Object</code>的原型对象。</li>
</ol>
<span id="more"></span>

<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p><img src="http://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180402215543.png" alt="image"></p>
<p>JavaScript 对象有一个私有属性（称之为 <code>[[Prototype]]</code>）,它指向它的 原型对象（<code>prototype</code>）;</p>
<p>该 <code>prototype</code>对象 又具有一个自己的 <code>prototype</code>,层层向上直到一个对象的原型为 <code>null</code>,</p>
<p>根据定义，<code>null</code> 没有原型，并作为这个原型链中的最后一个环节</p>
<h2 id="两种继承方式"><a href="#两种继承方式" class="headerlink" title="两种继承方式"></a>两种继承方式</h2><ul>
<li>接口继承:只继承方法签名(由于函数没有签名，<code>ECMAScript</code>无法实现此继承)</li>
<li>实现继承:继承实际方法(ECMAScript只支持实现继承)</li>
</ul>
<h3 id="实现继承的方法"><a href="#实现继承的方法" class="headerlink" title="实现继承的方法"></a>实现继承的方法</h3><p>将原型链作为实现继承的方法。</p>
<p>基本思想：利用原型让一个引用类型继承另一个引用类型的属性和方法</p>
<h3 id="JavaScript中的类-class-继承"><a href="#JavaScript中的类-class-继承" class="headerlink" title="JavaScript中的类(class)继承"></a>JavaScript中的类(class)继承</h3><ol>
<li>构造函数内的,这是供实例化对象复制用的</li>
<li>构造函数外的，直接通过点语法添加的，这是供类使用，实例化对象是访问不到的</li>
<li>类的原型中，实例化对象可以通过其原型链间接访问到，也是为供所有实例化对象所共用的</li>
</ol>
<h2 id="类式继承-子类的原型对象"><a href="#类式继承-子类的原型对象" class="headerlink" title="类式继承(子类的原型对象)"></a>类式继承(子类的原型对象)</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuperClass</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">supperValue</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">books</span> = [<span class="string">&quot;大数据&quot;</span>,<span class="string">&quot;人工智能&quot;</span>,<span class="string">&quot;区块链&quot;</span>,<span class="string">&quot;Kubernetes&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为父类添加共有方法</span></span><br><span class="line"><span class="title class_">SuperClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSuperValue</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">supperValue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubClass</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subValue</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承父类</span></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperClass</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//为子类添加共有方法</span></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSubValue</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">subValue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************测试代码****************************************/</span></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubClass</span>();</span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubClass</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">books</span>);<span class="comment">//[&quot;大数据,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;]</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="property">books</span>.<span class="title function_">push</span>(<span class="string">&quot;Docker&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">books</span>);<span class="comment">//[&quot;大数据&quot;,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;,&quot;Docker&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li><code>instance1</code>的修改伤害了<code>instance2</code>的<code>books</code>属性</li>
<li>创建父类的时候，无法向父类传参数，，也因此无法对父类的构造函数内的属性进行初始化</li>
</ol>
<h2 id="构造函数继承"><a href="#构造函数继承" class="headerlink" title="构造函数继承"></a>构造函数继承</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuperClass</span>(<span class="params">id</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">books</span> = [<span class="string">&quot;大数据&quot;</span>,<span class="string">&quot;人工智能&quot;</span>,<span class="string">&quot;区块链&quot;</span>,<span class="string">&quot;Kubernetes&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为父类添加共有方法</span></span><br><span class="line"><span class="title class_">SuperClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getBooks</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">books</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubClass</span>(<span class="params">id</span>)&#123;</span><br><span class="line">  <span class="comment">//继承父类</span></span><br><span class="line">  <span class="title class_">SuperClass</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**************************************测试代码********************************/</span></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">instance1.<span class="property">books</span>.<span class="title function_">push</span>(<span class="string">&quot;Docker&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">books</span>);<span class="comment">//[&quot;大数据&quot;,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;,&quot;Docker&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">id</span>);<span class="comment">//10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">books</span>);<span class="comment">//[&quot;大数据,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">id</span>);<span class="comment">//20</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="title function_">getBooks</span>();<span class="comment">//Uncaught TypeError: instance1.getBooks is not a function</span></span><br></pre></td></tr></table></figure>

<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>这种类型的继承没有涉及原型<code>prototype</code>,所以父类的原型方法不会被继承</li>
<li>如果想要被子类继承，就必须放在构造函数中，这样创建出来的每个实例都会单独拥有一份，而不能共用。违背了代码复用原则。</li>
</ol>
<h2 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h2><p>类式继承同构造函数继承组合使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuperClass</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">books</span> = [<span class="string">&quot;大数据&quot;</span>,<span class="string">&quot;人工智能&quot;</span>,<span class="string">&quot;区块链&quot;</span>,<span class="string">&quot;Kubernetes&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为父类添加共有方法</span></span><br><span class="line"><span class="title class_">SuperClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubClass</span>(<span class="params">name,time</span>)&#123;</span><br><span class="line">  <span class="comment">//继承父类</span></span><br><span class="line">  <span class="title class_">SuperClass</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">time</span> = time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//类式继承，子类原型继承父类</span></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">SuperClass</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//为子类添加共有方法</span></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getTime</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">time</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="string">&quot;软件工程&quot;</span>,<span class="number">2014</span>);</span><br><span class="line">instance1.<span class="property">books</span>.<span class="title function_">push</span>(<span class="string">&quot;Docker&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">books</span>);<span class="comment">//[&quot;大数据&quot;,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;,&quot;Docker&quot;]</span></span><br><span class="line">instance1.<span class="title function_">getName</span>();<span class="comment">//软件工程</span></span><br><span class="line">instance1.<span class="title function_">getTime</span>();<span class="comment">//2014</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="string">&quot;计算机与科学技术&quot;</span>,<span class="number">2015</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">books</span>);<span class="comment">//[&quot;大数据,&quot;人工智能&quot;,&quot;区块链&quot;,&quot;Kubernetes&quot;]</span></span><br><span class="line">instance2.<span class="title function_">getName</span>();<span class="comment">//计算机与科学技术</span></span><br><span class="line">instance2.<span class="title function_">getTime</span>();<span class="comment">//2015</span></span><br></pre></td></tr></table></figure>

<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>子类的实例中更改父类继承下来的引用类型，不会影响其他实例</li>
<li>子类实例化过程又能将参传递到父类的构造函数</li>
</ol>
<h3 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>使用构造函数继承时执行了一遍父类构的造函数，而实现子类原型的类式继承时又调用了一遍父类构造函数。因此构造函数调用了两遍</li>
</ol>
<h2 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h2><ol>
<li><p>要求必须有一个对象可以作为另一个对象的基础</p>
</li>
<li><p>本质是对传入的对象执行了一次浅复制</p>
</li>
<li><p>是对类式继承的封装，类式继承中的问题在这里也会出现。</p>
</li>
<li><p>其中的过度对象就相当于类式继承中的子类，在这里作为一个对象出现</p>
</li>
<li><p>目的为了创建要返回的新实例化对象</p>
</li>
<li><p><code>ES5</code>的<code>Object.create()</code>的方法规范了化了原型式继承</p>
</li>
<li><p>在传入一个参数的情况下与<code>ES5</code>的<code>Object.create()</code>与<code>inheritObject</code>方法行为类似</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//原型式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritObject</span>(<span class="params">o</span>)&#123;</span><br><span class="line">  <span class="comment">//声明过度函数对象</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">  <span class="comment">//过度对象的原型继承父对象</span></span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="comment">//返回过渡对象的一个实例，该实例的原型继承了父对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="attr">alikeBook</span>:[<span class="string">&quot;C语言&quot;</span>,<span class="string">&quot;c++程序设计&quot;</span>,<span class="string">&quot;java程序设计&quot;</span>,<span class="string">&quot;数据结构&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="title function_">inheritObject</span>(book);</span><br><span class="line">person1.<span class="property">name</span> = <span class="string">&quot;小刚&quot;</span>;</span><br><span class="line">person1.<span class="property">alikeBook</span>.<span class="title function_">push</span>(<span class="string">&quot;sql server数据库&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="title function_">inheritObject</span>(book);</span><br><span class="line">person2.<span class="property">name</span> = <span class="string">&quot;小花&quot;</span>;</span><br><span class="line">person2.<span class="property">alikeBook</span>.<span class="title function_">push</span>(<span class="string">&quot;Android程序开发&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">name</span>);<span class="comment">//小刚</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2.<span class="property">name</span>);<span class="comment">//小花</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">name</span>);<span class="comment">//小明</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>类式继承中的问题在这里出现，引用类型的属性被共用</li>
</ol>
<h2 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h2><ul>
<li>寄生式继承是对原型式继承的第二次封装，第二次对继承对象进行拓展</li>
<li>创建的对象不仅仅有父类的属性和方法，而且还添加新的属性和方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//原型式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritObject</span>(<span class="params">o</span>)&#123;</span><br><span class="line">  <span class="comment">//声明过度函数对象</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">  <span class="comment">//过度对象的原型继承父对象</span></span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="comment">//返回过渡对象的一个实例，该实例的原型继承了父对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//寄生式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createBook</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    <span class="comment">//通过原型继承方式创建新对象</span></span><br><span class="line">    <span class="keyword">var</span> clone = <span class="title function_">inheritObject</span>(obj);</span><br><span class="line">    clone.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> book = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&quot;小明&quot;</span>,</span><br><span class="line">  <span class="attr">alikeBook</span>:[<span class="string">&quot;C语言&quot;</span>,<span class="string">&quot;c++程序设计&quot;</span>,<span class="string">&quot;java程序设计&quot;</span>,<span class="string">&quot;数据结构&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="title function_">createBook</span>(book);</span><br><span class="line"></span><br><span class="line">person1.<span class="property">name</span> = <span class="string">&quot;小刚&quot;</span>;</span><br><span class="line">person1.<span class="property">alikeBook</span>.<span class="title function_">push</span>(<span class="string">&quot;sql server数据库&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="title function_">createBook</span>(book);</span><br><span class="line">person2.<span class="property">name</span> = <span class="string">&quot;小花&quot;</span>;</span><br><span class="line">person2.<span class="property">alikeBook</span>.<span class="title function_">push</span>(<span class="string">&quot;Android程序开发&quot;</span>);</span><br><span class="line"></span><br><span class="line">person1.<span class="title function_">getName</span>();<span class="comment">//小刚</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br><span class="line"></span><br><span class="line">person2.<span class="title function_">getName</span>();<span class="comment">//小花</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">name</span>);<span class="comment">//小明</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(book.<span class="property">alikeBook</span>);<span class="comment">//[&quot;C语言&quot;, &quot;c++程序设计&quot;, &quot;java程序设计&quot;, &quot;数据结构&quot;, &quot;sql server数据库&quot;, &quot;Android程序开发&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>使用寄生式继承来为对象添加函数，会由于不能做到函数复用而降低效率，这一点与构造函数模式类似</li>
</ol>
<h2 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h2><p>对子类原型的处理，被赋予了父类原型的一个引用，这是一个对象。</p>
<p><strong>注意：</strong> 子类再想添加原型方法必须通过<code>prototype.</code>对象，通过点语法的形式一个一个添加方法，否则直接赋予对象就会覆盖掉从父类原型继承的对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//原型式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritObject</span>(<span class="params">o</span>)&#123;</span><br><span class="line">  <span class="comment">//声明过度函数对象</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">  <span class="comment">//过度对象的原型继承父对象</span></span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="comment">//返回过渡对象的一个实例，该实例的原型继承了父对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 寄生式继承 继承原型</span></span><br><span class="line"><span class="comment">// 传递参数 subClass 子类</span></span><br><span class="line"><span class="comment">// 传递参数 superClass 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">subClass,superClass</span>)&#123;</span><br><span class="line">  <span class="comment">//复制父类的原型副本保存在变量中</span></span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="title function_">inheritObject</span>(superClass.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  <span class="comment">//修正因为重写子类原型导致子类的constructor属性被修改</span></span><br><span class="line">  prototype.<span class="property">constructor</span> = subClass;</span><br><span class="line">  <span class="comment">//设置子类的原型</span></span><br><span class="line">  subClass.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuperClass</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">books</span> = [<span class="string">&quot;数据结构&quot;</span>,<span class="string">&quot;数据库设计&quot;</span>,<span class="string">&quot;操作系统&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义父类原型方法</span></span><br><span class="line"><span class="title class_">SuperClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubClass</span>(<span class="params">name,time</span>)&#123;</span><br><span class="line">  <span class="title class_">SuperClass</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">time</span> = time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//寄生式继承父类原型</span></span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">SubClass</span>,<span class="title class_">SuperClass</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类新增原型方法</span></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getTime</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">time</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="string">&quot;软件工程&quot;</span>,<span class="number">2015</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="string">&quot;计算机与科学&quot;</span>,<span class="number">2016</span>);</span><br><span class="line"></span><br><span class="line">instance1.<span class="property">books</span>.<span class="title function_">push</span>(<span class="string">&quot;c#程序设计&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="property">books</span>);<span class="comment">//[&quot;数据结构&quot;, &quot;数据库设计&quot;, &quot;操作系统&quot;, &quot;c#程序设计&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance2.<span class="property">books</span>);<span class="comment">// [&quot;数据结构&quot;, &quot;数据库设计&quot;, &quot;操作系统&quot;]</span></span><br><span class="line">instance2.<span class="title function_">getName</span>();<span class="comment">//计算机与科学</span></span><br><span class="line">instance2.<span class="title function_">getTime</span>();<span class="comment">//2016</span></span><br></pre></td></tr></table></figure>

<h3 id="继承原理"><a href="#继承原理" class="headerlink" title="继承原理"></a>继承原理</h3><p><img src="https://imagesrc.oss-cn-shenzhen.aliyuncs.com/notes/20180407173905.png" alt="image"></p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ol>
<li>只调用了一次<code>SuperClass</code>构造函数</li>
<li>并且避免了在<code>SubClass.prototype</code>上面创建不必要的、多余属性。</li>
<li>与此同时原型链还能保持不变</li>
</ol>
<h2 id="Class继承"><a href="#Class继承" class="headerlink" title="Class继承"></a><code>Class</code>继承</h2><p><code>Class</code>通过 <code>extends</code>关键字实现继承</p>
<p><code>ES6</code>规定通过<code>super</code>调用父类的方法时，<code>super</code>会绑定子类的<code>this</code></p>
<h3 id="super的作用"><a href="#super的作用" class="headerlink" title="super的作用"></a>super的作用</h3><ol>
<li><code>super</code>作为函数调用时代表父类的构造函数,<code>ES6</code>要求子类的构造函数必须执行一次<code>super</code>函数</li>
<li><code>super</code>作为对象用在静态方法之中，这时<code>super</code>将指向父类，而不是父类的原型对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SuperClass</span> &#123;</span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">	<span class="title function_">constructor</span> (xAxis,yAxis,name)&#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">name</span>= name||<span class="string">&quot;SuperClass&quot;</span>;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">xAxis</span> = xAxis;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">yAxis</span> = yAxis;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//静态方法</span></span><br><span class="line">	<span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`static : <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> =&gt;`</span>+msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//普通方法</span></span><br><span class="line">	<span class="title function_">getName</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`instance: <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> =&gt;`</span>+msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印坐标</span></span><br><span class="line">	<span class="title function_">printCoordinate</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">`当前坐标是：(<span class="subst">$&#123;<span class="variable language_">this</span>.xAxis&#125;</span>,<span class="subst">$&#123;<span class="variable language_">this</span>.yAxis&#125;</span>)`</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">SuperClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getTime</span> = <span class="keyword">function</span>(<span class="params">time</span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前时间是：&quot;</span>,time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">SuperClass</span>&#123;</span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">	<span class="title function_">constructor</span> (xAxis,yAxis,name,time) &#123;</span><br><span class="line">		<span class="comment">//super表示父类的构造函数，用来新建父类的`this`对象</span></span><br><span class="line">		<span class="variable language_">super</span>(xAxis, yAxis);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">		<span class="variable language_">super</span>.<span class="title function_">getTime</span>(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//静态方法</span></span><br><span class="line">	<span class="keyword">static</span> <span class="title function_">getName</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">		<span class="comment">//super指向父类</span></span><br><span class="line">		<span class="variable language_">super</span>.<span class="title function_">getName</span>(msg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//普通方法</span></span><br><span class="line">	<span class="title function_">getName</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">		<span class="comment">//super指向父类的原型对象</span></span><br><span class="line">		<span class="variable language_">super</span>.<span class="title function_">getName</span>(msg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印信息</span></span><br><span class="line">	<span class="title function_">printCoordinate</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="comment">//调用父类的 printCoordinate方法</span></span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>：<span class="subst">$&#123;<span class="variable language_">super</span>.printCoordinate()&#125;</span>`</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">SuperClass</span>(<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> <span class="title class_">SubClass</span>(<span class="number">100</span>,<span class="number">200</span>,<span class="string">&quot;小明&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1.<span class="title function_">printCoordinate</span>());<span class="comment">//当前坐标是：(10,20)</span></span><br><span class="line">instance2.<span class="title function_">printCoordinate</span>();<span class="comment">//小明：当前坐标是：(100,200)</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">SubClass</span>.<span class="title function_">getName</span>(<span class="string">&quot;区块链&quot;</span>);<span class="comment">//static : SubClass =&gt;区块链</span></span><br><span class="line">instance2.<span class="title function_">getName</span>(<span class="string">&quot;持续部署&quot;</span>);<span class="comment">//instance: 小明 =&gt;持续部署</span></span><br></pre></td></tr></table></figure>

<h3 id="类的prototype属性和-proto-属性"><a href="#类的prototype属性和-proto-属性" class="headerlink" title="类的prototype属性和__proto__属性"></a>类的<code>prototype</code>属性和<code>__proto__</code>属性</h3><p><code>Class</code>作为构造函数的语法糖，同时有<code>prototype</code>属性和<code>__proto__</code>属性，因此同时存在两条继承链</p>
<ol>
<li>子类的<code>__proto__</code>属性表示构造函数的继承，总是指向父类</li>
<li>子类的<code>prototype</code>属性的<code>__proto__</code>属性表示方法的继承，总是指向父类的<code>prototype</code>属性</li>
</ol>
<h4 id="Object-setPrototypeOf"><a href="#Object-setPrototypeOf" class="headerlink" title="Object.setPrototypeOf() "></a><code>Object.setPrototypeOf() </code></h4><p><code>Object.setPrototypeOf()</code> 方法设置一个指定的对象的原型 ( 即, 内部<code>[[Prototype]]</code>属性）到另一个对象或  <code>null</code></p>
<p><code>Object.setPrototypeOf()</code>是<code>ECMAScript 6</code>最新草案中的方法，相对于<code>Object.prototype.__proto__</code>，它被认为是修改对象原型更合适的方法</p>
<h4 id="继承的实现"><a href="#继承的实现" class="headerlink" title="继承的实现"></a>继承的实现</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> = <span class="keyword">function</span>(<span class="params">obj,proto</span>)&#123;</span><br><span class="line">    obj.<span class="property">__proto__</span> = proto;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义类A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="comment">//定义类B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;&#125;</span><br><span class="line"><span class="comment">//B的实例继承A的实例</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(B.<span class="property"><span class="keyword">prototype</span></span>,A.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="comment">//B的实例继承A的静态属性</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(B,A);</span><br><span class="line"><span class="keyword">const</span> instance1 = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line"><span class="keyword">const</span> instance2 = <span class="keyword">new</span> <span class="title function_">B</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*********************测试代码************************/</span></span><br><span class="line">B.<span class="property">__proto__</span> === A <span class="comment">//true 作为一个对象，子类(`B`)的原型(`__proto__`属性)是父类`A`</span></span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === A.<span class="property"><span class="keyword">prototype</span></span> <span class="comment">//true 作为一个构造函数，子类(`B`)的原型(`prototype`属性)是父类的实例</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="property">__proto__</span> === instance2.<span class="property">__proto__</span>.<span class="property">__proto__</span> <span class="comment">//true</span></span><br><span class="line"><span class="comment">//子类实例的__proto__属性的__proto__属性指向父类的__proto__属性，也就是子类的原型的原型是父类的原型</span></span><br></pre></td></tr></table></figure>

<p>可理解为：</p>
<ol>
<li>作为一个对象，子类(<code>B</code>)的原型(<code>__proto__</code>属性)是父类<code>A</code></li>
<li>作为一个构造函数，子类(<code>B</code>)的原型(<code>prototype</code>属性)是父类的实例</li>
<li>子类实例的<code>__proto__</code>属性的<code>__proto__</code>属性指向父类的<code>__proto__</code>属性，也就是子类的原型的原型是父类的原型</li>
</ol>
<h2 id="原生构造函数的继承"><a href="#原生构造函数的继承" class="headerlink" title="原生构造函数的继承"></a>原生构造函数的继承</h2><p>原生构造函数如：<code>Array/Error/Object/...</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VersionArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="comment">//储存历史记录</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span> = [ [<span class="number">0</span>,<span class="number">0</span>] ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交方法</span></span><br><span class="line">    commit () &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="title function_">slice</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//还原</span></span><br><span class="line">    <span class="title function_">revert</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">splice</span>(<span class="number">0</span>,<span class="variable language_">this</span>.<span class="property">length</span>,...<span class="variable language_">this</span>.<span class="property">history</span>[<span class="variable language_">this</span>.<span class="property">history</span>.<span class="property">length</span>-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> <span class="title class_">VersionArray</span>();</span><br><span class="line">instance1.<span class="title function_">push</span>(<span class="number">1</span>);</span><br><span class="line">instance1.<span class="title function_">push</span>(<span class="number">2</span>);</span><br><span class="line">instance1.<span class="property">history</span>; <span class="comment">// [[0,0]]</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="title function_">commit</span>();</span><br><span class="line">instance1.<span class="property">history</span>;<span class="comment">//[[0,0],[1,2]]</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="title function_">push</span>(<span class="number">3</span>);</span><br><span class="line">instance1; <span class="comment">//[1,2,3]</span></span><br><span class="line"></span><br><span class="line">instance1.<span class="title function_">revert</span>()</span><br><span class="line">instance1 <span class="comment">//[[0,0],[1,2]]</span></span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto"><code>__proto__</code> MDN</a></li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>页面布局</title>
    <url>/2018/01/01/%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80/</url>
    <content><![CDATA[<h2 id="两列左侧定宽，右侧自适应"><a href="#两列左侧定宽，右侧自适应" class="headerlink" title="两列左侧定宽，右侧自适应"></a>两列左侧定宽，右侧自适应</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.aside</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">position</span>:relative;<span class="attribute">margin-right</span>:-<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-container</span>&#123;<span class="attribute">margin-left</span>:<span class="number">210px</span>;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;aside&quot;</span>&gt;</span></span><br><span class="line">        aside</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;main-container&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h2 id="两列右侧定宽，左侧自适应"><a href="#两列右侧定宽，左侧自适应" class="headerlink" title="两列右侧定宽，左侧自适应"></a>两列右侧定宽，左侧自适应</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.aside</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">position</span>:relative;<span class="attribute">margin-left</span>:-<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-container</span>&#123;<span class="attribute">margin-right</span>:<span class="number">210px</span>;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;main-container&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;aside&quot;</span>&gt;</span></span><br><span class="line">        aside</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三列右侧自适应布局"><a href="#三列右侧自适应布局" class="headerlink" title="三列右侧自适应布局"></a>三列右侧自适应布局</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>,<span class="selector-class">.sidenav</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">position</span>:relative;<span class="attribute">box-sizing</span>: border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">width</span>:<span class="number">60px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidenav</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">width</span>:<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">margin-left</span>:-<span class="number">260px</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-container</span>&#123;<span class="attribute">margin-left</span>:<span class="number">270px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid green;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sidebar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">        sidebar</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sidenav --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidenav&quot;</span>&gt;</span></span><br><span class="line">        sidenav</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;main-container&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三列左侧自适应布局"><a href="#三列左侧自适应布局" class="headerlink" title="三列左侧自适应布局"></a>三列左侧自适应布局</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>,<span class="selector-class">.sidenav</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">position</span>:relative;<span class="attribute">box-sizing</span>: border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">width</span>:<span class="number">60px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidenav</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">width</span>:<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">margin-right</span>:-<span class="number">260px</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-container</span>&#123;<span class="attribute">margin-right</span>:<span class="number">270px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid green;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sidebar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">        sidebar</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sidenav --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidenav&quot;</span>&gt;</span></span><br><span class="line">        sidenav</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;main-container&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三列中间自适应布局"><a href="#三列中间自适应布局" class="headerlink" title="三列中间自适应布局"></a>三列中间自适应布局</h2><h3 id="margin负值法"><a href="#margin负值法" class="headerlink" title="margin负值法"></a>margin负值法</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>,<span class="selector-class">.sidenav</span>&#123;<span class="attribute">position</span>:relative;<span class="attribute">box-sizing</span>: border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidebar</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">width</span>:<span class="number">60px</span>;<span class="attribute">margin-right</span>:-<span class="number">100%</span>&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sidenav</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">margin-left</span>:-<span class="number">100%</span>&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-container</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid green;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">margin-left</span>:<span class="number">60px</span>;<span class="attribute">margin-right</span>:<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sidebar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">        sidebar</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">article</span> <span class="attr">class</span>=<span class="string">&quot;main-container&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- sidenav --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aside</span> <span class="attr">class</span>=<span class="string">&quot;sidenav&quot;</span>&gt;</span></span><br><span class="line">        sidenav</span><br><span class="line">    <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="圣杯布局"><a href="#圣杯布局" class="headerlink" title="圣杯布局"></a>圣杯布局</h3><p>三列中间自适应布局</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span>,<span class="selector-class">.middle</span>,<span class="selector-class">.right</span>&#123;<span class="attribute">position</span>: relative;<span class="attribute">float</span>: left;<span class="attribute">box-sizing</span>:border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.middle</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">padding-left</span>:<span class="number">100px</span>;<span class="attribute">padding-right</span>:<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">margin-left</span>:-<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.right</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid green;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">margin-left</span>:-<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span>middle<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="双飞翼布局"><a href="#双飞翼布局" class="headerlink" title="双飞翼布局"></a>双飞翼布局</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>,<span class="selector-class">.sub</span>,<span class="selector-class">.extra</span>&#123;<span class="attribute">float</span>: left;<span class="attribute">box-sizing</span>:border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">width</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main-inner</span>&#123;<span class="attribute">margin-left</span>:<span class="number">100px</span>;<span class="attribute">margin-right</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sub</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">margin-left</span>:-<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.extra</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid green;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">margin-left</span>:-<span class="number">200px</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main-inner&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sub&quot;</span>&gt;</span>sub<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;extra&quot;</span>&gt;</span>extra<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="浮动布局"><a href="#浮动布局" class="headerlink" title="浮动布局"></a>浮动布局</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>,<span class="selector-class">.sub</span>,<span class="selector-class">.extra</span>&#123;<span class="attribute">box-sizing</span>:border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">margin-left</span>: <span class="number">100px</span>;<span class="attribute">margin-right</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sub</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.extra</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid green;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sub&quot;</span>&gt;</span>sub<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;extra&quot;</span>&gt;</span>extra<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="定位布局"><a href="#定位布局" class="headerlink" title="定位布局"></a>定位布局</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sub</span>,<span class="selector-class">.extra</span>&#123;<span class="attribute">position</span>:absolute;<span class="attribute">top</span>:<span class="number">0</span>; <span class="attribute">box-sizing</span>:border-box;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sub</span>&#123;<span class="attribute">left</span>:<span class="number">0</span>;<span class="attribute">width</span>:<span class="number">100px</span>; <span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.extra</span>&#123;<span class="attribute">right</span>:<span class="number">0</span>;<span class="attribute">width</span>:<span class="number">200px</span>; <span class="attribute">border</span>:<span class="number">1px</span> solid green;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">margin-left</span>: <span class="number">100px</span>;<span class="attribute">margin-right</span>:<span class="number">200px</span>; <span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sub&quot;</span>&gt;</span>sub<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;extra&quot;</span>&gt;</span>extra<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="margin与padding互冲等高"><a href="#margin与padding互冲等高" class="headerlink" title="margin与padding互冲等高"></a>margin与padding互冲等高</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">border</span>:<span class="number">1px</span> solid black;&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span>,<span class="selector-class">.main</span>,<span class="selector-class">.right</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">padding-bottom</span>:<span class="number">99999px</span>;<span class="attribute">margin-bottom</span>:-<span class="number">99999px</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span> &#123;<span class="attribute">width</span>: <span class="number">100px</span>;<span class="attribute">background-color</span>:<span class="number">#ddd</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">width</span>:<span class="number">300px</span>;<span class="attribute">background-color</span>:blue;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.right</span>&#123;<span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">background-color</span>:red;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span> left<span class="tag">&lt;<span class="name">br</span>/&gt;</span> left<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span>  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;<span class="name">br</span>/&gt;</span>right<span class="tag">&lt;<span class="name">br</span>/&gt;</span>  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="边界等高"><a href="#边界等高" class="headerlink" title="边界等高"></a>边界等高</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">border</span>:<span class="number">1px</span> solid black;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">background-color</span>:blue;<span class="attribute">width</span>:<span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-left</span>:<span class="number">100px</span> solid <span class="number">#0f0</span>; <span class="comment">/* 边框大小等于左边栏宽度，颜色和左边栏背景色一致*/</span></span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-right</span>:<span class="number">200px</span> solid <span class="number">#f00</span>;<span class="comment">/* 边框大小等于右边栏宽度，颜色和右边栏背景色一致*/</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>;<span class="attribute">width</span>:<span class="number">100px</span>; <span class="attribute">margin-left</span>:-<span class="number">100px</span>&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:left</span>; <span class="attribute">width</span>:<span class="number">500px</span>; <span class="attribute">margin-right</span>:-<span class="number">500px</span>; &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.right</span>&#123;<span class="attribute">float</span><span class="selector-pseudo">:right</span>; <span class="attribute">width</span>:<span class="number">200px</span>; <span class="attribute">margin-right</span>:-<span class="number">200px</span>; &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;<span class="name">br</span>/&gt;</span> left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="表格等高"><a href="#表格等高" class="headerlink" title="表格等高"></a>表格等高</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">*&#123;margin:0;padding:0;&#125;</span><br><span class="line">html,body&#123;height:100%;&#125;</span><br><span class="line">.wrap&#123;overflow:hidden;border:1px solid black;&#125;</span><br><span class="line">.main&#123;display:table;&#125;</span><br><span class="line">.left,.content,.right&#123;display:table-cell;&#125;</span><br><span class="line">.left&#123;width:100px;border:1px solid blue;&#125;</span><br><span class="line">.content&#123;width:500px;border:1px solid red;&#125;</span><br><span class="line">.right&#123; width:200px;border:1px solid green;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;<span class="name">br</span>/&gt;</span> left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="flex-等高"><a href="#flex-等高" class="headerlink" title="flex 等高"></a>flex 等高</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.wrap</span>&#123;<span class="attribute">overflow</span>:hidden;<span class="attribute">border</span>:<span class="number">1px</span> solid black;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>&#123;<span class="attribute">display</span>:flex;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.left</span>&#123;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span>&#123;<span class="attribute">width</span>:<span class="number">500px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.right</span>&#123; <span class="attribute">width</span>:<span class="number">200px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid green;&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span>main<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>left<span class="tag">&lt;<span class="name">br</span>/&gt;</span> left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span>left <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>right<span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>页面性能优化</title>
    <url>/2015/09/07/%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul>
<li>雅虎的35条页面优化准则,你大概能说出几条？</li>
<li>这35条准则被分为了7个类,内容(Content) 、服务器(Server) 、 CSS 、 JavaScript 、Cookie 、图片(Images) 、移动应用(Mobile)、</li>
<li>复习一下</li>
</ul>
<h2 id="三十五条黄金定律"><a href="#三十五条黄金定律" class="headerlink" title="三十五条黄金定律"></a>三十五条黄金定律</h2><h3 id="网页内容"><a href="#网页内容" class="headerlink" title="网页内容"></a>网页内容</h3><h4 id="减少http请求次数"><a href="#减少http请求次数" class="headerlink" title="减少http请求次数"></a><a href="https://developer.yahoo.com/performance/rules.html#num_http">减少http请求次数</a></h4><p>80%的响应时间花在下载网页内容(images, stylesheets, javascripts, scripts, flash等),减少请求次数是缩短响应时间的关键！可以通过简化页面设计来减少请求次数，但页面内容较多可以采用以下技巧:</p>
<ol>
<li><strong>捆绑文件</strong>: 现在有很多现成的库可以帮你将多个脚本文件捆绑成一个文件，将多个样式表文件捆绑成一个文件，以此来减少文件的下载次数。例如在asp.net中可以使用ScriptManager，asp.net MVC中的Bundling。</li>
<li><strong>CSS Sprites</strong>: 就是把多个图片拼成一副图片，然后通过CSS来控制在什么地方具体显示这整张图片的什么位置</li>
<li><strong>Image Maps</strong>: 也是将多幅图拼在一起，然后通过坐标来控制显示导航。这里有个经典的例子，选中图片中的某个人就会将你带到不同的链接。</li>
<li><strong>Inline images</strong>: 在实际页面中嵌入图像数据的网址。这可以增加你的HTML文件的大小。内联图像组合到你的样式表（缓存）是一种减少HTTP请求和避免增加页面大小的。如下：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//css 文件</span><br><span class="line">.change&#123;background:url(<span class="string">&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2HxkiAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAwBJREFUeNrs3NGNREAcwOGbsyKUJNGOFnSgEbrwqBsViIi5Cm5z5HYX+b53IX/zy4wXIcb4BXzOtxGACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEgAhBhIAIQYSACEGEwO8eb7vTsizrupr4EyGEPM93XTLP87ZtRncSSZJkWbb7svgubdt6Sc9VVbV3qnVdm9t5NE1zIA3HUfBNCCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIEXuVyf1s78EsyPqjruv9aq9M03XJEdkJwHAURAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRHjOOY7iLvu8tQeyEIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQIfAij8s9cVmWwzDcY/ppmlqCXC/CJEmKovDmcBwFRAgiBEQIIgRECCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIERAgiBEQIIgRECCIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQIiBBECIgQRAiIEEQJ/FmKMpgB2QhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEIQISBCECEgQhAhIEI4jx8BBgBKc9us1uAvqAAAAABJRU5ErkJggg==&#x27;</span>) no-repeat scroll center top;&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
</ol>
<h4 id="减少DNS查询次数"><a href="#减少DNS查询次数" class="headerlink" title="减少DNS查询次数"></a><a href="https://developer.yahoo.com/performance/rules.html#dns_lookups">减少DNS查询次数</a></h4><p>DNS查询也消耗响应时间，如果我们的网页内容来自各个不同的domain (比如嵌入了开放广告，引用了外部图片或脚本)，那么客户端首次解析这些domain也需要消耗一定的时间。DNS查询结果缓存在本地系统和浏览器中一段时间，所以DNS查询一般是对首次访问响应速度有所影响。</p>
<h4 id="避免页面跳转"><a href="#避免页面跳转" class="headerlink" title="避免页面跳转"></a><a href="https://developer.yahoo.com/performance/rules.html#redirects=">避免页面跳转</a></h4><p>当客户端收到服务器的跳转回复时，客户端再次根据服务器回复中的location指定的地址再次发送请求，例如以下跳转回复。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 301 Moved Permanently</span><br><span class="line">Location: http://example.com/newuri</span><br><span class="line">Content-Type: text/html</span><br></pre></td></tr></table></figure>
<p>当客户端遇到这种回复的时候，用户只能等待客户端再次发送请求，有的网站甚至会一直跳n次，跳到他想带你去的地方…当然在这个时候用户看不到任何页面内容，只有浏览器的进度条一直在刷新。</p>
<h4 id="缓存Ajax"><a href="#缓存Ajax" class="headerlink" title="缓存Ajax"></a><a href="https://developer.yahoo.com/performance/rules.html#cacheajax">缓存Ajax</a></h4><p>Ajax可以帮助我们异步的下载网页内容，但是有些网页内容即使是异步的，用户还是在等待它的返回结果，例如ajax的返回是用户联系人的下拉列表。所以我们还是要注意尽量应用以下规则提高ajax的响应速度。</p>
<ul>
<li>添加Expires 或 Cache-Control报文头使回复可以被客户端缓存</li>
<li>压缩回复内容</li>
<li>精简javascript</li>
<li>避免跳转</li>
<li>配置Etags</li>
</ul>
<h4 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a><a href="https://developer.yahoo.com/performance/rules.html#cacheajax">延迟加载</a></h4><p>这里讨论延迟加载需要我们知道我们的网页最初加载需要的最小内容集是什么。剩下的内容就可以推到延迟加载的集合中。<br>Javascript是典型的可以延迟加载内容。一个比较激进的做法是开发网页时先确保网页在没有Javascript的时候也可以基本工作，然后通过延迟加载脚本来完成一些高级的功能。</p>
<h4 id="提前加载"><a href="#提前加载" class="headerlink" title="提前加载"></a><a href="https://developer.yahoo.com/performance/rules.html#preload">提前加载</a></h4><p>与延迟加载目的相反，提前加载的是为了提前加载接下来网页中访问的资源，下面是提前加载的类型</p>
<p><strong>无条件提前加载</strong>：当前网页加载完成后，马上去下载一些其他的内容。例如google会在页面加载成功之后马上去下载一个所有结果中会用到的image sprite。</p>
<p><strong>有条件加载</strong>：根据用户的输入推断需要加载的内容</p>
<p><strong>有预期的的加载</strong>：这种情况一般发生在网页重新设计时，由于用户经常访问旧网页，本地对旧的网页内容缓存充分从而显得旧网页速度很快，而新的网页内容却没有缓存，设计者可以在旧网页的内容中预先加载一些新网页中可能用到的内容，这样新的网页就会生下来一些需要下载的资源。</p>
<h4 id="减少DOM元素数量"><a href="#减少DOM元素数量" class="headerlink" title="减少DOM元素数量"></a><a href="https://developer.yahoo.com/performance/rules.html#min_dom=">减少DOM元素数量</a></h4><p>网页中元素过多对网页的加载和脚本的执行都是沉重的负担，500个元素和5000个元素在加载速度上会有很大差别。<br>想知道你的网页中有多少元素，通过在浏览器中的一条简单命令就可以算出:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">document.getElementsByTagName(<span class="string">&#x27;*&#x27;</span>).length</span><br></pre></td></tr></table></figure>
<h4 id="根据域名划分内容"><a href="#根据域名划分内容" class="headerlink" title="根据域名划分内容"></a><a href="https://developer.yahoo.com/performance/rules.html#split">根据域名划分内容</a></h4><p>浏览器一般对同一个域的下载连接数有所限制，按照域名划分下载内容可以浏览器增大并行下载连接，但是注意控制域名使用在2-4个之间，不然dns查询也是个问题。</p>
<p>一般网站规划会将静态资源放在类似于static.example.com，动态内容放在<a href="http://www.example.com上.这样做还有一个好处是可以在静态的域名上避免使用cookie.后面我们会在cookie的规则中提到./">www.example.com上。这样做还有一个好处是可以在静态的域名上避免使用cookie。后面我们会在cookie的规则中提到。</a></p>
<h4 id="减少iframe数量"><a href="#减少iframe数量" class="headerlink" title="减少iframe数量"></a><a href="https://developer.yahoo.com/performance/rules.html#iframes">减少iframe数量</a></h4><p>使用iframe要注意理解iframe的优缺点<br><strong>优点</strong></p>
<ul>
<li>可以用来加载速度较慢的内容，例如广告。</li>
<li>安全沙箱保护。浏览器会对iframe中的内容进行安全控制。</li>
<li>脚本可以并行下载</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>即使iframe内容为空也消耗加载时间</li>
<li>会阻止页面加载</li>
<li>没有语义</li>
</ul>
<h4 id="避免404"><a href="#避免404" class="headerlink" title="避免404"></a><a href="https://developer.yahoo.com/performance/rules.html#no404">避免404</a></h4><p>404我们都不陌生，代表服务器没有找到资源，我们要特别要注意404的情况不要在我们提供的网页资源上，客户端发送一个请求但是服务器却返回一个无用的结果，时间浪费掉了。</p>
<p>更糟糕的是我们网页中需要加载一个外部脚本，结果返回一个404，不仅阻塞了其他脚本下载，下载回来的内容(404)客户端还会将其当成Javascript去解析。</p>
<h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><h4 id="使用CDN"><a href="#使用CDN" class="headerlink" title="使用CDN"></a><a href="https://developer.yahoo.com/performance/rules.html#cdn">使用CDN</a></h4><p>再次强调第一条黄金定律，减少网页内容的下载时间。提高下载速度还可以通过CDN(内容分发网络)来提升。CDN通过部署在不同地区的服务器来提高客户的下载速度。如果你的网站上有大量的静态内容，世界各地的用户都在访问，我说的是youtube么？那CDN是必不可少的。事实上大多数互联网中的巨头们都有自己的CDN。我们自己的网站可以先通过<a href="https://en.wikipedia.org/wiki/Content_delivery_network#Free_CDNs">免费的CDN供应商</a>来分发网页资源。</p>
<h4 id="添加Expires-或Cache-Control报文头"><a href="#添加Expires-或Cache-Control报文头" class="headerlink" title="添加Expires 或Cache-Control报文头"></a><a href="https://developer.yahoo.com/performance/rules.html#expires">添加Expires 或Cache-Control报文头</a></h4><p><strong>这条规则分为两个方面</strong></p>
<ol>
<li>对于静态内容添加Expires，将静态内容设为永不过期，或者很长时间以后。在IIS中设置Expires可以看<a href="https://technet.microsoft.com/en-us/library/cc754668%28v=WS.10%29.aspx">Configure the HTTP Expires Response Header (IIS 7)</a>。</li>
<li>对于动态内容应用合适的Cache-Control，让浏览器根据条件来发送请求。关于asp.net的caching，可以看<a href="https://msdn.microsoft.com/en-us/library/xsbfdd8c%28v=vs.100%29.aspx">asp.net cache feature</a>和<a href="https://msdn.microsoft.com/en-us/library/aa478965.aspx">asp.net caching best practices</a>。</li>
</ol>
<h4 id="Gzip压缩传输文件"><a href="#Gzip压缩传输文件" class="headerlink" title="Gzip压缩传输文件"></a><a href="https://developer.yahoo.com/performance/rules.html#gzip">Gzip压缩传输文件</a></h4><p>Gzip通常可以减少70%网页内容的大小，包括脚本、样式表、图片等文件。Gzip比deflate更高效，主流服务器都有相应的压缩支持模块。</p>
<p>IIS中内建了静态压缩和动态压缩模块，如何配制可以参考<a href="https://technet.microsoft.com/en-us/library/cc754668%28v=WS.10%29.aspx">Enable HTTP Compression of Static Content (IIS 7)</a>和<a href="https://technet.microsoft.com/en-us/library/cc753681%28v=WS.10%29.aspx">Enable HTTP Compression of Dynamic Content (IIS 7)</a>。</p>
<p>值得注意的是pdf文件可以从需要被压缩的类型中剔除，因为pdf文件本身已经压缩，gzip对其效果不大，而且会浪费CPU。</p>
<h4 id="配置ETags"><a href="#配置ETags" class="headerlink" title="配置ETags"></a><a href="https://developer.yahoo.com/performance/rules.html#etags">配置ETags</a></h4><p>虽然标题叫配制ETags，但是这里你要根据具体情况进行一些判断。首先Etag简单来说是通过一个文件版本标识使得服务器可以轻松判断该请求的内容是否有所更新，如果没有就回复304 (not modified)，从而避免下载整个文件。<br>但是Etags的版本信息即使主流服务器未能很好地支持跨服务器的判断，比如你从一个服务器集群中一台得到Etags，然后发送到了另一台那么校验很有可能会失败。</p>
<p>如果你遇到这样的问题，IIS 7中可以通过如下方法将Etag去掉，使用URL Rewrite，然后在web.config中添加如下配制:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;rewrite&gt;</span><br><span class="line">   &lt;outboundRules&gt;</span><br><span class="line">      &lt;rule name=<span class="string">&quot;Remove ETag&quot;</span>&gt;</span><br><span class="line">         &lt;match serverVariable=<span class="string">&quot;RESPONSE_ETag&quot;</span> pattern=<span class="string">&quot;.+&quot;</span> /&gt;</span><br><span class="line">         &lt;action <span class="built_in">type</span>=<span class="string">&quot;Rewrite&quot;</span> value=<span class="string">&quot;&quot;</span> /&gt;</span><br><span class="line">      &lt;/rule&gt;</span><br><span class="line">   &lt;/outboundRules&gt;</span><br><span class="line">&lt;/rewrite&gt;</span><br></pre></td></tr></table></figure>

<p>IIS8里提供了一个简单配制来直接关闭Etag:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;element name=<span class="string">&quot;clientCache&quot;</span>&gt;</span><br><span class="line">    &lt;attribute name=<span class="string">&quot;cacheControlMode&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;enum&quot;</span> defaultValue=<span class="string">&quot;NoControl&quot;</span>&gt;</span><br><span class="line">       &lt;enum name=<span class="string">&quot;NoControl&quot;</span> value=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line">       &lt;enum name=<span class="string">&quot;DisableCache&quot;</span> value=<span class="string">&quot;1&quot;</span> /&gt;</span><br><span class="line">       &lt;enum name=<span class="string">&quot;UseMaxAge&quot;</span> value=<span class="string">&quot;2&quot;</span> /&gt;</span><br><span class="line">       &lt;enum name=<span class="string">&quot;UseExpires&quot;</span> value=<span class="string">&quot;3&quot;</span> /&gt;</span><br><span class="line">    &lt;/attribute&gt;</span><br><span class="line">    &lt;attribute name=<span class="string">&quot;cacheControlMaxAge&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;timeSpan&quot;</span> defaultValue=<span class="string">&quot;1.00:00:00&quot;</span> /&gt;</span><br><span class="line">    &lt;attribute name=<span class="string">&quot;httpExpires&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> /&gt;</span><br><span class="line">    &lt;attribute name=<span class="string">&quot;cacheControlCustom&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span> /&gt;</span><br><span class="line">    &lt;attribute name=<span class="string">&quot;setEtag&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;bool&quot;</span> defaultValue=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">&lt;/element&gt;</span><br></pre></td></tr></table></figure>

<h4 id="尽早flush输出"><a href="#尽早flush输出" class="headerlink" title="尽早flush输出"></a><a href="https://developer.yahoo.com/performance/rules.html#flush">尽早flush输出</a></h4><p>网页后台程序中我们知道有个方法叫<a href="https://msdn.microsoft.com/en-us/library/system.web.httpresponse.flush.aspx">Response.Flush()</a>，一般我们调用它都是在程序末尾，但注意这个方法可以被调用多次。目的是可以将现有的缓存中的回复内容先发给客户端，让客户端“有活干”。</p>
<p>那在什么时候调用这个方法比较好呢？一般情况下我们可以在对于需要加载比较多外部脚本或者样式表时可以提前调用一次，客户端收到了关于脚本或其他外部资源的链接可以并行的先发请求去下载，服务器接下来把后续的处理结果发给客户端。</p>
<h4 id="使用GET-Ajax请求"><a href="#使用GET-Ajax请求" class="headerlink" title="使用GET Ajax请求"></a><a href="https://developer.yahoo.com/performance/rules.html#ajax_get">使用GET Ajax请求</a></h4><p>浏览器在实现XMLHttpRequest POST的时候分成两步，先发header，然后发送数据。而GET却可以用一个TCP报文完成请求。另外GET从语义上来讲是去服务器取数据，而POST则是向服务器发送数据，所以我们使用Ajax请求数据的时候尽量通过GET来完成。<br>关于GET和POST的详细对比可以查看<a href="http://www.w3schools.com/tags/ref_httpmethods.asp">这里</a>。</p>
<h4 id="避免空的图片src"><a href="#避免空的图片src" class="headerlink" title="避免空的图片src"></a><a href="https://developer.yahoo.com/performance/rules.html#emptysrc">避免空的图片src</a></h4><p>空的图片src仍然会使浏览器发送请求到服务器，这样完全是浪费时间，而且浪费服务器的资源。尤其是你的网站每天被很多人访问的时候，这种空请求造成的伤害不容忽略。</p>
<p>浏览器如此实现也是根据RFC 3986 - Uniform Resource Identifiers标准，空的src被定义为当前页面。所以注意我们的网页中是否存在这样的代码:<br><strong>straight HTML</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
<p><strong>JavaScript</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var img = new Image();</span><br><span class="line">img.src = <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><h4 id="减少Cookie大小"><a href="#减少Cookie大小" class="headerlink" title="减少Cookie大小"></a><a href="https://developer.yahoo.com/performance/rules.html#cookie_size">减少Cookie大小</a></h4><p>Cookie被用来做认证或个性化设置，其信息被包含在http报文头中，对于cookie我们要注意以下几点，来提高请求的响应速度，</p>
<ul>
<li>去除没有必要的cookie，如果网页不需要cookie就完全禁掉</li>
<li>将cookie的大小减到最小</li>
<li>注意cookie设置的domain级别，没有必要情况下不要影响到sub-domain</li>
<li>设置合适的过期时间，比较长的过期时间可以提高响应速度。</li>
</ul>
<p>关于asp.net中的cookie可以参考<a href="https://msdn.microsoft.com/en-us/library/ms178194%28v=vs.100%29.aspx">ASP.NET Cookies Overview</a>和<a href="https://technet.microsoft.com/en-us/library/cc754725%28v=ws.10%29.aspx">Configure Use Cookies Mode for Session State (IIS 7)</a></p>
<h4 id="页面内容使用无cookie域名"><a href="#页面内容使用无cookie域名" class="headerlink" title="页面内容使用无cookie域名"></a><a href="https://developer.yahoo.com/performance/rules.html#cookie_free">页面内容使用无cookie域名</a></h4><p>大多数网站的静态资源都没必要cookie，我们可以采用不同的domain来单独存放这些静态文件，这样做不仅可以减少cookie大小从而提高响应速度，还有一个好处是有些proxy拒绝缓存带有cookie的内容，如果能将这些静态资源cookie去除，那就可以得到这些proxy的缓存支持。</p>
<p>常见的划分domain的方式是将静态文件放在static.example.com，动态内容放在<a href="http://www.example.com./">www.example.com。</a></p>
<p>也有一些网站需要在二级域名上应用cookie，所有的子域都会继承，这种情况下一般会再购买一个专门的域名来存放cookie-free的静态资源。例如Yahoo!的yimg.com，YouTube的ytimg.com等。</p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="将样式表置顶"><a href="#将样式表置顶" class="headerlink" title="将样式表置顶"></a><a href="https://developer.yahoo.com/performance/rules.html#css_top=">将样式表置顶</a></h4><p>经样式表(css)放在网页的HEAD中会让网页显得加载速度更快，因为这样做可以使浏览器逐步加载已将下载的网页内容。这对内容比较多的网页尤其重要，用户不用一直等待在一个白屏上，而是可以先看已经下载的内容。</p>
<p>如果将样式表放在底部，浏览器会拒绝渲染已经下载的网页，因为大多数浏览器在实现时都努力避免重绘，样式表中的内容是绘制网页的关键信息，没有下载下来之前只好对不起观众了。</p>
<h4 id="避免CSS表达式"><a href="#避免CSS表达式" class="headerlink" title="避免CSS表达式"></a><a href="https://developer.yahoo.com/performance/rules.html#css_expressions">避免CSS表达式</a></h4><p>CSS表达式可以动态的设置CSS属性，在IE5-IE8中支持，其他浏览器中表达式会被忽略。例如下面表达式在不同时间设置不同的背景颜色。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CSS表达式可以动态的设置CSS属性，在IE5-IE8中支持，其他浏览器中表达式会被忽略。例如下面表达式在不同时间设置不同的背景颜色。</span><br></pre></td></tr></table></figure>
<p>CSS表达式的问题在于它被重新计算的次数远比我们想象的要多，不仅在网页绘制或大小改变时计算，即使我们滚动屏幕或者移动鼠标的时候也在计算，因此我们还是尽量避免使用它来防止使用不当而造成的性能损耗。</p>
<h4 id="用代替-import"><a href="#用代替-import" class="headerlink" title="用代替@import"></a><a href="https://developer.yahoo.com/performance/rules.html#csslink">用<link>代替@import</a></h4><p>避免使用@import的原因很简单，因为它相当于将css放在网页内容底部。</p>
<h4 id="避免使用Filters"><a href="#避免使用Filters" class="headerlink" title="避免使用Filters"></a><a href="https://developer.yahoo.com/performance/rules.html#no_filters">避免使用Filters</a></h4><p><a href="https://msdn.microsoft.com/en-us/library/ms532969%28v=vs.85%29.aspx">AlphaImageLoad</a>也是IE5.5 - IE8中支持，这种滤镜的使用会导致图片在下载的时候阻塞网页绘制，另外使用这种滤镜会导致内存使用量的问题。IE9中已经不再支持。</p>
<h3 id="Javascript"><a href="#Javascript" class="headerlink" title="Javascript"></a>Javascript</h3><h4 id="将脚本置底"><a href="#将脚本置底" class="headerlink" title="将脚本置底"></a><a href="https://developer.yahoo.com/performance/rules.html#js_bottom">将脚本置底</a></h4><p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1.4">HTTP&#x2F;1.1 specification</a>建议浏览器对同一个hostname不要超过两个并行下载连接， 所以当你从多个domain下载图片的时候可以提高并行下载连接数量。但是当脚本在下载的时候，即使是来自不同的hostname浏览器也不会下载其他资源，因为浏览器要在脚本下载之后依次解析和执行。</p>
<p>因此对于脚本提速，我们可以考虑以下方式:</p>
<ul>
<li>把脚本置底，这样可以让网页渲染所需要的内容尽快加载显示给用户。</li>
<li>现在主流浏览器都支持<a href="http://www.w3school.com.cn/tags/att_script_defer.asp">defer</a>关键字，可以指定脚本在文档加载后执行。</li>
<li>HTML5中新加了async关键字，可以让脚本异步执行。</li>
</ul>
<h4 id="使用外部Javascirpt和CSS文件"><a href="#使用外部Javascirpt和CSS文件" class="headerlink" title="使用外部Javascirpt和CSS文件"></a><a href="https://developer.yahoo.com/performance/rules.html#external">使用外部Javascirpt和CSS文件</a></h4><p>使用外部Javascript和CSS文件可以使这些文件被浏览器缓存，从而在不同的请求内容之间重用。</p>
<p>同时将Javascript和CSS从inline变为external也减小了网页内容的大小。</p>
<p>使用外部Javascript和CSS文件的决定因素在于这些外部文件的重用率，如果用户在浏览我们的页面时会访问多次相同页面或者可以重用脚本的不同页面，那么外部文件形式可以为你带来很大的好处。但对于用户通常只会访问一次的页面，例如microsoft.com首页，那inline的javascript和css相对来说可以提供更高的效率。</p>
<h4 id="精简Javascript和CSS"><a href="#精简Javascript和CSS" class="headerlink" title="精简Javascript和CSS"></a><a href="https://developer.yahoo.com/performance/rules.html#minify">精简Javascript和CSS</a></h4><p>精简就是将Javascript或CSS中的空格和注释全去掉，使用压缩工具,来缩小css&#x2F;js代码体积。</p>
<h4 id="去除重复脚本"><a href="#去除重复脚本" class="headerlink" title="去除重复脚本"></a><a href="https://developer.yahoo.com/performance/rules.html#js_dupes">去除重复脚本</a></h4><p>重复的脚本不仅浪费浏览器的下载时间，而且浪费解析和执行时间。一般用来避免引入重复脚本的做法是使用统一的脚本管理模块，这样不仅可以避免重复脚本引入，还可以兼顾脚本依赖管理和版本管理。</p>
<h4 id="减少DOM访问"><a href="#减少DOM访问" class="headerlink" title="减少DOM访问"></a><a href="https://developer.yahoo.com/performance/rules.html#dom_access">减少DOM访问</a></h4><p>通过Javascript访问DOM元素没有我们想象中快，元素多的网页尤其慢，对于Javascript对DOM的访问我们要注意</p>
<ul>
<li>缓存已经访问过的元素</li>
<li>Offline更新节点然后再加回DOM Tree</li>
<li>避免通过Javascript修复layout</li>
</ul>
<h4 id="使用智能事件处理"><a href="#使用智能事件处理" class="headerlink" title="使用智能事件处理"></a><a href="https://developer.yahoo.com/performance/rules.html#events">使用智能事件处理</a></h4><p>这里说智能的事件处理需要开发者对事件处理有更深入的了解，通过不同的方式尽量少去触发事件，如果必要就尽早的去处理事件。</p>
<p>比如一个div中10个按钮都需要事件句柄，那么我们可以将事件放在div上，在事件冒泡过程中捕获该事件然后判断事件来源。</p>
<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><h4 id="优化图像"><a href="#优化图像" class="headerlink" title="优化图像"></a><a href="https://developer.yahoo.com/performance/rules.html#opt_images=">优化图像</a></h4><p>当美工完成了网站的图片设计后，我们可以在上传图片之前对其做以下优化:</p>
<ul>
<li>检查GIF图片中图像颜色的数量是否和调色板规格一致。如果你发现图片中只用到了4种颜色，而在调色板的中显示的256色的颜色槽，那么这张图片就还有压缩的空间。可以使用<a href="http://www.imagemagick.org/script/index.php">imagemagick</a>检查：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">identify -verbose image.gif</span><br></pre></td></tr></table></figure></li>
<li>尝试把GIF格式转换成PNG格式，看看是否节省空间。大多数情况下是可以压缩的。下面这条简单的命令可以安全地把GIF格式转换为PNG格式：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">convert image.gif image.png</span><br></pre></td></tr></table></figure></li>
<li>在所有的PNG图片上运行<a href="http://pmt.sourceforge.net/pngcrush/">pngcrush</a>（或者其它PNG优化工具）。例如：<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pngcrush image.png -rem alla -reduce -brute result.png</span><br></pre></td></tr></table></figure></li>
<li>在所有的JPEG图片上运行jpegtran。这个工具可以对图片中的出现的锯齿等做无损操作，同时它还可以用于优化和清除图片中的注释以及其它无用信息<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jpegtran -copy none -optimize -perfect src.jpg dest.jpg</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="优化CSS-Sprite"><a href="#优化CSS-Sprite" class="headerlink" title="优化CSS Sprite"></a><a href="https://developer.yahoo.com/performance/rules.html#opt_sprites">优化CSS Sprite</a></h4><ul>
<li>Spirite中水平排列图片，垂直排列会增加文件大小；</li>
<li>Spirite中把颜色较近的组合在一起可以降低颜色数，理想状况是低于256色以便适用PNG8格式；</li>
<li>不要在Spirite的图像中间留有较大空隙。这虽然不大会增加文件大小,但对于用户代理来说它需要更少的内存来把图片解压为像素地图。100×100的图片为1万像素，1000×1000就是100万像素。</li>
</ul>
<h4 id="不要在HTML中缩放图片"><a href="#不要在HTML中缩放图片" class="headerlink" title="不要在HTML中缩放图片"></a><a href="https://developer.yahoo.com/performance/rules.html#no_scale">不要在HTML中缩放图片</a></h4><p>不要通过图片缩放来适应页面，如果你需要小图片，就直接使用小图片吧。</p>
<h4 id="使用小且可缓存的favicon-ico"><a href="#使用小且可缓存的favicon-ico" class="headerlink" title="使用小且可缓存的favicon.ico"></a><a href="https://developer.yahoo.com/performance/rules.html#favicon">使用小且可缓存的favicon.ico</a></h4><p>网站图标文件favicon.ico，不管你服务器有还是没有，浏览器都会去尝试请求这个图标。所以我们要确保这个图标</p>
<ul>
<li>存在</li>
<li>文件尽量小，最好小于1k</li>
<li>设置一个长的过期时间</li>
</ul>
<h3 id="移动客户端"><a href="#移动客户端" class="headerlink" title="移动客户端"></a>移动客户端</h3><h4 id="保持单个内容小于25KB"><a href="#保持单个内容小于25KB" class="headerlink" title="保持单个内容小于25KB"></a><a href="https://developer.yahoo.com/performance/rules.html#under25">保持单个内容小于25KB</a></h4><p>这限制是因为iphone，他只能缓存小于25K，注意这是解压后的大小。所以单纯gzip不一定够用，精简文件工具要用上了。</p>
<h4 id="打包组建成符合文档"><a href="#打包组建成符合文档" class="headerlink" title="打包组建成符合文档"></a><a href="https://developer.yahoo.com/performance/rules.html#multipart">打包组建成符合文档</a></h4><p>把页面内容打包成复合文本就如同带有多附件的Email，它能够使你在一个HTTP请求中取得多个组建。当你使用这条规则时，首先要确定用户代理是否支持（iPhone不支持）。</p>
<h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><ul>
<li>英文参考链接 <a href="https://developer.yahoo.com/performance/rules.html">雅虎35条黄金准则</a></li>
<li>中文参考链接 <a href="http://www.cnblogs.com/developersupport/p/webpage-performance-best-practices.html">微软互联网开发支持</a></li>
<li>感谢 @微软互联网开发支持 的中文翻译</li>
</ul>
]]></content>
      <categories>
        <category>seo</category>
      </categories>
      <tags>
        <tag>seo</tag>
      </tags>
  </entry>
  <entry>
    <title>鼠标拖动物体移动</title>
    <url>/2016/05/08/%E9%BC%A0%E6%A0%87%E6%8B%96%E5%8A%A8%E7%89%A9%E4%BD%93%E7%A7%BB%E5%8A%A8/</url>
    <content><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ol>
<li>鼠标滚轮实现缩放</li>
<li>鼠标拖动物体，移动</li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class MouseMoveCube : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">    private void <span class="function"><span class="title">Start</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        StartCoroutine(OnMouseDown());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void <span class="function"><span class="title">Update</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        ZoomCube();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void <span class="function"><span class="title">ZoomCube</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line">        //projection:投射方式</span><br><span class="line"></span><br><span class="line">        //zoom out</span><br><span class="line">        <span class="keyword">if</span> (Input.GetAxis(<span class="string">&quot;Mouse ScrollWheel&quot;</span>) &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            //Perspective：透视</span><br><span class="line">            <span class="keyword">if</span> (Camera.main.fieldOfView &lt;= 80)</span><br><span class="line">            &#123;</span><br><span class="line">                Camera.main.fieldOfView += 2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //Orthographic：正交</span><br><span class="line">            <span class="keyword">if</span> (Camera.main.orthographicSize &lt;= 18)</span><br><span class="line">            &#123;</span><br><span class="line">                Camera.main.orthographicSize += 0.5f;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //zoom <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> (Input.GetAxis(<span class="string">&quot;Mouse ScrollWheel&quot;</span>) &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Camera.main.fieldOfView &gt;= 2)</span><br><span class="line">            &#123;</span><br><span class="line">                Camera.main.fieldOfView -= 2;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Camera.main.orthographicSize &gt;= 1)</span><br><span class="line">            &#123;</span><br><span class="line">                Camera.main.orthographicSize -= 0.5f;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IEnumerator <span class="function"><span class="title">OnMouseDown</span></span>()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        //将物体由世界坐标系转换为屏幕坐标系</span><br><span class="line">        Vector3 screenPostion = Camera.main.WorldToScreenPoint(transform.position);</span><br><span class="line"></span><br><span class="line">        //将鼠标屏幕坐标转为三维坐标，再算出物体位置与鼠标之间的距离(offset)</span><br><span class="line">        Vector3 offset = transform.position-Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y,</span><br><span class="line">                             screenPostion.z));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>( Input.GetMouseButton(0) )</span><br><span class="line">        &#123;</span><br><span class="line">            //当前鼠标位置</span><br><span class="line">            Vector3 curMousePostion = new Vector3(Input.mousePosition.x, Input.mousePosition.y,</span><br><span class="line">                screenPostion.z);</span><br><span class="line"></span><br><span class="line">            //将鼠标位置转换为世界位置，加上偏移量</span><br><span class="line">            Vector3 curPosition = Camera.main.ScreenToWorldPoint(curMousePostion) + offset;</span><br><span class="line"></span><br><span class="line">            //将当前位置赋给世界物体的位置</span><br><span class="line">            transform.position = curPosition;</span><br><span class="line"></span><br><span class="line">            yield <span class="built_in">return</span> new WaitForFixedUpdate();//循环</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="http://unity3d.com/cn/learn/tutorials/modules/beginner/scripting/on-mouse-down">OnMouseDown-Unity</a></li>
</ol>
]]></content>
      <categories>
        <category>unity</category>
      </categories>
      <tags>
        <tag>unity</tag>
      </tags>
  </entry>
</search>
